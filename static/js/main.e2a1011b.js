/*! For license information please see main.e2a1011b.js.LICENSE.txt */
(()=>{var t={43(t,e,r){"use strict";t.exports=r(202)},139(t,e){var r;!function(){"use strict";var n={}.hasOwnProperty;function i(){for(var t="",e=0;e<arguments.length;e++){var r=arguments[e];r&&(t=a(t,s(r)))}return t}function s(t){if("string"===typeof t||"number"===typeof t)return t;if("object"!==typeof t)return"";if(Array.isArray(t))return i.apply(null,t);if(t.toString!==Object.prototype.toString&&!t.toString.toString().includes("[native code]"))return t.toString();var e="";for(var r in t)n.call(t,r)&&t[r]&&(e=a(e,r));return e}function a(t,e){return e?t?t+" "+e:t+e:t}t.exports?(i.default=i,t.exports=i):void 0===(r=function(){return i}.apply(e,[]))||(t.exports=r)}()},153(t,e,r){"use strict";var n=r(43),i=Symbol.for("react.element"),s=Symbol.for("react.fragment"),a=Object.prototype.hasOwnProperty,o=n.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,l={key:!0,ref:!0,__self:!0,__source:!0};function c(t,e,r){var n,s={},c=null,u=null;for(n in void 0!==r&&(c=""+r),void 0!==e.key&&(c=""+e.key),void 0!==e.ref&&(u=e.ref),e)a.call(e,n)&&!l.hasOwnProperty(n)&&(s[n]=e[n]);if(t&&t.defaultProps)for(n in e=t.defaultProps)void 0===s[n]&&(s[n]=e[n]);return{$$typeof:i,type:t,key:c,ref:u,props:s,_owner:o.current}}e.Fragment=s,e.jsx=c,e.jsxs=c},173(t,e,r){t.exports=r(497)()},202(t,e){"use strict";var r=Symbol.for("react.element"),n=Symbol.for("react.portal"),i=Symbol.for("react.fragment"),s=Symbol.for("react.strict_mode"),a=Symbol.for("react.profiler"),o=Symbol.for("react.provider"),l=Symbol.for("react.context"),c=Symbol.for("react.forward_ref"),u=Symbol.for("react.suspense"),h=Symbol.for("react.memo"),d=Symbol.for("react.lazy"),f=Symbol.iterator;var p={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},g=Object.assign,m={};function y(t,e,r){this.props=t,this.context=e,this.refs=m,this.updater=r||p}function v(){}function b(t,e,r){this.props=t,this.context=e,this.refs=m,this.updater=r||p}y.prototype.isReactComponent={},y.prototype.setState=function(t,e){if("object"!==typeof t&&"function"!==typeof t&&null!=t)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,t,e,"setState")},y.prototype.forceUpdate=function(t){this.updater.enqueueForceUpdate(this,t,"forceUpdate")},v.prototype=y.prototype;var _=b.prototype=new v;_.constructor=b,g(_,y.prototype),_.isPureReactComponent=!0;var w=Array.isArray,E=Object.prototype.hasOwnProperty,S={current:null},T={key:!0,ref:!0,__self:!0,__source:!0};function k(t,e,n){var i,s={},a=null,o=null;if(null!=e)for(i in void 0!==e.ref&&(o=e.ref),void 0!==e.key&&(a=""+e.key),e)E.call(e,i)&&!T.hasOwnProperty(i)&&(s[i]=e[i]);var l=arguments.length-2;if(1===l)s.children=n;else if(1<l){for(var c=Array(l),u=0;u<l;u++)c[u]=arguments[u+2];s.children=c}if(t&&t.defaultProps)for(i in l=t.defaultProps)void 0===s[i]&&(s[i]=l[i]);return{$$typeof:r,type:t,key:a,ref:o,props:s,_owner:S.current}}function A(t){return"object"===typeof t&&null!==t&&t.$$typeof===r}var x=/\/+/g;function I(t,e){return"object"===typeof t&&null!==t&&null!=t.key?function(t){var e={"=":"=0",":":"=2"};return"$"+t.replace(/[=:]/g,function(t){return e[t]})}(""+t.key):e.toString(36)}function R(t,e,i,s,a){var o=typeof t;"undefined"!==o&&"boolean"!==o||(t=null);var l=!1;if(null===t)l=!0;else switch(o){case"string":case"number":l=!0;break;case"object":switch(t.$$typeof){case r:case n:l=!0}}if(l)return a=a(l=t),t=""===s?"."+I(l,0):s,w(a)?(i="",null!=t&&(i=t.replace(x,"$&/")+"/"),R(a,e,i,"",function(t){return t})):null!=a&&(A(a)&&(a=function(t,e){return{$$typeof:r,type:t.type,key:e,ref:t.ref,props:t.props,_owner:t._owner}}(a,i+(!a.key||l&&l.key===a.key?"":(""+a.key).replace(x,"$&/")+"/")+t)),e.push(a)),1;if(l=0,s=""===s?".":s+":",w(t))for(var c=0;c<t.length;c++){var u=s+I(o=t[c],c);l+=R(o,e,i,u,a)}else if(u=function(t){return null===t||"object"!==typeof t?null:"function"===typeof(t=f&&t[f]||t["@@iterator"])?t:null}(t),"function"===typeof u)for(t=u.call(t),c=0;!(o=t.next()).done;)l+=R(o=o.value,e,i,u=s+I(o,c++),a);else if("object"===o)throw e=String(t),Error("Objects are not valid as a React child (found: "+("[object Object]"===e?"object with keys {"+Object.keys(t).join(", ")+"}":e)+"). If you meant to render a collection of children, use an array instead.");return l}function L(t,e,r){if(null==t)return t;var n=[],i=0;return R(t,n,"","",function(t){return e.call(r,t,i++)}),n}function P(t){if(-1===t._status){var e=t._result;(e=e()).then(function(e){0!==t._status&&-1!==t._status||(t._status=1,t._result=e)},function(e){0!==t._status&&-1!==t._status||(t._status=2,t._result=e)}),-1===t._status&&(t._status=0,t._result=e)}if(1===t._status)return t._result.default;throw t._result}var C={current:null},M={transition:null},O={ReactCurrentDispatcher:C,ReactCurrentBatchConfig:M,ReactCurrentOwner:S};function D(){throw Error("act(...) is not supported in production builds of React.")}e.Children={map:L,forEach:function(t,e,r){L(t,function(){e.apply(this,arguments)},r)},count:function(t){var e=0;return L(t,function(){e++}),e},toArray:function(t){return L(t,function(t){return t})||[]},only:function(t){if(!A(t))throw Error("React.Children.only expected to receive a single React element child.");return t}},e.Component=y,e.Fragment=i,e.Profiler=a,e.PureComponent=b,e.StrictMode=s,e.Suspense=u,e.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=O,e.act=D,e.cloneElement=function(t,e,n){if(null===t||void 0===t)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+t+".");var i=g({},t.props),s=t.key,a=t.ref,o=t._owner;if(null!=e){if(void 0!==e.ref&&(a=e.ref,o=S.current),void 0!==e.key&&(s=""+e.key),t.type&&t.type.defaultProps)var l=t.type.defaultProps;for(c in e)E.call(e,c)&&!T.hasOwnProperty(c)&&(i[c]=void 0===e[c]&&void 0!==l?l[c]:e[c])}var c=arguments.length-2;if(1===c)i.children=n;else if(1<c){l=Array(c);for(var u=0;u<c;u++)l[u]=arguments[u+2];i.children=l}return{$$typeof:r,type:t.type,key:s,ref:a,props:i,_owner:o}},e.createContext=function(t){return(t={$$typeof:l,_currentValue:t,_currentValue2:t,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null}).Provider={$$typeof:o,_context:t},t.Consumer=t},e.createElement=k,e.createFactory=function(t){var e=k.bind(null,t);return e.type=t,e},e.createRef=function(){return{current:null}},e.forwardRef=function(t){return{$$typeof:c,render:t}},e.isValidElement=A,e.lazy=function(t){return{$$typeof:d,_payload:{_status:-1,_result:t},_init:P}},e.memo=function(t,e){return{$$typeof:h,type:t,compare:void 0===e?null:e}},e.startTransition=function(t){var e=M.transition;M.transition={};try{t()}finally{M.transition=e}},e.unstable_act=D,e.useCallback=function(t,e){return C.current.useCallback(t,e)},e.useContext=function(t){return C.current.useContext(t)},e.useDebugValue=function(){},e.useDeferredValue=function(t){return C.current.useDeferredValue(t)},e.useEffect=function(t,e){return C.current.useEffect(t,e)},e.useId=function(){return C.current.useId()},e.useImperativeHandle=function(t,e,r){return C.current.useImperativeHandle(t,e,r)},e.useInsertionEffect=function(t,e){return C.current.useInsertionEffect(t,e)},e.useLayoutEffect=function(t,e){return C.current.useLayoutEffect(t,e)},e.useMemo=function(t,e){return C.current.useMemo(t,e)},e.useReducer=function(t,e,r){return C.current.useReducer(t,e,r)},e.useRef=function(t){return C.current.useRef(t)},e.useState=function(t){return C.current.useState(t)},e.useSyncExternalStore=function(t,e,r){return C.current.useSyncExternalStore(t,e,r)},e.useTransition=function(){return C.current.useTransition()},e.version="18.3.1"},218(t){"use strict";t.exports="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED"},234(t,e){"use strict";function r(t,e){var r=t.length;t.push(e);t:for(;0<r;){var n=r-1>>>1,i=t[n];if(!(0<s(i,e)))break t;t[n]=e,t[r]=i,r=n}}function n(t){return 0===t.length?null:t[0]}function i(t){if(0===t.length)return null;var e=t[0],r=t.pop();if(r!==e){t[0]=r;t:for(var n=0,i=t.length,a=i>>>1;n<a;){var o=2*(n+1)-1,l=t[o],c=o+1,u=t[c];if(0>s(l,r))c<i&&0>s(u,l)?(t[n]=u,t[c]=r,n=c):(t[n]=l,t[o]=r,n=o);else{if(!(c<i&&0>s(u,r)))break t;t[n]=u,t[c]=r,n=c}}}return e}function s(t,e){var r=t.sortIndex-e.sortIndex;return 0!==r?r:t.id-e.id}if("object"===typeof performance&&"function"===typeof performance.now){var a=performance;e.unstable_now=function(){return a.now()}}else{var o=Date,l=o.now();e.unstable_now=function(){return o.now()-l}}var c=[],u=[],h=1,d=null,f=3,p=!1,g=!1,m=!1,y="function"===typeof setTimeout?setTimeout:null,v="function"===typeof clearTimeout?clearTimeout:null,b="undefined"!==typeof setImmediate?setImmediate:null;function _(t){for(var e=n(u);null!==e;){if(null===e.callback)i(u);else{if(!(e.startTime<=t))break;i(u),e.sortIndex=e.expirationTime,r(c,e)}e=n(u)}}function w(t){if(m=!1,_(t),!g)if(null!==n(c))g=!0,M(E);else{var e=n(u);null!==e&&O(w,e.startTime-t)}}function E(t,r){g=!1,m&&(m=!1,v(A),A=-1),p=!0;var s=f;try{for(_(r),d=n(c);null!==d&&(!(d.expirationTime>r)||t&&!R());){var a=d.callback;if("function"===typeof a){d.callback=null,f=d.priorityLevel;var o=a(d.expirationTime<=r);r=e.unstable_now(),"function"===typeof o?d.callback=o:d===n(c)&&i(c),_(r)}else i(c);d=n(c)}if(null!==d)var l=!0;else{var h=n(u);null!==h&&O(w,h.startTime-r),l=!1}return l}finally{d=null,f=s,p=!1}}"undefined"!==typeof navigator&&void 0!==navigator.scheduling&&void 0!==navigator.scheduling.isInputPending&&navigator.scheduling.isInputPending.bind(navigator.scheduling);var S,T=!1,k=null,A=-1,x=5,I=-1;function R(){return!(e.unstable_now()-I<x)}function L(){if(null!==k){var t=e.unstable_now();I=t;var r=!0;try{r=k(!0,t)}finally{r?S():(T=!1,k=null)}}else T=!1}if("function"===typeof b)S=function(){b(L)};else if("undefined"!==typeof MessageChannel){var P=new MessageChannel,C=P.port2;P.port1.onmessage=L,S=function(){C.postMessage(null)}}else S=function(){y(L,0)};function M(t){k=t,T||(T=!0,S())}function O(t,r){A=y(function(){t(e.unstable_now())},r)}e.unstable_IdlePriority=5,e.unstable_ImmediatePriority=1,e.unstable_LowPriority=4,e.unstable_NormalPriority=3,e.unstable_Profiling=null,e.unstable_UserBlockingPriority=2,e.unstable_cancelCallback=function(t){t.callback=null},e.unstable_continueExecution=function(){g||p||(g=!0,M(E))},e.unstable_forceFrameRate=function(t){0>t||125<t?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):x=0<t?Math.floor(1e3/t):5},e.unstable_getCurrentPriorityLevel=function(){return f},e.unstable_getFirstCallbackNode=function(){return n(c)},e.unstable_next=function(t){switch(f){case 1:case 2:case 3:var e=3;break;default:e=f}var r=f;f=e;try{return t()}finally{f=r}},e.unstable_pauseExecution=function(){},e.unstable_requestPaint=function(){},e.unstable_runWithPriority=function(t,e){switch(t){case 1:case 2:case 3:case 4:case 5:break;default:t=3}var r=f;f=t;try{return e()}finally{f=r}},e.unstable_scheduleCallback=function(t,i,s){var a=e.unstable_now();switch("object"===typeof s&&null!==s?s="number"===typeof(s=s.delay)&&0<s?a+s:a:s=a,t){case 1:var o=-1;break;case 2:o=250;break;case 5:o=1073741823;break;case 4:o=1e4;break;default:o=5e3}return t={id:h++,callback:i,priorityLevel:t,startTime:s,expirationTime:o=s+o,sortIndex:-1},s>a?(t.sortIndex=s,r(u,t),null===n(c)&&t===n(u)&&(m?(v(A),A=-1):m=!0,O(w,s-a))):(t.sortIndex=o,r(c,t),g||p||(g=!0,M(E))),t},e.unstable_shouldYield=R,e.unstable_wrapCallback=function(t){var e=f;return function(){var r=f;f=e;try{return t.apply(this,arguments)}finally{f=r}}}},391(t,e,r){"use strict";var n=r(950);e.createRoot=n.createRoot,e.hydrateRoot=n.hydrateRoot},440(t){"use strict";var e=function(){};t.exports=e},497(t,e,r){"use strict";var n=r(218);function i(){}function s(){}s.resetWarningCache=i,t.exports=function(){function t(t,e,r,i,s,a){if(a!==n){var o=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw o.name="Invariant Violation",o}}function e(){return t}t.isRequired=t;var r={array:t,bigint:t,bool:t,func:t,number:t,object:t,string:t,symbol:t,any:t,arrayOf:e,element:t,elementType:t,instanceOf:e,node:t,objectOf:e,oneOf:e,oneOfType:e,shape:e,exact:e,checkPropTypes:s,resetWarningCache:i};return r.PropTypes=r,r}},579(t,e,r){"use strict";t.exports=r(153)},730(t,e,r){"use strict";var n=r(43),i=r(853);function s(t){for(var e="https://reactjs.org/docs/error-decoder.html?invariant="+t,r=1;r<arguments.length;r++)e+="&args[]="+encodeURIComponent(arguments[r]);return"Minified React error #"+t+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var a=new Set,o={};function l(t,e){c(t,e),c(t+"Capture",e)}function c(t,e){for(o[t]=e,t=0;t<e.length;t++)a.add(e[t])}var u=!("undefined"===typeof window||"undefined"===typeof window.document||"undefined"===typeof window.document.createElement),h=Object.prototype.hasOwnProperty,d=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,f={},p={};function g(t,e,r,n,i,s,a){this.acceptsBooleans=2===e||3===e||4===e,this.attributeName=n,this.attributeNamespace=i,this.mustUseProperty=r,this.propertyName=t,this.type=e,this.sanitizeURL=s,this.removeEmptyString=a}var m={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(t){m[t]=new g(t,0,!1,t,null,!1,!1)}),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(t){var e=t[0];m[e]=new g(e,1,!1,t[1],null,!1,!1)}),["contentEditable","draggable","spellCheck","value"].forEach(function(t){m[t]=new g(t,2,!1,t.toLowerCase(),null,!1,!1)}),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(t){m[t]=new g(t,2,!1,t,null,!1,!1)}),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(t){m[t]=new g(t,3,!1,t.toLowerCase(),null,!1,!1)}),["checked","multiple","muted","selected"].forEach(function(t){m[t]=new g(t,3,!0,t,null,!1,!1)}),["capture","download"].forEach(function(t){m[t]=new g(t,4,!1,t,null,!1,!1)}),["cols","rows","size","span"].forEach(function(t){m[t]=new g(t,6,!1,t,null,!1,!1)}),["rowSpan","start"].forEach(function(t){m[t]=new g(t,5,!1,t.toLowerCase(),null,!1,!1)});var y=/[\-:]([a-z])/g;function v(t){return t[1].toUpperCase()}function b(t,e,r,n){var i=m.hasOwnProperty(e)?m[e]:null;(null!==i?0!==i.type:n||!(2<e.length)||"o"!==e[0]&&"O"!==e[0]||"n"!==e[1]&&"N"!==e[1])&&(function(t,e,r,n){if(null===e||"undefined"===typeof e||function(t,e,r,n){if(null!==r&&0===r.type)return!1;switch(typeof e){case"function":case"symbol":return!0;case"boolean":return!n&&(null!==r?!r.acceptsBooleans:"data-"!==(t=t.toLowerCase().slice(0,5))&&"aria-"!==t);default:return!1}}(t,e,r,n))return!0;if(n)return!1;if(null!==r)switch(r.type){case 3:return!e;case 4:return!1===e;case 5:return isNaN(e);case 6:return isNaN(e)||1>e}return!1}(e,r,i,n)&&(r=null),n||null===i?function(t){return!!h.call(p,t)||!h.call(f,t)&&(d.test(t)?p[t]=!0:(f[t]=!0,!1))}(e)&&(null===r?t.removeAttribute(e):t.setAttribute(e,""+r)):i.mustUseProperty?t[i.propertyName]=null===r?3!==i.type&&"":r:(e=i.attributeName,n=i.attributeNamespace,null===r?t.removeAttribute(e):(r=3===(i=i.type)||4===i&&!0===r?"":""+r,n?t.setAttributeNS(n,e,r):t.setAttribute(e,r))))}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(t){var e=t.replace(y,v);m[e]=new g(e,1,!1,t,null,!1,!1)}),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(t){var e=t.replace(y,v);m[e]=new g(e,1,!1,t,"http://www.w3.org/1999/xlink",!1,!1)}),["xml:base","xml:lang","xml:space"].forEach(function(t){var e=t.replace(y,v);m[e]=new g(e,1,!1,t,"http://www.w3.org/XML/1998/namespace",!1,!1)}),["tabIndex","crossOrigin"].forEach(function(t){m[t]=new g(t,1,!1,t.toLowerCase(),null,!1,!1)}),m.xlinkHref=new g("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach(function(t){m[t]=new g(t,1,!1,t.toLowerCase(),null,!0,!0)});var _=n.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,w=Symbol.for("react.element"),E=Symbol.for("react.portal"),S=Symbol.for("react.fragment"),T=Symbol.for("react.strict_mode"),k=Symbol.for("react.profiler"),A=Symbol.for("react.provider"),x=Symbol.for("react.context"),I=Symbol.for("react.forward_ref"),R=Symbol.for("react.suspense"),L=Symbol.for("react.suspense_list"),P=Symbol.for("react.memo"),C=Symbol.for("react.lazy");Symbol.for("react.scope"),Symbol.for("react.debug_trace_mode");var M=Symbol.for("react.offscreen");Symbol.for("react.legacy_hidden"),Symbol.for("react.cache"),Symbol.for("react.tracing_marker");var O=Symbol.iterator;function D(t){return null===t||"object"!==typeof t?null:"function"===typeof(t=O&&t[O]||t["@@iterator"])?t:null}var N,F=Object.assign;function U(t){if(void 0===N)try{throw Error()}catch(r){var e=r.stack.trim().match(/\n( *(at )?)/);N=e&&e[1]||""}return"\n"+N+t}var B=!1;function j(t,e){if(!t||B)return"";B=!0;var r=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(e)if(e=function(){throw Error()},Object.defineProperty(e.prototype,"props",{set:function(){throw Error()}}),"object"===typeof Reflect&&Reflect.construct){try{Reflect.construct(e,[])}catch(c){var n=c}Reflect.construct(t,[],e)}else{try{e.call()}catch(c){n=c}t.call(e.prototype)}else{try{throw Error()}catch(c){n=c}t()}}catch(c){if(c&&n&&"string"===typeof c.stack){for(var i=c.stack.split("\n"),s=n.stack.split("\n"),a=i.length-1,o=s.length-1;1<=a&&0<=o&&i[a]!==s[o];)o--;for(;1<=a&&0<=o;a--,o--)if(i[a]!==s[o]){if(1!==a||1!==o)do{if(a--,0>--o||i[a]!==s[o]){var l="\n"+i[a].replace(" at new "," at ");return t.displayName&&l.includes("<anonymous>")&&(l=l.replace("<anonymous>",t.displayName)),l}}while(1<=a&&0<=o);break}}}finally{B=!1,Error.prepareStackTrace=r}return(t=t?t.displayName||t.name:"")?U(t):""}function z(t){switch(t.tag){case 5:return U(t.type);case 16:return U("Lazy");case 13:return U("Suspense");case 19:return U("SuspenseList");case 0:case 2:case 15:return t=j(t.type,!1);case 11:return t=j(t.type.render,!1);case 1:return t=j(t.type,!0);default:return""}}function W(t){if(null==t)return null;if("function"===typeof t)return t.displayName||t.name||null;if("string"===typeof t)return t;switch(t){case S:return"Fragment";case E:return"Portal";case k:return"Profiler";case T:return"StrictMode";case R:return"Suspense";case L:return"SuspenseList"}if("object"===typeof t)switch(t.$$typeof){case x:return(t.displayName||"Context")+".Consumer";case A:return(t._context.displayName||"Context")+".Provider";case I:var e=t.render;return(t=t.displayName)||(t=""!==(t=e.displayName||e.name||"")?"ForwardRef("+t+")":"ForwardRef"),t;case P:return null!==(e=t.displayName||null)?e:W(t.type)||"Memo";case C:e=t._payload,t=t._init;try{return W(t(e))}catch(r){}}return null}function G(t){var e=t.type;switch(t.tag){case 24:return"Cache";case 9:return(e.displayName||"Context")+".Consumer";case 10:return(e._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return t=(t=e.render).displayName||t.name||"",e.displayName||(""!==t?"ForwardRef("+t+")":"ForwardRef");case 7:return"Fragment";case 5:return e;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return W(e);case 8:return e===T?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if("function"===typeof e)return e.displayName||e.name||null;if("string"===typeof e)return e}return null}function V(t){switch(typeof t){case"boolean":case"number":case"string":case"undefined":case"object":return t;default:return""}}function H(t){var e=t.type;return(t=t.nodeName)&&"input"===t.toLowerCase()&&("checkbox"===e||"radio"===e)}function K(t){t._valueTracker||(t._valueTracker=function(t){var e=H(t)?"checked":"value",r=Object.getOwnPropertyDescriptor(t.constructor.prototype,e),n=""+t[e];if(!t.hasOwnProperty(e)&&"undefined"!==typeof r&&"function"===typeof r.get&&"function"===typeof r.set){var i=r.get,s=r.set;return Object.defineProperty(t,e,{configurable:!0,get:function(){return i.call(this)},set:function(t){n=""+t,s.call(this,t)}}),Object.defineProperty(t,e,{enumerable:r.enumerable}),{getValue:function(){return n},setValue:function(t){n=""+t},stopTracking:function(){t._valueTracker=null,delete t[e]}}}}(t))}function q(t){if(!t)return!1;var e=t._valueTracker;if(!e)return!0;var r=e.getValue(),n="";return t&&(n=H(t)?t.checked?"true":"false":t.value),(t=n)!==r&&(e.setValue(t),!0)}function Y(t){if("undefined"===typeof(t=t||("undefined"!==typeof document?document:void 0)))return null;try{return t.activeElement||t.body}catch(e){return t.body}}function Q(t,e){var r=e.checked;return F({},e,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:null!=r?r:t._wrapperState.initialChecked})}function X(t,e){var r=null==e.defaultValue?"":e.defaultValue,n=null!=e.checked?e.checked:e.defaultChecked;r=V(null!=e.value?e.value:r),t._wrapperState={initialChecked:n,initialValue:r,controlled:"checkbox"===e.type||"radio"===e.type?null!=e.checked:null!=e.value}}function $(t,e){null!=(e=e.checked)&&b(t,"checked",e,!1)}function Z(t,e){$(t,e);var r=V(e.value),n=e.type;if(null!=r)"number"===n?(0===r&&""===t.value||t.value!=r)&&(t.value=""+r):t.value!==""+r&&(t.value=""+r);else if("submit"===n||"reset"===n)return void t.removeAttribute("value");e.hasOwnProperty("value")?tt(t,e.type,r):e.hasOwnProperty("defaultValue")&&tt(t,e.type,V(e.defaultValue)),null==e.checked&&null!=e.defaultChecked&&(t.defaultChecked=!!e.defaultChecked)}function J(t,e,r){if(e.hasOwnProperty("value")||e.hasOwnProperty("defaultValue")){var n=e.type;if(!("submit"!==n&&"reset"!==n||void 0!==e.value&&null!==e.value))return;e=""+t._wrapperState.initialValue,r||e===t.value||(t.value=e),t.defaultValue=e}""!==(r=t.name)&&(t.name=""),t.defaultChecked=!!t._wrapperState.initialChecked,""!==r&&(t.name=r)}function tt(t,e,r){"number"===e&&Y(t.ownerDocument)===t||(null==r?t.defaultValue=""+t._wrapperState.initialValue:t.defaultValue!==""+r&&(t.defaultValue=""+r))}var et=Array.isArray;function rt(t,e,r,n){if(t=t.options,e){e={};for(var i=0;i<r.length;i++)e["$"+r[i]]=!0;for(r=0;r<t.length;r++)i=e.hasOwnProperty("$"+t[r].value),t[r].selected!==i&&(t[r].selected=i),i&&n&&(t[r].defaultSelected=!0)}else{for(r=""+V(r),e=null,i=0;i<t.length;i++){if(t[i].value===r)return t[i].selected=!0,void(n&&(t[i].defaultSelected=!0));null!==e||t[i].disabled||(e=t[i])}null!==e&&(e.selected=!0)}}function nt(t,e){if(null!=e.dangerouslySetInnerHTML)throw Error(s(91));return F({},e,{value:void 0,defaultValue:void 0,children:""+t._wrapperState.initialValue})}function it(t,e){var r=e.value;if(null==r){if(r=e.children,e=e.defaultValue,null!=r){if(null!=e)throw Error(s(92));if(et(r)){if(1<r.length)throw Error(s(93));r=r[0]}e=r}null==e&&(e=""),r=e}t._wrapperState={initialValue:V(r)}}function st(t,e){var r=V(e.value),n=V(e.defaultValue);null!=r&&((r=""+r)!==t.value&&(t.value=r),null==e.defaultValue&&t.defaultValue!==r&&(t.defaultValue=r)),null!=n&&(t.defaultValue=""+n)}function at(t){var e=t.textContent;e===t._wrapperState.initialValue&&""!==e&&null!==e&&(t.value=e)}function ot(t){switch(t){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function lt(t,e){return null==t||"http://www.w3.org/1999/xhtml"===t?ot(e):"http://www.w3.org/2000/svg"===t&&"foreignObject"===e?"http://www.w3.org/1999/xhtml":t}var ct,ut,ht=(ut=function(t,e){if("http://www.w3.org/2000/svg"!==t.namespaceURI||"innerHTML"in t)t.innerHTML=e;else{for((ct=ct||document.createElement("div")).innerHTML="<svg>"+e.valueOf().toString()+"</svg>",e=ct.firstChild;t.firstChild;)t.removeChild(t.firstChild);for(;e.firstChild;)t.appendChild(e.firstChild)}},"undefined"!==typeof MSApp&&MSApp.execUnsafeLocalFunction?function(t,e,r,n){MSApp.execUnsafeLocalFunction(function(){return ut(t,e)})}:ut);function dt(t,e){if(e){var r=t.firstChild;if(r&&r===t.lastChild&&3===r.nodeType)return void(r.nodeValue=e)}t.textContent=e}var ft={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},pt=["Webkit","ms","Moz","O"];function gt(t,e,r){return null==e||"boolean"===typeof e||""===e?"":r||"number"!==typeof e||0===e||ft.hasOwnProperty(t)&&ft[t]?(""+e).trim():e+"px"}function mt(t,e){for(var r in t=t.style,e)if(e.hasOwnProperty(r)){var n=0===r.indexOf("--"),i=gt(r,e[r],n);"float"===r&&(r="cssFloat"),n?t.setProperty(r,i):t[r]=i}}Object.keys(ft).forEach(function(t){pt.forEach(function(e){e=e+t.charAt(0).toUpperCase()+t.substring(1),ft[e]=ft[t]})});var yt=F({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function vt(t,e){if(e){if(yt[t]&&(null!=e.children||null!=e.dangerouslySetInnerHTML))throw Error(s(137,t));if(null!=e.dangerouslySetInnerHTML){if(null!=e.children)throw Error(s(60));if("object"!==typeof e.dangerouslySetInnerHTML||!("__html"in e.dangerouslySetInnerHTML))throw Error(s(61))}if(null!=e.style&&"object"!==typeof e.style)throw Error(s(62))}}function bt(t,e){if(-1===t.indexOf("-"))return"string"===typeof e.is;switch(t){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var _t=null;function wt(t){return(t=t.target||t.srcElement||window).correspondingUseElement&&(t=t.correspondingUseElement),3===t.nodeType?t.parentNode:t}var Et=null,St=null,Tt=null;function kt(t){if(t=bi(t)){if("function"!==typeof Et)throw Error(s(280));var e=t.stateNode;e&&(e=wi(e),Et(t.stateNode,t.type,e))}}function At(t){St?Tt?Tt.push(t):Tt=[t]:St=t}function xt(){if(St){var t=St,e=Tt;if(Tt=St=null,kt(t),e)for(t=0;t<e.length;t++)kt(e[t])}}function It(t,e){return t(e)}function Rt(){}var Lt=!1;function Pt(t,e,r){if(Lt)return t(e,r);Lt=!0;try{return It(t,e,r)}finally{Lt=!1,(null!==St||null!==Tt)&&(Rt(),xt())}}function Ct(t,e){var r=t.stateNode;if(null===r)return null;var n=wi(r);if(null===n)return null;r=n[e];t:switch(e){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(n=!n.disabled)||(n=!("button"===(t=t.type)||"input"===t||"select"===t||"textarea"===t)),t=!n;break t;default:t=!1}if(t)return null;if(r&&"function"!==typeof r)throw Error(s(231,e,typeof r));return r}var Mt=!1;if(u)try{var Ot={};Object.defineProperty(Ot,"passive",{get:function(){Mt=!0}}),window.addEventListener("test",Ot,Ot),window.removeEventListener("test",Ot,Ot)}catch(ut){Mt=!1}function Dt(t,e,r,n,i,s,a,o,l){var c=Array.prototype.slice.call(arguments,3);try{e.apply(r,c)}catch(u){this.onError(u)}}var Nt=!1,Ft=null,Ut=!1,Bt=null,jt={onError:function(t){Nt=!0,Ft=t}};function zt(t,e,r,n,i,s,a,o,l){Nt=!1,Ft=null,Dt.apply(jt,arguments)}function Wt(t){var e=t,r=t;if(t.alternate)for(;e.return;)e=e.return;else{t=e;do{0!==(4098&(e=t).flags)&&(r=e.return),t=e.return}while(t)}return 3===e.tag?r:null}function Gt(t){if(13===t.tag){var e=t.memoizedState;if(null===e&&(null!==(t=t.alternate)&&(e=t.memoizedState)),null!==e)return e.dehydrated}return null}function Vt(t){if(Wt(t)!==t)throw Error(s(188))}function Ht(t){return null!==(t=function(t){var e=t.alternate;if(!e){if(null===(e=Wt(t)))throw Error(s(188));return e!==t?null:t}for(var r=t,n=e;;){var i=r.return;if(null===i)break;var a=i.alternate;if(null===a){if(null!==(n=i.return)){r=n;continue}break}if(i.child===a.child){for(a=i.child;a;){if(a===r)return Vt(i),t;if(a===n)return Vt(i),e;a=a.sibling}throw Error(s(188))}if(r.return!==n.return)r=i,n=a;else{for(var o=!1,l=i.child;l;){if(l===r){o=!0,r=i,n=a;break}if(l===n){o=!0,n=i,r=a;break}l=l.sibling}if(!o){for(l=a.child;l;){if(l===r){o=!0,r=a,n=i;break}if(l===n){o=!0,n=a,r=i;break}l=l.sibling}if(!o)throw Error(s(189))}}if(r.alternate!==n)throw Error(s(190))}if(3!==r.tag)throw Error(s(188));return r.stateNode.current===r?t:e}(t))?Kt(t):null}function Kt(t){if(5===t.tag||6===t.tag)return t;for(t=t.child;null!==t;){var e=Kt(t);if(null!==e)return e;t=t.sibling}return null}var qt=i.unstable_scheduleCallback,Yt=i.unstable_cancelCallback,Qt=i.unstable_shouldYield,Xt=i.unstable_requestPaint,$t=i.unstable_now,Zt=i.unstable_getCurrentPriorityLevel,Jt=i.unstable_ImmediatePriority,te=i.unstable_UserBlockingPriority,ee=i.unstable_NormalPriority,re=i.unstable_LowPriority,ne=i.unstable_IdlePriority,ie=null,se=null;var ae=Math.clz32?Math.clz32:function(t){return t>>>=0,0===t?32:31-(oe(t)/le|0)|0},oe=Math.log,le=Math.LN2;var ce=64,ue=4194304;function he(t){switch(t&-t){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return 4194240&t;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return 130023424&t;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return t}}function de(t,e){var r=t.pendingLanes;if(0===r)return 0;var n=0,i=t.suspendedLanes,s=t.pingedLanes,a=268435455&r;if(0!==a){var o=a&~i;0!==o?n=he(o):0!==(s&=a)&&(n=he(s))}else 0!==(a=r&~i)?n=he(a):0!==s&&(n=he(s));if(0===n)return 0;if(0!==e&&e!==n&&0===(e&i)&&((i=n&-n)>=(s=e&-e)||16===i&&0!==(4194240&s)))return e;if(0!==(4&n)&&(n|=16&r),0!==(e=t.entangledLanes))for(t=t.entanglements,e&=n;0<e;)i=1<<(r=31-ae(e)),n|=t[r],e&=~i;return n}function fe(t,e){switch(t){case 1:case 2:case 4:return e+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e+5e3;default:return-1}}function pe(t){return 0!==(t=-1073741825&t.pendingLanes)?t:1073741824&t?1073741824:0}function ge(){var t=ce;return 0===(4194240&(ce<<=1))&&(ce=64),t}function me(t){for(var e=[],r=0;31>r;r++)e.push(t);return e}function ye(t,e,r){t.pendingLanes|=e,536870912!==e&&(t.suspendedLanes=0,t.pingedLanes=0),(t=t.eventTimes)[e=31-ae(e)]=r}function ve(t,e){var r=t.entangledLanes|=e;for(t=t.entanglements;r;){var n=31-ae(r),i=1<<n;i&e|t[n]&e&&(t[n]|=e),r&=~i}}var be=0;function _e(t){return 1<(t&=-t)?4<t?0!==(268435455&t)?16:536870912:4:1}var we,Ee,Se,Te,ke,Ae=!1,xe=[],Ie=null,Re=null,Le=null,Pe=new Map,Ce=new Map,Me=[],Oe="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function De(t,e){switch(t){case"focusin":case"focusout":Ie=null;break;case"dragenter":case"dragleave":Re=null;break;case"mouseover":case"mouseout":Le=null;break;case"pointerover":case"pointerout":Pe.delete(e.pointerId);break;case"gotpointercapture":case"lostpointercapture":Ce.delete(e.pointerId)}}function Ne(t,e,r,n,i,s){return null===t||t.nativeEvent!==s?(t={blockedOn:e,domEventName:r,eventSystemFlags:n,nativeEvent:s,targetContainers:[i]},null!==e&&(null!==(e=bi(e))&&Ee(e)),t):(t.eventSystemFlags|=n,e=t.targetContainers,null!==i&&-1===e.indexOf(i)&&e.push(i),t)}function Fe(t){var e=vi(t.target);if(null!==e){var r=Wt(e);if(null!==r)if(13===(e=r.tag)){if(null!==(e=Gt(r)))return t.blockedOn=e,void ke(t.priority,function(){Se(r)})}else if(3===e&&r.stateNode.current.memoizedState.isDehydrated)return void(t.blockedOn=3===r.tag?r.stateNode.containerInfo:null)}t.blockedOn=null}function Ue(t){if(null!==t.blockedOn)return!1;for(var e=t.targetContainers;0<e.length;){var r=Qe(t.domEventName,t.eventSystemFlags,e[0],t.nativeEvent);if(null!==r)return null!==(e=bi(r))&&Ee(e),t.blockedOn=r,!1;var n=new(r=t.nativeEvent).constructor(r.type,r);_t=n,r.target.dispatchEvent(n),_t=null,e.shift()}return!0}function Be(t,e,r){Ue(t)&&r.delete(e)}function je(){Ae=!1,null!==Ie&&Ue(Ie)&&(Ie=null),null!==Re&&Ue(Re)&&(Re=null),null!==Le&&Ue(Le)&&(Le=null),Pe.forEach(Be),Ce.forEach(Be)}function ze(t,e){t.blockedOn===e&&(t.blockedOn=null,Ae||(Ae=!0,i.unstable_scheduleCallback(i.unstable_NormalPriority,je)))}function We(t){function e(e){return ze(e,t)}if(0<xe.length){ze(xe[0],t);for(var r=1;r<xe.length;r++){var n=xe[r];n.blockedOn===t&&(n.blockedOn=null)}}for(null!==Ie&&ze(Ie,t),null!==Re&&ze(Re,t),null!==Le&&ze(Le,t),Pe.forEach(e),Ce.forEach(e),r=0;r<Me.length;r++)(n=Me[r]).blockedOn===t&&(n.blockedOn=null);for(;0<Me.length&&null===(r=Me[0]).blockedOn;)Fe(r),null===r.blockedOn&&Me.shift()}var Ge=_.ReactCurrentBatchConfig,Ve=!0;function He(t,e,r,n){var i=be,s=Ge.transition;Ge.transition=null;try{be=1,qe(t,e,r,n)}finally{be=i,Ge.transition=s}}function Ke(t,e,r,n){var i=be,s=Ge.transition;Ge.transition=null;try{be=4,qe(t,e,r,n)}finally{be=i,Ge.transition=s}}function qe(t,e,r,n){if(Ve){var i=Qe(t,e,r,n);if(null===i)Vn(t,e,n,Ye,r),De(t,n);else if(function(t,e,r,n,i){switch(e){case"focusin":return Ie=Ne(Ie,t,e,r,n,i),!0;case"dragenter":return Re=Ne(Re,t,e,r,n,i),!0;case"mouseover":return Le=Ne(Le,t,e,r,n,i),!0;case"pointerover":var s=i.pointerId;return Pe.set(s,Ne(Pe.get(s)||null,t,e,r,n,i)),!0;case"gotpointercapture":return s=i.pointerId,Ce.set(s,Ne(Ce.get(s)||null,t,e,r,n,i)),!0}return!1}(i,t,e,r,n))n.stopPropagation();else if(De(t,n),4&e&&-1<Oe.indexOf(t)){for(;null!==i;){var s=bi(i);if(null!==s&&we(s),null===(s=Qe(t,e,r,n))&&Vn(t,e,n,Ye,r),s===i)break;i=s}null!==i&&n.stopPropagation()}else Vn(t,e,n,null,r)}}var Ye=null;function Qe(t,e,r,n){if(Ye=null,null!==(t=vi(t=wt(n))))if(null===(e=Wt(t)))t=null;else if(13===(r=e.tag)){if(null!==(t=Gt(e)))return t;t=null}else if(3===r){if(e.stateNode.current.memoizedState.isDehydrated)return 3===e.tag?e.stateNode.containerInfo:null;t=null}else e!==t&&(t=null);return Ye=t,null}function Xe(t){switch(t){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(Zt()){case Jt:return 1;case te:return 4;case ee:case re:return 16;case ne:return 536870912;default:return 16}default:return 16}}var $e=null,Ze=null,Je=null;function tr(){if(Je)return Je;var t,e,r=Ze,n=r.length,i="value"in $e?$e.value:$e.textContent,s=i.length;for(t=0;t<n&&r[t]===i[t];t++);var a=n-t;for(e=1;e<=a&&r[n-e]===i[s-e];e++);return Je=i.slice(t,1<e?1-e:void 0)}function er(t){var e=t.keyCode;return"charCode"in t?0===(t=t.charCode)&&13===e&&(t=13):t=e,10===t&&(t=13),32<=t||13===t?t:0}function rr(){return!0}function nr(){return!1}function ir(t){function e(e,r,n,i,s){for(var a in this._reactName=e,this._targetInst=n,this.type=r,this.nativeEvent=i,this.target=s,this.currentTarget=null,t)t.hasOwnProperty(a)&&(e=t[a],this[a]=e?e(i):i[a]);return this.isDefaultPrevented=(null!=i.defaultPrevented?i.defaultPrevented:!1===i.returnValue)?rr:nr,this.isPropagationStopped=nr,this}return F(e.prototype,{preventDefault:function(){this.defaultPrevented=!0;var t=this.nativeEvent;t&&(t.preventDefault?t.preventDefault():"unknown"!==typeof t.returnValue&&(t.returnValue=!1),this.isDefaultPrevented=rr)},stopPropagation:function(){var t=this.nativeEvent;t&&(t.stopPropagation?t.stopPropagation():"unknown"!==typeof t.cancelBubble&&(t.cancelBubble=!0),this.isPropagationStopped=rr)},persist:function(){},isPersistent:rr}),e}var sr,ar,or,lr={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(t){return t.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},cr=ir(lr),ur=F({},lr,{view:0,detail:0}),hr=ir(ur),dr=F({},ur,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Tr,button:0,buttons:0,relatedTarget:function(t){return void 0===t.relatedTarget?t.fromElement===t.srcElement?t.toElement:t.fromElement:t.relatedTarget},movementX:function(t){return"movementX"in t?t.movementX:(t!==or&&(or&&"mousemove"===t.type?(sr=t.screenX-or.screenX,ar=t.screenY-or.screenY):ar=sr=0,or=t),sr)},movementY:function(t){return"movementY"in t?t.movementY:ar}}),fr=ir(dr),pr=ir(F({},dr,{dataTransfer:0})),gr=ir(F({},ur,{relatedTarget:0})),mr=ir(F({},lr,{animationName:0,elapsedTime:0,pseudoElement:0})),yr=F({},lr,{clipboardData:function(t){return"clipboardData"in t?t.clipboardData:window.clipboardData}}),vr=ir(yr),br=ir(F({},lr,{data:0})),_r={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},wr={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Er={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Sr(t){var e=this.nativeEvent;return e.getModifierState?e.getModifierState(t):!!(t=Er[t])&&!!e[t]}function Tr(){return Sr}var kr=F({},ur,{key:function(t){if(t.key){var e=_r[t.key]||t.key;if("Unidentified"!==e)return e}return"keypress"===t.type?13===(t=er(t))?"Enter":String.fromCharCode(t):"keydown"===t.type||"keyup"===t.type?wr[t.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Tr,charCode:function(t){return"keypress"===t.type?er(t):0},keyCode:function(t){return"keydown"===t.type||"keyup"===t.type?t.keyCode:0},which:function(t){return"keypress"===t.type?er(t):"keydown"===t.type||"keyup"===t.type?t.keyCode:0}}),Ar=ir(kr),xr=ir(F({},dr,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0})),Ir=ir(F({},ur,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Tr})),Rr=ir(F({},lr,{propertyName:0,elapsedTime:0,pseudoElement:0})),Lr=F({},dr,{deltaX:function(t){return"deltaX"in t?t.deltaX:"wheelDeltaX"in t?-t.wheelDeltaX:0},deltaY:function(t){return"deltaY"in t?t.deltaY:"wheelDeltaY"in t?-t.wheelDeltaY:"wheelDelta"in t?-t.wheelDelta:0},deltaZ:0,deltaMode:0}),Pr=ir(Lr),Cr=[9,13,27,32],Mr=u&&"CompositionEvent"in window,Or=null;u&&"documentMode"in document&&(Or=document.documentMode);var Dr=u&&"TextEvent"in window&&!Or,Nr=u&&(!Mr||Or&&8<Or&&11>=Or),Fr=String.fromCharCode(32),Ur=!1;function Br(t,e){switch(t){case"keyup":return-1!==Cr.indexOf(e.keyCode);case"keydown":return 229!==e.keyCode;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function jr(t){return"object"===typeof(t=t.detail)&&"data"in t?t.data:null}var zr=!1;var Wr={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Gr(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return"input"===e?!!Wr[t.type]:"textarea"===e}function Vr(t,e,r,n){At(n),0<(e=Kn(e,"onChange")).length&&(r=new cr("onChange","change",null,r,n),t.push({event:r,listeners:e}))}var Hr=null,Kr=null;function qr(t){Un(t,0)}function Yr(t){if(q(_i(t)))return t}function Qr(t,e){if("change"===t)return e}var Xr=!1;if(u){var $r;if(u){var Zr="oninput"in document;if(!Zr){var Jr=document.createElement("div");Jr.setAttribute("oninput","return;"),Zr="function"===typeof Jr.oninput}$r=Zr}else $r=!1;Xr=$r&&(!document.documentMode||9<document.documentMode)}function tn(){Hr&&(Hr.detachEvent("onpropertychange",en),Kr=Hr=null)}function en(t){if("value"===t.propertyName&&Yr(Kr)){var e=[];Vr(e,Kr,t,wt(t)),Pt(qr,e)}}function rn(t,e,r){"focusin"===t?(tn(),Kr=r,(Hr=e).attachEvent("onpropertychange",en)):"focusout"===t&&tn()}function nn(t){if("selectionchange"===t||"keyup"===t||"keydown"===t)return Yr(Kr)}function sn(t,e){if("click"===t)return Yr(e)}function an(t,e){if("input"===t||"change"===t)return Yr(e)}var on="function"===typeof Object.is?Object.is:function(t,e){return t===e&&(0!==t||1/t===1/e)||t!==t&&e!==e};function ln(t,e){if(on(t,e))return!0;if("object"!==typeof t||null===t||"object"!==typeof e||null===e)return!1;var r=Object.keys(t),n=Object.keys(e);if(r.length!==n.length)return!1;for(n=0;n<r.length;n++){var i=r[n];if(!h.call(e,i)||!on(t[i],e[i]))return!1}return!0}function cn(t){for(;t&&t.firstChild;)t=t.firstChild;return t}function un(t,e){var r,n=cn(t);for(t=0;n;){if(3===n.nodeType){if(r=t+n.textContent.length,t<=e&&r>=e)return{node:n,offset:e-t};t=r}t:{for(;n;){if(n.nextSibling){n=n.nextSibling;break t}n=n.parentNode}n=void 0}n=cn(n)}}function hn(t,e){return!(!t||!e)&&(t===e||(!t||3!==t.nodeType)&&(e&&3===e.nodeType?hn(t,e.parentNode):"contains"in t?t.contains(e):!!t.compareDocumentPosition&&!!(16&t.compareDocumentPosition(e))))}function dn(){for(var t=window,e=Y();e instanceof t.HTMLIFrameElement;){try{var r="string"===typeof e.contentWindow.location.href}catch(n){r=!1}if(!r)break;e=Y((t=e.contentWindow).document)}return e}function fn(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e&&("input"===e&&("text"===t.type||"search"===t.type||"tel"===t.type||"url"===t.type||"password"===t.type)||"textarea"===e||"true"===t.contentEditable)}function pn(t){var e=dn(),r=t.focusedElem,n=t.selectionRange;if(e!==r&&r&&r.ownerDocument&&hn(r.ownerDocument.documentElement,r)){if(null!==n&&fn(r))if(e=n.start,void 0===(t=n.end)&&(t=e),"selectionStart"in r)r.selectionStart=e,r.selectionEnd=Math.min(t,r.value.length);else if((t=(e=r.ownerDocument||document)&&e.defaultView||window).getSelection){t=t.getSelection();var i=r.textContent.length,s=Math.min(n.start,i);n=void 0===n.end?s:Math.min(n.end,i),!t.extend&&s>n&&(i=n,n=s,s=i),i=un(r,s);var a=un(r,n);i&&a&&(1!==t.rangeCount||t.anchorNode!==i.node||t.anchorOffset!==i.offset||t.focusNode!==a.node||t.focusOffset!==a.offset)&&((e=e.createRange()).setStart(i.node,i.offset),t.removeAllRanges(),s>n?(t.addRange(e),t.extend(a.node,a.offset)):(e.setEnd(a.node,a.offset),t.addRange(e)))}for(e=[],t=r;t=t.parentNode;)1===t.nodeType&&e.push({element:t,left:t.scrollLeft,top:t.scrollTop});for("function"===typeof r.focus&&r.focus(),r=0;r<e.length;r++)(t=e[r]).element.scrollLeft=t.left,t.element.scrollTop=t.top}}var gn=u&&"documentMode"in document&&11>=document.documentMode,mn=null,yn=null,vn=null,bn=!1;function _n(t,e,r){var n=r.window===r?r.document:9===r.nodeType?r:r.ownerDocument;bn||null==mn||mn!==Y(n)||("selectionStart"in(n=mn)&&fn(n)?n={start:n.selectionStart,end:n.selectionEnd}:n={anchorNode:(n=(n.ownerDocument&&n.ownerDocument.defaultView||window).getSelection()).anchorNode,anchorOffset:n.anchorOffset,focusNode:n.focusNode,focusOffset:n.focusOffset},vn&&ln(vn,n)||(vn=n,0<(n=Kn(yn,"onSelect")).length&&(e=new cr("onSelect","select",null,e,r),t.push({event:e,listeners:n}),e.target=mn)))}function wn(t,e){var r={};return r[t.toLowerCase()]=e.toLowerCase(),r["Webkit"+t]="webkit"+e,r["Moz"+t]="moz"+e,r}var En={animationend:wn("Animation","AnimationEnd"),animationiteration:wn("Animation","AnimationIteration"),animationstart:wn("Animation","AnimationStart"),transitionend:wn("Transition","TransitionEnd")},Sn={},Tn={};function kn(t){if(Sn[t])return Sn[t];if(!En[t])return t;var e,r=En[t];for(e in r)if(r.hasOwnProperty(e)&&e in Tn)return Sn[t]=r[e];return t}u&&(Tn=document.createElement("div").style,"AnimationEvent"in window||(delete En.animationend.animation,delete En.animationiteration.animation,delete En.animationstart.animation),"TransitionEvent"in window||delete En.transitionend.transition);var An=kn("animationend"),xn=kn("animationiteration"),In=kn("animationstart"),Rn=kn("transitionend"),Ln=new Map,Pn="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Cn(t,e){Ln.set(t,e),l(e,[t])}for(var Mn=0;Mn<Pn.length;Mn++){var On=Pn[Mn];Cn(On.toLowerCase(),"on"+(On[0].toUpperCase()+On.slice(1)))}Cn(An,"onAnimationEnd"),Cn(xn,"onAnimationIteration"),Cn(In,"onAnimationStart"),Cn("dblclick","onDoubleClick"),Cn("focusin","onFocus"),Cn("focusout","onBlur"),Cn(Rn,"onTransitionEnd"),c("onMouseEnter",["mouseout","mouseover"]),c("onMouseLeave",["mouseout","mouseover"]),c("onPointerEnter",["pointerout","pointerover"]),c("onPointerLeave",["pointerout","pointerover"]),l("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),l("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),l("onBeforeInput",["compositionend","keypress","textInput","paste"]),l("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),l("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),l("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Dn="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Nn=new Set("cancel close invalid load scroll toggle".split(" ").concat(Dn));function Fn(t,e,r){var n=t.type||"unknown-event";t.currentTarget=r,function(t,e,r,n,i,a,o,l,c){if(zt.apply(this,arguments),Nt){if(!Nt)throw Error(s(198));var u=Ft;Nt=!1,Ft=null,Ut||(Ut=!0,Bt=u)}}(n,e,void 0,t),t.currentTarget=null}function Un(t,e){e=0!==(4&e);for(var r=0;r<t.length;r++){var n=t[r],i=n.event;n=n.listeners;t:{var s=void 0;if(e)for(var a=n.length-1;0<=a;a--){var o=n[a],l=o.instance,c=o.currentTarget;if(o=o.listener,l!==s&&i.isPropagationStopped())break t;Fn(i,o,c),s=l}else for(a=0;a<n.length;a++){if(l=(o=n[a]).instance,c=o.currentTarget,o=o.listener,l!==s&&i.isPropagationStopped())break t;Fn(i,o,c),s=l}}}if(Ut)throw t=Bt,Ut=!1,Bt=null,t}function Bn(t,e){var r=e[gi];void 0===r&&(r=e[gi]=new Set);var n=t+"__bubble";r.has(n)||(Gn(e,t,2,!1),r.add(n))}function jn(t,e,r){var n=0;e&&(n|=4),Gn(r,t,n,e)}var zn="_reactListening"+Math.random().toString(36).slice(2);function Wn(t){if(!t[zn]){t[zn]=!0,a.forEach(function(e){"selectionchange"!==e&&(Nn.has(e)||jn(e,!1,t),jn(e,!0,t))});var e=9===t.nodeType?t:t.ownerDocument;null===e||e[zn]||(e[zn]=!0,jn("selectionchange",!1,e))}}function Gn(t,e,r,n){switch(Xe(e)){case 1:var i=He;break;case 4:i=Ke;break;default:i=qe}r=i.bind(null,e,r,t),i=void 0,!Mt||"touchstart"!==e&&"touchmove"!==e&&"wheel"!==e||(i=!0),n?void 0!==i?t.addEventListener(e,r,{capture:!0,passive:i}):t.addEventListener(e,r,!0):void 0!==i?t.addEventListener(e,r,{passive:i}):t.addEventListener(e,r,!1)}function Vn(t,e,r,n,i){var s=n;if(0===(1&e)&&0===(2&e)&&null!==n)t:for(;;){if(null===n)return;var a=n.tag;if(3===a||4===a){var o=n.stateNode.containerInfo;if(o===i||8===o.nodeType&&o.parentNode===i)break;if(4===a)for(a=n.return;null!==a;){var l=a.tag;if((3===l||4===l)&&((l=a.stateNode.containerInfo)===i||8===l.nodeType&&l.parentNode===i))return;a=a.return}for(;null!==o;){if(null===(a=vi(o)))return;if(5===(l=a.tag)||6===l){n=s=a;continue t}o=o.parentNode}}n=n.return}Pt(function(){var n=s,i=wt(r),a=[];t:{var o=Ln.get(t);if(void 0!==o){var l=cr,c=t;switch(t){case"keypress":if(0===er(r))break t;case"keydown":case"keyup":l=Ar;break;case"focusin":c="focus",l=gr;break;case"focusout":c="blur",l=gr;break;case"beforeblur":case"afterblur":l=gr;break;case"click":if(2===r.button)break t;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":l=fr;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":l=pr;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":l=Ir;break;case An:case xn:case In:l=mr;break;case Rn:l=Rr;break;case"scroll":l=hr;break;case"wheel":l=Pr;break;case"copy":case"cut":case"paste":l=vr;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":l=xr}var u=0!==(4&e),h=!u&&"scroll"===t,d=u?null!==o?o+"Capture":null:o;u=[];for(var f,p=n;null!==p;){var g=(f=p).stateNode;if(5===f.tag&&null!==g&&(f=g,null!==d&&(null!=(g=Ct(p,d))&&u.push(Hn(p,g,f)))),h)break;p=p.return}0<u.length&&(o=new l(o,c,null,r,i),a.push({event:o,listeners:u}))}}if(0===(7&e)){if(l="mouseout"===t||"pointerout"===t,(!(o="mouseover"===t||"pointerover"===t)||r===_t||!(c=r.relatedTarget||r.fromElement)||!vi(c)&&!c[pi])&&(l||o)&&(o=i.window===i?i:(o=i.ownerDocument)?o.defaultView||o.parentWindow:window,l?(l=n,null!==(c=(c=r.relatedTarget||r.toElement)?vi(c):null)&&(c!==(h=Wt(c))||5!==c.tag&&6!==c.tag)&&(c=null)):(l=null,c=n),l!==c)){if(u=fr,g="onMouseLeave",d="onMouseEnter",p="mouse","pointerout"!==t&&"pointerover"!==t||(u=xr,g="onPointerLeave",d="onPointerEnter",p="pointer"),h=null==l?o:_i(l),f=null==c?o:_i(c),(o=new u(g,p+"leave",l,r,i)).target=h,o.relatedTarget=f,g=null,vi(i)===n&&((u=new u(d,p+"enter",c,r,i)).target=f,u.relatedTarget=h,g=u),h=g,l&&c)t:{for(d=c,p=0,f=u=l;f;f=qn(f))p++;for(f=0,g=d;g;g=qn(g))f++;for(;0<p-f;)u=qn(u),p--;for(;0<f-p;)d=qn(d),f--;for(;p--;){if(u===d||null!==d&&u===d.alternate)break t;u=qn(u),d=qn(d)}u=null}else u=null;null!==l&&Yn(a,o,l,u,!1),null!==c&&null!==h&&Yn(a,h,c,u,!0)}if("select"===(l=(o=n?_i(n):window).nodeName&&o.nodeName.toLowerCase())||"input"===l&&"file"===o.type)var m=Qr;else if(Gr(o))if(Xr)m=an;else{m=nn;var y=rn}else(l=o.nodeName)&&"input"===l.toLowerCase()&&("checkbox"===o.type||"radio"===o.type)&&(m=sn);switch(m&&(m=m(t,n))?Vr(a,m,r,i):(y&&y(t,o,n),"focusout"===t&&(y=o._wrapperState)&&y.controlled&&"number"===o.type&&tt(o,"number",o.value)),y=n?_i(n):window,t){case"focusin":(Gr(y)||"true"===y.contentEditable)&&(mn=y,yn=n,vn=null);break;case"focusout":vn=yn=mn=null;break;case"mousedown":bn=!0;break;case"contextmenu":case"mouseup":case"dragend":bn=!1,_n(a,r,i);break;case"selectionchange":if(gn)break;case"keydown":case"keyup":_n(a,r,i)}var v;if(Mr)t:{switch(t){case"compositionstart":var b="onCompositionStart";break t;case"compositionend":b="onCompositionEnd";break t;case"compositionupdate":b="onCompositionUpdate";break t}b=void 0}else zr?Br(t,r)&&(b="onCompositionEnd"):"keydown"===t&&229===r.keyCode&&(b="onCompositionStart");b&&(Nr&&"ko"!==r.locale&&(zr||"onCompositionStart"!==b?"onCompositionEnd"===b&&zr&&(v=tr()):(Ze="value"in($e=i)?$e.value:$e.textContent,zr=!0)),0<(y=Kn(n,b)).length&&(b=new br(b,t,null,r,i),a.push({event:b,listeners:y}),v?b.data=v:null!==(v=jr(r))&&(b.data=v))),(v=Dr?function(t,e){switch(t){case"compositionend":return jr(e);case"keypress":return 32!==e.which?null:(Ur=!0,Fr);case"textInput":return(t=e.data)===Fr&&Ur?null:t;default:return null}}(t,r):function(t,e){if(zr)return"compositionend"===t||!Mr&&Br(t,e)?(t=tr(),Je=Ze=$e=null,zr=!1,t):null;switch(t){case"paste":default:return null;case"keypress":if(!(e.ctrlKey||e.altKey||e.metaKey)||e.ctrlKey&&e.altKey){if(e.char&&1<e.char.length)return e.char;if(e.which)return String.fromCharCode(e.which)}return null;case"compositionend":return Nr&&"ko"!==e.locale?null:e.data}}(t,r))&&(0<(n=Kn(n,"onBeforeInput")).length&&(i=new br("onBeforeInput","beforeinput",null,r,i),a.push({event:i,listeners:n}),i.data=v))}Un(a,e)})}function Hn(t,e,r){return{instance:t,listener:e,currentTarget:r}}function Kn(t,e){for(var r=e+"Capture",n=[];null!==t;){var i=t,s=i.stateNode;5===i.tag&&null!==s&&(i=s,null!=(s=Ct(t,r))&&n.unshift(Hn(t,s,i)),null!=(s=Ct(t,e))&&n.push(Hn(t,s,i))),t=t.return}return n}function qn(t){if(null===t)return null;do{t=t.return}while(t&&5!==t.tag);return t||null}function Yn(t,e,r,n,i){for(var s=e._reactName,a=[];null!==r&&r!==n;){var o=r,l=o.alternate,c=o.stateNode;if(null!==l&&l===n)break;5===o.tag&&null!==c&&(o=c,i?null!=(l=Ct(r,s))&&a.unshift(Hn(r,l,o)):i||null!=(l=Ct(r,s))&&a.push(Hn(r,l,o))),r=r.return}0!==a.length&&t.push({event:e,listeners:a})}var Qn=/\r\n?/g,Xn=/\u0000|\uFFFD/g;function $n(t){return("string"===typeof t?t:""+t).replace(Qn,"\n").replace(Xn,"")}function Zn(t,e,r){if(e=$n(e),$n(t)!==e&&r)throw Error(s(425))}function Jn(){}var ti=null,ei=null;function ri(t,e){return"textarea"===t||"noscript"===t||"string"===typeof e.children||"number"===typeof e.children||"object"===typeof e.dangerouslySetInnerHTML&&null!==e.dangerouslySetInnerHTML&&null!=e.dangerouslySetInnerHTML.__html}var ni="function"===typeof setTimeout?setTimeout:void 0,ii="function"===typeof clearTimeout?clearTimeout:void 0,si="function"===typeof Promise?Promise:void 0,ai="function"===typeof queueMicrotask?queueMicrotask:"undefined"!==typeof si?function(t){return si.resolve(null).then(t).catch(oi)}:ni;function oi(t){setTimeout(function(){throw t})}function li(t,e){var r=e,n=0;do{var i=r.nextSibling;if(t.removeChild(r),i&&8===i.nodeType)if("/$"===(r=i.data)){if(0===n)return t.removeChild(i),void We(e);n--}else"$"!==r&&"$?"!==r&&"$!"!==r||n++;r=i}while(r);We(e)}function ci(t){for(;null!=t;t=t.nextSibling){var e=t.nodeType;if(1===e||3===e)break;if(8===e){if("$"===(e=t.data)||"$!"===e||"$?"===e)break;if("/$"===e)return null}}return t}function ui(t){t=t.previousSibling;for(var e=0;t;){if(8===t.nodeType){var r=t.data;if("$"===r||"$!"===r||"$?"===r){if(0===e)return t;e--}else"/$"===r&&e++}t=t.previousSibling}return null}var hi=Math.random().toString(36).slice(2),di="__reactFiber$"+hi,fi="__reactProps$"+hi,pi="__reactContainer$"+hi,gi="__reactEvents$"+hi,mi="__reactListeners$"+hi,yi="__reactHandles$"+hi;function vi(t){var e=t[di];if(e)return e;for(var r=t.parentNode;r;){if(e=r[pi]||r[di]){if(r=e.alternate,null!==e.child||null!==r&&null!==r.child)for(t=ui(t);null!==t;){if(r=t[di])return r;t=ui(t)}return e}r=(t=r).parentNode}return null}function bi(t){return!(t=t[di]||t[pi])||5!==t.tag&&6!==t.tag&&13!==t.tag&&3!==t.tag?null:t}function _i(t){if(5===t.tag||6===t.tag)return t.stateNode;throw Error(s(33))}function wi(t){return t[fi]||null}var Ei=[],Si=-1;function Ti(t){return{current:t}}function ki(t){0>Si||(t.current=Ei[Si],Ei[Si]=null,Si--)}function Ai(t,e){Si++,Ei[Si]=t.current,t.current=e}var xi={},Ii=Ti(xi),Ri=Ti(!1),Li=xi;function Pi(t,e){var r=t.type.contextTypes;if(!r)return xi;var n=t.stateNode;if(n&&n.__reactInternalMemoizedUnmaskedChildContext===e)return n.__reactInternalMemoizedMaskedChildContext;var i,s={};for(i in r)s[i]=e[i];return n&&((t=t.stateNode).__reactInternalMemoizedUnmaskedChildContext=e,t.__reactInternalMemoizedMaskedChildContext=s),s}function Ci(t){return null!==(t=t.childContextTypes)&&void 0!==t}function Mi(){ki(Ri),ki(Ii)}function Oi(t,e,r){if(Ii.current!==xi)throw Error(s(168));Ai(Ii,e),Ai(Ri,r)}function Di(t,e,r){var n=t.stateNode;if(e=e.childContextTypes,"function"!==typeof n.getChildContext)return r;for(var i in n=n.getChildContext())if(!(i in e))throw Error(s(108,G(t)||"Unknown",i));return F({},r,n)}function Ni(t){return t=(t=t.stateNode)&&t.__reactInternalMemoizedMergedChildContext||xi,Li=Ii.current,Ai(Ii,t),Ai(Ri,Ri.current),!0}function Fi(t,e,r){var n=t.stateNode;if(!n)throw Error(s(169));r?(t=Di(t,e,Li),n.__reactInternalMemoizedMergedChildContext=t,ki(Ri),ki(Ii),Ai(Ii,t)):ki(Ri),Ai(Ri,r)}var Ui=null,Bi=!1,ji=!1;function zi(t){null===Ui?Ui=[t]:Ui.push(t)}function Wi(){if(!ji&&null!==Ui){ji=!0;var t=0,e=be;try{var r=Ui;for(be=1;t<r.length;t++){var n=r[t];do{n=n(!0)}while(null!==n)}Ui=null,Bi=!1}catch(i){throw null!==Ui&&(Ui=Ui.slice(t+1)),qt(Jt,Wi),i}finally{be=e,ji=!1}}return null}var Gi=[],Vi=0,Hi=null,Ki=0,qi=[],Yi=0,Qi=null,Xi=1,$i="";function Zi(t,e){Gi[Vi++]=Ki,Gi[Vi++]=Hi,Hi=t,Ki=e}function Ji(t,e,r){qi[Yi++]=Xi,qi[Yi++]=$i,qi[Yi++]=Qi,Qi=t;var n=Xi;t=$i;var i=32-ae(n)-1;n&=~(1<<i),r+=1;var s=32-ae(e)+i;if(30<s){var a=i-i%5;s=(n&(1<<a)-1).toString(32),n>>=a,i-=a,Xi=1<<32-ae(e)+i|r<<i|n,$i=s+t}else Xi=1<<s|r<<i|n,$i=t}function ts(t){null!==t.return&&(Zi(t,1),Ji(t,1,0))}function es(t){for(;t===Hi;)Hi=Gi[--Vi],Gi[Vi]=null,Ki=Gi[--Vi],Gi[Vi]=null;for(;t===Qi;)Qi=qi[--Yi],qi[Yi]=null,$i=qi[--Yi],qi[Yi]=null,Xi=qi[--Yi],qi[Yi]=null}var rs=null,ns=null,is=!1,ss=null;function as(t,e){var r=Lc(5,null,null,0);r.elementType="DELETED",r.stateNode=e,r.return=t,null===(e=t.deletions)?(t.deletions=[r],t.flags|=16):e.push(r)}function os(t,e){switch(t.tag){case 5:var r=t.type;return null!==(e=1!==e.nodeType||r.toLowerCase()!==e.nodeName.toLowerCase()?null:e)&&(t.stateNode=e,rs=t,ns=ci(e.firstChild),!0);case 6:return null!==(e=""===t.pendingProps||3!==e.nodeType?null:e)&&(t.stateNode=e,rs=t,ns=null,!0);case 13:return null!==(e=8!==e.nodeType?null:e)&&(r=null!==Qi?{id:Xi,overflow:$i}:null,t.memoizedState={dehydrated:e,treeContext:r,retryLane:1073741824},(r=Lc(18,null,null,0)).stateNode=e,r.return=t,t.child=r,rs=t,ns=null,!0);default:return!1}}function ls(t){return 0!==(1&t.mode)&&0===(128&t.flags)}function cs(t){if(is){var e=ns;if(e){var r=e;if(!os(t,e)){if(ls(t))throw Error(s(418));e=ci(r.nextSibling);var n=rs;e&&os(t,e)?as(n,r):(t.flags=-4097&t.flags|2,is=!1,rs=t)}}else{if(ls(t))throw Error(s(418));t.flags=-4097&t.flags|2,is=!1,rs=t}}}function us(t){for(t=t.return;null!==t&&5!==t.tag&&3!==t.tag&&13!==t.tag;)t=t.return;rs=t}function hs(t){if(t!==rs)return!1;if(!is)return us(t),is=!0,!1;var e;if((e=3!==t.tag)&&!(e=5!==t.tag)&&(e="head"!==(e=t.type)&&"body"!==e&&!ri(t.type,t.memoizedProps)),e&&(e=ns)){if(ls(t))throw ds(),Error(s(418));for(;e;)as(t,e),e=ci(e.nextSibling)}if(us(t),13===t.tag){if(!(t=null!==(t=t.memoizedState)?t.dehydrated:null))throw Error(s(317));t:{for(t=t.nextSibling,e=0;t;){if(8===t.nodeType){var r=t.data;if("/$"===r){if(0===e){ns=ci(t.nextSibling);break t}e--}else"$"!==r&&"$!"!==r&&"$?"!==r||e++}t=t.nextSibling}ns=null}}else ns=rs?ci(t.stateNode.nextSibling):null;return!0}function ds(){for(var t=ns;t;)t=ci(t.nextSibling)}function fs(){ns=rs=null,is=!1}function ps(t){null===ss?ss=[t]:ss.push(t)}var gs=_.ReactCurrentBatchConfig;function ms(t,e,r){if(null!==(t=r.ref)&&"function"!==typeof t&&"object"!==typeof t){if(r._owner){if(r=r._owner){if(1!==r.tag)throw Error(s(309));var n=r.stateNode}if(!n)throw Error(s(147,t));var i=n,a=""+t;return null!==e&&null!==e.ref&&"function"===typeof e.ref&&e.ref._stringRef===a?e.ref:(e=function(t){var e=i.refs;null===t?delete e[a]:e[a]=t},e._stringRef=a,e)}if("string"!==typeof t)throw Error(s(284));if(!r._owner)throw Error(s(290,t))}return t}function ys(t,e){throw t=Object.prototype.toString.call(e),Error(s(31,"[object Object]"===t?"object with keys {"+Object.keys(e).join(", ")+"}":t))}function vs(t){return(0,t._init)(t._payload)}function bs(t){function e(e,r){if(t){var n=e.deletions;null===n?(e.deletions=[r],e.flags|=16):n.push(r)}}function r(r,n){if(!t)return null;for(;null!==n;)e(r,n),n=n.sibling;return null}function n(t,e){for(t=new Map;null!==e;)null!==e.key?t.set(e.key,e):t.set(e.index,e),e=e.sibling;return t}function i(t,e){return(t=Cc(t,e)).index=0,t.sibling=null,t}function a(e,r,n){return e.index=n,t?null!==(n=e.alternate)?(n=n.index)<r?(e.flags|=2,r):n:(e.flags|=2,r):(e.flags|=1048576,r)}function o(e){return t&&null===e.alternate&&(e.flags|=2),e}function l(t,e,r,n){return null===e||6!==e.tag?((e=Nc(r,t.mode,n)).return=t,e):((e=i(e,r)).return=t,e)}function c(t,e,r,n){var s=r.type;return s===S?h(t,e,r.props.children,n,r.key):null!==e&&(e.elementType===s||"object"===typeof s&&null!==s&&s.$$typeof===C&&vs(s)===e.type)?((n=i(e,r.props)).ref=ms(t,e,r),n.return=t,n):((n=Mc(r.type,r.key,r.props,null,t.mode,n)).ref=ms(t,e,r),n.return=t,n)}function u(t,e,r,n){return null===e||4!==e.tag||e.stateNode.containerInfo!==r.containerInfo||e.stateNode.implementation!==r.implementation?((e=Fc(r,t.mode,n)).return=t,e):((e=i(e,r.children||[])).return=t,e)}function h(t,e,r,n,s){return null===e||7!==e.tag?((e=Oc(r,t.mode,n,s)).return=t,e):((e=i(e,r)).return=t,e)}function d(t,e,r){if("string"===typeof e&&""!==e||"number"===typeof e)return(e=Nc(""+e,t.mode,r)).return=t,e;if("object"===typeof e&&null!==e){switch(e.$$typeof){case w:return(r=Mc(e.type,e.key,e.props,null,t.mode,r)).ref=ms(t,null,e),r.return=t,r;case E:return(e=Fc(e,t.mode,r)).return=t,e;case C:return d(t,(0,e._init)(e._payload),r)}if(et(e)||D(e))return(e=Oc(e,t.mode,r,null)).return=t,e;ys(t,e)}return null}function f(t,e,r,n){var i=null!==e?e.key:null;if("string"===typeof r&&""!==r||"number"===typeof r)return null!==i?null:l(t,e,""+r,n);if("object"===typeof r&&null!==r){switch(r.$$typeof){case w:return r.key===i?c(t,e,r,n):null;case E:return r.key===i?u(t,e,r,n):null;case C:return f(t,e,(i=r._init)(r._payload),n)}if(et(r)||D(r))return null!==i?null:h(t,e,r,n,null);ys(t,r)}return null}function p(t,e,r,n,i){if("string"===typeof n&&""!==n||"number"===typeof n)return l(e,t=t.get(r)||null,""+n,i);if("object"===typeof n&&null!==n){switch(n.$$typeof){case w:return c(e,t=t.get(null===n.key?r:n.key)||null,n,i);case E:return u(e,t=t.get(null===n.key?r:n.key)||null,n,i);case C:return p(t,e,r,(0,n._init)(n._payload),i)}if(et(n)||D(n))return h(e,t=t.get(r)||null,n,i,null);ys(e,n)}return null}function g(i,s,o,l){for(var c=null,u=null,h=s,g=s=0,m=null;null!==h&&g<o.length;g++){h.index>g?(m=h,h=null):m=h.sibling;var y=f(i,h,o[g],l);if(null===y){null===h&&(h=m);break}t&&h&&null===y.alternate&&e(i,h),s=a(y,s,g),null===u?c=y:u.sibling=y,u=y,h=m}if(g===o.length)return r(i,h),is&&Zi(i,g),c;if(null===h){for(;g<o.length;g++)null!==(h=d(i,o[g],l))&&(s=a(h,s,g),null===u?c=h:u.sibling=h,u=h);return is&&Zi(i,g),c}for(h=n(i,h);g<o.length;g++)null!==(m=p(h,i,g,o[g],l))&&(t&&null!==m.alternate&&h.delete(null===m.key?g:m.key),s=a(m,s,g),null===u?c=m:u.sibling=m,u=m);return t&&h.forEach(function(t){return e(i,t)}),is&&Zi(i,g),c}function m(i,o,l,c){var u=D(l);if("function"!==typeof u)throw Error(s(150));if(null==(l=u.call(l)))throw Error(s(151));for(var h=u=null,g=o,m=o=0,y=null,v=l.next();null!==g&&!v.done;m++,v=l.next()){g.index>m?(y=g,g=null):y=g.sibling;var b=f(i,g,v.value,c);if(null===b){null===g&&(g=y);break}t&&g&&null===b.alternate&&e(i,g),o=a(b,o,m),null===h?u=b:h.sibling=b,h=b,g=y}if(v.done)return r(i,g),is&&Zi(i,m),u;if(null===g){for(;!v.done;m++,v=l.next())null!==(v=d(i,v.value,c))&&(o=a(v,o,m),null===h?u=v:h.sibling=v,h=v);return is&&Zi(i,m),u}for(g=n(i,g);!v.done;m++,v=l.next())null!==(v=p(g,i,m,v.value,c))&&(t&&null!==v.alternate&&g.delete(null===v.key?m:v.key),o=a(v,o,m),null===h?u=v:h.sibling=v,h=v);return t&&g.forEach(function(t){return e(i,t)}),is&&Zi(i,m),u}return function t(n,s,a,l){if("object"===typeof a&&null!==a&&a.type===S&&null===a.key&&(a=a.props.children),"object"===typeof a&&null!==a){switch(a.$$typeof){case w:t:{for(var c=a.key,u=s;null!==u;){if(u.key===c){if((c=a.type)===S){if(7===u.tag){r(n,u.sibling),(s=i(u,a.props.children)).return=n,n=s;break t}}else if(u.elementType===c||"object"===typeof c&&null!==c&&c.$$typeof===C&&vs(c)===u.type){r(n,u.sibling),(s=i(u,a.props)).ref=ms(n,u,a),s.return=n,n=s;break t}r(n,u);break}e(n,u),u=u.sibling}a.type===S?((s=Oc(a.props.children,n.mode,l,a.key)).return=n,n=s):((l=Mc(a.type,a.key,a.props,null,n.mode,l)).ref=ms(n,s,a),l.return=n,n=l)}return o(n);case E:t:{for(u=a.key;null!==s;){if(s.key===u){if(4===s.tag&&s.stateNode.containerInfo===a.containerInfo&&s.stateNode.implementation===a.implementation){r(n,s.sibling),(s=i(s,a.children||[])).return=n,n=s;break t}r(n,s);break}e(n,s),s=s.sibling}(s=Fc(a,n.mode,l)).return=n,n=s}return o(n);case C:return t(n,s,(u=a._init)(a._payload),l)}if(et(a))return g(n,s,a,l);if(D(a))return m(n,s,a,l);ys(n,a)}return"string"===typeof a&&""!==a||"number"===typeof a?(a=""+a,null!==s&&6===s.tag?(r(n,s.sibling),(s=i(s,a)).return=n,n=s):(r(n,s),(s=Nc(a,n.mode,l)).return=n,n=s),o(n)):r(n,s)}}var _s=bs(!0),ws=bs(!1),Es=Ti(null),Ss=null,Ts=null,ks=null;function As(){ks=Ts=Ss=null}function xs(t){var e=Es.current;ki(Es),t._currentValue=e}function Is(t,e,r){for(;null!==t;){var n=t.alternate;if((t.childLanes&e)!==e?(t.childLanes|=e,null!==n&&(n.childLanes|=e)):null!==n&&(n.childLanes&e)!==e&&(n.childLanes|=e),t===r)break;t=t.return}}function Rs(t,e){Ss=t,ks=Ts=null,null!==(t=t.dependencies)&&null!==t.firstContext&&(0!==(t.lanes&e)&&(bo=!0),t.firstContext=null)}function Ls(t){var e=t._currentValue;if(ks!==t)if(t={context:t,memoizedValue:e,next:null},null===Ts){if(null===Ss)throw Error(s(308));Ts=t,Ss.dependencies={lanes:0,firstContext:t}}else Ts=Ts.next=t;return e}var Ps=null;function Cs(t){null===Ps?Ps=[t]:Ps.push(t)}function Ms(t,e,r,n){var i=e.interleaved;return null===i?(r.next=r,Cs(e)):(r.next=i.next,i.next=r),e.interleaved=r,Os(t,n)}function Os(t,e){t.lanes|=e;var r=t.alternate;for(null!==r&&(r.lanes|=e),r=t,t=t.return;null!==t;)t.childLanes|=e,null!==(r=t.alternate)&&(r.childLanes|=e),r=t,t=t.return;return 3===r.tag?r.stateNode:null}var Ds=!1;function Ns(t){t.updateQueue={baseState:t.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function Fs(t,e){t=t.updateQueue,e.updateQueue===t&&(e.updateQueue={baseState:t.baseState,firstBaseUpdate:t.firstBaseUpdate,lastBaseUpdate:t.lastBaseUpdate,shared:t.shared,effects:t.effects})}function Us(t,e){return{eventTime:t,lane:e,tag:0,payload:null,callback:null,next:null}}function Bs(t,e,r){var n=t.updateQueue;if(null===n)return null;if(n=n.shared,0!==(2&xl)){var i=n.pending;return null===i?e.next=e:(e.next=i.next,i.next=e),n.pending=e,Os(t,r)}return null===(i=n.interleaved)?(e.next=e,Cs(n)):(e.next=i.next,i.next=e),n.interleaved=e,Os(t,r)}function js(t,e,r){if(null!==(e=e.updateQueue)&&(e=e.shared,0!==(4194240&r))){var n=e.lanes;r|=n&=t.pendingLanes,e.lanes=r,ve(t,r)}}function zs(t,e){var r=t.updateQueue,n=t.alternate;if(null!==n&&r===(n=n.updateQueue)){var i=null,s=null;if(null!==(r=r.firstBaseUpdate)){do{var a={eventTime:r.eventTime,lane:r.lane,tag:r.tag,payload:r.payload,callback:r.callback,next:null};null===s?i=s=a:s=s.next=a,r=r.next}while(null!==r);null===s?i=s=e:s=s.next=e}else i=s=e;return r={baseState:n.baseState,firstBaseUpdate:i,lastBaseUpdate:s,shared:n.shared,effects:n.effects},void(t.updateQueue=r)}null===(t=r.lastBaseUpdate)?r.firstBaseUpdate=e:t.next=e,r.lastBaseUpdate=e}function Ws(t,e,r,n){var i=t.updateQueue;Ds=!1;var s=i.firstBaseUpdate,a=i.lastBaseUpdate,o=i.shared.pending;if(null!==o){i.shared.pending=null;var l=o,c=l.next;l.next=null,null===a?s=c:a.next=c,a=l;var u=t.alternate;null!==u&&((o=(u=u.updateQueue).lastBaseUpdate)!==a&&(null===o?u.firstBaseUpdate=c:o.next=c,u.lastBaseUpdate=l))}if(null!==s){var h=i.baseState;for(a=0,u=c=l=null,o=s;;){var d=o.lane,f=o.eventTime;if((n&d)===d){null!==u&&(u=u.next={eventTime:f,lane:0,tag:o.tag,payload:o.payload,callback:o.callback,next:null});t:{var p=t,g=o;switch(d=e,f=r,g.tag){case 1:if("function"===typeof(p=g.payload)){h=p.call(f,h,d);break t}h=p;break t;case 3:p.flags=-65537&p.flags|128;case 0:if(null===(d="function"===typeof(p=g.payload)?p.call(f,h,d):p)||void 0===d)break t;h=F({},h,d);break t;case 2:Ds=!0}}null!==o.callback&&0!==o.lane&&(t.flags|=64,null===(d=i.effects)?i.effects=[o]:d.push(o))}else f={eventTime:f,lane:d,tag:o.tag,payload:o.payload,callback:o.callback,next:null},null===u?(c=u=f,l=h):u=u.next=f,a|=d;if(null===(o=o.next)){if(null===(o=i.shared.pending))break;o=(d=o).next,d.next=null,i.lastBaseUpdate=d,i.shared.pending=null}}if(null===u&&(l=h),i.baseState=l,i.firstBaseUpdate=c,i.lastBaseUpdate=u,null!==(e=i.shared.interleaved)){i=e;do{a|=i.lane,i=i.next}while(i!==e)}else null===s&&(i.shared.lanes=0);Dl|=a,t.lanes=a,t.memoizedState=h}}function Gs(t,e,r){if(t=e.effects,e.effects=null,null!==t)for(e=0;e<t.length;e++){var n=t[e],i=n.callback;if(null!==i){if(n.callback=null,n=r,"function"!==typeof i)throw Error(s(191,i));i.call(n)}}}var Vs={},Hs=Ti(Vs),Ks=Ti(Vs),qs=Ti(Vs);function Ys(t){if(t===Vs)throw Error(s(174));return t}function Qs(t,e){switch(Ai(qs,e),Ai(Ks,t),Ai(Hs,Vs),t=e.nodeType){case 9:case 11:e=(e=e.documentElement)?e.namespaceURI:lt(null,"");break;default:e=lt(e=(t=8===t?e.parentNode:e).namespaceURI||null,t=t.tagName)}ki(Hs),Ai(Hs,e)}function Xs(){ki(Hs),ki(Ks),ki(qs)}function $s(t){Ys(qs.current);var e=Ys(Hs.current),r=lt(e,t.type);e!==r&&(Ai(Ks,t),Ai(Hs,r))}function Zs(t){Ks.current===t&&(ki(Hs),ki(Ks))}var Js=Ti(0);function ta(t){for(var e=t;null!==e;){if(13===e.tag){var r=e.memoizedState;if(null!==r&&(null===(r=r.dehydrated)||"$?"===r.data||"$!"===r.data))return e}else if(19===e.tag&&void 0!==e.memoizedProps.revealOrder){if(0!==(128&e.flags))return e}else if(null!==e.child){e.child.return=e,e=e.child;continue}if(e===t)break;for(;null===e.sibling;){if(null===e.return||e.return===t)return null;e=e.return}e.sibling.return=e.return,e=e.sibling}return null}var ea=[];function ra(){for(var t=0;t<ea.length;t++)ea[t]._workInProgressVersionPrimary=null;ea.length=0}var na=_.ReactCurrentDispatcher,ia=_.ReactCurrentBatchConfig,sa=0,aa=null,oa=null,la=null,ca=!1,ua=!1,ha=0,da=0;function fa(){throw Error(s(321))}function pa(t,e){if(null===e)return!1;for(var r=0;r<e.length&&r<t.length;r++)if(!on(t[r],e[r]))return!1;return!0}function ga(t,e,r,n,i,a){if(sa=a,aa=e,e.memoizedState=null,e.updateQueue=null,e.lanes=0,na.current=null===t||null===t.memoizedState?Za:Ja,t=r(n,i),ua){a=0;do{if(ua=!1,ha=0,25<=a)throw Error(s(301));a+=1,la=oa=null,e.updateQueue=null,na.current=to,t=r(n,i)}while(ua)}if(na.current=$a,e=null!==oa&&null!==oa.next,sa=0,la=oa=aa=null,ca=!1,e)throw Error(s(300));return t}function ma(){var t=0!==ha;return ha=0,t}function ya(){var t={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return null===la?aa.memoizedState=la=t:la=la.next=t,la}function va(){if(null===oa){var t=aa.alternate;t=null!==t?t.memoizedState:null}else t=oa.next;var e=null===la?aa.memoizedState:la.next;if(null!==e)la=e,oa=t;else{if(null===t)throw Error(s(310));t={memoizedState:(oa=t).memoizedState,baseState:oa.baseState,baseQueue:oa.baseQueue,queue:oa.queue,next:null},null===la?aa.memoizedState=la=t:la=la.next=t}return la}function ba(t,e){return"function"===typeof e?e(t):e}function _a(t){var e=va(),r=e.queue;if(null===r)throw Error(s(311));r.lastRenderedReducer=t;var n=oa,i=n.baseQueue,a=r.pending;if(null!==a){if(null!==i){var o=i.next;i.next=a.next,a.next=o}n.baseQueue=i=a,r.pending=null}if(null!==i){a=i.next,n=n.baseState;var l=o=null,c=null,u=a;do{var h=u.lane;if((sa&h)===h)null!==c&&(c=c.next={lane:0,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null}),n=u.hasEagerState?u.eagerState:t(n,u.action);else{var d={lane:h,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null};null===c?(l=c=d,o=n):c=c.next=d,aa.lanes|=h,Dl|=h}u=u.next}while(null!==u&&u!==a);null===c?o=n:c.next=l,on(n,e.memoizedState)||(bo=!0),e.memoizedState=n,e.baseState=o,e.baseQueue=c,r.lastRenderedState=n}if(null!==(t=r.interleaved)){i=t;do{a=i.lane,aa.lanes|=a,Dl|=a,i=i.next}while(i!==t)}else null===i&&(r.lanes=0);return[e.memoizedState,r.dispatch]}function wa(t){var e=va(),r=e.queue;if(null===r)throw Error(s(311));r.lastRenderedReducer=t;var n=r.dispatch,i=r.pending,a=e.memoizedState;if(null!==i){r.pending=null;var o=i=i.next;do{a=t(a,o.action),o=o.next}while(o!==i);on(a,e.memoizedState)||(bo=!0),e.memoizedState=a,null===e.baseQueue&&(e.baseState=a),r.lastRenderedState=a}return[a,n]}function Ea(){}function Sa(t,e){var r=aa,n=va(),i=e(),a=!on(n.memoizedState,i);if(a&&(n.memoizedState=i,bo=!0),n=n.queue,Da(Aa.bind(null,r,n,t),[t]),n.getSnapshot!==e||a||null!==la&&1&la.memoizedState.tag){if(r.flags|=2048,La(9,ka.bind(null,r,n,i,e),void 0,null),null===Il)throw Error(s(349));0!==(30&sa)||Ta(r,e,i)}return i}function Ta(t,e,r){t.flags|=16384,t={getSnapshot:e,value:r},null===(e=aa.updateQueue)?(e={lastEffect:null,stores:null},aa.updateQueue=e,e.stores=[t]):null===(r=e.stores)?e.stores=[t]:r.push(t)}function ka(t,e,r,n){e.value=r,e.getSnapshot=n,xa(e)&&Ia(t)}function Aa(t,e,r){return r(function(){xa(e)&&Ia(t)})}function xa(t){var e=t.getSnapshot;t=t.value;try{var r=e();return!on(t,r)}catch(n){return!0}}function Ia(t){var e=Os(t,1);null!==e&&ec(e,t,1,-1)}function Ra(t){var e=ya();return"function"===typeof t&&(t=t()),e.memoizedState=e.baseState=t,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:ba,lastRenderedState:t},e.queue=t,t=t.dispatch=qa.bind(null,aa,t),[e.memoizedState,t]}function La(t,e,r,n){return t={tag:t,create:e,destroy:r,deps:n,next:null},null===(e=aa.updateQueue)?(e={lastEffect:null,stores:null},aa.updateQueue=e,e.lastEffect=t.next=t):null===(r=e.lastEffect)?e.lastEffect=t.next=t:(n=r.next,r.next=t,t.next=n,e.lastEffect=t),t}function Pa(){return va().memoizedState}function Ca(t,e,r,n){var i=ya();aa.flags|=t,i.memoizedState=La(1|e,r,void 0,void 0===n?null:n)}function Ma(t,e,r,n){var i=va();n=void 0===n?null:n;var s=void 0;if(null!==oa){var a=oa.memoizedState;if(s=a.destroy,null!==n&&pa(n,a.deps))return void(i.memoizedState=La(e,r,s,n))}aa.flags|=t,i.memoizedState=La(1|e,r,s,n)}function Oa(t,e){return Ca(8390656,8,t,e)}function Da(t,e){return Ma(2048,8,t,e)}function Na(t,e){return Ma(4,2,t,e)}function Fa(t,e){return Ma(4,4,t,e)}function Ua(t,e){return"function"===typeof e?(t=t(),e(t),function(){e(null)}):null!==e&&void 0!==e?(t=t(),e.current=t,function(){e.current=null}):void 0}function Ba(t,e,r){return r=null!==r&&void 0!==r?r.concat([t]):null,Ma(4,4,Ua.bind(null,e,t),r)}function ja(){}function za(t,e){var r=va();e=void 0===e?null:e;var n=r.memoizedState;return null!==n&&null!==e&&pa(e,n[1])?n[0]:(r.memoizedState=[t,e],t)}function Wa(t,e){var r=va();e=void 0===e?null:e;var n=r.memoizedState;return null!==n&&null!==e&&pa(e,n[1])?n[0]:(t=t(),r.memoizedState=[t,e],t)}function Ga(t,e,r){return 0===(21&sa)?(t.baseState&&(t.baseState=!1,bo=!0),t.memoizedState=r):(on(r,e)||(r=ge(),aa.lanes|=r,Dl|=r,t.baseState=!0),e)}function Va(t,e){var r=be;be=0!==r&&4>r?r:4,t(!0);var n=ia.transition;ia.transition={};try{t(!1),e()}finally{be=r,ia.transition=n}}function Ha(){return va().memoizedState}function Ka(t,e,r){var n=tc(t);if(r={lane:n,action:r,hasEagerState:!1,eagerState:null,next:null},Ya(t))Qa(e,r);else if(null!==(r=Ms(t,e,r,n))){ec(r,t,n,Jl()),Xa(r,e,n)}}function qa(t,e,r){var n=tc(t),i={lane:n,action:r,hasEagerState:!1,eagerState:null,next:null};if(Ya(t))Qa(e,i);else{var s=t.alternate;if(0===t.lanes&&(null===s||0===s.lanes)&&null!==(s=e.lastRenderedReducer))try{var a=e.lastRenderedState,o=s(a,r);if(i.hasEagerState=!0,i.eagerState=o,on(o,a)){var l=e.interleaved;return null===l?(i.next=i,Cs(e)):(i.next=l.next,l.next=i),void(e.interleaved=i)}}catch(c){}null!==(r=Ms(t,e,i,n))&&(ec(r,t,n,i=Jl()),Xa(r,e,n))}}function Ya(t){var e=t.alternate;return t===aa||null!==e&&e===aa}function Qa(t,e){ua=ca=!0;var r=t.pending;null===r?e.next=e:(e.next=r.next,r.next=e),t.pending=e}function Xa(t,e,r){if(0!==(4194240&r)){var n=e.lanes;r|=n&=t.pendingLanes,e.lanes=r,ve(t,r)}}var $a={readContext:Ls,useCallback:fa,useContext:fa,useEffect:fa,useImperativeHandle:fa,useInsertionEffect:fa,useLayoutEffect:fa,useMemo:fa,useReducer:fa,useRef:fa,useState:fa,useDebugValue:fa,useDeferredValue:fa,useTransition:fa,useMutableSource:fa,useSyncExternalStore:fa,useId:fa,unstable_isNewReconciler:!1},Za={readContext:Ls,useCallback:function(t,e){return ya().memoizedState=[t,void 0===e?null:e],t},useContext:Ls,useEffect:Oa,useImperativeHandle:function(t,e,r){return r=null!==r&&void 0!==r?r.concat([t]):null,Ca(4194308,4,Ua.bind(null,e,t),r)},useLayoutEffect:function(t,e){return Ca(4194308,4,t,e)},useInsertionEffect:function(t,e){return Ca(4,2,t,e)},useMemo:function(t,e){var r=ya();return e=void 0===e?null:e,t=t(),r.memoizedState=[t,e],t},useReducer:function(t,e,r){var n=ya();return e=void 0!==r?r(e):e,n.memoizedState=n.baseState=e,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:t,lastRenderedState:e},n.queue=t,t=t.dispatch=Ka.bind(null,aa,t),[n.memoizedState,t]},useRef:function(t){return t={current:t},ya().memoizedState=t},useState:Ra,useDebugValue:ja,useDeferredValue:function(t){return ya().memoizedState=t},useTransition:function(){var t=Ra(!1),e=t[0];return t=Va.bind(null,t[1]),ya().memoizedState=t,[e,t]},useMutableSource:function(){},useSyncExternalStore:function(t,e,r){var n=aa,i=ya();if(is){if(void 0===r)throw Error(s(407));r=r()}else{if(r=e(),null===Il)throw Error(s(349));0!==(30&sa)||Ta(n,e,r)}i.memoizedState=r;var a={value:r,getSnapshot:e};return i.queue=a,Oa(Aa.bind(null,n,a,t),[t]),n.flags|=2048,La(9,ka.bind(null,n,a,r,e),void 0,null),r},useId:function(){var t=ya(),e=Il.identifierPrefix;if(is){var r=$i;e=":"+e+"R"+(r=(Xi&~(1<<32-ae(Xi)-1)).toString(32)+r),0<(r=ha++)&&(e+="H"+r.toString(32)),e+=":"}else e=":"+e+"r"+(r=da++).toString(32)+":";return t.memoizedState=e},unstable_isNewReconciler:!1},Ja={readContext:Ls,useCallback:za,useContext:Ls,useEffect:Da,useImperativeHandle:Ba,useInsertionEffect:Na,useLayoutEffect:Fa,useMemo:Wa,useReducer:_a,useRef:Pa,useState:function(){return _a(ba)},useDebugValue:ja,useDeferredValue:function(t){return Ga(va(),oa.memoizedState,t)},useTransition:function(){return[_a(ba)[0],va().memoizedState]},useMutableSource:Ea,useSyncExternalStore:Sa,useId:Ha,unstable_isNewReconciler:!1},to={readContext:Ls,useCallback:za,useContext:Ls,useEffect:Da,useImperativeHandle:Ba,useInsertionEffect:Na,useLayoutEffect:Fa,useMemo:Wa,useReducer:wa,useRef:Pa,useState:function(){return wa(ba)},useDebugValue:ja,useDeferredValue:function(t){var e=va();return null===oa?e.memoizedState=t:Ga(e,oa.memoizedState,t)},useTransition:function(){return[wa(ba)[0],va().memoizedState]},useMutableSource:Ea,useSyncExternalStore:Sa,useId:Ha,unstable_isNewReconciler:!1};function eo(t,e){if(t&&t.defaultProps){for(var r in e=F({},e),t=t.defaultProps)void 0===e[r]&&(e[r]=t[r]);return e}return e}function ro(t,e,r,n){r=null===(r=r(n,e=t.memoizedState))||void 0===r?e:F({},e,r),t.memoizedState=r,0===t.lanes&&(t.updateQueue.baseState=r)}var no={isMounted:function(t){return!!(t=t._reactInternals)&&Wt(t)===t},enqueueSetState:function(t,e,r){t=t._reactInternals;var n=Jl(),i=tc(t),s=Us(n,i);s.payload=e,void 0!==r&&null!==r&&(s.callback=r),null!==(e=Bs(t,s,i))&&(ec(e,t,i,n),js(e,t,i))},enqueueReplaceState:function(t,e,r){t=t._reactInternals;var n=Jl(),i=tc(t),s=Us(n,i);s.tag=1,s.payload=e,void 0!==r&&null!==r&&(s.callback=r),null!==(e=Bs(t,s,i))&&(ec(e,t,i,n),js(e,t,i))},enqueueForceUpdate:function(t,e){t=t._reactInternals;var r=Jl(),n=tc(t),i=Us(r,n);i.tag=2,void 0!==e&&null!==e&&(i.callback=e),null!==(e=Bs(t,i,n))&&(ec(e,t,n,r),js(e,t,n))}};function io(t,e,r,n,i,s,a){return"function"===typeof(t=t.stateNode).shouldComponentUpdate?t.shouldComponentUpdate(n,s,a):!e.prototype||!e.prototype.isPureReactComponent||(!ln(r,n)||!ln(i,s))}function so(t,e,r){var n=!1,i=xi,s=e.contextType;return"object"===typeof s&&null!==s?s=Ls(s):(i=Ci(e)?Li:Ii.current,s=(n=null!==(n=e.contextTypes)&&void 0!==n)?Pi(t,i):xi),e=new e(r,s),t.memoizedState=null!==e.state&&void 0!==e.state?e.state:null,e.updater=no,t.stateNode=e,e._reactInternals=t,n&&((t=t.stateNode).__reactInternalMemoizedUnmaskedChildContext=i,t.__reactInternalMemoizedMaskedChildContext=s),e}function ao(t,e,r,n){t=e.state,"function"===typeof e.componentWillReceiveProps&&e.componentWillReceiveProps(r,n),"function"===typeof e.UNSAFE_componentWillReceiveProps&&e.UNSAFE_componentWillReceiveProps(r,n),e.state!==t&&no.enqueueReplaceState(e,e.state,null)}function oo(t,e,r,n){var i=t.stateNode;i.props=r,i.state=t.memoizedState,i.refs={},Ns(t);var s=e.contextType;"object"===typeof s&&null!==s?i.context=Ls(s):(s=Ci(e)?Li:Ii.current,i.context=Pi(t,s)),i.state=t.memoizedState,"function"===typeof(s=e.getDerivedStateFromProps)&&(ro(t,e,s,r),i.state=t.memoizedState),"function"===typeof e.getDerivedStateFromProps||"function"===typeof i.getSnapshotBeforeUpdate||"function"!==typeof i.UNSAFE_componentWillMount&&"function"!==typeof i.componentWillMount||(e=i.state,"function"===typeof i.componentWillMount&&i.componentWillMount(),"function"===typeof i.UNSAFE_componentWillMount&&i.UNSAFE_componentWillMount(),e!==i.state&&no.enqueueReplaceState(i,i.state,null),Ws(t,r,i,n),i.state=t.memoizedState),"function"===typeof i.componentDidMount&&(t.flags|=4194308)}function lo(t,e){try{var r="",n=e;do{r+=z(n),n=n.return}while(n);var i=r}catch(s){i="\nError generating stack: "+s.message+"\n"+s.stack}return{value:t,source:e,stack:i,digest:null}}function co(t,e,r){return{value:t,source:null,stack:null!=r?r:null,digest:null!=e?e:null}}function uo(t,e){try{console.error(e.value)}catch(r){setTimeout(function(){throw r})}}var ho="function"===typeof WeakMap?WeakMap:Map;function fo(t,e,r){(r=Us(-1,r)).tag=3,r.payload={element:null};var n=e.value;return r.callback=function(){Gl||(Gl=!0,Vl=n),uo(0,e)},r}function po(t,e,r){(r=Us(-1,r)).tag=3;var n=t.type.getDerivedStateFromError;if("function"===typeof n){var i=e.value;r.payload=function(){return n(i)},r.callback=function(){uo(0,e)}}var s=t.stateNode;return null!==s&&"function"===typeof s.componentDidCatch&&(r.callback=function(){uo(0,e),"function"!==typeof n&&(null===Hl?Hl=new Set([this]):Hl.add(this));var t=e.stack;this.componentDidCatch(e.value,{componentStack:null!==t?t:""})}),r}function go(t,e,r){var n=t.pingCache;if(null===n){n=t.pingCache=new ho;var i=new Set;n.set(e,i)}else void 0===(i=n.get(e))&&(i=new Set,n.set(e,i));i.has(r)||(i.add(r),t=Tc.bind(null,t,e,r),e.then(t,t))}function mo(t){do{var e;if((e=13===t.tag)&&(e=null===(e=t.memoizedState)||null!==e.dehydrated),e)return t;t=t.return}while(null!==t);return null}function yo(t,e,r,n,i){return 0===(1&t.mode)?(t===e?t.flags|=65536:(t.flags|=128,r.flags|=131072,r.flags&=-52805,1===r.tag&&(null===r.alternate?r.tag=17:((e=Us(-1,1)).tag=2,Bs(r,e,1))),r.lanes|=1),t):(t.flags|=65536,t.lanes=i,t)}var vo=_.ReactCurrentOwner,bo=!1;function _o(t,e,r,n){e.child=null===t?ws(e,null,r,n):_s(e,t.child,r,n)}function wo(t,e,r,n,i){r=r.render;var s=e.ref;return Rs(e,i),n=ga(t,e,r,n,s,i),r=ma(),null===t||bo?(is&&r&&ts(e),e.flags|=1,_o(t,e,n,i),e.child):(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~i,Go(t,e,i))}function Eo(t,e,r,n,i){if(null===t){var s=r.type;return"function"!==typeof s||Pc(s)||void 0!==s.defaultProps||null!==r.compare||void 0!==r.defaultProps?((t=Mc(r.type,null,n,e,e.mode,i)).ref=e.ref,t.return=e,e.child=t):(e.tag=15,e.type=s,So(t,e,s,n,i))}if(s=t.child,0===(t.lanes&i)){var a=s.memoizedProps;if((r=null!==(r=r.compare)?r:ln)(a,n)&&t.ref===e.ref)return Go(t,e,i)}return e.flags|=1,(t=Cc(s,n)).ref=e.ref,t.return=e,e.child=t}function So(t,e,r,n,i){if(null!==t){var s=t.memoizedProps;if(ln(s,n)&&t.ref===e.ref){if(bo=!1,e.pendingProps=n=s,0===(t.lanes&i))return e.lanes=t.lanes,Go(t,e,i);0!==(131072&t.flags)&&(bo=!0)}}return Ao(t,e,r,n,i)}function To(t,e,r){var n=e.pendingProps,i=n.children,s=null!==t?t.memoizedState:null;if("hidden"===n.mode)if(0===(1&e.mode))e.memoizedState={baseLanes:0,cachePool:null,transitions:null},Ai(Cl,Pl),Pl|=r;else{if(0===(1073741824&r))return t=null!==s?s.baseLanes|r:r,e.lanes=e.childLanes=1073741824,e.memoizedState={baseLanes:t,cachePool:null,transitions:null},e.updateQueue=null,Ai(Cl,Pl),Pl|=t,null;e.memoizedState={baseLanes:0,cachePool:null,transitions:null},n=null!==s?s.baseLanes:r,Ai(Cl,Pl),Pl|=n}else null!==s?(n=s.baseLanes|r,e.memoizedState=null):n=r,Ai(Cl,Pl),Pl|=n;return _o(t,e,i,r),e.child}function ko(t,e){var r=e.ref;(null===t&&null!==r||null!==t&&t.ref!==r)&&(e.flags|=512,e.flags|=2097152)}function Ao(t,e,r,n,i){var s=Ci(r)?Li:Ii.current;return s=Pi(e,s),Rs(e,i),r=ga(t,e,r,n,s,i),n=ma(),null===t||bo?(is&&n&&ts(e),e.flags|=1,_o(t,e,r,i),e.child):(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~i,Go(t,e,i))}function xo(t,e,r,n,i){if(Ci(r)){var s=!0;Ni(e)}else s=!1;if(Rs(e,i),null===e.stateNode)Wo(t,e),so(e,r,n),oo(e,r,n,i),n=!0;else if(null===t){var a=e.stateNode,o=e.memoizedProps;a.props=o;var l=a.context,c=r.contextType;"object"===typeof c&&null!==c?c=Ls(c):c=Pi(e,c=Ci(r)?Li:Ii.current);var u=r.getDerivedStateFromProps,h="function"===typeof u||"function"===typeof a.getSnapshotBeforeUpdate;h||"function"!==typeof a.UNSAFE_componentWillReceiveProps&&"function"!==typeof a.componentWillReceiveProps||(o!==n||l!==c)&&ao(e,a,n,c),Ds=!1;var d=e.memoizedState;a.state=d,Ws(e,n,a,i),l=e.memoizedState,o!==n||d!==l||Ri.current||Ds?("function"===typeof u&&(ro(e,r,u,n),l=e.memoizedState),(o=Ds||io(e,r,o,n,d,l,c))?(h||"function"!==typeof a.UNSAFE_componentWillMount&&"function"!==typeof a.componentWillMount||("function"===typeof a.componentWillMount&&a.componentWillMount(),"function"===typeof a.UNSAFE_componentWillMount&&a.UNSAFE_componentWillMount()),"function"===typeof a.componentDidMount&&(e.flags|=4194308)):("function"===typeof a.componentDidMount&&(e.flags|=4194308),e.memoizedProps=n,e.memoizedState=l),a.props=n,a.state=l,a.context=c,n=o):("function"===typeof a.componentDidMount&&(e.flags|=4194308),n=!1)}else{a=e.stateNode,Fs(t,e),o=e.memoizedProps,c=e.type===e.elementType?o:eo(e.type,o),a.props=c,h=e.pendingProps,d=a.context,"object"===typeof(l=r.contextType)&&null!==l?l=Ls(l):l=Pi(e,l=Ci(r)?Li:Ii.current);var f=r.getDerivedStateFromProps;(u="function"===typeof f||"function"===typeof a.getSnapshotBeforeUpdate)||"function"!==typeof a.UNSAFE_componentWillReceiveProps&&"function"!==typeof a.componentWillReceiveProps||(o!==h||d!==l)&&ao(e,a,n,l),Ds=!1,d=e.memoizedState,a.state=d,Ws(e,n,a,i);var p=e.memoizedState;o!==h||d!==p||Ri.current||Ds?("function"===typeof f&&(ro(e,r,f,n),p=e.memoizedState),(c=Ds||io(e,r,c,n,d,p,l)||!1)?(u||"function"!==typeof a.UNSAFE_componentWillUpdate&&"function"!==typeof a.componentWillUpdate||("function"===typeof a.componentWillUpdate&&a.componentWillUpdate(n,p,l),"function"===typeof a.UNSAFE_componentWillUpdate&&a.UNSAFE_componentWillUpdate(n,p,l)),"function"===typeof a.componentDidUpdate&&(e.flags|=4),"function"===typeof a.getSnapshotBeforeUpdate&&(e.flags|=1024)):("function"!==typeof a.componentDidUpdate||o===t.memoizedProps&&d===t.memoizedState||(e.flags|=4),"function"!==typeof a.getSnapshotBeforeUpdate||o===t.memoizedProps&&d===t.memoizedState||(e.flags|=1024),e.memoizedProps=n,e.memoizedState=p),a.props=n,a.state=p,a.context=l,n=c):("function"!==typeof a.componentDidUpdate||o===t.memoizedProps&&d===t.memoizedState||(e.flags|=4),"function"!==typeof a.getSnapshotBeforeUpdate||o===t.memoizedProps&&d===t.memoizedState||(e.flags|=1024),n=!1)}return Io(t,e,r,n,s,i)}function Io(t,e,r,n,i,s){ko(t,e);var a=0!==(128&e.flags);if(!n&&!a)return i&&Fi(e,r,!1),Go(t,e,s);n=e.stateNode,vo.current=e;var o=a&&"function"!==typeof r.getDerivedStateFromError?null:n.render();return e.flags|=1,null!==t&&a?(e.child=_s(e,t.child,null,s),e.child=_s(e,null,o,s)):_o(t,e,o,s),e.memoizedState=n.state,i&&Fi(e,r,!0),e.child}function Ro(t){var e=t.stateNode;e.pendingContext?Oi(0,e.pendingContext,e.pendingContext!==e.context):e.context&&Oi(0,e.context,!1),Qs(t,e.containerInfo)}function Lo(t,e,r,n,i){return fs(),ps(i),e.flags|=256,_o(t,e,r,n),e.child}var Po,Co,Mo,Oo={dehydrated:null,treeContext:null,retryLane:0};function Do(t){return{baseLanes:t,cachePool:null,transitions:null}}function No(t,e,r){var n,i=e.pendingProps,a=Js.current,o=!1,l=0!==(128&e.flags);if((n=l)||(n=(null===t||null!==t.memoizedState)&&0!==(2&a)),n?(o=!0,e.flags&=-129):null!==t&&null===t.memoizedState||(a|=1),Ai(Js,1&a),null===t)return cs(e),null!==(t=e.memoizedState)&&null!==(t=t.dehydrated)?(0===(1&e.mode)?e.lanes=1:"$!"===t.data?e.lanes=8:e.lanes=1073741824,null):(l=i.children,t=i.fallback,o?(i=e.mode,o=e.child,l={mode:"hidden",children:l},0===(1&i)&&null!==o?(o.childLanes=0,o.pendingProps=l):o=Dc(l,i,0,null),t=Oc(t,i,r,null),o.return=e,t.return=e,o.sibling=t,e.child=o,e.child.memoizedState=Do(r),e.memoizedState=Oo,t):Fo(e,l));if(null!==(a=t.memoizedState)&&null!==(n=a.dehydrated))return function(t,e,r,n,i,a,o){if(r)return 256&e.flags?(e.flags&=-257,Uo(t,e,o,n=co(Error(s(422))))):null!==e.memoizedState?(e.child=t.child,e.flags|=128,null):(a=n.fallback,i=e.mode,n=Dc({mode:"visible",children:n.children},i,0,null),(a=Oc(a,i,o,null)).flags|=2,n.return=e,a.return=e,n.sibling=a,e.child=n,0!==(1&e.mode)&&_s(e,t.child,null,o),e.child.memoizedState=Do(o),e.memoizedState=Oo,a);if(0===(1&e.mode))return Uo(t,e,o,null);if("$!"===i.data){if(n=i.nextSibling&&i.nextSibling.dataset)var l=n.dgst;return n=l,Uo(t,e,o,n=co(a=Error(s(419)),n,void 0))}if(l=0!==(o&t.childLanes),bo||l){if(null!==(n=Il)){switch(o&-o){case 4:i=2;break;case 16:i=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:i=32;break;case 536870912:i=268435456;break;default:i=0}0!==(i=0!==(i&(n.suspendedLanes|o))?0:i)&&i!==a.retryLane&&(a.retryLane=i,Os(t,i),ec(n,t,i,-1))}return pc(),Uo(t,e,o,n=co(Error(s(421))))}return"$?"===i.data?(e.flags|=128,e.child=t.child,e=Ac.bind(null,t),i._reactRetry=e,null):(t=a.treeContext,ns=ci(i.nextSibling),rs=e,is=!0,ss=null,null!==t&&(qi[Yi++]=Xi,qi[Yi++]=$i,qi[Yi++]=Qi,Xi=t.id,$i=t.overflow,Qi=e),e=Fo(e,n.children),e.flags|=4096,e)}(t,e,l,i,n,a,r);if(o){o=i.fallback,l=e.mode,n=(a=t.child).sibling;var c={mode:"hidden",children:i.children};return 0===(1&l)&&e.child!==a?((i=e.child).childLanes=0,i.pendingProps=c,e.deletions=null):(i=Cc(a,c)).subtreeFlags=14680064&a.subtreeFlags,null!==n?o=Cc(n,o):(o=Oc(o,l,r,null)).flags|=2,o.return=e,i.return=e,i.sibling=o,e.child=i,i=o,o=e.child,l=null===(l=t.child.memoizedState)?Do(r):{baseLanes:l.baseLanes|r,cachePool:null,transitions:l.transitions},o.memoizedState=l,o.childLanes=t.childLanes&~r,e.memoizedState=Oo,i}return t=(o=t.child).sibling,i=Cc(o,{mode:"visible",children:i.children}),0===(1&e.mode)&&(i.lanes=r),i.return=e,i.sibling=null,null!==t&&(null===(r=e.deletions)?(e.deletions=[t],e.flags|=16):r.push(t)),e.child=i,e.memoizedState=null,i}function Fo(t,e){return(e=Dc({mode:"visible",children:e},t.mode,0,null)).return=t,t.child=e}function Uo(t,e,r,n){return null!==n&&ps(n),_s(e,t.child,null,r),(t=Fo(e,e.pendingProps.children)).flags|=2,e.memoizedState=null,t}function Bo(t,e,r){t.lanes|=e;var n=t.alternate;null!==n&&(n.lanes|=e),Is(t.return,e,r)}function jo(t,e,r,n,i){var s=t.memoizedState;null===s?t.memoizedState={isBackwards:e,rendering:null,renderingStartTime:0,last:n,tail:r,tailMode:i}:(s.isBackwards=e,s.rendering=null,s.renderingStartTime=0,s.last=n,s.tail=r,s.tailMode=i)}function zo(t,e,r){var n=e.pendingProps,i=n.revealOrder,s=n.tail;if(_o(t,e,n.children,r),0!==(2&(n=Js.current)))n=1&n|2,e.flags|=128;else{if(null!==t&&0!==(128&t.flags))t:for(t=e.child;null!==t;){if(13===t.tag)null!==t.memoizedState&&Bo(t,r,e);else if(19===t.tag)Bo(t,r,e);else if(null!==t.child){t.child.return=t,t=t.child;continue}if(t===e)break t;for(;null===t.sibling;){if(null===t.return||t.return===e)break t;t=t.return}t.sibling.return=t.return,t=t.sibling}n&=1}if(Ai(Js,n),0===(1&e.mode))e.memoizedState=null;else switch(i){case"forwards":for(r=e.child,i=null;null!==r;)null!==(t=r.alternate)&&null===ta(t)&&(i=r),r=r.sibling;null===(r=i)?(i=e.child,e.child=null):(i=r.sibling,r.sibling=null),jo(e,!1,i,r,s);break;case"backwards":for(r=null,i=e.child,e.child=null;null!==i;){if(null!==(t=i.alternate)&&null===ta(t)){e.child=i;break}t=i.sibling,i.sibling=r,r=i,i=t}jo(e,!0,r,null,s);break;case"together":jo(e,!1,null,null,void 0);break;default:e.memoizedState=null}return e.child}function Wo(t,e){0===(1&e.mode)&&null!==t&&(t.alternate=null,e.alternate=null,e.flags|=2)}function Go(t,e,r){if(null!==t&&(e.dependencies=t.dependencies),Dl|=e.lanes,0===(r&e.childLanes))return null;if(null!==t&&e.child!==t.child)throw Error(s(153));if(null!==e.child){for(r=Cc(t=e.child,t.pendingProps),e.child=r,r.return=e;null!==t.sibling;)t=t.sibling,(r=r.sibling=Cc(t,t.pendingProps)).return=e;r.sibling=null}return e.child}function Vo(t,e){if(!is)switch(t.tailMode){case"hidden":e=t.tail;for(var r=null;null!==e;)null!==e.alternate&&(r=e),e=e.sibling;null===r?t.tail=null:r.sibling=null;break;case"collapsed":r=t.tail;for(var n=null;null!==r;)null!==r.alternate&&(n=r),r=r.sibling;null===n?e||null===t.tail?t.tail=null:t.tail.sibling=null:n.sibling=null}}function Ho(t){var e=null!==t.alternate&&t.alternate.child===t.child,r=0,n=0;if(e)for(var i=t.child;null!==i;)r|=i.lanes|i.childLanes,n|=14680064&i.subtreeFlags,n|=14680064&i.flags,i.return=t,i=i.sibling;else for(i=t.child;null!==i;)r|=i.lanes|i.childLanes,n|=i.subtreeFlags,n|=i.flags,i.return=t,i=i.sibling;return t.subtreeFlags|=n,t.childLanes=r,e}function Ko(t,e,r){var n=e.pendingProps;switch(es(e),e.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Ho(e),null;case 1:case 17:return Ci(e.type)&&Mi(),Ho(e),null;case 3:return n=e.stateNode,Xs(),ki(Ri),ki(Ii),ra(),n.pendingContext&&(n.context=n.pendingContext,n.pendingContext=null),null!==t&&null!==t.child||(hs(e)?e.flags|=4:null===t||t.memoizedState.isDehydrated&&0===(256&e.flags)||(e.flags|=1024,null!==ss&&(sc(ss),ss=null))),Ho(e),null;case 5:Zs(e);var i=Ys(qs.current);if(r=e.type,null!==t&&null!=e.stateNode)Co(t,e,r,n),t.ref!==e.ref&&(e.flags|=512,e.flags|=2097152);else{if(!n){if(null===e.stateNode)throw Error(s(166));return Ho(e),null}if(t=Ys(Hs.current),hs(e)){n=e.stateNode,r=e.type;var a=e.memoizedProps;switch(n[di]=e,n[fi]=a,t=0!==(1&e.mode),r){case"dialog":Bn("cancel",n),Bn("close",n);break;case"iframe":case"object":case"embed":Bn("load",n);break;case"video":case"audio":for(i=0;i<Dn.length;i++)Bn(Dn[i],n);break;case"source":Bn("error",n);break;case"img":case"image":case"link":Bn("error",n),Bn("load",n);break;case"details":Bn("toggle",n);break;case"input":X(n,a),Bn("invalid",n);break;case"select":n._wrapperState={wasMultiple:!!a.multiple},Bn("invalid",n);break;case"textarea":it(n,a),Bn("invalid",n)}for(var l in vt(r,a),i=null,a)if(a.hasOwnProperty(l)){var c=a[l];"children"===l?"string"===typeof c?n.textContent!==c&&(!0!==a.suppressHydrationWarning&&Zn(n.textContent,c,t),i=["children",c]):"number"===typeof c&&n.textContent!==""+c&&(!0!==a.suppressHydrationWarning&&Zn(n.textContent,c,t),i=["children",""+c]):o.hasOwnProperty(l)&&null!=c&&"onScroll"===l&&Bn("scroll",n)}switch(r){case"input":K(n),J(n,a,!0);break;case"textarea":K(n),at(n);break;case"select":case"option":break;default:"function"===typeof a.onClick&&(n.onclick=Jn)}n=i,e.updateQueue=n,null!==n&&(e.flags|=4)}else{l=9===i.nodeType?i:i.ownerDocument,"http://www.w3.org/1999/xhtml"===t&&(t=ot(r)),"http://www.w3.org/1999/xhtml"===t?"script"===r?((t=l.createElement("div")).innerHTML="<script><\/script>",t=t.removeChild(t.firstChild)):"string"===typeof n.is?t=l.createElement(r,{is:n.is}):(t=l.createElement(r),"select"===r&&(l=t,n.multiple?l.multiple=!0:n.size&&(l.size=n.size))):t=l.createElementNS(t,r),t[di]=e,t[fi]=n,Po(t,e),e.stateNode=t;t:{switch(l=bt(r,n),r){case"dialog":Bn("cancel",t),Bn("close",t),i=n;break;case"iframe":case"object":case"embed":Bn("load",t),i=n;break;case"video":case"audio":for(i=0;i<Dn.length;i++)Bn(Dn[i],t);i=n;break;case"source":Bn("error",t),i=n;break;case"img":case"image":case"link":Bn("error",t),Bn("load",t),i=n;break;case"details":Bn("toggle",t),i=n;break;case"input":X(t,n),i=Q(t,n),Bn("invalid",t);break;case"option":default:i=n;break;case"select":t._wrapperState={wasMultiple:!!n.multiple},i=F({},n,{value:void 0}),Bn("invalid",t);break;case"textarea":it(t,n),i=nt(t,n),Bn("invalid",t)}for(a in vt(r,i),c=i)if(c.hasOwnProperty(a)){var u=c[a];"style"===a?mt(t,u):"dangerouslySetInnerHTML"===a?null!=(u=u?u.__html:void 0)&&ht(t,u):"children"===a?"string"===typeof u?("textarea"!==r||""!==u)&&dt(t,u):"number"===typeof u&&dt(t,""+u):"suppressContentEditableWarning"!==a&&"suppressHydrationWarning"!==a&&"autoFocus"!==a&&(o.hasOwnProperty(a)?null!=u&&"onScroll"===a&&Bn("scroll",t):null!=u&&b(t,a,u,l))}switch(r){case"input":K(t),J(t,n,!1);break;case"textarea":K(t),at(t);break;case"option":null!=n.value&&t.setAttribute("value",""+V(n.value));break;case"select":t.multiple=!!n.multiple,null!=(a=n.value)?rt(t,!!n.multiple,a,!1):null!=n.defaultValue&&rt(t,!!n.multiple,n.defaultValue,!0);break;default:"function"===typeof i.onClick&&(t.onclick=Jn)}switch(r){case"button":case"input":case"select":case"textarea":n=!!n.autoFocus;break t;case"img":n=!0;break t;default:n=!1}}n&&(e.flags|=4)}null!==e.ref&&(e.flags|=512,e.flags|=2097152)}return Ho(e),null;case 6:if(t&&null!=e.stateNode)Mo(0,e,t.memoizedProps,n);else{if("string"!==typeof n&&null===e.stateNode)throw Error(s(166));if(r=Ys(qs.current),Ys(Hs.current),hs(e)){if(n=e.stateNode,r=e.memoizedProps,n[di]=e,(a=n.nodeValue!==r)&&null!==(t=rs))switch(t.tag){case 3:Zn(n.nodeValue,r,0!==(1&t.mode));break;case 5:!0!==t.memoizedProps.suppressHydrationWarning&&Zn(n.nodeValue,r,0!==(1&t.mode))}a&&(e.flags|=4)}else(n=(9===r.nodeType?r:r.ownerDocument).createTextNode(n))[di]=e,e.stateNode=n}return Ho(e),null;case 13:if(ki(Js),n=e.memoizedState,null===t||null!==t.memoizedState&&null!==t.memoizedState.dehydrated){if(is&&null!==ns&&0!==(1&e.mode)&&0===(128&e.flags))ds(),fs(),e.flags|=98560,a=!1;else if(a=hs(e),null!==n&&null!==n.dehydrated){if(null===t){if(!a)throw Error(s(318));if(!(a=null!==(a=e.memoizedState)?a.dehydrated:null))throw Error(s(317));a[di]=e}else fs(),0===(128&e.flags)&&(e.memoizedState=null),e.flags|=4;Ho(e),a=!1}else null!==ss&&(sc(ss),ss=null),a=!0;if(!a)return 65536&e.flags?e:null}return 0!==(128&e.flags)?(e.lanes=r,e):((n=null!==n)!==(null!==t&&null!==t.memoizedState)&&n&&(e.child.flags|=8192,0!==(1&e.mode)&&(null===t||0!==(1&Js.current)?0===Ml&&(Ml=3):pc())),null!==e.updateQueue&&(e.flags|=4),Ho(e),null);case 4:return Xs(),null===t&&Wn(e.stateNode.containerInfo),Ho(e),null;case 10:return xs(e.type._context),Ho(e),null;case 19:if(ki(Js),null===(a=e.memoizedState))return Ho(e),null;if(n=0!==(128&e.flags),null===(l=a.rendering))if(n)Vo(a,!1);else{if(0!==Ml||null!==t&&0!==(128&t.flags))for(t=e.child;null!==t;){if(null!==(l=ta(t))){for(e.flags|=128,Vo(a,!1),null!==(n=l.updateQueue)&&(e.updateQueue=n,e.flags|=4),e.subtreeFlags=0,n=r,r=e.child;null!==r;)t=n,(a=r).flags&=14680066,null===(l=a.alternate)?(a.childLanes=0,a.lanes=t,a.child=null,a.subtreeFlags=0,a.memoizedProps=null,a.memoizedState=null,a.updateQueue=null,a.dependencies=null,a.stateNode=null):(a.childLanes=l.childLanes,a.lanes=l.lanes,a.child=l.child,a.subtreeFlags=0,a.deletions=null,a.memoizedProps=l.memoizedProps,a.memoizedState=l.memoizedState,a.updateQueue=l.updateQueue,a.type=l.type,t=l.dependencies,a.dependencies=null===t?null:{lanes:t.lanes,firstContext:t.firstContext}),r=r.sibling;return Ai(Js,1&Js.current|2),e.child}t=t.sibling}null!==a.tail&&$t()>zl&&(e.flags|=128,n=!0,Vo(a,!1),e.lanes=4194304)}else{if(!n)if(null!==(t=ta(l))){if(e.flags|=128,n=!0,null!==(r=t.updateQueue)&&(e.updateQueue=r,e.flags|=4),Vo(a,!0),null===a.tail&&"hidden"===a.tailMode&&!l.alternate&&!is)return Ho(e),null}else 2*$t()-a.renderingStartTime>zl&&1073741824!==r&&(e.flags|=128,n=!0,Vo(a,!1),e.lanes=4194304);a.isBackwards?(l.sibling=e.child,e.child=l):(null!==(r=a.last)?r.sibling=l:e.child=l,a.last=l)}return null!==a.tail?(e=a.tail,a.rendering=e,a.tail=e.sibling,a.renderingStartTime=$t(),e.sibling=null,r=Js.current,Ai(Js,n?1&r|2:1&r),e):(Ho(e),null);case 22:case 23:return uc(),n=null!==e.memoizedState,null!==t&&null!==t.memoizedState!==n&&(e.flags|=8192),n&&0!==(1&e.mode)?0!==(1073741824&Pl)&&(Ho(e),6&e.subtreeFlags&&(e.flags|=8192)):Ho(e),null;case 24:case 25:return null}throw Error(s(156,e.tag))}function qo(t,e){switch(es(e),e.tag){case 1:return Ci(e.type)&&Mi(),65536&(t=e.flags)?(e.flags=-65537&t|128,e):null;case 3:return Xs(),ki(Ri),ki(Ii),ra(),0!==(65536&(t=e.flags))&&0===(128&t)?(e.flags=-65537&t|128,e):null;case 5:return Zs(e),null;case 13:if(ki(Js),null!==(t=e.memoizedState)&&null!==t.dehydrated){if(null===e.alternate)throw Error(s(340));fs()}return 65536&(t=e.flags)?(e.flags=-65537&t|128,e):null;case 19:return ki(Js),null;case 4:return Xs(),null;case 10:return xs(e.type._context),null;case 22:case 23:return uc(),null;default:return null}}Po=function(t,e){for(var r=e.child;null!==r;){if(5===r.tag||6===r.tag)t.appendChild(r.stateNode);else if(4!==r.tag&&null!==r.child){r.child.return=r,r=r.child;continue}if(r===e)break;for(;null===r.sibling;){if(null===r.return||r.return===e)return;r=r.return}r.sibling.return=r.return,r=r.sibling}},Co=function(t,e,r,n){var i=t.memoizedProps;if(i!==n){t=e.stateNode,Ys(Hs.current);var s,a=null;switch(r){case"input":i=Q(t,i),n=Q(t,n),a=[];break;case"select":i=F({},i,{value:void 0}),n=F({},n,{value:void 0}),a=[];break;case"textarea":i=nt(t,i),n=nt(t,n),a=[];break;default:"function"!==typeof i.onClick&&"function"===typeof n.onClick&&(t.onclick=Jn)}for(u in vt(r,n),r=null,i)if(!n.hasOwnProperty(u)&&i.hasOwnProperty(u)&&null!=i[u])if("style"===u){var l=i[u];for(s in l)l.hasOwnProperty(s)&&(r||(r={}),r[s]="")}else"dangerouslySetInnerHTML"!==u&&"children"!==u&&"suppressContentEditableWarning"!==u&&"suppressHydrationWarning"!==u&&"autoFocus"!==u&&(o.hasOwnProperty(u)?a||(a=[]):(a=a||[]).push(u,null));for(u in n){var c=n[u];if(l=null!=i?i[u]:void 0,n.hasOwnProperty(u)&&c!==l&&(null!=c||null!=l))if("style"===u)if(l){for(s in l)!l.hasOwnProperty(s)||c&&c.hasOwnProperty(s)||(r||(r={}),r[s]="");for(s in c)c.hasOwnProperty(s)&&l[s]!==c[s]&&(r||(r={}),r[s]=c[s])}else r||(a||(a=[]),a.push(u,r)),r=c;else"dangerouslySetInnerHTML"===u?(c=c?c.__html:void 0,l=l?l.__html:void 0,null!=c&&l!==c&&(a=a||[]).push(u,c)):"children"===u?"string"!==typeof c&&"number"!==typeof c||(a=a||[]).push(u,""+c):"suppressContentEditableWarning"!==u&&"suppressHydrationWarning"!==u&&(o.hasOwnProperty(u)?(null!=c&&"onScroll"===u&&Bn("scroll",t),a||l===c||(a=[])):(a=a||[]).push(u,c))}r&&(a=a||[]).push("style",r);var u=a;(e.updateQueue=u)&&(e.flags|=4)}},Mo=function(t,e,r,n){r!==n&&(e.flags|=4)};var Yo=!1,Qo=!1,Xo="function"===typeof WeakSet?WeakSet:Set,$o=null;function Zo(t,e){var r=t.ref;if(null!==r)if("function"===typeof r)try{r(null)}catch(n){Sc(t,e,n)}else r.current=null}function Jo(t,e,r){try{r()}catch(n){Sc(t,e,n)}}var tl=!1;function el(t,e,r){var n=e.updateQueue;if(null!==(n=null!==n?n.lastEffect:null)){var i=n=n.next;do{if((i.tag&t)===t){var s=i.destroy;i.destroy=void 0,void 0!==s&&Jo(e,r,s)}i=i.next}while(i!==n)}}function rl(t,e){if(null!==(e=null!==(e=e.updateQueue)?e.lastEffect:null)){var r=e=e.next;do{if((r.tag&t)===t){var n=r.create;r.destroy=n()}r=r.next}while(r!==e)}}function nl(t){var e=t.ref;if(null!==e){var r=t.stateNode;t.tag,t=r,"function"===typeof e?e(t):e.current=t}}function il(t){var e=t.alternate;null!==e&&(t.alternate=null,il(e)),t.child=null,t.deletions=null,t.sibling=null,5===t.tag&&(null!==(e=t.stateNode)&&(delete e[di],delete e[fi],delete e[gi],delete e[mi],delete e[yi])),t.stateNode=null,t.return=null,t.dependencies=null,t.memoizedProps=null,t.memoizedState=null,t.pendingProps=null,t.stateNode=null,t.updateQueue=null}function sl(t){return 5===t.tag||3===t.tag||4===t.tag}function al(t){t:for(;;){for(;null===t.sibling;){if(null===t.return||sl(t.return))return null;t=t.return}for(t.sibling.return=t.return,t=t.sibling;5!==t.tag&&6!==t.tag&&18!==t.tag;){if(2&t.flags)continue t;if(null===t.child||4===t.tag)continue t;t.child.return=t,t=t.child}if(!(2&t.flags))return t.stateNode}}function ol(t,e,r){var n=t.tag;if(5===n||6===n)t=t.stateNode,e?8===r.nodeType?r.parentNode.insertBefore(t,e):r.insertBefore(t,e):(8===r.nodeType?(e=r.parentNode).insertBefore(t,r):(e=r).appendChild(t),null!==(r=r._reactRootContainer)&&void 0!==r||null!==e.onclick||(e.onclick=Jn));else if(4!==n&&null!==(t=t.child))for(ol(t,e,r),t=t.sibling;null!==t;)ol(t,e,r),t=t.sibling}function ll(t,e,r){var n=t.tag;if(5===n||6===n)t=t.stateNode,e?r.insertBefore(t,e):r.appendChild(t);else if(4!==n&&null!==(t=t.child))for(ll(t,e,r),t=t.sibling;null!==t;)ll(t,e,r),t=t.sibling}var cl=null,ul=!1;function hl(t,e,r){for(r=r.child;null!==r;)dl(t,e,r),r=r.sibling}function dl(t,e,r){if(se&&"function"===typeof se.onCommitFiberUnmount)try{se.onCommitFiberUnmount(ie,r)}catch(o){}switch(r.tag){case 5:Qo||Zo(r,e);case 6:var n=cl,i=ul;cl=null,hl(t,e,r),ul=i,null!==(cl=n)&&(ul?(t=cl,r=r.stateNode,8===t.nodeType?t.parentNode.removeChild(r):t.removeChild(r)):cl.removeChild(r.stateNode));break;case 18:null!==cl&&(ul?(t=cl,r=r.stateNode,8===t.nodeType?li(t.parentNode,r):1===t.nodeType&&li(t,r),We(t)):li(cl,r.stateNode));break;case 4:n=cl,i=ul,cl=r.stateNode.containerInfo,ul=!0,hl(t,e,r),cl=n,ul=i;break;case 0:case 11:case 14:case 15:if(!Qo&&(null!==(n=r.updateQueue)&&null!==(n=n.lastEffect))){i=n=n.next;do{var s=i,a=s.destroy;s=s.tag,void 0!==a&&(0!==(2&s)||0!==(4&s))&&Jo(r,e,a),i=i.next}while(i!==n)}hl(t,e,r);break;case 1:if(!Qo&&(Zo(r,e),"function"===typeof(n=r.stateNode).componentWillUnmount))try{n.props=r.memoizedProps,n.state=r.memoizedState,n.componentWillUnmount()}catch(o){Sc(r,e,o)}hl(t,e,r);break;case 21:hl(t,e,r);break;case 22:1&r.mode?(Qo=(n=Qo)||null!==r.memoizedState,hl(t,e,r),Qo=n):hl(t,e,r);break;default:hl(t,e,r)}}function fl(t){var e=t.updateQueue;if(null!==e){t.updateQueue=null;var r=t.stateNode;null===r&&(r=t.stateNode=new Xo),e.forEach(function(e){var n=xc.bind(null,t,e);r.has(e)||(r.add(e),e.then(n,n))})}}function pl(t,e){var r=e.deletions;if(null!==r)for(var n=0;n<r.length;n++){var i=r[n];try{var a=t,o=e,l=o;t:for(;null!==l;){switch(l.tag){case 5:cl=l.stateNode,ul=!1;break t;case 3:case 4:cl=l.stateNode.containerInfo,ul=!0;break t}l=l.return}if(null===cl)throw Error(s(160));dl(a,o,i),cl=null,ul=!1;var c=i.alternate;null!==c&&(c.return=null),i.return=null}catch(u){Sc(i,e,u)}}if(12854&e.subtreeFlags)for(e=e.child;null!==e;)gl(e,t),e=e.sibling}function gl(t,e){var r=t.alternate,n=t.flags;switch(t.tag){case 0:case 11:case 14:case 15:if(pl(e,t),ml(t),4&n){try{el(3,t,t.return),rl(3,t)}catch(m){Sc(t,t.return,m)}try{el(5,t,t.return)}catch(m){Sc(t,t.return,m)}}break;case 1:pl(e,t),ml(t),512&n&&null!==r&&Zo(r,r.return);break;case 5:if(pl(e,t),ml(t),512&n&&null!==r&&Zo(r,r.return),32&t.flags){var i=t.stateNode;try{dt(i,"")}catch(m){Sc(t,t.return,m)}}if(4&n&&null!=(i=t.stateNode)){var a=t.memoizedProps,o=null!==r?r.memoizedProps:a,l=t.type,c=t.updateQueue;if(t.updateQueue=null,null!==c)try{"input"===l&&"radio"===a.type&&null!=a.name&&$(i,a),bt(l,o);var u=bt(l,a);for(o=0;o<c.length;o+=2){var h=c[o],d=c[o+1];"style"===h?mt(i,d):"dangerouslySetInnerHTML"===h?ht(i,d):"children"===h?dt(i,d):b(i,h,d,u)}switch(l){case"input":Z(i,a);break;case"textarea":st(i,a);break;case"select":var f=i._wrapperState.wasMultiple;i._wrapperState.wasMultiple=!!a.multiple;var p=a.value;null!=p?rt(i,!!a.multiple,p,!1):f!==!!a.multiple&&(null!=a.defaultValue?rt(i,!!a.multiple,a.defaultValue,!0):rt(i,!!a.multiple,a.multiple?[]:"",!1))}i[fi]=a}catch(m){Sc(t,t.return,m)}}break;case 6:if(pl(e,t),ml(t),4&n){if(null===t.stateNode)throw Error(s(162));i=t.stateNode,a=t.memoizedProps;try{i.nodeValue=a}catch(m){Sc(t,t.return,m)}}break;case 3:if(pl(e,t),ml(t),4&n&&null!==r&&r.memoizedState.isDehydrated)try{We(e.containerInfo)}catch(m){Sc(t,t.return,m)}break;case 4:default:pl(e,t),ml(t);break;case 13:pl(e,t),ml(t),8192&(i=t.child).flags&&(a=null!==i.memoizedState,i.stateNode.isHidden=a,!a||null!==i.alternate&&null!==i.alternate.memoizedState||(jl=$t())),4&n&&fl(t);break;case 22:if(h=null!==r&&null!==r.memoizedState,1&t.mode?(Qo=(u=Qo)||h,pl(e,t),Qo=u):pl(e,t),ml(t),8192&n){if(u=null!==t.memoizedState,(t.stateNode.isHidden=u)&&!h&&0!==(1&t.mode))for($o=t,h=t.child;null!==h;){for(d=$o=h;null!==$o;){switch(p=(f=$o).child,f.tag){case 0:case 11:case 14:case 15:el(4,f,f.return);break;case 1:Zo(f,f.return);var g=f.stateNode;if("function"===typeof g.componentWillUnmount){n=f,r=f.return;try{e=n,g.props=e.memoizedProps,g.state=e.memoizedState,g.componentWillUnmount()}catch(m){Sc(n,r,m)}}break;case 5:Zo(f,f.return);break;case 22:if(null!==f.memoizedState){_l(d);continue}}null!==p?(p.return=f,$o=p):_l(d)}h=h.sibling}t:for(h=null,d=t;;){if(5===d.tag){if(null===h){h=d;try{i=d.stateNode,u?"function"===typeof(a=i.style).setProperty?a.setProperty("display","none","important"):a.display="none":(l=d.stateNode,o=void 0!==(c=d.memoizedProps.style)&&null!==c&&c.hasOwnProperty("display")?c.display:null,l.style.display=gt("display",o))}catch(m){Sc(t,t.return,m)}}}else if(6===d.tag){if(null===h)try{d.stateNode.nodeValue=u?"":d.memoizedProps}catch(m){Sc(t,t.return,m)}}else if((22!==d.tag&&23!==d.tag||null===d.memoizedState||d===t)&&null!==d.child){d.child.return=d,d=d.child;continue}if(d===t)break t;for(;null===d.sibling;){if(null===d.return||d.return===t)break t;h===d&&(h=null),d=d.return}h===d&&(h=null),d.sibling.return=d.return,d=d.sibling}}break;case 19:pl(e,t),ml(t),4&n&&fl(t);case 21:}}function ml(t){var e=t.flags;if(2&e){try{t:{for(var r=t.return;null!==r;){if(sl(r)){var n=r;break t}r=r.return}throw Error(s(160))}switch(n.tag){case 5:var i=n.stateNode;32&n.flags&&(dt(i,""),n.flags&=-33),ll(t,al(t),i);break;case 3:case 4:var a=n.stateNode.containerInfo;ol(t,al(t),a);break;default:throw Error(s(161))}}catch(o){Sc(t,t.return,o)}t.flags&=-3}4096&e&&(t.flags&=-4097)}function yl(t,e,r){$o=t,vl(t,e,r)}function vl(t,e,r){for(var n=0!==(1&t.mode);null!==$o;){var i=$o,s=i.child;if(22===i.tag&&n){var a=null!==i.memoizedState||Yo;if(!a){var o=i.alternate,l=null!==o&&null!==o.memoizedState||Qo;o=Yo;var c=Qo;if(Yo=a,(Qo=l)&&!c)for($o=i;null!==$o;)l=(a=$o).child,22===a.tag&&null!==a.memoizedState?wl(i):null!==l?(l.return=a,$o=l):wl(i);for(;null!==s;)$o=s,vl(s,e,r),s=s.sibling;$o=i,Yo=o,Qo=c}bl(t)}else 0!==(8772&i.subtreeFlags)&&null!==s?(s.return=i,$o=s):bl(t)}}function bl(t){for(;null!==$o;){var e=$o;if(0!==(8772&e.flags)){var r=e.alternate;try{if(0!==(8772&e.flags))switch(e.tag){case 0:case 11:case 15:Qo||rl(5,e);break;case 1:var n=e.stateNode;if(4&e.flags&&!Qo)if(null===r)n.componentDidMount();else{var i=e.elementType===e.type?r.memoizedProps:eo(e.type,r.memoizedProps);n.componentDidUpdate(i,r.memoizedState,n.__reactInternalSnapshotBeforeUpdate)}var a=e.updateQueue;null!==a&&Gs(e,a,n);break;case 3:var o=e.updateQueue;if(null!==o){if(r=null,null!==e.child)switch(e.child.tag){case 5:case 1:r=e.child.stateNode}Gs(e,o,r)}break;case 5:var l=e.stateNode;if(null===r&&4&e.flags){r=l;var c=e.memoizedProps;switch(e.type){case"button":case"input":case"select":case"textarea":c.autoFocus&&r.focus();break;case"img":c.src&&(r.src=c.src)}}break;case 6:case 4:case 12:case 19:case 17:case 21:case 22:case 23:case 25:break;case 13:if(null===e.memoizedState){var u=e.alternate;if(null!==u){var h=u.memoizedState;if(null!==h){var d=h.dehydrated;null!==d&&We(d)}}}break;default:throw Error(s(163))}Qo||512&e.flags&&nl(e)}catch(f){Sc(e,e.return,f)}}if(e===t){$o=null;break}if(null!==(r=e.sibling)){r.return=e.return,$o=r;break}$o=e.return}}function _l(t){for(;null!==$o;){var e=$o;if(e===t){$o=null;break}var r=e.sibling;if(null!==r){r.return=e.return,$o=r;break}$o=e.return}}function wl(t){for(;null!==$o;){var e=$o;try{switch(e.tag){case 0:case 11:case 15:var r=e.return;try{rl(4,e)}catch(l){Sc(e,r,l)}break;case 1:var n=e.stateNode;if("function"===typeof n.componentDidMount){var i=e.return;try{n.componentDidMount()}catch(l){Sc(e,i,l)}}var s=e.return;try{nl(e)}catch(l){Sc(e,s,l)}break;case 5:var a=e.return;try{nl(e)}catch(l){Sc(e,a,l)}}}catch(l){Sc(e,e.return,l)}if(e===t){$o=null;break}var o=e.sibling;if(null!==o){o.return=e.return,$o=o;break}$o=e.return}}var El,Sl=Math.ceil,Tl=_.ReactCurrentDispatcher,kl=_.ReactCurrentOwner,Al=_.ReactCurrentBatchConfig,xl=0,Il=null,Rl=null,Ll=0,Pl=0,Cl=Ti(0),Ml=0,Ol=null,Dl=0,Nl=0,Fl=0,Ul=null,Bl=null,jl=0,zl=1/0,Wl=null,Gl=!1,Vl=null,Hl=null,Kl=!1,ql=null,Yl=0,Ql=0,Xl=null,$l=-1,Zl=0;function Jl(){return 0!==(6&xl)?$t():-1!==$l?$l:$l=$t()}function tc(t){return 0===(1&t.mode)?1:0!==(2&xl)&&0!==Ll?Ll&-Ll:null!==gs.transition?(0===Zl&&(Zl=ge()),Zl):0!==(t=be)?t:t=void 0===(t=window.event)?16:Xe(t.type)}function ec(t,e,r,n){if(50<Ql)throw Ql=0,Xl=null,Error(s(185));ye(t,r,n),0!==(2&xl)&&t===Il||(t===Il&&(0===(2&xl)&&(Nl|=r),4===Ml&&ac(t,Ll)),rc(t,n),1===r&&0===xl&&0===(1&e.mode)&&(zl=$t()+500,Bi&&Wi()))}function rc(t,e){var r=t.callbackNode;!function(t,e){for(var r=t.suspendedLanes,n=t.pingedLanes,i=t.expirationTimes,s=t.pendingLanes;0<s;){var a=31-ae(s),o=1<<a,l=i[a];-1===l?0!==(o&r)&&0===(o&n)||(i[a]=fe(o,e)):l<=e&&(t.expiredLanes|=o),s&=~o}}(t,e);var n=de(t,t===Il?Ll:0);if(0===n)null!==r&&Yt(r),t.callbackNode=null,t.callbackPriority=0;else if(e=n&-n,t.callbackPriority!==e){if(null!=r&&Yt(r),1===e)0===t.tag?function(t){Bi=!0,zi(t)}(oc.bind(null,t)):zi(oc.bind(null,t)),ai(function(){0===(6&xl)&&Wi()}),r=null;else{switch(_e(n)){case 1:r=Jt;break;case 4:r=te;break;case 16:default:r=ee;break;case 536870912:r=ne}r=Ic(r,nc.bind(null,t))}t.callbackPriority=e,t.callbackNode=r}}function nc(t,e){if($l=-1,Zl=0,0!==(6&xl))throw Error(s(327));var r=t.callbackNode;if(wc()&&t.callbackNode!==r)return null;var n=de(t,t===Il?Ll:0);if(0===n)return null;if(0!==(30&n)||0!==(n&t.expiredLanes)||e)e=gc(t,n);else{e=n;var i=xl;xl|=2;var a=fc();for(Il===t&&Ll===e||(Wl=null,zl=$t()+500,hc(t,e));;)try{yc();break}catch(l){dc(t,l)}As(),Tl.current=a,xl=i,null!==Rl?e=0:(Il=null,Ll=0,e=Ml)}if(0!==e){if(2===e&&(0!==(i=pe(t))&&(n=i,e=ic(t,i))),1===e)throw r=Ol,hc(t,0),ac(t,n),rc(t,$t()),r;if(6===e)ac(t,n);else{if(i=t.current.alternate,0===(30&n)&&!function(t){for(var e=t;;){if(16384&e.flags){var r=e.updateQueue;if(null!==r&&null!==(r=r.stores))for(var n=0;n<r.length;n++){var i=r[n],s=i.getSnapshot;i=i.value;try{if(!on(s(),i))return!1}catch(o){return!1}}}if(r=e.child,16384&e.subtreeFlags&&null!==r)r.return=e,e=r;else{if(e===t)break;for(;null===e.sibling;){if(null===e.return||e.return===t)return!0;e=e.return}e.sibling.return=e.return,e=e.sibling}}return!0}(i)&&(2===(e=gc(t,n))&&(0!==(a=pe(t))&&(n=a,e=ic(t,a))),1===e))throw r=Ol,hc(t,0),ac(t,n),rc(t,$t()),r;switch(t.finishedWork=i,t.finishedLanes=n,e){case 0:case 1:throw Error(s(345));case 2:case 5:_c(t,Bl,Wl);break;case 3:if(ac(t,n),(130023424&n)===n&&10<(e=jl+500-$t())){if(0!==de(t,0))break;if(((i=t.suspendedLanes)&n)!==n){Jl(),t.pingedLanes|=t.suspendedLanes&i;break}t.timeoutHandle=ni(_c.bind(null,t,Bl,Wl),e);break}_c(t,Bl,Wl);break;case 4:if(ac(t,n),(4194240&n)===n)break;for(e=t.eventTimes,i=-1;0<n;){var o=31-ae(n);a=1<<o,(o=e[o])>i&&(i=o),n&=~a}if(n=i,10<(n=(120>(n=$t()-n)?120:480>n?480:1080>n?1080:1920>n?1920:3e3>n?3e3:4320>n?4320:1960*Sl(n/1960))-n)){t.timeoutHandle=ni(_c.bind(null,t,Bl,Wl),n);break}_c(t,Bl,Wl);break;default:throw Error(s(329))}}}return rc(t,$t()),t.callbackNode===r?nc.bind(null,t):null}function ic(t,e){var r=Ul;return t.current.memoizedState.isDehydrated&&(hc(t,e).flags|=256),2!==(t=gc(t,e))&&(e=Bl,Bl=r,null!==e&&sc(e)),t}function sc(t){null===Bl?Bl=t:Bl.push.apply(Bl,t)}function ac(t,e){for(e&=~Fl,e&=~Nl,t.suspendedLanes|=e,t.pingedLanes&=~e,t=t.expirationTimes;0<e;){var r=31-ae(e),n=1<<r;t[r]=-1,e&=~n}}function oc(t){if(0!==(6&xl))throw Error(s(327));wc();var e=de(t,0);if(0===(1&e))return rc(t,$t()),null;var r=gc(t,e);if(0!==t.tag&&2===r){var n=pe(t);0!==n&&(e=n,r=ic(t,n))}if(1===r)throw r=Ol,hc(t,0),ac(t,e),rc(t,$t()),r;if(6===r)throw Error(s(345));return t.finishedWork=t.current.alternate,t.finishedLanes=e,_c(t,Bl,Wl),rc(t,$t()),null}function lc(t,e){var r=xl;xl|=1;try{return t(e)}finally{0===(xl=r)&&(zl=$t()+500,Bi&&Wi())}}function cc(t){null!==ql&&0===ql.tag&&0===(6&xl)&&wc();var e=xl;xl|=1;var r=Al.transition,n=be;try{if(Al.transition=null,be=1,t)return t()}finally{be=n,Al.transition=r,0===(6&(xl=e))&&Wi()}}function uc(){Pl=Cl.current,ki(Cl)}function hc(t,e){t.finishedWork=null,t.finishedLanes=0;var r=t.timeoutHandle;if(-1!==r&&(t.timeoutHandle=-1,ii(r)),null!==Rl)for(r=Rl.return;null!==r;){var n=r;switch(es(n),n.tag){case 1:null!==(n=n.type.childContextTypes)&&void 0!==n&&Mi();break;case 3:Xs(),ki(Ri),ki(Ii),ra();break;case 5:Zs(n);break;case 4:Xs();break;case 13:case 19:ki(Js);break;case 10:xs(n.type._context);break;case 22:case 23:uc()}r=r.return}if(Il=t,Rl=t=Cc(t.current,null),Ll=Pl=e,Ml=0,Ol=null,Fl=Nl=Dl=0,Bl=Ul=null,null!==Ps){for(e=0;e<Ps.length;e++)if(null!==(n=(r=Ps[e]).interleaved)){r.interleaved=null;var i=n.next,s=r.pending;if(null!==s){var a=s.next;s.next=i,n.next=a}r.pending=n}Ps=null}return t}function dc(t,e){for(;;){var r=Rl;try{if(As(),na.current=$a,ca){for(var n=aa.memoizedState;null!==n;){var i=n.queue;null!==i&&(i.pending=null),n=n.next}ca=!1}if(sa=0,la=oa=aa=null,ua=!1,ha=0,kl.current=null,null===r||null===r.return){Ml=1,Ol=e,Rl=null;break}t:{var a=t,o=r.return,l=r,c=e;if(e=Ll,l.flags|=32768,null!==c&&"object"===typeof c&&"function"===typeof c.then){var u=c,h=l,d=h.tag;if(0===(1&h.mode)&&(0===d||11===d||15===d)){var f=h.alternate;f?(h.updateQueue=f.updateQueue,h.memoizedState=f.memoizedState,h.lanes=f.lanes):(h.updateQueue=null,h.memoizedState=null)}var p=mo(o);if(null!==p){p.flags&=-257,yo(p,o,l,0,e),1&p.mode&&go(a,u,e),c=u;var g=(e=p).updateQueue;if(null===g){var m=new Set;m.add(c),e.updateQueue=m}else g.add(c);break t}if(0===(1&e)){go(a,u,e),pc();break t}c=Error(s(426))}else if(is&&1&l.mode){var y=mo(o);if(null!==y){0===(65536&y.flags)&&(y.flags|=256),yo(y,o,l,0,e),ps(lo(c,l));break t}}a=c=lo(c,l),4!==Ml&&(Ml=2),null===Ul?Ul=[a]:Ul.push(a),a=o;do{switch(a.tag){case 3:a.flags|=65536,e&=-e,a.lanes|=e,zs(a,fo(0,c,e));break t;case 1:l=c;var v=a.type,b=a.stateNode;if(0===(128&a.flags)&&("function"===typeof v.getDerivedStateFromError||null!==b&&"function"===typeof b.componentDidCatch&&(null===Hl||!Hl.has(b)))){a.flags|=65536,e&=-e,a.lanes|=e,zs(a,po(a,l,e));break t}}a=a.return}while(null!==a)}bc(r)}catch(_){e=_,Rl===r&&null!==r&&(Rl=r=r.return);continue}break}}function fc(){var t=Tl.current;return Tl.current=$a,null===t?$a:t}function pc(){0!==Ml&&3!==Ml&&2!==Ml||(Ml=4),null===Il||0===(268435455&Dl)&&0===(268435455&Nl)||ac(Il,Ll)}function gc(t,e){var r=xl;xl|=2;var n=fc();for(Il===t&&Ll===e||(Wl=null,hc(t,e));;)try{mc();break}catch(i){dc(t,i)}if(As(),xl=r,Tl.current=n,null!==Rl)throw Error(s(261));return Il=null,Ll=0,Ml}function mc(){for(;null!==Rl;)vc(Rl)}function yc(){for(;null!==Rl&&!Qt();)vc(Rl)}function vc(t){var e=El(t.alternate,t,Pl);t.memoizedProps=t.pendingProps,null===e?bc(t):Rl=e,kl.current=null}function bc(t){var e=t;do{var r=e.alternate;if(t=e.return,0===(32768&e.flags)){if(null!==(r=Ko(r,e,Pl)))return void(Rl=r)}else{if(null!==(r=qo(r,e)))return r.flags&=32767,void(Rl=r);if(null===t)return Ml=6,void(Rl=null);t.flags|=32768,t.subtreeFlags=0,t.deletions=null}if(null!==(e=e.sibling))return void(Rl=e);Rl=e=t}while(null!==e);0===Ml&&(Ml=5)}function _c(t,e,r){var n=be,i=Al.transition;try{Al.transition=null,be=1,function(t,e,r,n){do{wc()}while(null!==ql);if(0!==(6&xl))throw Error(s(327));r=t.finishedWork;var i=t.finishedLanes;if(null===r)return null;if(t.finishedWork=null,t.finishedLanes=0,r===t.current)throw Error(s(177));t.callbackNode=null,t.callbackPriority=0;var a=r.lanes|r.childLanes;if(function(t,e){var r=t.pendingLanes&~e;t.pendingLanes=e,t.suspendedLanes=0,t.pingedLanes=0,t.expiredLanes&=e,t.mutableReadLanes&=e,t.entangledLanes&=e,e=t.entanglements;var n=t.eventTimes;for(t=t.expirationTimes;0<r;){var i=31-ae(r),s=1<<i;e[i]=0,n[i]=-1,t[i]=-1,r&=~s}}(t,a),t===Il&&(Rl=Il=null,Ll=0),0===(2064&r.subtreeFlags)&&0===(2064&r.flags)||Kl||(Kl=!0,Ic(ee,function(){return wc(),null})),a=0!==(15990&r.flags),0!==(15990&r.subtreeFlags)||a){a=Al.transition,Al.transition=null;var o=be;be=1;var l=xl;xl|=4,kl.current=null,function(t,e){if(ti=Ve,fn(t=dn())){if("selectionStart"in t)var r={start:t.selectionStart,end:t.selectionEnd};else t:{var n=(r=(r=t.ownerDocument)&&r.defaultView||window).getSelection&&r.getSelection();if(n&&0!==n.rangeCount){r=n.anchorNode;var i=n.anchorOffset,a=n.focusNode;n=n.focusOffset;try{r.nodeType,a.nodeType}catch(w){r=null;break t}var o=0,l=-1,c=-1,u=0,h=0,d=t,f=null;e:for(;;){for(var p;d!==r||0!==i&&3!==d.nodeType||(l=o+i),d!==a||0!==n&&3!==d.nodeType||(c=o+n),3===d.nodeType&&(o+=d.nodeValue.length),null!==(p=d.firstChild);)f=d,d=p;for(;;){if(d===t)break e;if(f===r&&++u===i&&(l=o),f===a&&++h===n&&(c=o),null!==(p=d.nextSibling))break;f=(d=f).parentNode}d=p}r=-1===l||-1===c?null:{start:l,end:c}}else r=null}r=r||{start:0,end:0}}else r=null;for(ei={focusedElem:t,selectionRange:r},Ve=!1,$o=e;null!==$o;)if(t=(e=$o).child,0!==(1028&e.subtreeFlags)&&null!==t)t.return=e,$o=t;else for(;null!==$o;){e=$o;try{var g=e.alternate;if(0!==(1024&e.flags))switch(e.tag){case 0:case 11:case 15:case 5:case 6:case 4:case 17:break;case 1:if(null!==g){var m=g.memoizedProps,y=g.memoizedState,v=e.stateNode,b=v.getSnapshotBeforeUpdate(e.elementType===e.type?m:eo(e.type,m),y);v.__reactInternalSnapshotBeforeUpdate=b}break;case 3:var _=e.stateNode.containerInfo;1===_.nodeType?_.textContent="":9===_.nodeType&&_.documentElement&&_.removeChild(_.documentElement);break;default:throw Error(s(163))}}catch(w){Sc(e,e.return,w)}if(null!==(t=e.sibling)){t.return=e.return,$o=t;break}$o=e.return}g=tl,tl=!1}(t,r),gl(r,t),pn(ei),Ve=!!ti,ei=ti=null,t.current=r,yl(r,t,i),Xt(),xl=l,be=o,Al.transition=a}else t.current=r;if(Kl&&(Kl=!1,ql=t,Yl=i),a=t.pendingLanes,0===a&&(Hl=null),function(t){if(se&&"function"===typeof se.onCommitFiberRoot)try{se.onCommitFiberRoot(ie,t,void 0,128===(128&t.current.flags))}catch(e){}}(r.stateNode),rc(t,$t()),null!==e)for(n=t.onRecoverableError,r=0;r<e.length;r++)i=e[r],n(i.value,{componentStack:i.stack,digest:i.digest});if(Gl)throw Gl=!1,t=Vl,Vl=null,t;0!==(1&Yl)&&0!==t.tag&&wc(),a=t.pendingLanes,0!==(1&a)?t===Xl?Ql++:(Ql=0,Xl=t):Ql=0,Wi()}(t,e,r,n)}finally{Al.transition=i,be=n}return null}function wc(){if(null!==ql){var t=_e(Yl),e=Al.transition,r=be;try{if(Al.transition=null,be=16>t?16:t,null===ql)var n=!1;else{if(t=ql,ql=null,Yl=0,0!==(6&xl))throw Error(s(331));var i=xl;for(xl|=4,$o=t.current;null!==$o;){var a=$o,o=a.child;if(0!==(16&$o.flags)){var l=a.deletions;if(null!==l){for(var c=0;c<l.length;c++){var u=l[c];for($o=u;null!==$o;){var h=$o;switch(h.tag){case 0:case 11:case 15:el(8,h,a)}var d=h.child;if(null!==d)d.return=h,$o=d;else for(;null!==$o;){var f=(h=$o).sibling,p=h.return;if(il(h),h===u){$o=null;break}if(null!==f){f.return=p,$o=f;break}$o=p}}}var g=a.alternate;if(null!==g){var m=g.child;if(null!==m){g.child=null;do{var y=m.sibling;m.sibling=null,m=y}while(null!==m)}}$o=a}}if(0!==(2064&a.subtreeFlags)&&null!==o)o.return=a,$o=o;else t:for(;null!==$o;){if(0!==(2048&(a=$o).flags))switch(a.tag){case 0:case 11:case 15:el(9,a,a.return)}var v=a.sibling;if(null!==v){v.return=a.return,$o=v;break t}$o=a.return}}var b=t.current;for($o=b;null!==$o;){var _=(o=$o).child;if(0!==(2064&o.subtreeFlags)&&null!==_)_.return=o,$o=_;else t:for(o=b;null!==$o;){if(0!==(2048&(l=$o).flags))try{switch(l.tag){case 0:case 11:case 15:rl(9,l)}}catch(E){Sc(l,l.return,E)}if(l===o){$o=null;break t}var w=l.sibling;if(null!==w){w.return=l.return,$o=w;break t}$o=l.return}}if(xl=i,Wi(),se&&"function"===typeof se.onPostCommitFiberRoot)try{se.onPostCommitFiberRoot(ie,t)}catch(E){}n=!0}return n}finally{be=r,Al.transition=e}}return!1}function Ec(t,e,r){t=Bs(t,e=fo(0,e=lo(r,e),1),1),e=Jl(),null!==t&&(ye(t,1,e),rc(t,e))}function Sc(t,e,r){if(3===t.tag)Ec(t,t,r);else for(;null!==e;){if(3===e.tag){Ec(e,t,r);break}if(1===e.tag){var n=e.stateNode;if("function"===typeof e.type.getDerivedStateFromError||"function"===typeof n.componentDidCatch&&(null===Hl||!Hl.has(n))){e=Bs(e,t=po(e,t=lo(r,t),1),1),t=Jl(),null!==e&&(ye(e,1,t),rc(e,t));break}}e=e.return}}function Tc(t,e,r){var n=t.pingCache;null!==n&&n.delete(e),e=Jl(),t.pingedLanes|=t.suspendedLanes&r,Il===t&&(Ll&r)===r&&(4===Ml||3===Ml&&(130023424&Ll)===Ll&&500>$t()-jl?hc(t,0):Fl|=r),rc(t,e)}function kc(t,e){0===e&&(0===(1&t.mode)?e=1:(e=ue,0===(130023424&(ue<<=1))&&(ue=4194304)));var r=Jl();null!==(t=Os(t,e))&&(ye(t,e,r),rc(t,r))}function Ac(t){var e=t.memoizedState,r=0;null!==e&&(r=e.retryLane),kc(t,r)}function xc(t,e){var r=0;switch(t.tag){case 13:var n=t.stateNode,i=t.memoizedState;null!==i&&(r=i.retryLane);break;case 19:n=t.stateNode;break;default:throw Error(s(314))}null!==n&&n.delete(e),kc(t,r)}function Ic(t,e){return qt(t,e)}function Rc(t,e,r,n){this.tag=t,this.key=r,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=e,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=n,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Lc(t,e,r,n){return new Rc(t,e,r,n)}function Pc(t){return!(!(t=t.prototype)||!t.isReactComponent)}function Cc(t,e){var r=t.alternate;return null===r?((r=Lc(t.tag,e,t.key,t.mode)).elementType=t.elementType,r.type=t.type,r.stateNode=t.stateNode,r.alternate=t,t.alternate=r):(r.pendingProps=e,r.type=t.type,r.flags=0,r.subtreeFlags=0,r.deletions=null),r.flags=14680064&t.flags,r.childLanes=t.childLanes,r.lanes=t.lanes,r.child=t.child,r.memoizedProps=t.memoizedProps,r.memoizedState=t.memoizedState,r.updateQueue=t.updateQueue,e=t.dependencies,r.dependencies=null===e?null:{lanes:e.lanes,firstContext:e.firstContext},r.sibling=t.sibling,r.index=t.index,r.ref=t.ref,r}function Mc(t,e,r,n,i,a){var o=2;if(n=t,"function"===typeof t)Pc(t)&&(o=1);else if("string"===typeof t)o=5;else t:switch(t){case S:return Oc(r.children,i,a,e);case T:o=8,i|=8;break;case k:return(t=Lc(12,r,e,2|i)).elementType=k,t.lanes=a,t;case R:return(t=Lc(13,r,e,i)).elementType=R,t.lanes=a,t;case L:return(t=Lc(19,r,e,i)).elementType=L,t.lanes=a,t;case M:return Dc(r,i,a,e);default:if("object"===typeof t&&null!==t)switch(t.$$typeof){case A:o=10;break t;case x:o=9;break t;case I:o=11;break t;case P:o=14;break t;case C:o=16,n=null;break t}throw Error(s(130,null==t?t:typeof t,""))}return(e=Lc(o,r,e,i)).elementType=t,e.type=n,e.lanes=a,e}function Oc(t,e,r,n){return(t=Lc(7,t,n,e)).lanes=r,t}function Dc(t,e,r,n){return(t=Lc(22,t,n,e)).elementType=M,t.lanes=r,t.stateNode={isHidden:!1},t}function Nc(t,e,r){return(t=Lc(6,t,null,e)).lanes=r,t}function Fc(t,e,r){return(e=Lc(4,null!==t.children?t.children:[],t.key,e)).lanes=r,e.stateNode={containerInfo:t.containerInfo,pendingChildren:null,implementation:t.implementation},e}function Uc(t,e,r,n,i){this.tag=e,this.containerInfo=t,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=me(0),this.expirationTimes=me(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=me(0),this.identifierPrefix=n,this.onRecoverableError=i,this.mutableSourceEagerHydrationData=null}function Bc(t,e,r,n,i,s,a,o,l){return t=new Uc(t,e,r,o,l),1===e?(e=1,!0===s&&(e|=8)):e=0,s=Lc(3,null,null,e),t.current=s,s.stateNode=t,s.memoizedState={element:n,isDehydrated:r,cache:null,transitions:null,pendingSuspenseBoundaries:null},Ns(s),t}function jc(t){if(!t)return xi;t:{if(Wt(t=t._reactInternals)!==t||1!==t.tag)throw Error(s(170));var e=t;do{switch(e.tag){case 3:e=e.stateNode.context;break t;case 1:if(Ci(e.type)){e=e.stateNode.__reactInternalMemoizedMergedChildContext;break t}}e=e.return}while(null!==e);throw Error(s(171))}if(1===t.tag){var r=t.type;if(Ci(r))return Di(t,r,e)}return e}function zc(t,e,r,n,i,s,a,o,l){return(t=Bc(r,n,!0,t,0,s,0,o,l)).context=jc(null),r=t.current,(s=Us(n=Jl(),i=tc(r))).callback=void 0!==e&&null!==e?e:null,Bs(r,s,i),t.current.lanes=i,ye(t,i,n),rc(t,n),t}function Wc(t,e,r,n){var i=e.current,s=Jl(),a=tc(i);return r=jc(r),null===e.context?e.context=r:e.pendingContext=r,(e=Us(s,a)).payload={element:t},null!==(n=void 0===n?null:n)&&(e.callback=n),null!==(t=Bs(i,e,a))&&(ec(t,i,a,s),js(t,i,a)),a}function Gc(t){return(t=t.current).child?(t.child.tag,t.child.stateNode):null}function Vc(t,e){if(null!==(t=t.memoizedState)&&null!==t.dehydrated){var r=t.retryLane;t.retryLane=0!==r&&r<e?r:e}}function Hc(t,e){Vc(t,e),(t=t.alternate)&&Vc(t,e)}El=function(t,e,r){if(null!==t)if(t.memoizedProps!==e.pendingProps||Ri.current)bo=!0;else{if(0===(t.lanes&r)&&0===(128&e.flags))return bo=!1,function(t,e,r){switch(e.tag){case 3:Ro(e),fs();break;case 5:$s(e);break;case 1:Ci(e.type)&&Ni(e);break;case 4:Qs(e,e.stateNode.containerInfo);break;case 10:var n=e.type._context,i=e.memoizedProps.value;Ai(Es,n._currentValue),n._currentValue=i;break;case 13:if(null!==(n=e.memoizedState))return null!==n.dehydrated?(Ai(Js,1&Js.current),e.flags|=128,null):0!==(r&e.child.childLanes)?No(t,e,r):(Ai(Js,1&Js.current),null!==(t=Go(t,e,r))?t.sibling:null);Ai(Js,1&Js.current);break;case 19:if(n=0!==(r&e.childLanes),0!==(128&t.flags)){if(n)return zo(t,e,r);e.flags|=128}if(null!==(i=e.memoizedState)&&(i.rendering=null,i.tail=null,i.lastEffect=null),Ai(Js,Js.current),n)break;return null;case 22:case 23:return e.lanes=0,To(t,e,r)}return Go(t,e,r)}(t,e,r);bo=0!==(131072&t.flags)}else bo=!1,is&&0!==(1048576&e.flags)&&Ji(e,Ki,e.index);switch(e.lanes=0,e.tag){case 2:var n=e.type;Wo(t,e),t=e.pendingProps;var i=Pi(e,Ii.current);Rs(e,r),i=ga(null,e,n,t,i,r);var a=ma();return e.flags|=1,"object"===typeof i&&null!==i&&"function"===typeof i.render&&void 0===i.$$typeof?(e.tag=1,e.memoizedState=null,e.updateQueue=null,Ci(n)?(a=!0,Ni(e)):a=!1,e.memoizedState=null!==i.state&&void 0!==i.state?i.state:null,Ns(e),i.updater=no,e.stateNode=i,i._reactInternals=e,oo(e,n,t,r),e=Io(null,e,n,!0,a,r)):(e.tag=0,is&&a&&ts(e),_o(null,e,i,r),e=e.child),e;case 16:n=e.elementType;t:{switch(Wo(t,e),t=e.pendingProps,n=(i=n._init)(n._payload),e.type=n,i=e.tag=function(t){if("function"===typeof t)return Pc(t)?1:0;if(void 0!==t&&null!==t){if((t=t.$$typeof)===I)return 11;if(t===P)return 14}return 2}(n),t=eo(n,t),i){case 0:e=Ao(null,e,n,t,r);break t;case 1:e=xo(null,e,n,t,r);break t;case 11:e=wo(null,e,n,t,r);break t;case 14:e=Eo(null,e,n,eo(n.type,t),r);break t}throw Error(s(306,n,""))}return e;case 0:return n=e.type,i=e.pendingProps,Ao(t,e,n,i=e.elementType===n?i:eo(n,i),r);case 1:return n=e.type,i=e.pendingProps,xo(t,e,n,i=e.elementType===n?i:eo(n,i),r);case 3:t:{if(Ro(e),null===t)throw Error(s(387));n=e.pendingProps,i=(a=e.memoizedState).element,Fs(t,e),Ws(e,n,null,r);var o=e.memoizedState;if(n=o.element,a.isDehydrated){if(a={element:n,isDehydrated:!1,cache:o.cache,pendingSuspenseBoundaries:o.pendingSuspenseBoundaries,transitions:o.transitions},e.updateQueue.baseState=a,e.memoizedState=a,256&e.flags){e=Lo(t,e,n,r,i=lo(Error(s(423)),e));break t}if(n!==i){e=Lo(t,e,n,r,i=lo(Error(s(424)),e));break t}for(ns=ci(e.stateNode.containerInfo.firstChild),rs=e,is=!0,ss=null,r=ws(e,null,n,r),e.child=r;r;)r.flags=-3&r.flags|4096,r=r.sibling}else{if(fs(),n===i){e=Go(t,e,r);break t}_o(t,e,n,r)}e=e.child}return e;case 5:return $s(e),null===t&&cs(e),n=e.type,i=e.pendingProps,a=null!==t?t.memoizedProps:null,o=i.children,ri(n,i)?o=null:null!==a&&ri(n,a)&&(e.flags|=32),ko(t,e),_o(t,e,o,r),e.child;case 6:return null===t&&cs(e),null;case 13:return No(t,e,r);case 4:return Qs(e,e.stateNode.containerInfo),n=e.pendingProps,null===t?e.child=_s(e,null,n,r):_o(t,e,n,r),e.child;case 11:return n=e.type,i=e.pendingProps,wo(t,e,n,i=e.elementType===n?i:eo(n,i),r);case 7:return _o(t,e,e.pendingProps,r),e.child;case 8:case 12:return _o(t,e,e.pendingProps.children,r),e.child;case 10:t:{if(n=e.type._context,i=e.pendingProps,a=e.memoizedProps,o=i.value,Ai(Es,n._currentValue),n._currentValue=o,null!==a)if(on(a.value,o)){if(a.children===i.children&&!Ri.current){e=Go(t,e,r);break t}}else for(null!==(a=e.child)&&(a.return=e);null!==a;){var l=a.dependencies;if(null!==l){o=a.child;for(var c=l.firstContext;null!==c;){if(c.context===n){if(1===a.tag){(c=Us(-1,r&-r)).tag=2;var u=a.updateQueue;if(null!==u){var h=(u=u.shared).pending;null===h?c.next=c:(c.next=h.next,h.next=c),u.pending=c}}a.lanes|=r,null!==(c=a.alternate)&&(c.lanes|=r),Is(a.return,r,e),l.lanes|=r;break}c=c.next}}else if(10===a.tag)o=a.type===e.type?null:a.child;else if(18===a.tag){if(null===(o=a.return))throw Error(s(341));o.lanes|=r,null!==(l=o.alternate)&&(l.lanes|=r),Is(o,r,e),o=a.sibling}else o=a.child;if(null!==o)o.return=a;else for(o=a;null!==o;){if(o===e){o=null;break}if(null!==(a=o.sibling)){a.return=o.return,o=a;break}o=o.return}a=o}_o(t,e,i.children,r),e=e.child}return e;case 9:return i=e.type,n=e.pendingProps.children,Rs(e,r),n=n(i=Ls(i)),e.flags|=1,_o(t,e,n,r),e.child;case 14:return i=eo(n=e.type,e.pendingProps),Eo(t,e,n,i=eo(n.type,i),r);case 15:return So(t,e,e.type,e.pendingProps,r);case 17:return n=e.type,i=e.pendingProps,i=e.elementType===n?i:eo(n,i),Wo(t,e),e.tag=1,Ci(n)?(t=!0,Ni(e)):t=!1,Rs(e,r),so(e,n,i),oo(e,n,i,r),Io(null,e,n,!0,t,r);case 19:return zo(t,e,r);case 22:return To(t,e,r)}throw Error(s(156,e.tag))};var Kc="function"===typeof reportError?reportError:function(t){console.error(t)};function qc(t){this._internalRoot=t}function Yc(t){this._internalRoot=t}function Qc(t){return!(!t||1!==t.nodeType&&9!==t.nodeType&&11!==t.nodeType)}function Xc(t){return!(!t||1!==t.nodeType&&9!==t.nodeType&&11!==t.nodeType&&(8!==t.nodeType||" react-mount-point-unstable "!==t.nodeValue))}function $c(){}function Zc(t,e,r,n,i){var s=r._reactRootContainer;if(s){var a=s;if("function"===typeof i){var o=i;i=function(){var t=Gc(a);o.call(t)}}Wc(e,a,t,i)}else a=function(t,e,r,n,i){if(i){if("function"===typeof n){var s=n;n=function(){var t=Gc(a);s.call(t)}}var a=zc(e,n,t,0,null,!1,0,"",$c);return t._reactRootContainer=a,t[pi]=a.current,Wn(8===t.nodeType?t.parentNode:t),cc(),a}for(;i=t.lastChild;)t.removeChild(i);if("function"===typeof n){var o=n;n=function(){var t=Gc(l);o.call(t)}}var l=Bc(t,0,!1,null,0,!1,0,"",$c);return t._reactRootContainer=l,t[pi]=l.current,Wn(8===t.nodeType?t.parentNode:t),cc(function(){Wc(e,l,r,n)}),l}(r,e,t,i,n);return Gc(a)}Yc.prototype.render=qc.prototype.render=function(t){var e=this._internalRoot;if(null===e)throw Error(s(409));Wc(t,e,null,null)},Yc.prototype.unmount=qc.prototype.unmount=function(){var t=this._internalRoot;if(null!==t){this._internalRoot=null;var e=t.containerInfo;cc(function(){Wc(null,t,null,null)}),e[pi]=null}},Yc.prototype.unstable_scheduleHydration=function(t){if(t){var e=Te();t={blockedOn:null,target:t,priority:e};for(var r=0;r<Me.length&&0!==e&&e<Me[r].priority;r++);Me.splice(r,0,t),0===r&&Fe(t)}},we=function(t){switch(t.tag){case 3:var e=t.stateNode;if(e.current.memoizedState.isDehydrated){var r=he(e.pendingLanes);0!==r&&(ve(e,1|r),rc(e,$t()),0===(6&xl)&&(zl=$t()+500,Wi()))}break;case 13:cc(function(){var e=Os(t,1);if(null!==e){var r=Jl();ec(e,t,1,r)}}),Hc(t,1)}},Ee=function(t){if(13===t.tag){var e=Os(t,134217728);if(null!==e)ec(e,t,134217728,Jl());Hc(t,134217728)}},Se=function(t){if(13===t.tag){var e=tc(t),r=Os(t,e);if(null!==r)ec(r,t,e,Jl());Hc(t,e)}},Te=function(){return be},ke=function(t,e){var r=be;try{return be=t,e()}finally{be=r}},Et=function(t,e,r){switch(e){case"input":if(Z(t,r),e=r.name,"radio"===r.type&&null!=e){for(r=t;r.parentNode;)r=r.parentNode;for(r=r.querySelectorAll("input[name="+JSON.stringify(""+e)+'][type="radio"]'),e=0;e<r.length;e++){var n=r[e];if(n!==t&&n.form===t.form){var i=wi(n);if(!i)throw Error(s(90));q(n),Z(n,i)}}}break;case"textarea":st(t,r);break;case"select":null!=(e=r.value)&&rt(t,!!r.multiple,e,!1)}},It=lc,Rt=cc;var Jc={usingClientEntryPoint:!1,Events:[bi,_i,wi,At,xt,lc]},tu={findFiberByHostInstance:vi,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},eu={bundleType:tu.bundleType,version:tu.version,rendererPackageName:tu.rendererPackageName,rendererConfig:tu.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:_.ReactCurrentDispatcher,findHostInstanceByFiber:function(t){return null===(t=Ht(t))?null:t.stateNode},findFiberByHostInstance:tu.findFiberByHostInstance||function(){return null},findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if("undefined"!==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__){var ru=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!ru.isDisabled&&ru.supportsFiber)try{ie=ru.inject(eu),se=ru}catch(ut){}}e.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Jc,e.createPortal=function(t,e){var r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;if(!Qc(e))throw Error(s(200));return function(t,e,r){var n=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null;return{$$typeof:E,key:null==n?null:""+n,children:t,containerInfo:e,implementation:r}}(t,e,null,r)},e.createRoot=function(t,e){if(!Qc(t))throw Error(s(299));var r=!1,n="",i=Kc;return null!==e&&void 0!==e&&(!0===e.unstable_strictMode&&(r=!0),void 0!==e.identifierPrefix&&(n=e.identifierPrefix),void 0!==e.onRecoverableError&&(i=e.onRecoverableError)),e=Bc(t,1,!1,null,0,r,0,n,i),t[pi]=e.current,Wn(8===t.nodeType?t.parentNode:t),new qc(e)},e.findDOMNode=function(t){if(null==t)return null;if(1===t.nodeType)return t;var e=t._reactInternals;if(void 0===e){if("function"===typeof t.render)throw Error(s(188));throw t=Object.keys(t).join(","),Error(s(268,t))}return t=null===(t=Ht(e))?null:t.stateNode},e.flushSync=function(t){return cc(t)},e.hydrate=function(t,e,r){if(!Xc(e))throw Error(s(200));return Zc(null,t,e,!0,r)},e.hydrateRoot=function(t,e,r){if(!Qc(t))throw Error(s(405));var n=null!=r&&r.hydratedSources||null,i=!1,a="",o=Kc;if(null!==r&&void 0!==r&&(!0===r.unstable_strictMode&&(i=!0),void 0!==r.identifierPrefix&&(a=r.identifierPrefix),void 0!==r.onRecoverableError&&(o=r.onRecoverableError)),e=zc(e,null,t,1,null!=r?r:null,i,0,a,o),t[pi]=e.current,Wn(t),n)for(t=0;t<n.length;t++)i=(i=(r=n[t])._getVersion)(r._source),null==e.mutableSourceEagerHydrationData?e.mutableSourceEagerHydrationData=[r,i]:e.mutableSourceEagerHydrationData.push(r,i);return new Yc(e)},e.render=function(t,e,r){if(!Xc(e))throw Error(s(200));return Zc(null,t,e,!1,r)},e.unmountComponentAtNode=function(t){if(!Xc(t))throw Error(s(40));return!!t._reactRootContainer&&(cc(function(){Zc(null,null,t,!1,function(){t._reactRootContainer=null,t[pi]=null})}),!0)},e.unstable_batchedUpdates=lc,e.unstable_renderSubtreeIntoContainer=function(t,e,r,n){if(!Xc(r))throw Error(s(200));if(null==t||void 0===t._reactInternals)throw Error(s(38));return Zc(t,e,r,!1,n)},e.version="18.3.1-next-f1338f8080-20240426"},853(t,e,r){"use strict";t.exports=r(234)},950(t,e,r){"use strict";!function t(){if("undefined"!==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__&&"function"===typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE)try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(t)}catch(e){console.error(e)}}(),t.exports=r(730)}},e={};function r(n){var i=e[n];if(void 0!==i)return i.exports;var s=e[n]={exports:{}};return t[n](s,s.exports,r),s.exports}r.m=t,r.amdO={},r.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return r.d(e,{a:e}),e},(()=>{var t,e=Object.getPrototypeOf?t=>Object.getPrototypeOf(t):t=>t.__proto__;r.t=function(n,i){if(1&i&&(n=this(n)),8&i)return n;if("object"===typeof n&&n){if(4&i&&n.__esModule)return n;if(16&i&&"function"===typeof n.then)return n}var s=Object.create(null);r.r(s);var a={};t=t||[null,e({}),e([]),e(e)];for(var o=2&i&&n;("object"==typeof o||"function"==typeof o)&&!~t.indexOf(o);o=e(o))Object.getOwnPropertyNames(o).forEach(t=>a[t]=()=>n[t]);return a.default=()=>n,r.d(s,a),s}})(),r.d=(t,e)=>{for(var n in e)r.o(e,n)&&!r.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:e[n]})},r.f={},r.e=t=>Promise.all(Object.keys(r.f).reduce((e,n)=>(r.f[n](t,e),e),[])),r.u=t=>"static/js/"+t+".c9d6cb0e.chunk.js",r.miniCssF=t=>{},r.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"===typeof window)return window}}(),r.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),(()=>{var t={},e="deploy_ros_panel:";r.l=(n,i,s,a)=>{if(t[n])t[n].push(i);else{var o,l;if(void 0!==s)for(var c=document.getElementsByTagName("script"),u=0;u<c.length;u++){var h=c[u];if(h.getAttribute("src")==n||h.getAttribute("data-webpack")==e+s){o=h;break}}o||(l=!0,(o=document.createElement("script")).charset="utf-8",r.nc&&o.setAttribute("nonce",r.nc),o.setAttribute("data-webpack",e+s),o.src=n),t[n]=[i];var d=(e,r)=>{o.onerror=o.onload=null,clearTimeout(f);var i=t[n];if(delete t[n],o.parentNode&&o.parentNode.removeChild(o),i&&i.forEach(t=>t(r)),e)return e(r)},f=setTimeout(d.bind(null,void 0,{type:"timeout",target:o}),12e4);o.onerror=d.bind(null,o.onerror),o.onload=d.bind(null,o.onload),l&&document.head.appendChild(o)}}})(),r.r=t=>{"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.p="/",(()=>{var t={792:0};r.f.j=(e,n)=>{var i=r.o(t,e)?t[e]:void 0;if(0!==i)if(i)n.push(i[2]);else{var s=new Promise((r,n)=>i=t[e]=[r,n]);n.push(i[2]=s);var a=r.p+r.u(e),o=new Error;r.l(a,n=>{if(r.o(t,e)&&(0!==(i=t[e])&&(t[e]=void 0),i)){var s=n&&("load"===n.type?"missing":n.type),a=n&&n.target&&n.target.src;o.message="Loading chunk "+e+" failed.\n("+s+": "+a+")",o.name="ChunkLoadError",o.type=s,o.request=a,i[1](o)}},"chunk-"+e,e)}};var e=(e,n)=>{var i,s,[a,o,l]=n,c=0;if(a.some(e=>0!==t[e])){for(i in o)r.o(o,i)&&(r.m[i]=o[i]);if(l)l(r)}for(e&&e(n);c<a.length;c++)s=a[c],r.o(t,s)&&t[s]&&t[s][0](),t[s]=0},n=self.webpackChunkdeploy_ros_panel=self.webpackChunkdeploy_ros_panel||[];n.forEach(e.bind(null,0)),n.push=e.bind(null,n.push.bind(n))})(),(()=>{"use strict";var t=r(43),e=r.t(t,2),n=r(391);function i(t,e){if(null==t)return{};var r,n,i=function(t,e){if(null==t)return{};var r={};for(var n in t)if({}.hasOwnProperty.call(t,n)){if(-1!==e.indexOf(n))continue;r[n]=t[n]}return r}(t,e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);for(n=0;n<s.length;n++)r=s[n],-1===e.indexOf(r)&&{}.propertyIsEnumerable.call(t,r)&&(i[r]=t[r])}return i}function s(t){return s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},s(t)}function a(t){var e=function(t,e){if("object"!=s(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,e||"default");if("object"!=s(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==s(e)?e:e+""}function o(t,e,r){return(e=a(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function l(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),r.push.apply(r,n)}return r}function c(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?l(Object(r),!0).forEach(function(e){o(t,e,r[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):l(Object(r)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))})}return t}const u=["sri"],h=["page"],d=["page","matches"],f=["onClick","discover","prefetch","relative","reloadDocument","replace","state","target","to","preventScrollReset","viewTransition","unstable_defaultShouldRevalidate"],p=["aria-current","caseSensitive","className","end","style","to","viewTransition","children"],g=["discover","fetcherKey","navigate","reloadDocument","replace","state","method","action","onSubmit","relative","preventScrollReset","viewTransition","unstable_defaultShouldRevalidate"];var m="popstate";function y(){return T(function(t,e){let{pathname:r,search:n,hash:i}=t.location;return w("",{pathname:r,search:n,hash:i},e.state&&e.state.usr||null,e.state&&e.state.key||"default")},function(t,e){return"string"===typeof e?e:E(e)},null,arguments.length>0&&void 0!==arguments[0]?arguments[0]:{})}function v(t,e){if(!1===t||null===t||"undefined"===typeof t)throw new Error(e)}function b(t,e){if(!t){"undefined"!==typeof console&&console.warn(e);try{throw new Error(e)}catch(r){}}}function _(t,e){return{usr:t.state,key:t.key,idx:e}}function w(t,e){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,n=arguments.length>3?arguments[3]:void 0;return c(c({pathname:"string"===typeof t?t:t.pathname,search:"",hash:""},"string"===typeof e?S(e):e),{},{state:r,key:e&&e.key||n||Math.random().toString(36).substring(2,10)})}function E(t){let{pathname:e="/",search:r="",hash:n=""}=t;return r&&"?"!==r&&(e+="?"===r.charAt(0)?r:"?"+r),n&&"#"!==n&&(e+="#"===n.charAt(0)?n:"#"+n),e}function S(t){let e={};if(t){let r=t.indexOf("#");r>=0&&(e.hash=t.substring(r),t=t.substring(0,r));let n=t.indexOf("?");n>=0&&(e.search=t.substring(n),t=t.substring(0,n)),t&&(e.pathname=t)}return e}function T(t,e,r){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},{window:i=document.defaultView,v5Compat:s=!1}=n,a=i.history,o="POP",l=null,u=h();function h(){return(a.state||{idx:null}).idx}function d(){o="POP";let t=h(),e=null==t?null:t-u;u=t,l&&l({action:o,location:p.location,delta:e})}function f(t){return k(t)}null==u&&(u=0,a.replaceState(c(c({},a.state),{},{idx:u}),""));let p={get action(){return o},get location(){return t(i,a)},listen(t){if(l)throw new Error("A history only accepts one active listener");return i.addEventListener(m,d),l=t,()=>{i.removeEventListener(m,d),l=null}},createHref:t=>e(i,t),createURL:f,encodeLocation(t){let e=f(t);return{pathname:e.pathname,search:e.search,hash:e.hash}},push:function(t,e){o="PUSH";let n=w(p.location,t,e);r&&r(n,t),u=h()+1;let c=_(n,u),d=p.createHref(n);try{a.pushState(c,"",d)}catch(cg){if(cg instanceof DOMException&&"DataCloneError"===cg.name)throw cg;i.location.assign(d)}s&&l&&l({action:o,location:p.location,delta:1})},replace:function(t,e){o="REPLACE";let n=w(p.location,t,e);r&&r(n,t),u=h();let i=_(n,u),c=p.createHref(n);a.replaceState(i,"",c),s&&l&&l({action:o,location:p.location,delta:0})},go:t=>a.go(t)};return p}function k(t){let e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r="http://localhost";"undefined"!==typeof window&&(r="null"!==window.location.origin?window.location.origin:window.location.href),v(r,"No window.location.(origin|href) available to create URL");let n="string"===typeof t?t:E(t);return n=n.replace(/ $/,"%20"),!e&&n.startsWith("//")&&(n=r+n),new URL(n,r)}new WeakMap;function A(t,e){return x(t,e,arguments.length>2&&void 0!==arguments[2]?arguments[2]:"/",!1)}function x(t,e,r,n){let i=W(("string"===typeof e?S(e):e).pathname||"/",r);if(null==i)return null;let s=I(t);!function(t){t.sort((t,e)=>t.score!==e.score?e.score-t.score:function(t,e){let r=t.length===e.length&&t.slice(0,-1).every((t,r)=>t===e[r]);return r?t[t.length-1]-e[e.length-1]:0}(t.routesMeta.map(t=>t.childrenIndex),e.routesMeta.map(t=>t.childrenIndex)))}(s);let a=null;for(let o=0;null==a&&o<s.length;++o){let t=z(i);a=U(s[o],t,n)}return a}function I(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",i=arguments.length>4&&void 0!==arguments[4]&&arguments[4],s=function(t,s){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:i,o=arguments.length>3?arguments[3]:void 0,l={relativePath:void 0===o?t.path||"":o,caseSensitive:!0===t.caseSensitive,childrenIndex:s,route:t};if(l.relativePath.startsWith("/")){if(!l.relativePath.startsWith(n)&&a)return;v(l.relativePath.startsWith(n),'Absolute route path "'.concat(l.relativePath,'" nested under path "').concat(n,'" is not valid. An absolute child route path must start with the combined path of all its parent routes.')),l.relativePath=l.relativePath.slice(n.length)}let c=X([n,l.relativePath]),u=r.concat(l);t.children&&t.children.length>0&&(v(!0!==t.index,'Index routes must not have child routes. Please remove all child routes from route path "'.concat(c,'".')),I(t.children,e,u,c,a)),(null!=t.path||t.index)&&e.push({path:c,score:F(c,t.index),routesMeta:u})};return t.forEach((t,e)=>{var r;if(""!==t.path&&null!==(r=t.path)&&void 0!==r&&r.includes("?"))for(let n of R(t.path))s(t,e,!0,n);else s(t,e)}),e}function R(t){let e=t.split("/");if(0===e.length)return[];let[r,...n]=e,i=r.endsWith("?"),s=r.replace(/\?$/,"");if(0===n.length)return i?[s,""]:[s];let a=R(n.join("/")),o=[];return o.push(...a.map(t=>""===t?s:[s,t].join("/"))),i&&o.push(...a),o.map(e=>t.startsWith("/")&&""===e?"/":e)}var L=/^:[\w-]+$/,P=3,C=2,M=1,O=10,D=-2,N=t=>"*"===t;function F(t,e){let r=t.split("/"),n=r.length;return r.some(N)&&(n+=D),e&&(n+=C),r.filter(t=>!N(t)).reduce((t,e)=>t+(L.test(e)?P:""===e?M:O),n)}function U(t,e){let r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],{routesMeta:n}=t,i={},s="/",a=[];for(let o=0;o<n.length;++o){let t=n[o],l=o===n.length-1,c="/"===s?e:e.slice(s.length)||"/",u=B({path:t.relativePath,caseSensitive:t.caseSensitive,end:l},c),h=t.route;if(!u&&l&&r&&!n[n.length-1].route.index&&(u=B({path:t.relativePath,caseSensitive:t.caseSensitive,end:!1},c)),!u)return null;Object.assign(i,u.params),a.push({params:i,pathname:X([s,u.pathname]),pathnameBase:$(X([s,u.pathnameBase])),route:h}),"/"!==u.pathnameBase&&(s=X([s,u.pathnameBase]))}return a}function B(t,e){"string"===typeof t&&(t={path:t,caseSensitive:!1,end:!0});let[r,n]=j(t.path,t.caseSensitive,t.end),i=e.match(r);if(!i)return null;let s=i[0],a=s.replace(/(.)\/+$/,"$1"),o=i.slice(1);return{params:n.reduce((t,e,r)=>{let{paramName:n,isOptional:i}=e;if("*"===n){let t=o[r]||"";a=s.slice(0,s.length-t.length).replace(/(.)\/+$/,"$1")}const l=o[r];return t[n]=i&&!l?void 0:(l||"").replace(/%2F/g,"/"),t},{}),pathname:s,pathnameBase:a,pattern:t}}function j(t){let e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];b("*"===t||!t.endsWith("*")||t.endsWith("/*"),'Route path "'.concat(t,'" will be treated as if it were "').concat(t.replace(/\*$/,"/*"),'" because the `*` character must always follow a `/` in the pattern. To get rid of this warning, please change the route path to "').concat(t.replace(/\*$/,"/*"),'".'));let n=[],i="^"+t.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(t,e,r)=>(n.push({paramName:e,isOptional:null!=r}),r?"/?([^\\/]+)?":"/([^\\/]+)")).replace(/\/([\w-]+)\?(\/|$)/g,"(/$1)?$2");return t.endsWith("*")?(n.push({paramName:"*"}),i+="*"===t||"/*"===t?"(.*)$":"(?:\\/(.+)|\\/*)$"):r?i+="\\/*$":""!==t&&"/"!==t&&(i+="(?:(?=\\/|$))"),[new RegExp(i,e?void 0:"i"),n]}function z(t){try{return t.split("/").map(t=>decodeURIComponent(t).replace(/\//g,"%2F")).join("/")}catch(cg){return b(!1,'The URL path "'.concat(t,'" could not be decoded because it is a malformed URL segment. This is probably due to a bad percent encoding (').concat(cg,").")),t}}function W(t,e){if("/"===e)return t;if(!t.toLowerCase().startsWith(e.toLowerCase()))return null;let r=e.endsWith("/")?e.length-1:e.length,n=t.charAt(r);return n&&"/"!==n?null:t.slice(r)||"/"}var G=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,V=t=>G.test(t);function H(t,e){let r=e.replace(/\/+$/,"").split("/");return t.split("/").forEach(t=>{".."===t?r.length>1&&r.pop():"."!==t&&r.push(t)}),r.length>1?r.join("/"):"/"}function K(t,e,r,n){return"Cannot include a '".concat(t,"' character in a manually specified `to.").concat(e,"` field [").concat(JSON.stringify(n),"].  Please separate it out to the `to.").concat(r,'` field. Alternatively you may provide the full path as a string in <Link to="..."> and the router will parse it for you.')}function q(t){return t.filter((t,e)=>0===e||t.route.path&&t.route.path.length>0)}function Y(t){let e=q(t);return e.map((t,r)=>r===e.length-1?t.pathname:t.pathnameBase)}function Q(t,e,r){let n,i=arguments.length>3&&void 0!==arguments[3]&&arguments[3];"string"===typeof t?n=S(t):(n=c({},t),v(!n.pathname||!n.pathname.includes("?"),K("?","pathname","search",n)),v(!n.pathname||!n.pathname.includes("#"),K("#","pathname","hash",n)),v(!n.search||!n.search.includes("#"),K("#","search","hash",n)));let s,a=""===t||""===n.pathname,o=a?"/":n.pathname;if(null==o)s=r;else{let t=e.length-1;if(!i&&o.startsWith("..")){let e=o.split("/");for(;".."===e[0];)e.shift(),t-=1;n.pathname=e.join("/")}s=t>=0?e[t]:"/"}let l=function(t){let e,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"/",{pathname:n,search:i="",hash:s=""}="string"===typeof t?S(t):t;if(n)if(V(n))e=n;else{if(n.includes("//")){let t=n;n=n.replace(/\/\/+/g,"/"),b(!1,"Pathnames cannot have embedded double slashes - normalizing ".concat(t," -> ").concat(n))}e=n.startsWith("/")?H(n.substring(1),"/"):H(n,r)}else e=r;return{pathname:e,search:Z(i),hash:J(s)}}(n,s),u=o&&"/"!==o&&o.endsWith("/"),h=(a||"."===o)&&r.endsWith("/");return l.pathname.endsWith("/")||!u&&!h||(l.pathname+="/"),l}var X=t=>t.join("/").replace(/\/\/+/g,"/"),$=t=>t.replace(/\/+$/,"").replace(/^\/*/,"/"),Z=t=>t&&"?"!==t?t.startsWith("?")?t:"?"+t:"",J=t=>t&&"#"!==t?t.startsWith("#")?t:"#"+t:"";var tt=class{constructor(t,e,r){let n=arguments.length>3&&void 0!==arguments[3]&&arguments[3];this.status=t,this.statusText=e||"",this.internal=n,r instanceof Error?(this.data=r.toString(),this.error=r):this.data=r}};function et(t){return null!=t&&"number"===typeof t.status&&"string"===typeof t.statusText&&"boolean"===typeof t.internal&&"data"in t}function rt(t){return t.map(t=>t.route.path).filter(Boolean).join("/").replace(/\/\/*/g,"/")||"/"}var nt="undefined"!==typeof window&&"undefined"!==typeof window.document&&"undefined"!==typeof window.document.createElement;function it(t,e){let r=t;if("string"!==typeof r||!G.test(r))return{absoluteURL:void 0,isExternal:!1,to:r};let n=r,i=!1;if(nt)try{let t=new URL(window.location.href),n=r.startsWith("//")?new URL(t.protocol+r):new URL(r),s=W(n.pathname,e);n.origin===t.origin&&null!=s?r=s+n.search+n.hash:i=!0}catch(s){b(!1,'<Link to="'.concat(r,'"> contains an invalid URL which will probably break when clicked - please update to a valid URL path.'))}return{absoluteURL:n,isExternal:i,to:r}}Symbol("Uninstrumented");Object.getOwnPropertyNames(Object.prototype).sort().join("\0");var st=["POST","PUT","PATCH","DELETE"],at=(new Set(st),["GET",...st]);new Set(at),Symbol("ResetLoaderData");var ot=t.createContext(null);ot.displayName="DataRouter";var lt=t.createContext(null);lt.displayName="DataRouterState";var ct=t.createContext(!1);function ut(){return t.useContext(ct)}var ht=t.createContext({isTransitioning:!1});ht.displayName="ViewTransition";var dt=t.createContext(new Map);dt.displayName="Fetchers";var ft=t.createContext(null);ft.displayName="Await";var pt=t.createContext(null);pt.displayName="Navigation";var gt=t.createContext(null);gt.displayName="Location";var mt=t.createContext({outlet:null,matches:[],isDataRoute:!1});mt.displayName="Route";var yt=t.createContext(null);yt.displayName="RouteError";var vt="REACT_ROUTER_ERROR";function bt(){return null!=t.useContext(gt)}function _t(){return v(bt(),"useLocation() may be used only in the context of a <Router> component."),t.useContext(gt).location}var wt="You should call navigate() in a React.useEffect(), not when your component is first rendered.";function Et(e){t.useContext(pt).static||t.useLayoutEffect(e)}function St(){let{isDataRoute:e}=t.useContext(mt);return e?function(){let{router:e}=Ot("useNavigate"),r=Nt("useNavigate"),n=t.useRef(!1);Et(()=>{n.current=!0});let i=t.useCallback(async function(t){let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};b(n.current,wt),n.current&&("number"===typeof t?await e.navigate(t):await e.navigate(t,c({fromRouteId:r},i)))},[e,r]);return i}():function(){v(bt(),"useNavigate() may be used only in the context of a <Router> component.");let e=t.useContext(ot),{basename:r,navigator:n}=t.useContext(pt),{matches:i}=t.useContext(mt),{pathname:s}=_t(),a=JSON.stringify(Y(i)),o=t.useRef(!1);Et(()=>{o.current=!0});let l=t.useCallback(function(t){let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(b(o.current,wt),!o.current)return;if("number"===typeof t)return void n.go(t);let l=Q(t,JSON.parse(a),s,"path"===i.relative);null==e&&"/"!==r&&(l.pathname="/"===l.pathname?r:X([r,l.pathname])),(i.replace?n.replace:n.push)(l,i.state,i)},[r,n,a,s,e]);return l}()}t.createContext(null);function Tt(e){let{relative:r}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},{matches:n}=t.useContext(mt),{pathname:i}=_t(),s=JSON.stringify(Y(n));return t.useMemo(()=>Q(e,JSON.parse(s),i,"path"===r),[e,s,i,r])}function kt(e,r,n,i,s){v(bt(),"useRoutes() may be used only in the context of a <Router> component.");let{navigator:a}=t.useContext(pt),{matches:o}=t.useContext(mt),l=o[o.length-1],u=l?l.params:{},h=l?l.pathname:"/",d=l?l.pathnameBase:"/",f=l&&l.route;{let t=f&&f.path||"";Bt(h,!f||t.endsWith("*")||t.endsWith("*?"),'You rendered descendant <Routes> (or called `useRoutes()`) at "'.concat(h,'" (under <Route path="').concat(t,'">) but the parent route path has no trailing "*". This means if you navigate deeper, the parent won\'t match anymore and therefore the child routes will never render.\n\nPlease change the parent <Route path="').concat(t,'"> to <Route path="').concat("/"===t?"*":"".concat(t,"/*"),'">.'))}let p,g=_t();if(r){var m;let t="string"===typeof r?S(r):r;v("/"===d||(null===(m=t.pathname)||void 0===m?void 0:m.startsWith(d)),'When overriding the location using `<Routes location>` or `useRoutes(routes, location)`, the location pathname must begin with the portion of the URL pathname that was matched by all parent routes. The current pathname base is "'.concat(d,'" but pathname "').concat(t.pathname,'" was given in the `location` prop.')),p=t}else p=g;let y=p.pathname||"/",_=y;if("/"!==d){let t=d.replace(/^\//,"").split("/");_="/"+y.replace(/^\//,"").split("/").slice(t.length).join("/")}let w=A(e,{pathname:_});b(f||null!=w,'No routes matched location "'.concat(p.pathname).concat(p.search).concat(p.hash,'" ')),b(null==w||void 0!==w[w.length-1].route.element||void 0!==w[w.length-1].route.Component||void 0!==w[w.length-1].route.lazy,'Matched leaf route at location "'.concat(p.pathname).concat(p.search).concat(p.hash,'" does not have an element or Component. This means it will render an <Outlet /> with a null value by default resulting in an "empty" page.'));let E=Ct(w&&w.map(t=>Object.assign({},t,{params:Object.assign({},u,t.params),pathname:X([d,a.encodeLocation?a.encodeLocation(t.pathname.replace(/\?/g,"%3F").replace(/#/g,"%23")).pathname:t.pathname]),pathnameBase:"/"===t.pathnameBase?d:X([d,a.encodeLocation?a.encodeLocation(t.pathnameBase.replace(/\?/g,"%3F").replace(/#/g,"%23")).pathname:t.pathnameBase])})),o,n,i,s);return r&&E?t.createElement(gt.Provider,{value:{location:c({pathname:"/",search:"",hash:"",state:null,key:"default"},p),navigationType:"POP"}},E):E}function At(){let e=Ft(),r=et(e)?"".concat(e.status," ").concat(e.statusText):e instanceof Error?e.message:JSON.stringify(e),n=e instanceof Error?e.stack:null,i="rgba(200,200,200, 0.5)",s={padding:"0.5rem",backgroundColor:i},a={padding:"2px 4px",backgroundColor:i},o=null;return console.error("Error handled by React Router default ErrorBoundary:",e),o=t.createElement(t.Fragment,null,t.createElement("p",null,"\ud83d\udcbf Hey developer \ud83d\udc4b"),t.createElement("p",null,"You can provide a way better UX than this when your app throws errors by providing your own ",t.createElement("code",{style:a},"ErrorBoundary")," or"," ",t.createElement("code",{style:a},"errorElement")," prop on your route.")),t.createElement(t.Fragment,null,t.createElement("h2",null,"Unexpected Application Error!"),t.createElement("h3",{style:{fontStyle:"italic"}},r),n?t.createElement("pre",{style:s},n):null,o)}var xt=t.createElement(At,null),It=class extends t.Component{constructor(t){super(t),this.state={location:t.location,revalidation:t.revalidation,error:t.error}}static getDerivedStateFromError(t){return{error:t}}static getDerivedStateFromProps(t,e){return e.location!==t.location||"idle"!==e.revalidation&&"idle"===t.revalidation?{error:t.error,location:t.location,revalidation:t.revalidation}:{error:void 0!==t.error?t.error:e.error,location:e.location,revalidation:t.revalidation||e.revalidation}}componentDidCatch(t,e){this.props.onError?this.props.onError(t,e):console.error("React Router caught the following error during render",t)}render(){let e=this.state.error;if(this.context&&"object"===typeof e&&e&&"digest"in e&&"string"===typeof e.digest){const t=function(t){if(t.startsWith("".concat(vt,":").concat("ROUTE_ERROR_RESPONSE",":{")))try{let e=JSON.parse(t.slice(40));if("object"===typeof e&&e&&"number"===typeof e.status&&"string"===typeof e.statusText)return new tt(e.status,e.statusText,e.data)}catch(e){}}(e.digest);t&&(e=t)}let r=void 0!==e?t.createElement(mt.Provider,{value:this.props.routeContext},t.createElement(yt.Provider,{value:e,children:this.props.component})):this.props.children;return this.context?t.createElement(Lt,{error:e},r):r}};It.contextType=ct;var Rt=new WeakMap;function Lt(e){let{children:r,error:n}=e,{basename:i}=t.useContext(pt);if("object"===typeof n&&n&&"digest"in n&&"string"===typeof n.digest){let e=function(t){if(t.startsWith("".concat(vt,":").concat("REDIRECT",":{")))try{let e=JSON.parse(t.slice(28));if("object"===typeof e&&e&&"number"===typeof e.status&&"string"===typeof e.statusText&&"string"===typeof e.location&&"boolean"===typeof e.reloadDocument&&"boolean"===typeof e.replace)return e}catch(e){}}(n.digest);if(e){let r=Rt.get(n);if(r)throw r;let s=it(e.location,i);if(nt&&!Rt.get(n)){if(!s.isExternal&&!e.reloadDocument){const t=Promise.resolve().then(()=>window.__reactRouterDataRouter.navigate(s.to,{replace:e.replace}));throw Rt.set(n,t),t}window.location.href=s.absoluteURL||s.to}return t.createElement("meta",{httpEquiv:"refresh",content:"0;url=".concat(s.absoluteURL||s.to)})}}return r}function Pt(e){let{routeContext:r,match:n,children:i}=e,s=t.useContext(ot);return s&&s.static&&s.staticContext&&(n.route.errorElement||n.route.ErrorBoundary)&&(s.staticContext._deepestRenderedBoundaryId=n.route.id),t.createElement(mt.Provider,{value:r},i)}function Ct(e){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(null==e){if(!n)return null;if(n.errors)e=n.matches;else{if(0!==r.length||n.initialized||!(n.matches.length>0))return null;e=n.matches}}let s=e,a=null===n||void 0===n?void 0:n.errors;if(null!=a){let t=s.findIndex(t=>t.route.id&&void 0!==(null===a||void 0===a?void 0:a[t.route.id]));v(t>=0,"Could not find a matching route for errors on route IDs: ".concat(Object.keys(a).join(","))),s=s.slice(0,Math.min(s.length,t+1))}let o=!1,l=-1;if(n)for(let t=0;t<s.length;t++){let e=s[t];if((e.route.HydrateFallback||e.route.hydrateFallbackElement)&&(l=t),e.route.id){let{loaderData:t,errors:r}=n,i=e.route.loader&&!t.hasOwnProperty(e.route.id)&&(!r||void 0===r[e.route.id]);if(e.route.lazy||i){o=!0,s=l>=0?s.slice(0,l+1):[s[0]];break}}}let c=n&&i?(t,e)=>{var r,s;i(t,{location:n.location,params:null!==(r=null===(s=n.matches)||void 0===s||null===(s=s[0])||void 0===s?void 0:s.params)&&void 0!==r?r:{},unstable_pattern:rt(n.matches),errorInfo:e})}:void 0;return s.reduceRight((e,i,u)=>{let h,d=!1,f=null,p=null;n&&(h=a&&i.route.id?a[i.route.id]:void 0,f=i.route.errorElement||xt,o&&(l<0&&0===u?(Bt("route-fallback",!1,"No `HydrateFallback` element provided to render during initial hydration"),d=!0,p=null):l===u&&(d=!0,p=i.route.hydrateFallbackElement||null)));let g=r.concat(s.slice(0,u+1)),m=()=>{let r;return r=h?f:d?p:i.route.Component?t.createElement(i.route.Component,null):i.route.element?i.route.element:e,t.createElement(Pt,{match:i,routeContext:{outlet:e,matches:g,isDataRoute:null!=n},children:r})};return n&&(i.route.ErrorBoundary||i.route.errorElement||0===u)?t.createElement(It,{location:n.location,revalidation:n.revalidation,component:f,error:h,children:m(),routeContext:{outlet:null,matches:g,isDataRoute:!0},onError:c}):m()},null)}function Mt(t){return"".concat(t," must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.")}function Ot(e){let r=t.useContext(ot);return v(r,Mt(e)),r}function Dt(e){let r=t.useContext(lt);return v(r,Mt(e)),r}function Nt(e){let r=function(e){let r=t.useContext(mt);return v(r,Mt(e)),r}(e),n=r.matches[r.matches.length-1];return v(n.route.id,"".concat(e,' can only be used on routes that contain a unique "id"')),n.route.id}function Ft(){var e;let r=t.useContext(yt),n=Dt("useRouteError"),i=Nt("useRouteError");return void 0!==r?r:null===(e=n.errors)||void 0===e?void 0:e[i]}var Ut={};function Bt(t,e,r){e||Ut[t]||(Ut[t]=!0,b(!1,r))}var jt={};function zt(t,e){t||jt[e]||(jt[e]=!0,console.warn(e))}e.useOptimistic;t.memo(function(t){let{routes:e,future:r,state:n,onError:i}=t;return kt(e,void 0,n,i,r)});function Wt(e){let{to:r,replace:n,state:i,relative:s}=e;v(bt(),"<Navigate> may be used only in the context of a <Router> component.");let{static:a}=t.useContext(pt);b(!a,"<Navigate> must not be used on the initial render in a <StaticRouter>. This is a no-op, but you should modify your code so the <Navigate> is only ever rendered in response to some user interaction or state change.");let{matches:o}=t.useContext(mt),{pathname:l}=_t(),c=St(),u=Q(r,Y(o),l,"path"===s),h=JSON.stringify(u);return t.useEffect(()=>{c(JSON.parse(h),{replace:n,state:i,relative:s})},[c,h,s,n,i]),null}function Gt(t){v(!1,"A <Route> is only ever to be used as the child of <Routes> element, never rendered directly. Please wrap your <Route> in a <Routes>.")}function Vt(e){let{basename:r="/",children:n=null,location:i,navigationType:s="POP",navigator:a,static:o=!1,unstable_useTransitions:l}=e;v(!bt(),"You cannot render a <Router> inside another <Router>. You should never have more than one in your app.");let c=r.replace(/^\/*/,"/"),u=t.useMemo(()=>({basename:c,navigator:a,static:o,unstable_useTransitions:l,future:{}}),[c,a,o,l]);"string"===typeof i&&(i=S(i));let{pathname:h="/",search:d="",hash:f="",state:p=null,key:g="default"}=i,m=t.useMemo(()=>{let t=W(h,c);return null==t?null:{location:{pathname:t,search:d,hash:f,state:p,key:g},navigationType:s}},[c,h,d,f,p,g,s]);return b(null!=m,'<Router basename="'.concat(c,'"> is not able to match the URL "').concat(h).concat(d).concat(f,"\" because it does not start with the basename, so the <Router> won't render anything.")),null==m?null:t.createElement(pt.Provider,{value:u},t.createElement(gt.Provider,{children:n,value:m}))}function Ht(t){let{children:e,location:r}=t;return kt(Kt(e),r)}t.Component;function Kt(e){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=[];return t.Children.forEach(e,(e,i)=>{if(!t.isValidElement(e))return;let s=[...r,i];if(e.type===t.Fragment)return void n.push.apply(n,Kt(e.props.children,s));v(e.type===Gt,"[".concat("string"===typeof e.type?e.type:e.type.name,"] is not a <Route> component. All component children of <Routes> must be a <Route> or <React.Fragment>")),v(!e.props.index||!e.props.children,"An index route cannot have child routes.");let a={id:e.props.id||s.join("-"),caseSensitive:e.props.caseSensitive,element:e.props.element,Component:e.props.Component,index:e.props.index,path:e.props.path,middleware:e.props.middleware,loader:e.props.loader,action:e.props.action,hydrateFallbackElement:e.props.hydrateFallbackElement,HydrateFallback:e.props.HydrateFallback,errorElement:e.props.errorElement,ErrorBoundary:e.props.ErrorBoundary,hasErrorBoundary:!0===e.props.hasErrorBoundary||null!=e.props.ErrorBoundary||null!=e.props.errorElement,shouldRevalidate:e.props.shouldRevalidate,handle:e.props.handle,lazy:e.props.lazy};e.props.children&&(a.children=Kt(e.props.children,s)),n.push(a)}),n}var qt="get",Yt="application/x-www-form-urlencoded";function Qt(t){return"undefined"!==typeof HTMLElement&&t instanceof HTMLElement}var Xt=null;var $t=new Set(["application/x-www-form-urlencoded","multipart/form-data","text/plain"]);function Zt(t){return null==t||$t.has(t)?t:(b(!1,'"'.concat(t,'" is not a valid `encType` for `<Form>`/`<fetcher.Form>` and will default to "').concat(Yt,'"')),null)}function Jt(t,e){let r,n,i,s,a;if(Qt(o=t)&&"form"===o.tagName.toLowerCase()){let a=t.getAttribute("action");n=a?W(a,e):null,r=t.getAttribute("method")||qt,i=Zt(t.getAttribute("enctype"))||Yt,s=new FormData(t)}else if(function(t){return Qt(t)&&"button"===t.tagName.toLowerCase()}(t)||function(t){return Qt(t)&&"input"===t.tagName.toLowerCase()}(t)&&("submit"===t.type||"image"===t.type)){let a=t.form;if(null==a)throw new Error('Cannot submit a <button> or <input type="submit"> without a <form>');let o=t.getAttribute("formaction")||a.getAttribute("action");if(n=o?W(o,e):null,r=t.getAttribute("formmethod")||a.getAttribute("method")||qt,i=Zt(t.getAttribute("formenctype"))||Zt(a.getAttribute("enctype"))||Yt,s=new FormData(a,t),!function(){if(null===Xt)try{new FormData(document.createElement("form"),0),Xt=!1}catch(t){Xt=!0}return Xt}()){let{name:e,type:r,value:n}=t;if("image"===r){let t=e?"".concat(e,"."):"";s.append("".concat(t,"x"),"0"),s.append("".concat(t,"y"),"0")}else e&&s.append(e,n)}}else{if(Qt(t))throw new Error('Cannot submit element that is not <form>, <button>, or <input type="submit|image">');r=qt,n=null,i=Yt,a=t}var o;return s&&"text/plain"===i&&(a=s,s=void 0),{action:n,method:r.toLowerCase(),encType:i,formData:s,body:a}}Object.getOwnPropertyNames(Object.prototype).sort().join("\0");"undefined"!==typeof window?window:"undefined"!==typeof globalThis&&globalThis;function te(t,e){if(!1===t||null===t||"undefined"===typeof t)throw new Error(e)}Symbol("SingleFetchRedirect");function ee(t,e,r){let n="string"===typeof t?new URL(t,"undefined"===typeof window?"server://singlefetch/":window.location.origin):t;return"/"===n.pathname?n.pathname="_root.".concat(r):e&&"/"===W(n.pathname,e)?n.pathname="".concat(e.replace(/\/$/,""),"/_root.").concat(r):n.pathname="".concat(n.pathname.replace(/\/$/,""),".").concat(r),n}async function re(t,e){if(t.id in e)return e[t.id];try{let r=await import(t.module);return e[t.id]=r,r}catch(cg){return console.error("Error loading route module `".concat(t.module,"`, reloading page...")),console.error(cg),window.__reactRouterContext&&window.__reactRouterContext.isSpaMode,window.location.reload(),new Promise(()=>{})}}function ne(t){return null!=t&&"string"===typeof t.page}function ie(t){return null!=t&&(null==t.href?"preload"===t.rel&&"string"===typeof t.imageSrcSet&&"string"===typeof t.imageSizes:"string"===typeof t.rel&&"string"===typeof t.href)}function se(t,e,r,n,i,s){let a=(t,e)=>!r[e]||t.route.id!==r[e].route.id,o=(t,e)=>{var n;return r[e].pathname!==t.pathname||(null===(n=r[e].route.path)||void 0===n?void 0:n.endsWith("*"))&&r[e].params["*"]!==t.params["*"]};return"assets"===s?e.filter((t,e)=>a(t,e)||o(t,e)):"data"===s?e.filter((e,s)=>{let l=n.routes[e.route.id];if(!l||!l.hasLoader)return!1;if(a(e,s)||o(e,s))return!0;if(e.route.shouldRevalidate){var c;let n=e.route.shouldRevalidate({currentUrl:new URL(i.pathname+i.search+i.hash,window.origin),currentParams:(null===(c=r[0])||void 0===c?void 0:c.params)||{},nextUrl:new URL(t,window.origin),nextParams:e.params,defaultShouldRevalidate:!0});if("boolean"===typeof n)return n}return!0}):[]}function ae(t,e){let{includeHydrateFallback:r}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return n=t.map(t=>{let n=e.routes[t.route.id];if(!n)return[];let i=[n.module];return n.clientActionModule&&(i=i.concat(n.clientActionModule)),n.clientLoaderModule&&(i=i.concat(n.clientLoaderModule)),r&&n.hydrateFallbackModule&&(i=i.concat(n.hydrateFallbackModule)),n.imports&&(i=i.concat(n.imports)),i}).flat(1),[...new Set(n)];var n}function oe(t,e){let r=new Set,n=new Set(e);return t.reduce((t,i)=>{if(e&&!ne(i)&&"script"===i.as&&i.href&&n.has(i.href))return t;let s=JSON.stringify(function(t){let e={},r=Object.keys(t).sort();for(let n of r)e[n]=t[n];return e}(i));return r.has(s)||(r.add(s),t.push({key:s,link:i})),t},[])}function le(t,e){return"lazy"===t.mode&&!0===e}function ce(){let e=t.useContext(ot);return te(e,"You must render this element inside a <DataRouterContext.Provider> element"),e}function ue(){let e=t.useContext(lt);return te(e,"You must render this element inside a <DataRouterStateContext.Provider> element"),e}var he=t.createContext(void 0);function de(){let e=t.useContext(he);return te(e,"You must render this element inside a <HydratedRouter> element"),e}function fe(t,e){return r=>{t&&t(r),r.defaultPrevented||e(r)}}function pe(t,e,r){if(r&&!ve)return[t[0]];if(e){let r=t.findIndex(t=>void 0!==e[t.route.id]);return t.slice(0,r+1)}return t}he.displayName="FrameworkContext";function ge(e){let{page:r}=e,n=i(e,h),{router:s}=ce(),a=t.useMemo(()=>A(s.routes,r,s.basename),[s.routes,r,s.basename]);return a?t.createElement(ye,c({page:r,matches:a},n)):null}function me(e){let{manifest:r,routeModules:n}=de(),[i,s]=t.useState([]);return t.useEffect(()=>{let t=!1;return async function(t,e,r){return oe((await Promise.all(t.map(async t=>{let n=e.routes[t.route.id];if(n){let t=await re(n,r);return t.links?t.links():[]}return[]}))).flat(1).filter(ie).filter(t=>"stylesheet"===t.rel||"preload"===t.rel).map(t=>"stylesheet"===t.rel?c(c({},t),{},{rel:"prefetch",as:"style"}):c(c({},t),{},{rel:"prefetch"})))}(e,r,n).then(e=>{t||s(e)}),()=>{t=!0}},[e,r,n]),i}function ye(e){let{page:r,matches:n}=e,s=i(e,d),a=_t(),{manifest:o,routeModules:l}=de(),{basename:u}=ce(),{loaderData:h,matches:f}=ue(),p=t.useMemo(()=>se(r,n,f,o,a,"data"),[r,n,f,o,a]),g=t.useMemo(()=>se(r,n,f,o,a,"assets"),[r,n,f,o,a]),m=t.useMemo(()=>{if(r===a.pathname+a.search+a.hash)return[];let t=new Set,e=!1;if(n.forEach(r=>{var n;let i=o.routes[r.route.id];i&&i.hasLoader&&(!p.some(t=>t.route.id===r.route.id)&&r.route.id in h&&null!==(n=l[r.route.id])&&void 0!==n&&n.shouldRevalidate||i.hasClientLoader?e=!0:t.add(r.route.id))}),0===t.size)return[];let i=ee(r,u,"data");return e&&t.size>0&&i.searchParams.set("_routes",n.filter(e=>t.has(e.route.id)).map(t=>t.route.id).join(",")),[i.pathname+i.search]},[u,h,a,o,p,n,r,l]),y=t.useMemo(()=>ae(g,o),[g,o]),v=me(g);return t.createElement(t.Fragment,null,m.map(e=>t.createElement("link",c({key:e,rel:"prefetch",as:"fetch",href:e},s))),y.map(e=>t.createElement("link",c({key:e,rel:"modulepreload",href:e},s))),v.map(e=>{let{key:r,link:n}=e;return t.createElement("link",c({key:r,nonce:s.nonce},n))}))}var ve=!1;function be(e){let{manifest:r,serverHandoffString:n,isSpaMode:s,renderMeta:a,routeDiscovery:o,ssr:l}=de(),{router:h,static:d,staticContext:f}=ce(),{matches:p}=ue(),g=ut(),m=le(o,l);a&&(a.didRenderScripts=!0);let y=pe(p,null,s);t.useEffect(()=>{0},[]);let v=t.useMemo(()=>{var s;if(g)return null;let a=f?"window.__reactRouterContext = ".concat(n,";").concat("window.__reactRouterContext.stream = new ReadableStream({start(controller){window.__reactRouterContext.streamController = controller;}}).pipeThrough(new TextEncoderStream());"):" ",o=d?"".concat(null!==r.hmr&&void 0!==s&&s.runtime?"import ".concat(JSON.stringify(r.hmr.runtime),";"):"").concat(m?"":"import ".concat(JSON.stringify(r.url)),";\n").concat(y.map((t,e)=>{let n="route".concat(e),i=r.routes[t.route.id];te(i,"Route ".concat(t.route.id," not found in manifest"));let{clientActionModule:s,clientLoaderModule:a,clientMiddlewareModule:o,hydrateFallbackModule:l,module:c}=i,u=[...s?[{module:s,varName:"".concat(n,"_clientAction")}]:[],...a?[{module:a,varName:"".concat(n,"_clientLoader")}]:[],...o?[{module:o,varName:"".concat(n,"_clientMiddleware")}]:[],...l?[{module:l,varName:"".concat(n,"_HydrateFallback")}]:[],{module:c,varName:"".concat(n,"_main")}];return 1===u.length?"import * as ".concat(n," from ").concat(JSON.stringify(c),";"):[u.map(t=>"import * as ".concat(t.varName,' from "').concat(t.module,'";')).join("\n"),"const ".concat(n," = {").concat(u.map(t=>"...".concat(t.varName)).join(","),"};")].join("\n")}).join("\n"),"\n  ").concat(m?"window.__reactRouterManifest = ".concat(JSON.stringify(function(t,e){let{sri:r}=t,n=i(t,u),s=new Set(e.state.matches.map(t=>t.route.id)),a=e.state.location.pathname.split("/").filter(Boolean),o=["/"];for(a.pop();a.length>0;)o.push("/".concat(a.join("/"))),a.pop();o.forEach(t=>{let r=A(e.routes,t,e.basename);r&&r.forEach(t=>s.add(t.route.id))});let l=[...s].reduce((t,e)=>Object.assign(t,{[e]:n.routes[e]}),{});return c(c({},n),{},{routes:l,sri:!!r||void 0})}(r,h),null,2),";"):"","\n  window.__reactRouterRouteModules = {").concat(y.map((t,e)=>"".concat(JSON.stringify(t.route.id),":route").concat(e)).join(","),"};\n\nimport(").concat(JSON.stringify(r.entry.module),");"):" ";return t.createElement(t.Fragment,null,t.createElement("script",c(c({},e),{},{suppressHydrationWarning:!0,dangerouslySetInnerHTML:{__html:a},type:void 0})),t.createElement("script",c(c({},e),{},{suppressHydrationWarning:!0,dangerouslySetInnerHTML:{__html:o},type:"module",async:!0})))},[]),b=ve||g?[]:(r.entry.imports.concat(ae(y,r,{includeHydrateFallback:!0})),[...new Set(_)]);var _;let w="object"===typeof r.sri?r.sri:{};return zt(!g,"The <Scripts /> element is a no-op when using RSC and can be safely removed."),ve||g?null:t.createElement(t.Fragment,null,"object"===typeof r.sri?t.createElement("script",{"rr-importmap":"",type:"importmap",suppressHydrationWarning:!0,dangerouslySetInnerHTML:{__html:JSON.stringify({integrity:w})}}):null,m?null:t.createElement("link",{rel:"modulepreload",href:r.url,crossOrigin:e.crossOrigin,integrity:w[r.url],suppressHydrationWarning:!0}),t.createElement("link",{rel:"modulepreload",href:r.entry.module,crossOrigin:e.crossOrigin,integrity:w[r.entry.module],suppressHydrationWarning:!0}),b.map(r=>t.createElement("link",{key:r,rel:"modulepreload",href:r,crossOrigin:e.crossOrigin,integrity:w[r],suppressHydrationWarning:!0})),v)}function _e(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];return t=>{e.forEach(e=>{"function"===typeof e?e(t):null!=e&&(e.current=t)})}}t.Component;function we(e){let{error:r,isOutsideRemixApp:n}=e;console.error(r);let i,s=t.createElement("script",{dangerouslySetInnerHTML:{__html:'\n        console.log(\n          "\ud83d\udcbf Hey developer \ud83d\udc4b. You can provide a way better UX than this when your app throws errors. Check out https://reactrouter.com/how-to/error-boundary for more information."\n        );\n      '}});if(et(r))return t.createElement(Ee,{title:"Unhandled Thrown Response!"},t.createElement("h1",{style:{fontSize:"24px"}},r.status," ",r.statusText),s);if(r instanceof Error)0;else{let t=null==r?"Unknown Error":"object"===typeof r&&"toString"in r?r.toString():JSON.stringify(r);new Error(t)}return t.createElement(Ee,{title:"Application Error!",isOutsideRemixApp:n},t.createElement("h1",{style:{fontSize:"24px"}},"Application Error"),t.createElement("pre",{style:{padding:"2rem",background:"hsla(10, 50%, 50%, 0.1)",color:"red",overflow:"auto"}},i.stack),s)}function Ee(e){var r;let{title:n,renderScripts:i,isOutsideRemixApp:s,children:a}=e,{routeModules:o}=de();return null!==o.root&&void 0!==r&&r.Layout&&!s?a:t.createElement("html",{lang:"en"},t.createElement("head",null,t.createElement("meta",{charSet:"utf-8"}),t.createElement("meta",{name:"viewport",content:"width=device-width,initial-scale=1,viewport-fit=cover"}),t.createElement("title",null,n)),t.createElement("body",null,t.createElement("main",{style:{fontFamily:"system-ui, sans-serif",padding:"2rem"}},a,i?t.createElement(be,null):null)))}var Se="undefined"!==typeof window&&"undefined"!==typeof window.document&&"undefined"!==typeof window.document.createElement;try{Se&&(window.__reactRouterVersion="7.11.0")}catch(vA){}function Te(e){let{basename:r,children:n,unstable_useTransitions:i,window:s}=e,a=t.useRef();null==a.current&&(a.current=y({window:s,v5Compat:!0}));let o=a.current,[l,c]=t.useState({action:o.action,location:o.location}),u=t.useCallback(e=>{!1===i?c(e):t.startTransition(()=>c(e))},[i]);return t.useLayoutEffect(()=>o.listen(u),[o,u]),t.createElement(Vt,{basename:r,children:n,location:l.location,navigationType:l.action,navigator:o,unstable_useTransitions:i})}var ke=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,Ae=t.forwardRef(function(e,r){let{onClick:n,discover:s="render",prefetch:a="none",relative:o,reloadDocument:l,replace:u,state:h,target:d,to:p,preventScrollReset:g,viewTransition:m,unstable_defaultShouldRevalidate:y}=e,b=i(e,f),{basename:_,unstable_useTransitions:w}=t.useContext(pt),S="string"===typeof p&&ke.test(p),T=it(p,_);p=T.to;let k=function(e){let{relative:r}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};v(bt(),"useHref() may be used only in the context of a <Router> component.");let{basename:n,navigator:i}=t.useContext(pt),{hash:s,pathname:a,search:o}=Tt(e,{relative:r}),l=a;return"/"!==n&&(l="/"===a?n:X([n,a])),i.createHref({pathname:l,search:o,hash:s})}(p,{relative:o}),[A,x,I]=function(e,r){let n=t.useContext(he),[i,s]=t.useState(!1),[a,o]=t.useState(!1),{onFocus:l,onBlur:c,onMouseEnter:u,onMouseLeave:h,onTouchStart:d}=r,f=t.useRef(null);t.useEffect(()=>{if("render"===e&&o(!0),"viewport"===e){let t=new IntersectionObserver(t=>{t.forEach(t=>{o(t.isIntersecting)})},{threshold:.5});return f.current&&t.observe(f.current),()=>{t.disconnect()}}},[e]),t.useEffect(()=>{if(i){let t=setTimeout(()=>{o(!0)},100);return()=>{clearTimeout(t)}}},[i]);let p=()=>{s(!0)},g=()=>{s(!1),o(!1)};return n?"intent"!==e?[a,f,{}]:[a,f,{onFocus:fe(l,p),onBlur:fe(c,g),onMouseEnter:fe(u,p),onMouseLeave:fe(h,g),onTouchStart:fe(d,p)}]:[!1,f,{}]}(a,b),R=function(e){let{target:r,replace:n,state:i,preventScrollReset:s,relative:a,viewTransition:o,unstable_defaultShouldRevalidate:l,unstable_useTransitions:c}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},u=St(),h=_t(),d=Tt(e,{relative:a});return t.useCallback(f=>{if(function(t,e){return 0===t.button&&(!e||"_self"===e)&&!function(t){return!!(t.metaKey||t.altKey||t.ctrlKey||t.shiftKey)}(t)}(f,r)){f.preventDefault();let r=void 0!==n?n:E(h)===E(d),p=()=>u(e,{replace:r,state:i,preventScrollReset:s,relative:a,viewTransition:o,unstable_defaultShouldRevalidate:l});c?t.startTransition(()=>p()):p()}},[h,u,d,n,i,r,e,s,a,o,l,c])}(p,{replace:u,state:h,target:d,preventScrollReset:g,relative:o,viewTransition:m,unstable_defaultShouldRevalidate:y,unstable_useTransitions:w});let L=t.createElement("a",c(c(c({},b),I),{},{href:T.absoluteURL||k,onClick:T.isExternal||l?n:function(t){n&&n(t),t.defaultPrevented||R(t)},ref:_e(r,x),target:d,"data-discover":S||"render"!==s?void 0:"true"}));return A&&!S?t.createElement(t.Fragment,null,L,t.createElement(ge,{page:k})):L});Ae.displayName="Link",t.forwardRef(function(e,r){let{"aria-current":n="page",caseSensitive:s=!1,className:a="",end:o=!1,style:l,to:u,viewTransition:h,children:d}=e,f=i(e,p),g=Tt(u,{relative:f.relative}),m=_t(),y=t.useContext(lt),{navigator:b,basename:_}=t.useContext(pt),w=null!=y&&function(e){let{relative:r}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.useContext(ht);v(null!=n,"`useViewTransitionState` must be used within `react-router-dom`'s `RouterProvider`.  Did you accidentally import `RouterProvider` from `react-router`?");let{basename:i}=Re("useViewTransitionState"),s=Tt(e,{relative:r});if(!n.isTransitioning)return!1;let a=W(n.currentLocation.pathname,i)||n.currentLocation.pathname,o=W(n.nextLocation.pathname,i)||n.nextLocation.pathname;return null!=B(s.pathname,o)||null!=B(s.pathname,a)}(g)&&!0===h,E=b.encodeLocation?b.encodeLocation(g).pathname:g.pathname,S=m.pathname,T=y&&y.navigation&&y.navigation.location?y.navigation.location.pathname:null;s||(S=S.toLowerCase(),T=T?T.toLowerCase():null,E=E.toLowerCase()),T&&_&&(T=W(T,_)||T);const k="/"!==E&&E.endsWith("/")?E.length-1:E.length;let A,x=S===E||!o&&S.startsWith(E)&&"/"===S.charAt(k),I=null!=T&&(T===E||!o&&T.startsWith(E)&&"/"===T.charAt(E.length)),R={isActive:x,isPending:I,isTransitioning:w},L=x?n:void 0;A="function"===typeof a?a(R):[a,x?"active":null,I?"pending":null,w?"transitioning":null].filter(Boolean).join(" ");let P="function"===typeof l?l(R):l;return t.createElement(Ae,c(c({},f),{},{"aria-current":L,className:A,ref:r,style:P,to:u,viewTransition:h}),"function"===typeof d?d(R):d)}).displayName="NavLink";var xe=t.forwardRef((e,r)=>{let{discover:n="render",fetcherKey:s,navigate:a,reloadDocument:o,replace:l,state:u,method:h=qt,action:d,onSubmit:f,relative:p,preventScrollReset:m,viewTransition:y,unstable_defaultShouldRevalidate:b}=e,_=i(e,g),{unstable_useTransitions:w}=t.useContext(pt),S=Ce(),T=function(e){let{relative:r}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},{basename:n}=t.useContext(pt),i=t.useContext(mt);v(i,"useFormAction must be used inside a RouteContext");let[s]=i.matches.slice(-1),a=c({},Tt(e||".",{relative:r})),o=_t();if(null==e){a.search=o.search;let t=new URLSearchParams(a.search),e=t.getAll("index");if(e.some(t=>""===t)){t.delete("index"),e.filter(t=>t).forEach(e=>t.append("index",e));let r=t.toString();a.search=r?"?".concat(r):""}}e&&"."!==e||!s.route.index||(a.search=a.search?a.search.replace(/^\?/,"?index&"):"?index");"/"!==n&&(a.pathname="/"===a.pathname?n:X([n,a.pathname]));return E(a)}(d,{relative:p}),k="get"===h.toLowerCase()?"get":"post",A="string"===typeof d&&ke.test(d);return t.createElement("form",c(c({ref:r,method:k,action:T,onSubmit:o?f:e=>{if(f&&f(e),e.defaultPrevented)return;e.preventDefault();let r=e.nativeEvent.submitter,n=(null===r||void 0===r?void 0:r.getAttribute("formmethod"))||h,i=()=>S(r||e.currentTarget,{fetcherKey:s,method:n,navigate:a,replace:l,state:u,relative:p,preventScrollReset:m,viewTransition:y,unstable_defaultShouldRevalidate:b});w&&!1!==a?t.startTransition(()=>i()):i()}},_),{},{"data-discover":A||"render"!==n?void 0:"true"}))});function Ie(t){return"".concat(t," must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.")}function Re(e){let r=t.useContext(ot);return v(r,Ie(e)),r}xe.displayName="Form";var Le=0,Pe=()=>"__".concat(String(++Le),"__");function Ce(){let{router:e}=Re("useSubmit"),{basename:r}=t.useContext(pt),n=Nt("useRouteId"),i=e.fetch,s=e.navigate;return t.useCallback(async function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},{action:a,method:o,encType:l,formData:c,body:u}=Jt(t,r);if(!1===e.navigate){let t=e.fetcherKey||Pe();await i(t,n,e.action||a,{unstable_defaultShouldRevalidate:e.unstable_defaultShouldRevalidate,preventScrollReset:e.preventScrollReset,formData:c,body:u,formMethod:e.method||o,formEncType:e.encType||l,flushSync:e.flushSync})}else await s(e.action||a,{unstable_defaultShouldRevalidate:e.unstable_defaultShouldRevalidate,preventScrollReset:e.preventScrollReset,formData:c,body:u,formMethod:e.method||o,formEncType:e.encType||l,replace:e.replace,state:e.state,fromRouteId:n,flushSync:e.flushSync,viewTransition:e.viewTransition})},[i,s,r,n])}var Me=r(579);class Oe extends t.Component{constructor(t){super(t),this.toggleSidebar=()=>{this.setState(t=>{const e=!t.isOpen;return localStorage.setItem("sidebarOpen",e),{isOpen:e}})},this.closeSidebar=()=>{this.setState({isOpen:!1},()=>{localStorage.setItem("sidebarOpen","false")})};const e="true"===localStorage.getItem("sidebarOpen");this.state={isOpen:e}}render(){const{location:t}=this.props;if("/"===t.pathname)return null;const{isOpen:e}=this.state;return(0,Me.jsxs)("div",{className:"sidebar ".concat(e?"open":"collapsed"),children:[(0,Me.jsx)("div",{className:"sidebar-header",children:(0,Me.jsx)("span",{className:"brand",onClick:this.toggleSidebar,children:"ROS II PANEL"})}),e&&(0,Me.jsx)("nav",{className:"sidebar-links",children:(0,Me.jsx)(Ae,{to:"/panel",className:"nav-item",onClick:this.closeSidebar,children:"Panel"})})]})}}const De=Oe;const Ne=function(t){const e=_t();return(0,Me.jsx)(De,c(c({},t),{},{location:e}))};var Fe=r(139),Ue=r.n(Fe);const Be=["xxl","xl","lg","md","sm","xs"],je="xs",ze=t.createContext({prefixes:{},breakpoints:Be,minBreakpoint:je}),{Consumer:We,Provider:Ge}=ze;function Ve(e,r){const{prefixes:n}=(0,t.useContext)(ze);return e||n[r]||r}const He=["bsPrefix","fluid","as","className"],Ke=t.forwardRef((t,e)=>{let{bsPrefix:r,fluid:n=!1,as:s="div",className:a}=t,o=i(t,He);const l=Ve(r,"container"),u="string"===typeof n?"-".concat(n):"-fluid";return(0,Me.jsx)(s,c(c({ref:e},o),{},{className:Ue()(a,n?"".concat(l).concat(u):l)}))});Ke.displayName="Container";const qe=Ke;const Ye=function(t){let{children:e}=t;return"true"===sessionStorage.getItem("isLogin")?e:(0,Me.jsx)(Wt,{to:"/",replace:!0})};class Qe extends t.Component{constructor(){super(...arguments),this.state={username:"",password:"",loggedIn:!1},this.usernameRef=(0,t.createRef)(),this.handleLogin=()=>{const t=this.state.username.trim(),e=this.state.password.trim();"admin"===t&&"1234"===e?(sessionStorage.setItem("isLogin","true"),this.setState({loggedIn:!0})):(alert("\u767b\u5165\u5931\u6557"),this.setState({username:"",password:""},()=>{this.usernameRef.current&&this.usernameRef.current.focus()}))},this.handleKeyDown=t=>{"Enter"===t.key&&this.handleLogin()}}render(){return this.state.loggedIn?(0,Me.jsx)(Wt,{to:"/panel",replace:!0}):(0,Me.jsx)("div",{className:"login-page",children:(0,Me.jsxs)("div",{className:"login-card",children:[(0,Me.jsxs)("div",{className:"login-header",children:[(0,Me.jsx)("h1",{children:"\u9060\u7aef\u76e3\u63a7\u7cfb\u7d71"}),(0,Me.jsx)("p",{children:"Remote Control System"})]}),(0,Me.jsxs)("div",{className:"login-form",children:[(0,Me.jsx)("input",{type:"text",placeholder:"\u5e33\u865f",value:this.state.username,ref:this.usernameRef,maxLength:20,onChange:t=>this.setState({username:t.target.value}),onKeyDown:this.handleKeyDown}),(0,Me.jsx)("input",{type:"password",placeholder:"\u5bc6\u78bc",value:this.state.password,maxLength:12,onChange:t=>this.setState({password:t.target.value}),onKeyDown:this.handleKeyDown})]}),(0,Me.jsx)("div",{className:"login-actions",children:(0,Me.jsx)("button",{onClick:this.handleLogin,children:"\u767b\u5165\u7cfb\u7d71"})})]})})}}const Xe=Qe,$e=["as","disabled"];function Ze(t){let{tagName:e,disabled:r,href:n,target:i,rel:s,role:a,onClick:o,tabIndex:l=0,type:c}=t;e||(e=null!=n||null!=i||null!=s?"a":"button");const u={tagName:e};if("button"===e)return[{type:c||"button",disabled:r},u];const h=t=>{(r||"a"===e&&function(t){return!t||"#"===t.trim()}(n))&&t.preventDefault(),r?t.stopPropagation():null==o||o(t)};return"a"===e&&(n||(n="#"),r&&(n=void 0)),[{role:null!=a?a:"button",disabled:void 0,tabIndex:r?void 0:l,href:n,target:"a"===e?i:void 0,"aria-disabled":r||void 0,rel:"a"===e?s:void 0,onClick:h,onKeyDown:t=>{" "===t.key&&(t.preventDefault(),h(t))}},u]}const Je=t.forwardRef((t,e)=>{let{as:r,disabled:n}=t,i=function(t,e){if(null==t)return{};var r={};for(var n in t)if({}.hasOwnProperty.call(t,n)){if(e.indexOf(n)>=0)continue;r[n]=t[n]}return r}(t,$e);const[s,{tagName:a}]=Ze(Object.assign({tagName:r,disabled:n},i));return(0,Me.jsx)(a,Object.assign({},i,s,{ref:e}))});Je.displayName="Button";const tr=["as","bsPrefix","variant","size","active","disabled","className"],er=t.forwardRef((t,e)=>{let{as:r,bsPrefix:n,variant:s="primary",size:a,active:o=!1,disabled:l=!1,className:u}=t,h=i(t,tr);const d=Ve(n,"btn"),[f,{tagName:p}]=Ze(c({tagName:r,disabled:l},h)),g=p;return(0,Me.jsx)(g,c(c(c({},f),h),{},{ref:e,disabled:l,className:Ue()(u,d,o&&"active",s&&"".concat(d,"-").concat(s),a&&"".concat(d,"-").concat(a),h.href&&l&&"disabled")}))});er.displayName="Button";const rr=er,nr="https://ros_bot1_server.jampenglab.tw/bot1/api/v1",ir={getStatus:async()=>{const t="".concat(nr,"/ros/status");try{const e=await fetch(t);if(!e.ok)throw new Error("\u8b80\u53d6 ROS \u72c0\u614b\u5931\u6557");return await e.json()}catch(Dd){return{running:!1,mode:"idle",mapName:null}}},startMode:async function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const r="".concat(nr,"/ros/start_mode");try{const n={mode:t};e&&(n.mapName=e);const i=await fetch(r,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)});if(!i.ok){const t=await i.text();throw new Error(t||"\u4f3a\u670d\u5668\u56de\u61c9\u5931\u6557")}return await i.text()}catch(Dd){throw Dd}},stopMode:async()=>{const t="".concat(nr,"/ros/stop_mode");try{const e=await fetch(t,{method:"POST"});if(!e.ok){const t=await e.text();throw new Error(t||"\u4f3a\u670d\u5668\u56de\u61c9\u5931\u6557")}return await e.text()}catch(Dd){throw Dd}},getMaps:async()=>{const t="".concat(nr,"/maps/list_maps");try{const e=await fetch(t,{method:"GET"});if(!e.ok){const t=await e.text();throw new Error(t||"\u4f3a\u670d\u5668\u56de\u61c9\u5931\u6557")}return await e.json()}catch(Dd){throw Dd}},saveMap:async t=>{const e="".concat(nr,"/maps/save_map");try{const r=await fetch(e,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({folderName:t})});if(!r.ok){const t=await r.text();throw new Error(t||"\u4f3a\u670d\u5668\u56de\u61c9\u5931\u6557")}return await r.text()}catch(Dd){throw Dd}},startCameraGstreamer:async()=>{const t="".concat(nr,"/ros/gstreamer/start"),e=await fetch(t,{method:"POST"});if(!e.ok)throw new Error("\u555f\u52d5 Camera \u5931\u6557");return await e.text()},stopCameraGstreamer:async()=>{const t="".concat(nr,"/ros/gstreamer/stop"),e=await fetch(t,{method:"POST"});if(!e.ok)throw new Error("\u505c\u6b62 Camera \u5931\u6557");return await e.text()}},sr=ir;function ar(t,e){if(e.has(t))throw new TypeError("Cannot initialize the same private elements twice on an object")}function or(t,e,r){ar(t,e),e.set(t,r)}function lr(t,e,r){if("function"==typeof t?t===e:t.has(e))return arguments.length<3?e:r;throw new TypeError("Private element is not present on this object")}function cr(t,e,r){return t.set(lr(t,e),r),r}function ur(t,e){return t.get(lr(t,e))}function hr(t,e){this.v=t,this.k=e}function dr(t){var e={},r=!1;function n(e,n){return r=!0,n=new Promise(function(r){r(t[e](n))}),{done:!1,value:new hr(n,1)}}return e["undefined"!=typeof Symbol&&Symbol.iterator||"@@iterator"]=function(){return this},e.next=function(t){return r?(r=!1,t):n("next",t)},"function"==typeof t.throw&&(e.throw=function(t){if(r)throw r=!1,t;return n("throw",t)}),"function"==typeof t.return&&(e.return=function(t){return r?(r=!1,t):n("return",t)}),e}function fr(t){var e,r,n,i=2;for("undefined"!=typeof Symbol&&(r=Symbol.asyncIterator,n=Symbol.iterator);i--;){if(r&&null!=(e=t[r]))return e.call(t);if(n&&null!=(e=t[n]))return new pr(e.call(t));r="@@asyncIterator",n="@@iterator"}throw new TypeError("Object is not async iterable")}function pr(t){function e(t){if(Object(t)!==t)return Promise.reject(new TypeError(t+" is not an object."));var e=t.done;return Promise.resolve(t.value).then(function(t){return{value:t,done:e}})}return pr=function(t){this.s=t,this.n=t.next},pr.prototype={s:null,n:null,next:function(){return e(this.n.apply(this.s,arguments))},return:function(t){var r=this.s.return;return void 0===r?Promise.resolve({value:t,done:!0}):e(r.apply(this.s,arguments))},throw:function(t){var r=this.s.return;return void 0===r?Promise.reject(t):e(r.apply(this.s,arguments))}},new pr(t)}function gr(t){return new hr(t,0)}function mr(t){return function(){return new yr(t.apply(this,arguments))}}function yr(t){var e,r;function n(e,r){try{var s=t[e](r),a=s.value,o=a instanceof hr;Promise.resolve(o?a.v:a).then(function(r){if(o){var l="return"===e?"return":"next";if(!a.k||r.done)return n(l,r);r=t[l](r).value}i(s.done?"return":"normal",r)},function(t){n("throw",t)})}catch(t){i("throw",t)}}function i(t,i){switch(t){case"return":e.resolve({value:i,done:!0});break;case"throw":e.reject(i);break;default:e.resolve({value:i,done:!1})}(e=e.next)?n(e.key,e.arg):r=null}this._invoke=function(t,i){return new Promise(function(s,a){var o={key:t,arg:i,resolve:s,reject:a,next:null};r?r=r.next=o:(e=r=o,n(t,i))})},"function"!=typeof t.return&&(this.return=void 0)}yr.prototype["function"==typeof Symbol&&Symbol.asyncIterator||"@@asyncIterator"]=function(){return this},yr.prototype.next=function(t){return this._invoke("next",t)},yr.prototype.throw=function(t){return this._invoke("throw",t)},yr.prototype.return=function(t){return this._invoke("return",t)};const vr=["context","forceRefresh"],br=["host","port","socksProxy"];var _r=Object.defineProperty,wr=Object.getOwnPropertyDescriptor,Er=Object.getOwnPropertyNames,Sr=Object.prototype.hasOwnProperty,Tr=(t,e)=>()=>(t&&(e=t(t=0)),e),kr=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports),Ar=(t,e)=>{for(var r in e)_r(t,r,{get:e[r],enumerable:!0})},xr=t=>((t,e,r,n)=>{if(e&&"object"==typeof e||"function"==typeof e)for(let i of Er(e))!Sr.call(t,i)&&i!==r&&_r(t,i,{get:()=>e[i],enumerable:!(n=wr(e,i))||n.enumerable});return t})(_r({},"__esModule",{value:!0}),t),Ir=Tr(()=>{}),Rr={};function Lr(t){throw new Error("Node.js process "+t+" is not supported by JSPM core outside of Node.js")}function Pr(){!qr||!Yr||(qr=!1,Yr.length?Kr=Yr.concat(Kr):Qr=-1,Kr.length&&Cr())}function Cr(){if(!qr){var t=setTimeout(Pr,0);qr=!0;for(var e=Kr.length;e;){for(Yr=Kr,Kr=[];++Qr<e;)Yr&&Yr[Qr].run();Qr=-1,e=Kr.length}Yr=null,qr=!1,clearTimeout(t)}}function Mr(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)e[r-1]=arguments[r];Kr.push(new Or(t,e)),1===Kr.length&&!qr&&setTimeout(Cr,0)}function Or(t,e){this.fun=t,this.array=e}function Dr(){}function Nr(t){Lr("_linkedBinding")}function Fr(t){Lr("dlopen")}function Ur(){return[]}function Br(){return[]}function jr(t,e){if(!t)throw new Error(e||"assertion error")}function zr(){return!1}function Wr(){return Hn.now()/1e3}function Gr(t){var e=Math.floor(.001*(Date.now()-Hn.now())),r=.001*Hn.now(),n=Math.floor(r)+e,i=Math.floor(r%1*1e9);return t&&(n-=t[0],(i-=t[1])<0&&(n--,i+=qn)),[n,i]}function Vr(){return si}function Hr(t){return[]}Ar(Rr,{_debugEnd:()=>Pn,_debugProcess:()=>Ln,_events:()=>Qn,_eventsCount:()=>Xn,_exiting:()=>gn,_fatalExceptions:()=>xn,_getActiveHandles:()=>Br,_getActiveRequests:()=>Ur,_kill:()=>vn,_linkedBinding:()=>Nr,_maxListeners:()=>Yn,_preload_modules:()=>Gn,_rawDebug:()=>dn,_startProfilerIdleNotifier:()=>Cn,_stopProfilerIdleNotifier:()=>Mn,_tickCallback:()=>Rn,abort:()=>Fn,addListener:()=>$n,allowedNodeEnvironmentFlags:()=>kn,arch:()=>$r,argv:()=>tn,argv0:()=>Wn,assert:()=>jr,binding:()=>an,browser:()=>hn,chdir:()=>cn,config:()=>mn,cpuUsage:()=>bn,cwd:()=>ln,debugPort:()=>zn,default:()=>si,dlopen:()=>Fr,domain:()=>pn,emit:()=>ri,emitWarning:()=>sn,env:()=>Jr,execArgv:()=>en,execPath:()=>jn,exit:()=>Sn,features:()=>An,hasUncaughtExceptionCaptureCallback:()=>zr,hrtime:()=>Gr,kill:()=>En,listeners:()=>Hr,memoryUsage:()=>wn,moduleLoadList:()=>fn,nextTick:()=>Mr,off:()=>Jn,on:()=>Vr,once:()=>Zn,openStdin:()=>Tn,pid:()=>Un,platform:()=>Zr,ppid:()=>Bn,prependListener:()=>ni,prependOnceListener:()=>ii,reallyExit:()=>yn,release:()=>un,removeAllListeners:()=>ei,removeListener:()=>ti,resourceUsage:()=>_n,setSourceMapsEnabled:()=>Vn,setUncaughtExceptionCaptureCallback:()=>In,stderr:()=>Dn,stdin:()=>Nn,stdout:()=>On,title:()=>Xr,umask:()=>on,uptime:()=>Wr,version:()=>rn,versions:()=>nn});var Kr,qr,Yr,Qr,Xr,$r,Zr,Jr,tn,en,rn,nn,sn,an,on,ln,cn,un,hn,dn,fn,pn,gn,mn,yn,vn,bn,_n,wn,En,Sn,Tn,kn,An,xn,In,Rn,Ln,Pn,Cn,Mn,On,Dn,Nn,Fn,Un,Bn,jn,zn,Wn,Gn,Vn,Hn,Kn,qn,Yn,Qn,Xn,$n,Zn,Jn,ti,ei,ri,ni,ii,si,ai=Tr(()=>{Ir(),Ei(),oi(),Kr=[],qr=!1,Qr=-1,Or.prototype.run=function(){this.fun.apply(null,this.array)},Xr="browser",$r="x64",Zr="browser",Jr={PATH:"/usr/bin",LANG:typeof navigator<"u"?navigator.language+".UTF-8":void 0,PWD:"/",HOME:"/home",TMP:"/tmp"},tn=["/usr/bin/node"],en=[],rn="v16.8.0",nn={},sn=function(t,e){console.warn((e?e+": ":"")+t)},an=function(t){Lr("binding")},on=function(t){return 0},ln=function(){return"/"},cn=function(t){},un={name:"node",sourceUrl:"",headersUrl:"",libUrl:""},hn=!0,dn=Dr,fn=[],pn={},gn=!1,mn={},yn=Dr,vn=Dr,_n=bn=function(){return{}},wn=bn,En=Dr,Sn=Dr,Tn=Dr,kn={},An={inspector:!1,debug:!1,uv:!1,ipv6:!1,tls_alpn:!1,tls_sni:!1,tls_ocsp:!1,tls:!1,cached_builtins:!0},xn=Dr,In=Dr,Rn=Dr,Ln=Dr,Pn=Dr,Cn=Dr,Mn=Dr,On=void 0,Dn=void 0,Nn=void 0,Fn=Dr,Un=2,Bn=1,jn="/bin/usr/node",zn=9229,Wn="node",Gn=[],Vn=Dr,void 0===(Hn={now:typeof performance<"u"?performance.now.bind(performance):void 0,timing:typeof performance<"u"?performance.timing:void 0}).now&&(Kn=Date.now(),Hn.timing&&Hn.timing.navigationStart&&(Kn=Hn.timing.navigationStart),Hn.now=()=>Date.now()-Kn),qn=1e9,Gr.bigint=function(t){var e=Gr(t);return typeof BigInt>"u"?e[0]*qn+e[1]:BigInt(e[0]*qn)+BigInt(e[1])},si={version:rn,versions:nn,arch:$r,platform:Zr,browser:hn,release:un,_rawDebug:dn,moduleLoadList:fn,binding:an,_linkedBinding:Nr,_events:Qn={},_eventsCount:Xn=0,_maxListeners:Yn=10,on:Vr,addListener:$n=Vr,once:Zn=Vr,off:Jn=Vr,removeListener:ti=Vr,removeAllListeners:ei=Vr,emit:ri=Dr,prependListener:ni=Vr,prependOnceListener:ii=Vr,listeners:Hr,domain:pn,_exiting:gn,config:mn,dlopen:Fr,uptime:Wr,_getActiveRequests:Ur,_getActiveHandles:Br,reallyExit:yn,_kill:vn,cpuUsage:bn,resourceUsage:_n,memoryUsage:wn,kill:En,exit:Sn,openStdin:Tn,allowedNodeEnvironmentFlags:kn,assert:jr,features:An,_fatalExceptions:xn,setUncaughtExceptionCaptureCallback:In,hasUncaughtExceptionCaptureCallback:zr,emitWarning:sn,nextTick:Mr,_tickCallback:Rn,_debugProcess:Ln,_debugEnd:Pn,_startProfilerIdleNotifier:Cn,_stopProfilerIdleNotifier:Mn,stdout:On,stdin:Nn,stderr:Dn,abort:Fn,umask:on,chdir:cn,cwd:ln,env:Jr,title:Xr,argv:tn,execArgv:en,pid:Un,ppid:Bn,execPath:jn,debugPort:zn,hrtime:Gr,argv0:Wn,_preload_modules:Gn,setSourceMapsEnabled:Vn}}),oi=Tr(()=>{ai()});function li(){if(pi)return fi;pi=!0;let t=function(){if(ui)return ci;ui=!0,ci.byteLength=function(t){var e=s(t),r=e[0],n=e[1];return 3*(r+n)/4-n},ci.toByteArray=function(t){var n,i,a=s(t),o=a[0],l=a[1],c=new r(function(t,e,r){return 3*(e+r)/4-r}(0,o,l)),u=0,h=l>0?o-4:o;for(i=0;i<h;i+=4)n=e[t.charCodeAt(i)]<<18|e[t.charCodeAt(i+1)]<<12|e[t.charCodeAt(i+2)]<<6|e[t.charCodeAt(i+3)],c[u++]=n>>16&255,c[u++]=n>>8&255,c[u++]=255&n;return 2===l&&(n=e[t.charCodeAt(i)]<<2|e[t.charCodeAt(i+1)]>>4,c[u++]=255&n),1===l&&(n=e[t.charCodeAt(i)]<<10|e[t.charCodeAt(i+1)]<<4|e[t.charCodeAt(i+2)]>>2,c[u++]=n>>8&255,c[u++]=255&n),c},ci.fromByteArray=function(e){for(var r,n=e.length,i=n%3,s=[],a=16383,l=0,c=n-i;l<c;l+=a)s.push(o(e,l,l+a>c?c:l+a));return 1===i?(r=e[n-1],s.push(t[r>>2]+t[r<<4&63]+"==")):2===i&&(r=(e[n-2]<<8)+e[n-1],s.push(t[r>>10]+t[r>>4&63]+t[r<<2&63]+"=")),s.join("")};for(var t=[],e=[],r=typeof Uint8Array<"u"?Uint8Array:Array,n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",i=0;i<64;++i)t[i]=n[i],e[n.charCodeAt(i)]=i;function s(t){var e=t.length;if(e%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var r=t.indexOf("=");return-1===r&&(r=e),[r,r===e?0:4-r%4]}function a(e){return t[e>>18&63]+t[e>>12&63]+t[e>>6&63]+t[63&e]}function o(t,e,r){for(var n,i=[],s=e;s<r;s+=3)n=(t[s]<<16&16711680)+(t[s+1]<<8&65280)+(255&t[s+2]),i.push(a(n));return i.join("")}return e[45]=62,e[95]=63,ci}(),e=(di||(di=!0,hi.read=function(t,e,r,n,i){var s,a,o=8*i-n-1,l=(1<<o)-1,c=l>>1,u=-7,h=r?i-1:0,d=r?-1:1,f=t[e+h];for(h+=d,s=f&(1<<-u)-1,f>>=-u,u+=o;u>0;s=256*s+t[e+h],h+=d,u-=8);for(a=s&(1<<-u)-1,s>>=-u,u+=n;u>0;a=256*a+t[e+h],h+=d,u-=8);if(0===s)s=1-c;else{if(s===l)return a?NaN:1/0*(f?-1:1);a+=Math.pow(2,n),s-=c}return(f?-1:1)*a*Math.pow(2,s-n)},hi.write=function(t,e,r,n,i,s){var a,o,l,c=8*s-i-1,u=(1<<c)-1,h=u>>1,d=23===i?Math.pow(2,-24)-Math.pow(2,-77):0,f=n?0:s-1,p=n?1:-1,g=e<0||0===e&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(o=isNaN(e)?1:0,a=u):(a=Math.floor(Math.log(e)/Math.LN2),e*(l=Math.pow(2,-a))<1&&(a--,l*=2),(e+=a+h>=1?d/l:d*Math.pow(2,1-h))*l>=2&&(a++,l/=2),a+h>=u?(o=0,a=u):a+h>=1?(o=(e*l-1)*Math.pow(2,i),a+=h):(o=e*Math.pow(2,h-1)*Math.pow(2,i),a=0));i>=8;t[r+f]=255&o,f+=p,o/=256,i-=8);for(a=a<<i|o,c+=i;c>0;t[r+f]=255&a,f+=p,a/=256,c-=8);t[r+f-p]|=128*g}),hi),r="function"==typeof Symbol&&"function"==typeof Symbol.for?Symbol.for("nodejs.util.inspect.custom"):null;fi.Buffer=s,fi.SlowBuffer=function(t){return+t!=t&&(t=0),s.alloc(+t)},fi.INSPECT_MAX_BYTES=50;let n=2147483647;function i(t){if(t>n)throw new RangeError('The value "'+t+'" is invalid for option "size"');let e=new Uint8Array(t);return Object.setPrototypeOf(e,s.prototype),e}function s(t,e,r){if("number"==typeof t){if("string"==typeof e)throw new TypeError('The "string" argument must be of type string. Received type number');return l(t)}return a(t,e,r)}function a(t,e,r){if("string"==typeof t)return function(t,e){if(("string"!=typeof e||""===e)&&(e="utf8"),!s.isEncoding(e))throw new TypeError("Unknown encoding: "+e);let r=0|d(t,e),n=i(r),a=n.write(t,e);return a!==r&&(n=n.slice(0,a)),n}(t,e);if(ArrayBuffer.isView(t))return function(t){if(K(t,Uint8Array)){let e=new Uint8Array(t);return u(e.buffer,e.byteOffset,e.byteLength)}return c(t)}(t);if(null==t)throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof t);if(K(t,ArrayBuffer)||t&&K(t.buffer,ArrayBuffer)||typeof SharedArrayBuffer<"u"&&(K(t,SharedArrayBuffer)||t&&K(t.buffer,SharedArrayBuffer)))return u(t,e,r);if("number"==typeof t)throw new TypeError('The "value" argument must not be of type number. Received type number');let n=t.valueOf&&t.valueOf();if(null!=n&&n!==t)return s.from(n,e,r);let a=function(t){if(s.isBuffer(t)){let e=0|h(t.length),r=i(e);return 0===r.length||t.copy(r,0,0,e),r}if(void 0!==t.length)return"number"!=typeof t.length||q(t.length)?i(0):c(t);if("Buffer"===t.type&&Array.isArray(t.data))return c(t.data)}(t);if(a)return a;if(typeof Symbol<"u"&&null!=Symbol.toPrimitive&&"function"==typeof t[Symbol.toPrimitive])return s.from(t[Symbol.toPrimitive]("string"),e,r);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof t)}function o(t){if("number"!=typeof t)throw new TypeError('"size" argument must be of type number');if(t<0)throw new RangeError('The value "'+t+'" is invalid for option "size"')}function l(t){return o(t),i(t<0?0:0|h(t))}function c(t){let e=t.length<0?0:0|h(t.length),r=i(e);for(let n=0;n<e;n+=1)r[n]=255&t[n];return r}function u(t,e,r){if(e<0||t.byteLength<e)throw new RangeError('"offset" is outside of buffer bounds');if(t.byteLength<e+(r||0))throw new RangeError('"length" is outside of buffer bounds');let n;return n=void 0===e&&void 0===r?new Uint8Array(t):void 0===r?new Uint8Array(t,e):new Uint8Array(t,e,r),Object.setPrototypeOf(n,s.prototype),n}function h(t){if(t>=n)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+n.toString(16)+" bytes");return 0|t}function d(t,e){if(s.isBuffer(t))return t.length;if(ArrayBuffer.isView(t)||K(t,ArrayBuffer))return t.byteLength;if("string"!=typeof t)throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof t);let r=t.length,n=arguments.length>2&&!0===arguments[2];if(!n&&0===r)return 0;let i=!1;for(;;)switch(e){case"ascii":case"latin1":case"binary":return r;case"utf8":case"utf-8":return G(t).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*r;case"hex":return r>>>1;case"base64":return V(t).length;default:if(i)return n?-1:G(t).length;e=(""+e).toLowerCase(),i=!0}}function f(t,e,r){let n=!1;if((void 0===e||e<0)&&(e=0),e>this.length||((void 0===r||r>this.length)&&(r=this.length),r<=0)||(r>>>=0)<=(e>>>=0))return"";for(t||(t="utf8");;)switch(t){case"hex":return x(this,e,r);case"utf8":case"utf-8":return S(this,e,r);case"ascii":return k(this,e,r);case"latin1":case"binary":return A(this,e,r);case"base64":return E(this,e,r);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return I(this,e,r);default:if(n)throw new TypeError("Unknown encoding: "+t);t=(t+"").toLowerCase(),n=!0}}function p(t,e,r){let n=t[e];t[e]=t[r],t[r]=n}function g(t,e,r,n,i){if(0===t.length)return-1;if("string"==typeof r?(n=r,r=0):r>2147483647?r=2147483647:r<-2147483648&&(r=-2147483648),q(r=+r)&&(r=i?0:t.length-1),r<0&&(r=t.length+r),r>=t.length){if(i)return-1;r=t.length-1}else if(r<0){if(!i)return-1;r=0}if("string"==typeof e&&(e=s.from(e,n)),s.isBuffer(e))return 0===e.length?-1:m(t,e,r,n,i);if("number"==typeof e)return e&=255,"function"==typeof Uint8Array.prototype.indexOf?i?Uint8Array.prototype.indexOf.call(t,e,r):Uint8Array.prototype.lastIndexOf.call(t,e,r):m(t,[e],r,n,i);throw new TypeError("val must be string, number or Buffer")}function m(t,e,r,n,i){let s,a=1,o=t.length,l=e.length;if(void 0!==n&&("ucs2"===(n=String(n).toLowerCase())||"ucs-2"===n||"utf16le"===n||"utf-16le"===n)){if(t.length<2||e.length<2)return-1;a=2,o/=2,l/=2,r/=2}function c(t,e){return 1===a?t[e]:t.readUInt16BE(e*a)}if(i){let n=-1;for(s=r;s<o;s++)if(c(t,s)===c(e,-1===n?0:s-n)){if(-1===n&&(n=s),s-n+1===l)return n*a}else-1!==n&&(s-=s-n),n=-1}else for(r+l>o&&(r=o-l),s=r;s>=0;s--){let r=!0;for(let n=0;n<l;n++)if(c(t,s+n)!==c(e,n)){r=!1;break}if(r)return s}return-1}function y(t,e,r,n){r=Number(r)||0;let i=t.length-r;n?(n=Number(n))>i&&(n=i):n=i;let s,a=e.length;for(n>a/2&&(n=a/2),s=0;s<n;++s){let n=parseInt(e.substr(2*s,2),16);if(q(n))return s;t[r+s]=n}return s}function v(t,e,r,n){return H(G(e,t.length-r),t,r,n)}function b(t,e,r,n){return H(function(t){let e=[];for(let r=0;r<t.length;++r)e.push(255&t.charCodeAt(r));return e}(e),t,r,n)}function _(t,e,r,n){return H(V(e),t,r,n)}function w(t,e,r,n){return H(function(t,e){let r,n,i,s=[];for(let a=0;a<t.length&&!((e-=2)<0);++a)r=t.charCodeAt(a),n=r>>8,i=r%256,s.push(i),s.push(n);return s}(e,t.length-r),t,r,n)}function E(e,r,n){return 0===r&&n===e.length?t.fromByteArray(e):t.fromByteArray(e.slice(r,n))}function S(t,e,r){r=Math.min(t.length,r);let n=[],i=e;for(;i<r;){let e=t[i],s=null,a=e>239?4:e>223?3:e>191?2:1;if(i+a<=r){let r,n,o,l;switch(a){case 1:e<128&&(s=e);break;case 2:r=t[i+1],128===(192&r)&&(l=(31&e)<<6|63&r,l>127&&(s=l));break;case 3:r=t[i+1],n=t[i+2],128===(192&r)&&128===(192&n)&&(l=(15&e)<<12|(63&r)<<6|63&n,l>2047&&(l<55296||l>57343)&&(s=l));break;case 4:r=t[i+1],n=t[i+2],o=t[i+3],128===(192&r)&&128===(192&n)&&128===(192&o)&&(l=(15&e)<<18|(63&r)<<12|(63&n)<<6|63&o,l>65535&&l<1114112&&(s=l))}}null===s?(s=65533,a=1):s>65535&&(s-=65536,n.push(s>>>10&1023|55296),s=56320|1023&s),n.push(s),i+=a}return function(t){let e=t.length;if(e<=T)return String.fromCharCode.apply(String,t);let r="",n=0;for(;n<e;)r+=String.fromCharCode.apply(String,t.slice(n,n+=T));return r}(n)}fi.kMaxLength=n,s.TYPED_ARRAY_SUPPORT=function(){try{let t=new Uint8Array(1),e={foo:function(){return 42}};return Object.setPrototypeOf(e,Uint8Array.prototype),Object.setPrototypeOf(t,e),42===t.foo()}catch(t){return!1}}(),!s.TYPED_ARRAY_SUPPORT&&typeof console<"u"&&"function"==typeof console.error&&console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support."),Object.defineProperty(s.prototype,"parent",{enumerable:!0,get:function(){if(s.isBuffer(this))return this.buffer}}),Object.defineProperty(s.prototype,"offset",{enumerable:!0,get:function(){if(s.isBuffer(this))return this.byteOffset}}),s.poolSize=8192,s.from=function(t,e,r){return a(t,e,r)},Object.setPrototypeOf(s.prototype,Uint8Array.prototype),Object.setPrototypeOf(s,Uint8Array),s.alloc=function(t,e,r){return function(t,e,r){return o(t),t<=0?i(t):void 0!==e?"string"==typeof r?i(t).fill(e,r):i(t).fill(e):i(t)}(t,e,r)},s.allocUnsafe=function(t){return l(t)},s.allocUnsafeSlow=function(t){return l(t)},s.isBuffer=function(t){return null!=t&&!0===t._isBuffer&&t!==s.prototype},s.compare=function(t,e){if(K(t,Uint8Array)&&(t=s.from(t,t.offset,t.byteLength)),K(e,Uint8Array)&&(e=s.from(e,e.offset,e.byteLength)),!s.isBuffer(t)||!s.isBuffer(e))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(t===e)return 0;let r=t.length,n=e.length;for(let i=0,s=Math.min(r,n);i<s;++i)if(t[i]!==e[i]){r=t[i],n=e[i];break}return r<n?-1:n<r?1:0},s.isEncoding=function(t){switch(String(t).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},s.concat=function(t,e){if(!Array.isArray(t))throw new TypeError('"list" argument must be an Array of Buffers');if(0===t.length)return s.alloc(0);let r;if(void 0===e)for(e=0,r=0;r<t.length;++r)e+=t[r].length;let n=s.allocUnsafe(e),i=0;for(r=0;r<t.length;++r){let e=t[r];if(K(e,Uint8Array))i+e.length>n.length?(s.isBuffer(e)||(e=s.from(e)),e.copy(n,i)):Uint8Array.prototype.set.call(n,e,i);else{if(!s.isBuffer(e))throw new TypeError('"list" argument must be an Array of Buffers');e.copy(n,i)}i+=e.length}return n},s.byteLength=d,s.prototype._isBuffer=!0,s.prototype.swap16=function(){let t=this.length;if(t%2!==0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(let e=0;e<t;e+=2)p(this,e,e+1);return this},s.prototype.swap32=function(){let t=this.length;if(t%4!==0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(let e=0;e<t;e+=4)p(this,e,e+3),p(this,e+1,e+2);return this},s.prototype.swap64=function(){let t=this.length;if(t%8!==0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(let e=0;e<t;e+=8)p(this,e,e+7),p(this,e+1,e+6),p(this,e+2,e+5),p(this,e+3,e+4);return this},s.prototype.toString=function(){let t=this.length;return 0===t?"":0===arguments.length?S(this,0,t):f.apply(this,arguments)},s.prototype.toLocaleString=s.prototype.toString,s.prototype.equals=function(t){if(!s.isBuffer(t))throw new TypeError("Argument must be a Buffer");return this===t||0===s.compare(this,t)},s.prototype.inspect=function(){let t="",e=fi.INSPECT_MAX_BYTES;return t=this.toString("hex",0,e).replace(/(.{2})/g,"$1 ").trim(),this.length>e&&(t+=" ... "),"<Buffer "+t+">"},r&&(s.prototype[r]=s.prototype.inspect),s.prototype.compare=function(t,e,r,n,i){if(K(t,Uint8Array)&&(t=s.from(t,t.offset,t.byteLength)),!s.isBuffer(t))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof t);if(void 0===e&&(e=0),void 0===r&&(r=t?t.length:0),void 0===n&&(n=0),void 0===i&&(i=this.length),e<0||r>t.length||n<0||i>this.length)throw new RangeError("out of range index");if(n>=i&&e>=r)return 0;if(n>=i)return-1;if(e>=r)return 1;if(this===t)return 0;let a=(i>>>=0)-(n>>>=0),o=(r>>>=0)-(e>>>=0),l=Math.min(a,o),c=this.slice(n,i),u=t.slice(e,r);for(let s=0;s<l;++s)if(c[s]!==u[s]){a=c[s],o=u[s];break}return a<o?-1:o<a?1:0},s.prototype.includes=function(t,e,r){return-1!==this.indexOf(t,e,r)},s.prototype.indexOf=function(t,e,r){return g(this,t,e,r,!0)},s.prototype.lastIndexOf=function(t,e,r){return g(this,t,e,r,!1)},s.prototype.write=function(t,e,r,n){if(void 0===e)n="utf8",r=this.length,e=0;else if(void 0===r&&"string"==typeof e)n=e,r=this.length,e=0;else{if(!isFinite(e))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");e>>>=0,isFinite(r)?(r>>>=0,void 0===n&&(n="utf8")):(n=r,r=void 0)}let i=this.length-e;if((void 0===r||r>i)&&(r=i),t.length>0&&(r<0||e<0)||e>this.length)throw new RangeError("Attempt to write outside buffer bounds");n||(n="utf8");let s=!1;for(;;)switch(n){case"hex":return y(this,t,e,r);case"utf8":case"utf-8":return v(this,t,e,r);case"ascii":case"latin1":case"binary":return b(this,t,e,r);case"base64":return _(this,t,e,r);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return w(this,t,e,r);default:if(s)throw new TypeError("Unknown encoding: "+n);n=(""+n).toLowerCase(),s=!0}},s.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};let T=4096;function k(t,e,r){let n="";r=Math.min(t.length,r);for(let i=e;i<r;++i)n+=String.fromCharCode(127&t[i]);return n}function A(t,e,r){let n="";r=Math.min(t.length,r);for(let i=e;i<r;++i)n+=String.fromCharCode(t[i]);return n}function x(t,e,r){let n=t.length;(!e||e<0)&&(e=0),(!r||r<0||r>n)&&(r=n);let i="";for(let s=e;s<r;++s)i+=Y[t[s]];return i}function I(t,e,r){let n=t.slice(e,r),i="";for(let s=0;s<n.length-1;s+=2)i+=String.fromCharCode(n[s]+256*n[s+1]);return i}function R(t,e,r){if(t%1!==0||t<0)throw new RangeError("offset is not uint");if(t+e>r)throw new RangeError("Trying to access beyond buffer length")}function L(t,e,r,n,i,a){if(!s.isBuffer(t))throw new TypeError('"buffer" argument must be a Buffer instance');if(e>i||e<a)throw new RangeError('"value" argument is out of bounds');if(r+n>t.length)throw new RangeError("Index out of range")}function P(t,e,r,n,i){B(e,n,i,t,r,7);let s=Number(e&BigInt(4294967295));t[r++]=s,s>>=8,t[r++]=s,s>>=8,t[r++]=s,s>>=8,t[r++]=s;let a=Number(e>>BigInt(32)&BigInt(4294967295));return t[r++]=a,a>>=8,t[r++]=a,a>>=8,t[r++]=a,a>>=8,t[r++]=a,r}function C(t,e,r,n,i){B(e,n,i,t,r,7);let s=Number(e&BigInt(4294967295));t[r+7]=s,s>>=8,t[r+6]=s,s>>=8,t[r+5]=s,s>>=8,t[r+4]=s;let a=Number(e>>BigInt(32)&BigInt(4294967295));return t[r+3]=a,a>>=8,t[r+2]=a,a>>=8,t[r+1]=a,a>>=8,t[r]=a,r+8}function M(t,e,r,n,i,s){if(r+n>t.length)throw new RangeError("Index out of range");if(r<0)throw new RangeError("Index out of range")}function O(t,r,n,i,s){return r=+r,n>>>=0,s||M(t,0,n,4),e.write(t,r,n,i,23,4),n+4}function D(t,r,n,i,s){return r=+r,n>>>=0,s||M(t,0,n,8),e.write(t,r,n,i,52,8),n+8}s.prototype.slice=function(t,e){let r=this.length;(t=~~t)<0?(t+=r)<0&&(t=0):t>r&&(t=r),(e=void 0===e?r:~~e)<0?(e+=r)<0&&(e=0):e>r&&(e=r),e<t&&(e=t);let n=this.subarray(t,e);return Object.setPrototypeOf(n,s.prototype),n},s.prototype.readUintLE=s.prototype.readUIntLE=function(t,e,r){t>>>=0,e>>>=0,r||R(t,e,this.length);let n=this[t],i=1,s=0;for(;++s<e&&(i*=256);)n+=this[t+s]*i;return n},s.prototype.readUintBE=s.prototype.readUIntBE=function(t,e,r){t>>>=0,e>>>=0,r||R(t,e,this.length);let n=this[t+--e],i=1;for(;e>0&&(i*=256);)n+=this[t+--e]*i;return n},s.prototype.readUint8=s.prototype.readUInt8=function(t,e){return t>>>=0,e||R(t,1,this.length),this[t]},s.prototype.readUint16LE=s.prototype.readUInt16LE=function(t,e){return t>>>=0,e||R(t,2,this.length),this[t]|this[t+1]<<8},s.prototype.readUint16BE=s.prototype.readUInt16BE=function(t,e){return t>>>=0,e||R(t,2,this.length),this[t]<<8|this[t+1]},s.prototype.readUint32LE=s.prototype.readUInt32LE=function(t,e){return t>>>=0,e||R(t,4,this.length),(this[t]|this[t+1]<<8|this[t+2]<<16)+16777216*this[t+3]},s.prototype.readUint32BE=s.prototype.readUInt32BE=function(t,e){return t>>>=0,e||R(t,4,this.length),16777216*this[t]+(this[t+1]<<16|this[t+2]<<8|this[t+3])},s.prototype.readBigUInt64LE=Q(function(t){j(t>>>=0,"offset");let e=this[t],r=this[t+7];(void 0===e||void 0===r)&&z(t,this.length-8);let n=e+256*this[++t]+65536*this[++t]+this[++t]*2**24,i=this[++t]+256*this[++t]+65536*this[++t]+r*2**24;return BigInt(n)+(BigInt(i)<<BigInt(32))}),s.prototype.readBigUInt64BE=Q(function(t){j(t>>>=0,"offset");let e=this[t],r=this[t+7];(void 0===e||void 0===r)&&z(t,this.length-8);let n=e*2**24+65536*this[++t]+256*this[++t]+this[++t],i=this[++t]*2**24+65536*this[++t]+256*this[++t]+r;return(BigInt(n)<<BigInt(32))+BigInt(i)}),s.prototype.readIntLE=function(t,e,r){t>>>=0,e>>>=0,r||R(t,e,this.length);let n=this[t],i=1,s=0;for(;++s<e&&(i*=256);)n+=this[t+s]*i;return i*=128,n>=i&&(n-=Math.pow(2,8*e)),n},s.prototype.readIntBE=function(t,e,r){t>>>=0,e>>>=0,r||R(t,e,this.length);let n=e,i=1,s=this[t+--n];for(;n>0&&(i*=256);)s+=this[t+--n]*i;return i*=128,s>=i&&(s-=Math.pow(2,8*e)),s},s.prototype.readInt8=function(t,e){return t>>>=0,e||R(t,1,this.length),128&this[t]?-1*(255-this[t]+1):this[t]},s.prototype.readInt16LE=function(t,e){t>>>=0,e||R(t,2,this.length);let r=this[t]|this[t+1]<<8;return 32768&r?4294901760|r:r},s.prototype.readInt16BE=function(t,e){t>>>=0,e||R(t,2,this.length);let r=this[t+1]|this[t]<<8;return 32768&r?4294901760|r:r},s.prototype.readInt32LE=function(t,e){return t>>>=0,e||R(t,4,this.length),this[t]|this[t+1]<<8|this[t+2]<<16|this[t+3]<<24},s.prototype.readInt32BE=function(t,e){return t>>>=0,e||R(t,4,this.length),this[t]<<24|this[t+1]<<16|this[t+2]<<8|this[t+3]},s.prototype.readBigInt64LE=Q(function(t){j(t>>>=0,"offset");let e=this[t],r=this[t+7];(void 0===e||void 0===r)&&z(t,this.length-8);let n=this[t+4]+256*this[t+5]+65536*this[t+6]+(r<<24);return(BigInt(n)<<BigInt(32))+BigInt(e+256*this[++t]+65536*this[++t]+this[++t]*2**24)}),s.prototype.readBigInt64BE=Q(function(t){j(t>>>=0,"offset");let e=this[t],r=this[t+7];(void 0===e||void 0===r)&&z(t,this.length-8);let n=(e<<24)+65536*this[++t]+256*this[++t]+this[++t];return(BigInt(n)<<BigInt(32))+BigInt(this[++t]*2**24+65536*this[++t]+256*this[++t]+r)}),s.prototype.readFloatLE=function(t,r){return t>>>=0,r||R(t,4,this.length),e.read(this,t,!0,23,4)},s.prototype.readFloatBE=function(t,r){return t>>>=0,r||R(t,4,this.length),e.read(this,t,!1,23,4)},s.prototype.readDoubleLE=function(t,r){return t>>>=0,r||R(t,8,this.length),e.read(this,t,!0,52,8)},s.prototype.readDoubleBE=function(t,r){return t>>>=0,r||R(t,8,this.length),e.read(this,t,!1,52,8)},s.prototype.writeUintLE=s.prototype.writeUIntLE=function(t,e,r,n){if(t=+t,e>>>=0,r>>>=0,!n){L(this,t,e,r,Math.pow(2,8*r)-1,0)}let i=1,s=0;for(this[e]=255&t;++s<r&&(i*=256);)this[e+s]=t/i&255;return e+r},s.prototype.writeUintBE=s.prototype.writeUIntBE=function(t,e,r,n){if(t=+t,e>>>=0,r>>>=0,!n){L(this,t,e,r,Math.pow(2,8*r)-1,0)}let i=r-1,s=1;for(this[e+i]=255&t;--i>=0&&(s*=256);)this[e+i]=t/s&255;return e+r},s.prototype.writeUint8=s.prototype.writeUInt8=function(t,e,r){return t=+t,e>>>=0,r||L(this,t,e,1,255,0),this[e]=255&t,e+1},s.prototype.writeUint16LE=s.prototype.writeUInt16LE=function(t,e,r){return t=+t,e>>>=0,r||L(this,t,e,2,65535,0),this[e]=255&t,this[e+1]=t>>>8,e+2},s.prototype.writeUint16BE=s.prototype.writeUInt16BE=function(t,e,r){return t=+t,e>>>=0,r||L(this,t,e,2,65535,0),this[e]=t>>>8,this[e+1]=255&t,e+2},s.prototype.writeUint32LE=s.prototype.writeUInt32LE=function(t,e,r){return t=+t,e>>>=0,r||L(this,t,e,4,4294967295,0),this[e+3]=t>>>24,this[e+2]=t>>>16,this[e+1]=t>>>8,this[e]=255&t,e+4},s.prototype.writeUint32BE=s.prototype.writeUInt32BE=function(t,e,r){return t=+t,e>>>=0,r||L(this,t,e,4,4294967295,0),this[e]=t>>>24,this[e+1]=t>>>16,this[e+2]=t>>>8,this[e+3]=255&t,e+4},s.prototype.writeBigUInt64LE=Q(function(t){return P(this,t,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,BigInt(0),BigInt("0xffffffffffffffff"))}),s.prototype.writeBigUInt64BE=Q(function(t){return C(this,t,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,BigInt(0),BigInt("0xffffffffffffffff"))}),s.prototype.writeIntLE=function(t,e,r,n){if(t=+t,e>>>=0,!n){let n=Math.pow(2,8*r-1);L(this,t,e,r,n-1,-n)}let i=0,s=1,a=0;for(this[e]=255&t;++i<r&&(s*=256);)t<0&&0===a&&0!==this[e+i-1]&&(a=1),this[e+i]=(t/s|0)-a&255;return e+r},s.prototype.writeIntBE=function(t,e,r,n){if(t=+t,e>>>=0,!n){let n=Math.pow(2,8*r-1);L(this,t,e,r,n-1,-n)}let i=r-1,s=1,a=0;for(this[e+i]=255&t;--i>=0&&(s*=256);)t<0&&0===a&&0!==this[e+i+1]&&(a=1),this[e+i]=(t/s|0)-a&255;return e+r},s.prototype.writeInt8=function(t,e,r){return t=+t,e>>>=0,r||L(this,t,e,1,127,-128),t<0&&(t=255+t+1),this[e]=255&t,e+1},s.prototype.writeInt16LE=function(t,e,r){return t=+t,e>>>=0,r||L(this,t,e,2,32767,-32768),this[e]=255&t,this[e+1]=t>>>8,e+2},s.prototype.writeInt16BE=function(t,e,r){return t=+t,e>>>=0,r||L(this,t,e,2,32767,-32768),this[e]=t>>>8,this[e+1]=255&t,e+2},s.prototype.writeInt32LE=function(t,e,r){return t=+t,e>>>=0,r||L(this,t,e,4,2147483647,-2147483648),this[e]=255&t,this[e+1]=t>>>8,this[e+2]=t>>>16,this[e+3]=t>>>24,e+4},s.prototype.writeInt32BE=function(t,e,r){return t=+t,e>>>=0,r||L(this,t,e,4,2147483647,-2147483648),t<0&&(t=4294967295+t+1),this[e]=t>>>24,this[e+1]=t>>>16,this[e+2]=t>>>8,this[e+3]=255&t,e+4},s.prototype.writeBigInt64LE=Q(function(t){return P(this,t,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))}),s.prototype.writeBigInt64BE=Q(function(t){return C(this,t,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))}),s.prototype.writeFloatLE=function(t,e,r){return O(this,t,e,!0,r)},s.prototype.writeFloatBE=function(t,e,r){return O(this,t,e,!1,r)},s.prototype.writeDoubleLE=function(t,e,r){return D(this,t,e,!0,r)},s.prototype.writeDoubleBE=function(t,e,r){return D(this,t,e,!1,r)},s.prototype.copy=function(t,e,r,n){if(!s.isBuffer(t))throw new TypeError("argument should be a Buffer");if(r||(r=0),!n&&0!==n&&(n=this.length),e>=t.length&&(e=t.length),e||(e=0),n>0&&n<r&&(n=r),n===r||0===t.length||0===this.length)return 0;if(e<0)throw new RangeError("targetStart out of bounds");if(r<0||r>=this.length)throw new RangeError("Index out of range");if(n<0)throw new RangeError("sourceEnd out of bounds");n>this.length&&(n=this.length),t.length-e<n-r&&(n=t.length-e+r);let i=n-r;return this===t&&"function"==typeof Uint8Array.prototype.copyWithin?this.copyWithin(e,r,n):Uint8Array.prototype.set.call(t,this.subarray(r,n),e),i},s.prototype.fill=function(t,e,r,n){if("string"==typeof t){if("string"==typeof e?(n=e,e=0,r=this.length):"string"==typeof r&&(n=r,r=this.length),void 0!==n&&"string"!=typeof n)throw new TypeError("encoding must be a string");if("string"==typeof n&&!s.isEncoding(n))throw new TypeError("Unknown encoding: "+n);if(1===t.length){let e=t.charCodeAt(0);("utf8"===n&&e<128||"latin1"===n)&&(t=e)}}else"number"==typeof t?t&=255:"boolean"==typeof t&&(t=Number(t));if(e<0||this.length<e||this.length<r)throw new RangeError("Out of range index");if(r<=e)return this;let i;if(e>>>=0,r=void 0===r?this.length:r>>>0,t||(t=0),"number"==typeof t)for(i=e;i<r;++i)this[i]=t;else{let a=s.isBuffer(t)?t:s.from(t,n),o=a.length;if(0===o)throw new TypeError('The value "'+t+'" is invalid for argument "value"');for(i=0;i<r-e;++i)this[i+e]=a[i%o]}return this};let N={};function F(t,e,r){N[t]=class extends r{constructor(){super(),Object.defineProperty(this,"message",{value:e.apply(this,arguments),writable:!0,configurable:!0}),this.name="".concat(this.name," [").concat(t,"]"),this.stack,delete this.name}get code(){return t}set code(t){Object.defineProperty(this,"code",{configurable:!0,enumerable:!0,value:t,writable:!0})}toString(){return"".concat(this.name," [").concat(t,"]: ").concat(this.message)}}}function U(t){let e="",r=t.length,n="-"===t[0]?1:0;for(;r>=n+4;r-=3)e="_".concat(t.slice(r-3,r)).concat(e);return"".concat(t.slice(0,r)).concat(e)}function B(t,e,r,n,i,s){if(t>r||t<e){let r,n="bigint"==typeof e?"n":"";throw r=0===e||e===BigInt(0)?">= 0".concat(n," and < 2").concat(n," ** ").concat(8*(s+1)).concat(n):">= -(2".concat(n," ** ").concat(8*(s+1)-1).concat(n,") and < 2 ** ").concat(8*(s+1)-1).concat(n),new N.ERR_OUT_OF_RANGE("value",r,t)}!function(t,e,r){j(e,"offset"),(void 0===t[e]||void 0===t[e+r])&&z(e,t.length-(r+1))}(n,i,s)}function j(t,e){if("number"!=typeof t)throw new N.ERR_INVALID_ARG_TYPE(e,"number",t)}function z(t,e,r){throw Math.floor(t)!==t?(j(t,r),new N.ERR_OUT_OF_RANGE("offset","an integer",t)):e<0?new N.ERR_BUFFER_OUT_OF_BOUNDS:new N.ERR_OUT_OF_RANGE("offset",">= 0 and <= ".concat(e),t)}F("ERR_BUFFER_OUT_OF_BOUNDS",function(t){return t?"".concat(t," is outside of buffer bounds"):"Attempt to access memory outside buffer bounds"},RangeError),F("ERR_INVALID_ARG_TYPE",function(t,e){return'The "'.concat(t,'" argument must be of type number. Received type ').concat(typeof e)},TypeError),F("ERR_OUT_OF_RANGE",function(t,e,r){let n='The value of "'.concat(t,'" is out of range.'),i=r;return Number.isInteger(r)&&Math.abs(r)>2**32?i=U(String(r)):"bigint"==typeof r&&(i=String(r),(r>BigInt(2)**BigInt(32)||r<-(BigInt(2)**BigInt(32)))&&(i=U(i)),i+="n"),n+=" It must be ".concat(e,". Received ").concat(i),n},RangeError);let W=/[^+/0-9A-Za-z-_]/g;function G(t,e){e=e||1/0;let r,n=t.length,i=null,s=[];for(let a=0;a<n;++a){if(r=t.charCodeAt(a),r>55295&&r<57344){if(!i){if(r>56319){(e-=3)>-1&&s.push(239,191,189);continue}if(a+1===n){(e-=3)>-1&&s.push(239,191,189);continue}i=r;continue}if(r<56320){(e-=3)>-1&&s.push(239,191,189),i=r;continue}r=65536+(i-55296<<10|r-56320)}else i&&(e-=3)>-1&&s.push(239,191,189);if(i=null,r<128){if((e-=1)<0)break;s.push(r)}else if(r<2048){if((e-=2)<0)break;s.push(r>>6|192,63&r|128)}else if(r<65536){if((e-=3)<0)break;s.push(r>>12|224,r>>6&63|128,63&r|128)}else{if(!(r<1114112))throw new Error("Invalid code point");if((e-=4)<0)break;s.push(r>>18|240,r>>12&63|128,r>>6&63|128,63&r|128)}}return s}function V(e){return t.toByteArray(function(t){if((t=(t=t.split("=")[0]).trim().replace(W,"")).length<2)return"";for(;t.length%4!==0;)t+="=";return t}(e))}function H(t,e,r,n){let i;for(i=0;i<n&&!(i+r>=e.length||i>=t.length);++i)e[i+r]=t[i];return i}function K(t,e){return t instanceof e||null!=t&&null!=t.constructor&&null!=t.constructor.name&&t.constructor.name===e.name}function q(t){return t!==t}let Y=function(){let t="0123456789abcdef",e=new Array(256);for(let r=0;r<16;++r){let n=16*r;for(let i=0;i<16;++i)e[n+i]=t[r]+t[i]}return e}();function Q(t){return typeof BigInt>"u"?X:t}function X(){throw new Error("BigInt not supported")}return fi}var ci,ui,hi,di,fi,pi,gi=Tr(()=>{Ir(),Ei(),oi(),ci={},ui=!1,hi={},di=!1,fi={},pi=!1}),mi={};Ar(mi,{Buffer:()=>vi,INSPECT_MAX_BYTES:()=>bi,default:()=>yi,kMaxLength:()=>_i});var yi,vi,bi,_i,wi=Tr(()=>{Ir(),Ei(),oi(),gi(),(yi=li()).Buffer,yi.SlowBuffer,yi.INSPECT_MAX_BYTES,yi.kMaxLength,vi=yi.Buffer,bi=yi.INSPECT_MAX_BYTES,_i=yi.kMaxLength}),Ei=Tr(()=>{wi()}),Si=kr((t,e)=>{Ir(),Ei(),oi();var r=class extends Error{constructor(t){if(!Array.isArray(t))throw new TypeError("Expected input to be an Array, got ".concat(typeof t));let e="";for(let r=0;r<t.length;r++)e+="    ".concat(t[r].stack,"\n");super(e),this.name="AggregateError",this.errors=t}};e.exports={AggregateError:r,ArrayIsArray:t=>Array.isArray(t),ArrayPrototypeIncludes:(t,e)=>t.includes(e),ArrayPrototypeIndexOf:(t,e)=>t.indexOf(e),ArrayPrototypeJoin:(t,e)=>t.join(e),ArrayPrototypeMap:(t,e)=>t.map(e),ArrayPrototypePop:(t,e)=>t.pop(e),ArrayPrototypePush:(t,e)=>t.push(e),ArrayPrototypeSlice:(t,e,r)=>t.slice(e,r),Error:Error,FunctionPrototypeCall(t,e){for(var r=arguments.length,n=new Array(r>2?r-2:0),i=2;i<r;i++)n[i-2]=arguments[i];return t.call(e,...n)},FunctionPrototypeSymbolHasInstance:(t,e)=>Function.prototype[Symbol.hasInstance].call(t,e),MathFloor:Math.floor,Number:Number,NumberIsInteger:Number.isInteger,NumberIsNaN:Number.isNaN,NumberMAX_SAFE_INTEGER:Number.MAX_SAFE_INTEGER,NumberMIN_SAFE_INTEGER:Number.MIN_SAFE_INTEGER,NumberParseInt:Number.parseInt,ObjectDefineProperties:(t,e)=>Object.defineProperties(t,e),ObjectDefineProperty:(t,e,r)=>Object.defineProperty(t,e,r),ObjectGetOwnPropertyDescriptor:(t,e)=>Object.getOwnPropertyDescriptor(t,e),ObjectKeys:t=>Object.keys(t),ObjectSetPrototypeOf:(t,e)=>Object.setPrototypeOf(t,e),Promise:Promise,PromisePrototypeCatch:(t,e)=>t.catch(e),PromisePrototypeThen:(t,e,r)=>t.then(e,r),PromiseReject:t=>Promise.reject(t),PromiseResolve:t=>Promise.resolve(t),ReflectApply:Reflect.apply,RegExpPrototypeTest:(t,e)=>t.test(e),SafeSet:Set,String:String,StringPrototypeSlice:(t,e,r)=>t.slice(e,r),StringPrototypeToLowerCase:t=>t.toLowerCase(),StringPrototypeToUpperCase:t=>t.toUpperCase(),StringPrototypeTrim:t=>t.trim(),Symbol:Symbol,SymbolFor:Symbol.for,SymbolAsyncIterator:Symbol.asyncIterator,SymbolHasInstance:Symbol.hasInstance,SymbolIterator:Symbol.iterator,SymbolDispose:Symbol.dispose||Symbol("Symbol.dispose"),SymbolAsyncDispose:Symbol.asyncDispose||Symbol("Symbol.asyncDispose"),TypedArrayPrototypeSet:(t,e,r)=>t.set(e,r),Boolean:Boolean,Uint8Array:Uint8Array}}),Ti=kr((t,e)=>{Ir(),Ei(),oi(),e.exports={format(t){for(var e=arguments.length,r=new Array(e>1?e-1:0),n=1;n<e;n++)r[n-1]=arguments[n];return t.replace(/%([sdifj])/g,function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];let[i,s]=e,a=r.shift();return"f"===s?a.toFixed(6):"j"===s?JSON.stringify(a):"s"===s&&"object"==typeof a?"".concat(a.constructor!==Object?a.constructor.name:""," {}").trim():a.toString()})},inspect(t){switch(typeof t){case"string":if(t.includes("'")){if(!t.includes('"'))return'"'.concat(t,'"');if(!t.includes("`")&&!t.includes("${"))return"`".concat(t,"`")}return"'".concat(t,"'");case"number":return isNaN(t)?"NaN":Object.is(t,-0)?String(t):t;case"bigint":return"".concat(String(t),"n");case"boolean":case"undefined":return String(t);case"object":return"{}"}}}}),ki=kr((t,e)=>{Ir(),Ei(),oi();var{format:r,inspect:n}=Ti(),{AggregateError:i}=Si(),s=globalThis.AggregateError||i,a=Symbol("kIsNodeError"),o=["string","function","number","object","Function","Object","boolean","bigint","symbol"],l=/^([A-Z][a-z0-9]*)+$/,c={};function u(t,e){if(!t)throw new c.ERR_INTERNAL_ASSERTION(e)}function h(t){let e="",r=t.length,n="-"===t[0]?1:0;for(;r>=n+4;r-=3)e="_".concat(t.slice(r-3,r)).concat(e);return"".concat(t.slice(0,r)).concat(e)}function d(t,e,n){n||(n=Error);class i extends n{constructor(){for(var n=arguments.length,i=new Array(n),s=0;s<n;s++)i[s]=arguments[s];super(function(t,e,n){if("function"==typeof e)return u(e.length<=n.length,"Code: ".concat(t,"; The provided arguments length (").concat(n.length,") does not match the required ones (").concat(e.length,").")),e(...n);let i=(e.match(/%[dfijoOs]/g)||[]).length;return u(i===n.length,"Code: ".concat(t,"; The provided arguments length (").concat(n.length,") does not match the required ones (").concat(i,").")),0===n.length?e:r(e,...n)}(t,e,i))}toString(){return"".concat(this.name," [").concat(t,"]: ").concat(this.message)}}Object.defineProperties(i.prototype,{name:{value:n.name,writable:!0,enumerable:!1,configurable:!0},toString:{value(){return"".concat(this.name," [").concat(t,"]: ").concat(this.message)},writable:!0,enumerable:!1,configurable:!0}}),i.prototype.code=t,i.prototype[a]=!0,c[t]=i}function f(t){let e="__node_internal_"+t.name;return Object.defineProperty(t,"name",{value:e}),t}var p=class extends Error{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"The operation was aborted",e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0;if(void 0!==e&&"object"!=typeof e)throw new c.ERR_INVALID_ARG_TYPE("options","Object",e);super(t,e),this.code="ABORT_ERR",this.name="AbortError"}};d("ERR_ASSERTION","%s",Error),d("ERR_INVALID_ARG_TYPE",(t,e,r)=>{u("string"==typeof t,"'name' must be a string"),Array.isArray(e)||(e=[e]);let i="The ";t.endsWith(" argument")?i+="".concat(t," "):i+='"'.concat(t,'" ').concat(t.includes(".")?"property":"argument"," "),i+="must be ";let s=[],a=[],c=[];for(let n of e)u("string"==typeof n,"All expected entries have to be of type string"),o.includes(n)?s.push(n.toLowerCase()):l.test(n)?a.push(n):(u("object"!==n,'The value "object" should be written as "Object"'),c.push(n));if(a.length>0){let t=s.indexOf("object");-1!==t&&(s.splice(s,t,1),a.push("Object"))}if(s.length>0){switch(s.length){case 1:i+="of type ".concat(s[0]);break;case 2:i+="one of type ".concat(s[0]," or ").concat(s[1]);break;default:{let t=s.pop();i+="one of type ".concat(s.join(", "),", or ").concat(t)}}(a.length>0||c.length>0)&&(i+=" or ")}if(a.length>0){switch(a.length){case 1:i+="an instance of ".concat(a[0]);break;case 2:i+="an instance of ".concat(a[0]," or ").concat(a[1]);break;default:{let t=a.pop();i+="an instance of ".concat(a.join(", "),", or ").concat(t)}}c.length>0&&(i+=" or ")}switch(c.length){case 0:break;case 1:c[0].toLowerCase()!==c[0]&&(i+="an "),i+="".concat(c[0]);break;case 2:i+="one of ".concat(c[0]," or ").concat(c[1]);break;default:{let t=c.pop();i+="one of ".concat(c.join(", "),", or ").concat(t)}}if(null==r)i+=". Received ".concat(r);else if("function"==typeof r&&r.name)i+=". Received function ".concat(r.name);else if("object"==typeof r){var h;if(null!==(h=r.constructor)&&void 0!==h&&h.name)i+=". Received an instance of ".concat(r.constructor.name);else{let t=n(r,{depth:-1});i+=". Received ".concat(t)}}else{let t=n(r,{colors:!1});t.length>25&&(t="".concat(t.slice(0,25),"...")),i+=". Received type ".concat(typeof r," (").concat(t,")")}return i},TypeError),d("ERR_INVALID_ARG_VALUE",function(t,e){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"is invalid",i=n(e);return i.length>128&&(i=i.slice(0,128)+"..."),"The ".concat(t.includes(".")?"property":"argument"," '").concat(t,"' ").concat(r,". Received ").concat(i)},TypeError),d("ERR_INVALID_RETURN_VALUE",(t,e,r)=>{var n;let i=null!=r&&null!==(n=r.constructor)&&void 0!==n&&n.name?"instance of ".concat(r.constructor.name):"type ".concat(typeof r);return"Expected ".concat(t,' to be returned from the "').concat(e,'" function but got ').concat(i,".")},TypeError),d("ERR_MISSING_ARGS",function(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];u(e.length>0,"At least one arg needs to be specified");let n,i=e.length;switch(e=(Array.isArray(e)?e:[e]).map(t=>'"'.concat(t,'"')).join(" or "),i){case 1:n+="The ".concat(e[0]," argument");break;case 2:n+="The ".concat(e[0]," and ").concat(e[1]," arguments");break;default:{let t=e.pop();n+="The ".concat(e.join(", "),", and ").concat(t," arguments")}}return"".concat(n," must be specified")},TypeError),d("ERR_OUT_OF_RANGE",(t,e,r)=>{let i;if(u(e,'Missing "range" argument'),Number.isInteger(r)&&Math.abs(r)>2**32)i=h(String(r));else if("bigint"==typeof r){i=String(r);let t=BigInt(2)**BigInt(32);(r>t||r<-t)&&(i=h(i)),i+="n"}else i=n(r);return'The value of "'.concat(t,'" is out of range. It must be ').concat(e,". Received ").concat(i)},RangeError),d("ERR_MULTIPLE_CALLBACK","Callback called multiple times",Error),d("ERR_METHOD_NOT_IMPLEMENTED","The %s method is not implemented",Error),d("ERR_STREAM_ALREADY_FINISHED","Cannot call %s after a stream was finished",Error),d("ERR_STREAM_CANNOT_PIPE","Cannot pipe, not readable",Error),d("ERR_STREAM_DESTROYED","Cannot call %s after a stream was destroyed",Error),d("ERR_STREAM_NULL_VALUES","May not write null values to stream",TypeError),d("ERR_STREAM_PREMATURE_CLOSE","Premature close",Error),d("ERR_STREAM_PUSH_AFTER_EOF","stream.push() after EOF",Error),d("ERR_STREAM_UNSHIFT_AFTER_END_EVENT","stream.unshift() after end event",Error),d("ERR_STREAM_WRITE_AFTER_END","write after end",Error),d("ERR_UNKNOWN_ENCODING","Unknown encoding: %s",TypeError),e.exports={AbortError:p,aggregateTwoErrors:f(function(t,e){if(t&&e&&t!==e){if(Array.isArray(e.errors))return e.errors.push(t),e;let r=new s([e,t],e.message);return r.code=e.code,r}return t||e}),hideStackFrames:f,codes:c}}),Ai=kr((t,e)=>{Ir(),Ei(),oi();var{AbortController:r,AbortSignal:n}=typeof self<"u"?self:typeof window<"u"?window:void 0;e.exports=r,e.exports.AbortSignal=n,e.exports.default=r}),xi={};function Ii(){if(Li)return Ri;Li=!0;var t,e="object"==typeof Reflect?Reflect:null,r=e&&"function"==typeof e.apply?e.apply:function(t,e,r){return Function.prototype.apply.call(t,e,r)};t=e&&"function"==typeof e.ownKeys?e.ownKeys:Object.getOwnPropertySymbols?function(t){return Object.getOwnPropertyNames(t).concat(Object.getOwnPropertySymbols(t))}:function(t){return Object.getOwnPropertyNames(t)};var n=Number.isNaN||function(t){return t!==t};function i(){i.init.call(this)}(Ri=i).once=function(t,e){return new Promise(function(r,n){function i(r){t.removeListener(e,s),n(r)}function s(){"function"==typeof t.removeListener&&t.removeListener("error",i),r([].slice.call(arguments))}p(t,e,s,{once:!0}),"error"!==e&&function(t,e,r){"function"==typeof t.on&&p(t,"error",e,r)}(t,i,{once:!0})})},i.EventEmitter=i,i.prototype._events=void 0,i.prototype._eventsCount=0,i.prototype._maxListeners=void 0;var s=10;function a(t){if("function"!=typeof t)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof t)}function o(t){return void 0===t._maxListeners?i.defaultMaxListeners:t._maxListeners}function l(t,e,r,n){var i,s,l;if(a(r),void 0===(s=t._events)?(s=t._events=Object.create(null),t._eventsCount=0):(void 0!==s.newListener&&(t.emit("newListener",e,r.listener?r.listener:r),s=t._events),l=s[e]),void 0===l)l=s[e]=r,++t._eventsCount;else if("function"==typeof l?l=s[e]=n?[r,l]:[l,r]:n?l.unshift(r):l.push(r),(i=o(t))>0&&l.length>i&&!l.warned){l.warned=!0;var c=new Error("Possible EventEmitter memory leak detected. "+l.length+" "+String(e)+" listeners added. Use emitter.setMaxListeners() to increase limit");c.name="MaxListenersExceededWarning",c.emitter=t,c.type=e,c.count=l.length,function(t){console&&console.warn&&console.warn(t)}(c)}return t}function c(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function u(t,e,r){var n={fired:!1,wrapFn:void 0,target:t,type:e,listener:r},i=c.bind(n);return i.listener=r,n.wrapFn=i,i}function h(t,e,r){var n=t._events;if(void 0===n)return[];var i=n[e];return void 0===i?[]:"function"==typeof i?r?[i.listener||i]:[i]:r?function(t){for(var e=new Array(t.length),r=0;r<e.length;++r)e[r]=t[r].listener||t[r];return e}(i):f(i,i.length)}function d(t){var e=this._events;if(void 0!==e){var r=e[t];if("function"==typeof r)return 1;if(void 0!==r)return r.length}return 0}function f(t,e){for(var r=new Array(e),n=0;n<e;++n)r[n]=t[n];return r}function p(t,e,r,n){if("function"==typeof t.on)n.once?t.once(e,r):t.on(e,r);else{if("function"!=typeof t.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof t);t.addEventListener(e,function i(s){n.once&&t.removeEventListener(e,i),r(s)})}}return Object.defineProperty(i,"defaultMaxListeners",{enumerable:!0,get:function(){return s},set:function(t){if("number"!=typeof t||t<0||n(t))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+t+".");s=t}}),i.init=function(){(void 0===this._events||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},i.prototype.setMaxListeners=function(t){if("number"!=typeof t||t<0||n(t))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+t+".");return this._maxListeners=t,this},i.prototype.getMaxListeners=function(){return o(this)},i.prototype.emit=function(t){for(var e=[],n=1;n<arguments.length;n++)e.push(arguments[n]);var i="error"===t,s=this._events;if(void 0!==s)i=i&&void 0===s.error;else if(!i)return!1;if(i){var a;if(e.length>0&&(a=e[0]),a instanceof Error)throw a;var o=new Error("Unhandled error."+(a?" ("+a.message+")":""));throw o.context=a,o}var l=s[t];if(void 0===l)return!1;if("function"==typeof l)r(l,this,e);else{var c=l.length,u=f(l,c);for(n=0;n<c;++n)r(u[n],this,e)}return!0},i.prototype.addListener=function(t,e){return l(this,t,e,!1)},i.prototype.on=i.prototype.addListener,i.prototype.prependListener=function(t,e){return l(this,t,e,!0)},i.prototype.once=function(t,e){return a(e),this.on(t,u(this,t,e)),this},i.prototype.prependOnceListener=function(t,e){return a(e),this.prependListener(t,u(this,t,e)),this},i.prototype.removeListener=function(t,e){var r,n,i,s,o;if(a(e),void 0===(n=this._events))return this;if(void 0===(r=n[t]))return this;if(r===e||r.listener===e)0===--this._eventsCount?this._events=Object.create(null):(delete n[t],n.removeListener&&this.emit("removeListener",t,r.listener||e));else if("function"!=typeof r){for(i=-1,s=r.length-1;s>=0;s--)if(r[s]===e||r[s].listener===e){o=r[s].listener,i=s;break}if(i<0)return this;0===i?r.shift():function(t,e){for(;e+1<t.length;e++)t[e]=t[e+1];t.pop()}(r,i),1===r.length&&(n[t]=r[0]),void 0!==n.removeListener&&this.emit("removeListener",t,o||e)}return this},i.prototype.off=i.prototype.removeListener,i.prototype.removeAllListeners=function(t){var e,r,n;if(void 0===(r=this._events))return this;if(void 0===r.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==r[t]&&(0===--this._eventsCount?this._events=Object.create(null):delete r[t]),this;if(0===arguments.length){var i,s=Object.keys(r);for(n=0;n<s.length;++n)"removeListener"!==(i=s[n])&&this.removeAllListeners(i);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(e=r[t]))this.removeListener(t,e);else if(void 0!==e)for(n=e.length-1;n>=0;n--)this.removeListener(t,e[n]);return this},i.prototype.listeners=function(t){return h(this,t,!0)},i.prototype.rawListeners=function(t){return h(this,t,!1)},i.listenerCount=function(t,e){return"function"==typeof t.listenerCount?t.listenerCount(e):d.call(t,e)},i.prototype.listenerCount=d,i.prototype.eventNames=function(){return this._eventsCount>0?t(this._events):[]},Ri}Ar(xi,{EventEmitter:()=>Ci,default:()=>Pi,defaultMaxListeners:()=>Mi,init:()=>Oi,listenerCount:()=>Di,on:()=>Ni,once:()=>Fi});var Ri,Li,Pi,Ci,Mi,Oi,Di,Ni,Fi,Ui=Tr(()=>{Ir(),Ei(),oi(),Ri={},Li=!1,(Pi=Ii()).once,Pi.once=function(t,e){return new Promise((r,n)=>{function i(){for(var e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];void 0!==s&&t.removeListener("error",s),r(n)}let s;"error"!==e&&(s=e=>{t.removeListener(name,i),n(e)},t.once("error",s)),t.once(e,i)})},Pi.on=function(t,e){let r=[],n=[],i=null,s=!1,a={async next(){let t=r.shift();if(t)return createIterResult(t,!1);if(i){let t=Promise.reject(i);return i=null,t}return s?createIterResult(void 0,!0):new Promise((t,e)=>n.push({resolve:t,reject:e}))},async return(){t.removeListener(e,o),t.removeListener("error",l),s=!0;for(let t of n)t.resolve(createIterResult(void 0,!0));return createIterResult(void 0,!0)},throw(r){i=r,t.removeListener(e,o),t.removeListener("error",l)},[Symbol.asyncIterator](){return this}};return t.on(e,o),t.on("error",l),a;function o(){let t=n.shift();for(var e=arguments.length,i=new Array(e),s=0;s<e;s++)i[s]=arguments[s];t?t.resolve(createIterResult(i,!1)):r.push(i)}function l(t){s=!0;let e=n.shift();e?e.reject(t):i=t,a.return()}},({EventEmitter:Ci,defaultMaxListeners:Mi,init:Oi,listenerCount:Di,on:Ni,once:Fi}=Pi)}),Bi=kr((t,e)=>{Ir(),Ei(),oi();var r=(wi(),xr(mi)),{format:n,inspect:i}=Ti(),{codes:{ERR_INVALID_ARG_TYPE:s}}=ki(),{kResistStopPropagation:a,AggregateError:o,SymbolDispose:l}=Si(),c=globalThis.AbortSignal||Ai().AbortSignal,u=globalThis.AbortController||Ai().AbortController,h=Object.getPrototypeOf(async function(){}).constructor,d=globalThis.Blob||r.Blob,f=typeof d<"u"?function(t){return t instanceof d}:function(t){return!1},p=(t,e)=>{if(void 0!==t&&(null===t||"object"!=typeof t||!("aborted"in t)))throw new s(e,"AbortSignal",t)};e.exports={AggregateError:o,kEmptyObject:Object.freeze({}),once(t){let e=!1;return function(){for(var r=arguments.length,n=new Array(r),i=0;i<r;i++)n[i]=arguments[i];e||(e=!0,t.apply(this,n))}},createDeferredPromise:function(){let t,e;return{promise:new Promise((r,n)=>{t=r,e=n}),resolve:t,reject:e}},promisify:t=>new Promise((e,r)=>{t(function(t){for(var n=arguments.length,i=new Array(n>1?n-1:0),s=1;s<n;s++)i[s-1]=arguments[s];return t?r(t):e(...i)})}),debuglog:()=>function(){},format:n,inspect:i,types:{isAsyncFunction:t=>t instanceof h,isArrayBufferView:t=>ArrayBuffer.isView(t)},isBlob:f,deprecate:(t,e)=>t,addAbortListener:(Ui(),xr(xi)).addAbortListener||function(t,e){if(void 0===t)throw new s("signal","AbortSignal",t);let r;return p(t,"signal"),((t,e)=>{if("function"!=typeof t)throw new s(e,"Function",t)})(e,"listener"),t.aborted?queueMicrotask(()=>e()):(t.addEventListener("abort",e,{__proto__:null,once:!0,[a]:!0}),r=()=>{t.removeEventListener("abort",e)}),{__proto__:null,[l](){var t;null===(t=r)||void 0===t||t()}}},AbortSignalAny:c.any||function(t){if(1===t.length)return t[0];let e=new u,r=()=>e.abort();return t.forEach(t=>{p(t,"signals"),t.addEventListener("abort",r,{once:!0})}),e.signal.addEventListener("abort",()=>{t.forEach(t=>t.removeEventListener("abort",r))},{once:!0}),e.signal}},e.exports.promisify.custom=Symbol.for("nodejs.util.promisify.custom")}),ji=kr((t,e)=>{Ir(),Ei(),oi();var{ArrayIsArray:r,ArrayPrototypeIncludes:n,ArrayPrototypeJoin:i,ArrayPrototypeMap:s,NumberIsInteger:a,NumberIsNaN:o,NumberMAX_SAFE_INTEGER:l,NumberMIN_SAFE_INTEGER:c,NumberParseInt:u,ObjectPrototypeHasOwnProperty:h,RegExpPrototypeExec:d,String:f,StringPrototypeToUpperCase:p,StringPrototypeTrim:g}=Si(),{hideStackFrames:m,codes:{ERR_SOCKET_BAD_PORT:y,ERR_INVALID_ARG_TYPE:v,ERR_INVALID_ARG_VALUE:b,ERR_OUT_OF_RANGE:_,ERR_UNKNOWN_SIGNAL:w}}=ki(),{normalizeEncoding:E}=Bi(),{isAsyncFunction:S,isArrayBufferView:T}=Bi().types,k={};var A=/^[0-7]+$/;var x=m(function(t,e){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:c,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:l;if("number"!=typeof t)throw new v(e,"number",t);if(!a(t))throw new _(e,"an integer",t);if(t<r||t>n)throw new _(e,">= ".concat(r," && <= ").concat(n),t)}),I=m(function(t,e){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-2147483648,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2147483647;if("number"!=typeof t)throw new v(e,"number",t);if(!a(t))throw new _(e,"an integer",t);if(t<r||t>n)throw new _(e,">= ".concat(r," && <= ").concat(n),t)}),R=m(function(t,e){let r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if("number"!=typeof t)throw new v(e,"number",t);if(!a(t))throw new _(e,"an integer",t);let n=r?1:0,i=4294967295;if(t<n||t>i)throw new _(e,">= ".concat(n," && <= ").concat(i),t)});function L(t,e){if("string"!=typeof t)throw new v(e,"string",t)}var P=m((t,e,r)=>{if(!n(r,t)){let n="must be one of: "+i(s(r,t=>"string"==typeof t?"'".concat(t,"'"):f(t)),", ");throw new b(e,t,n)}});function C(t,e){if("boolean"!=typeof t)throw new v(e,"boolean",t)}function M(t,e,r){return null!=t&&h(t,e)?t[e]:r}var O=m(function(t,e){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,i=M(n,"allowArray",!1),s=M(n,"allowFunction",!1);if(!M(n,"nullable",!1)&&null===t||!i&&r(t)||"object"!=typeof t&&(!s||"function"!=typeof t))throw new v(e,"Object",t)}),D=m((t,e)=>{if(null!=t&&"object"!=typeof t&&"function"!=typeof t)throw new v(e,"a dictionary",t)}),N=m(function(t,e){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;if(!r(t))throw new v(e,"Array",t);if(t.length<n){let r="must be longer than ".concat(n);throw new b(e,t,r)}});var F=m(function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"buffer";if(!T(t))throw new v(e,["Buffer","TypedArray","DataView"],t)});var U=m((t,e)=>{if(void 0!==t&&(null===t||"object"!=typeof t||!("aborted"in t)))throw new v(e,"AbortSignal",t)}),B=m((t,e)=>{if("function"!=typeof t)throw new v(e,"Function",t)}),j=m((t,e)=>{if("function"!=typeof t||S(t))throw new v(e,"Function",t)}),z=m((t,e)=>{if(void 0!==t)throw new v(e,"undefined",t)});var W=/^(?:<[^>]*>)(?:\s*;\s*[^;"\s]+(?:=(")?[^;"\s]*\1)?)*$/;function G(t,e){if(typeof t>"u"||!d(W,t))throw new b(e,t,'must be an array or string of format "</styles.css>; rel=preload; as=style"')}e.exports={isInt32:function(t){return t===(0|t)},isUint32:function(t){return t===t>>>0},parseFileMode:function(t,e,r){if(typeof t>"u"&&(t=r),"string"==typeof t){if(null===d(A,t))throw new b(e,t,"must be a 32-bit unsigned integer or an octal string");t=u(t,8)}return R(t,e),t},validateArray:N,validateStringArray:function(t,e){N(t,e);for(let r=0;r<t.length;r++)L(t[r],"".concat(e,"[").concat(r,"]"))},validateBooleanArray:function(t,e){N(t,e);for(let r=0;r<t.length;r++)C(t[r],"".concat(e,"[").concat(r,"]"))},validateAbortSignalArray:function(t,e){N(t,e);for(let r=0;r<t.length;r++){let n=t[r],i="".concat(e,"[").concat(r,"]");if(null==n)throw new v(i,"AbortSignal",n);U(n,i)}},validateBoolean:C,validateBuffer:F,validateDictionary:D,validateEncoding:function(t,e){let r=E(e),n=t.length;if("hex"===r&&n%2!==0)throw new b("encoding",e,"is invalid for data of length ".concat(n))},validateFunction:B,validateInt32:I,validateInteger:x,validateNumber:function(t,e){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:void 0,n=arguments.length>3?arguments[3]:void 0;if("number"!=typeof t)throw new v(e,"number",t);if(null!=r&&t<r||null!=n&&t>n||(null!=r||null!=n)&&o(t))throw new _(e,"".concat(null!=r?">= ".concat(r):"").concat(null!=r&&null!=n?" && ":"").concat(null!=n?"<= ".concat(n):""),t)},validateObject:O,validateOneOf:P,validatePlainFunction:j,validatePort:function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"Port",r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if("number"!=typeof t&&"string"!=typeof t||"string"==typeof t&&0===g(t).length||+t!==+t>>>0||t>65535||0===t&&!r)throw new y(e,t,r);return 0|t},validateSignalName:function(t){if(L(t,arguments.length>1&&void 0!==arguments[1]?arguments[1]:"signal"),void 0===k[t])throw void 0!==k[p(t)]?new w(t+" (signals must use all capital letters)"):new w(t)},validateString:L,validateUint32:R,validateUndefined:z,validateUnion:function(t,e,r){if(!n(r,t))throw new v(e,"('".concat(i(r,"|"),"')"),t)},validateAbortSignal:U,validateLinkHeaderValue:function(t){if("string"==typeof t)return G(t,"hints"),t;if(r(t)){let e=t.length,r="";if(0===e)return r;for(let n=0;n<e;n++){let i=t[n];G(i,"hints"),r+=i,n!==e-1&&(r+=", ")}return r}throw new b("hints",t,'must be an array or string of format "</styles.css>; rel=preload; as=style"')}}}),zi=kr((t,e)=>{Ir(),Ei(),oi();var r,n,i=e.exports={};function s(){throw new Error("setTimeout has not been defined")}function a(){throw new Error("clearTimeout has not been defined")}function o(t){if(r===setTimeout)return setTimeout(t,0);if((r===s||!r)&&setTimeout)return r=setTimeout,setTimeout(t,0);try{return r(t,0)}catch(e){try{return r.call(null,t,0)}catch(n){return r.call(this,t,0)}}}!function(){try{r="function"==typeof setTimeout?setTimeout:s}catch(t){r=s}try{n="function"==typeof clearTimeout?clearTimeout:a}catch(e){n=a}}();var l,c=[],u=!1,h=-1;function d(){!u||!l||(u=!1,l.length?c=l.concat(c):h=-1,c.length&&f())}function f(){if(!u){var t=o(d);u=!0;for(var e=c.length;e;){for(l=c,c=[];++h<e;)l&&l[h].run();h=-1,e=c.length}l=null,u=!1,function(t){if(n===clearTimeout)return clearTimeout(t);if((n===a||!n)&&clearTimeout)return n=clearTimeout,clearTimeout(t);try{return n(t)}catch(e){try{return n.call(null,t)}catch(r){return n.call(this,t)}}}(t)}}function p(t,e){this.fun=t,this.array=e}function g(){}i.nextTick=function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)e[r-1]=arguments[r];c.push(new p(t,e)),1===c.length&&!u&&o(f)},p.prototype.run=function(){this.fun.apply(null,this.array)},i.title="browser",i.browser=!0,i.env={},i.argv=[],i.version="",i.versions={},i.on=g,i.addListener=g,i.once=g,i.off=g,i.removeListener=g,i.removeAllListeners=g,i.emit=g,i.prependListener=g,i.prependOnceListener=g,i.listeners=function(t){return[]},i.binding=function(t){throw new Error("process.binding is not supported")},i.cwd=function(){return"/"},i.chdir=function(t){throw new Error("process.chdir is not supported")},i.umask=function(){return 0}}),Wi=kr((t,e)=>{Ir(),Ei(),oi();var{SymbolAsyncIterator:r,SymbolIterator:n,SymbolFor:i}=Si(),s=i("nodejs.stream.destroyed"),a=i("nodejs.stream.errored"),o=i("nodejs.stream.readable"),l=i("nodejs.stream.writable"),c=i("nodejs.stream.disturbed"),u=i("nodejs.webstream.isClosedPromise"),h=i("nodejs.webstream.controllerErrorFunction");function d(t){let e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];var r;return!(!t||"function"!=typeof t.pipe||"function"!=typeof t.on||e&&("function"!=typeof t.pause||"function"!=typeof t.resume)||t._writableState&&!1===(null===(r=t._readableState)||void 0===r?void 0:r.readable)||t._writableState&&!t._readableState)}function f(t){var e;return!(!t||"function"!=typeof t.write||"function"!=typeof t.on||t._readableState&&!1===(null===(e=t._writableState)||void 0===e?void 0:e.writable))}function p(t){return t&&(t._readableState||t._writableState||"function"==typeof t.write&&"function"==typeof t.on||"function"==typeof t.pipe&&"function"==typeof t.on)}function g(t){return!(!t||p(t)||"function"!=typeof t.pipeThrough||"function"!=typeof t.getReader||"function"!=typeof t.cancel)}function m(t){return!(!t||p(t)||"function"!=typeof t.getWriter||"function"!=typeof t.abort)}function y(t){return!(!t||p(t)||"object"!=typeof t.readable||"object"!=typeof t.writable)}function v(t){if(!p(t))return null;let e=t._writableState,r=t._readableState,n=e||r;return!!(t.destroyed||t[s]||null!=n&&n.destroyed)}function b(t){if(!f(t))return null;if(!0===t.writableEnded)return!0;let e=t._writableState;return(null==e||!e.errored)&&("boolean"!=typeof(null===e||void 0===e?void 0:e.ended)?null:e.ended)}function _(t,e){if(!d(t))return null;let r=t._readableState;return(null==r||!r.errored)&&("boolean"!=typeof(null===r||void 0===r?void 0:r.endEmitted)?null:!!(r.endEmitted||!1===e&&!0===r.ended&&0===r.length))}function w(t){return t&&null!=t[o]?t[o]:"boolean"!=typeof(null===t||void 0===t?void 0:t.readable)?null:!v(t)&&(d(t)&&t.readable&&!_(t))}function E(t){return t&&null!=t[l]?t[l]:"boolean"!=typeof(null===t||void 0===t?void 0:t.writable)?null:!v(t)&&(f(t)&&t.writable&&!b(t))}function S(t){return"boolean"==typeof t._closed&&"boolean"==typeof t._defaultKeepAlive&&"boolean"==typeof t._removedConnection&&"boolean"==typeof t._removedContLen}function T(t){return"boolean"==typeof t._sent100&&S(t)}e.exports={isDestroyed:v,kIsDestroyed:s,isDisturbed:function(t){var e;return!(!t||!(null!==(e=t[c])&&void 0!==e?e:t.readableDidRead||t.readableAborted))},kIsDisturbed:c,isErrored:function(t){var e,r,n,i,s,o,l,c,u,h;return!(!t||!(null!==(e=null!==(r=null!==(n=null!==(i=null!==(s=null!==(o=t[a])&&void 0!==o?o:t.readableErrored)&&void 0!==s?s:t.writableErrored)&&void 0!==i?i:null===(l=t._readableState)||void 0===l?void 0:l.errorEmitted)&&void 0!==n?n:null===(c=t._writableState)||void 0===c?void 0:c.errorEmitted)&&void 0!==r?r:null===(u=t._readableState)||void 0===u?void 0:u.errored)&&void 0!==e?e:null!==(h=t._writableState)&&void 0!==h&&h.errored))},kIsErrored:a,isReadable:w,kIsReadable:o,kIsClosedPromise:u,kControllerErrorFunction:h,kIsWritable:l,isClosed:function(t){if(!p(t))return null;if("boolean"==typeof t.closed)return t.closed;let e=t._writableState,r=t._readableState;return"boolean"==typeof(null===e||void 0===e?void 0:e.closed)||"boolean"==typeof(null===r||void 0===r?void 0:r.closed)?(null===e||void 0===e?void 0:e.closed)||(null===r||void 0===r?void 0:r.closed):"boolean"==typeof t._closed&&S(t)?t._closed:null},isDuplexNodeStream:function(t){return!(!t||"function"!=typeof t.pipe||!t._readableState||"function"!=typeof t.on||"function"!=typeof t.write)},isFinished:function(t,e){return p(t)?!!v(t)||!(!1!==(null===e||void 0===e?void 0:e.readable)&&w(t)||!1!==(null===e||void 0===e?void 0:e.writable)&&E(t)):null},isIterable:function(t,e){return null!=t&&(!0===e?"function"==typeof t[r]:!1===e?"function"==typeof t[n]:"function"==typeof t[r]||"function"==typeof t[n])},isReadableNodeStream:d,isReadableStream:g,isReadableEnded:function(t){if(!d(t))return null;if(!0===t.readableEnded)return!0;let e=t._readableState;return!(!e||e.errored)&&("boolean"!=typeof(null===e||void 0===e?void 0:e.ended)?null:e.ended)},isReadableFinished:_,isReadableErrored:function(t){var e,r;return p(t)?t.readableErrored?t.readableErrored:null!==(e=null===(r=t._readableState)||void 0===r?void 0:r.errored)&&void 0!==e?e:null:null},isNodeStream:p,isWebStream:function(t){return g(t)||m(t)||y(t)},isWritable:E,isWritableNodeStream:f,isWritableStream:m,isWritableEnded:b,isWritableFinished:function(t,e){if(!f(t))return null;if(!0===t.writableFinished)return!0;let r=t._writableState;return(null==r||!r.errored)&&("boolean"!=typeof(null===r||void 0===r?void 0:r.finished)?null:!!(r.finished||!1===e&&!0===r.ended&&0===r.length))},isWritableErrored:function(t){var e,r;return p(t)?t.writableErrored?t.writableErrored:null!==(e=null===(r=t._writableState)||void 0===r?void 0:r.errored)&&void 0!==e?e:null:null},isServerRequest:function(t){var e;return"boolean"==typeof t._consuming&&"boolean"==typeof t._dumped&&void 0===(null===(e=t.req)||void 0===e?void 0:e.upgradeOrConnect)},isServerResponse:T,willEmitClose:function(t){if(!p(t))return null;let e=t._writableState,r=t._readableState,n=e||r;return!n&&T(t)||!!(n&&n.autoDestroy&&n.emitClose&&!1===n.closed)},isTransformStream:y}}),Gi=kr((t,e)=>{Ir(),Ei(),oi();var r,n=zi(),{AbortError:i,codes:s}=ki(),{ERR_INVALID_ARG_TYPE:a,ERR_STREAM_PREMATURE_CLOSE:o}=s,{kEmptyObject:l,once:c}=Bi(),{validateAbortSignal:u,validateFunction:h,validateObject:d,validateBoolean:f}=ji(),{Promise:p,PromisePrototypeThen:g,SymbolDispose:m}=Si(),{isClosed:y,isReadable:v,isReadableNodeStream:b,isReadableStream:_,isReadableFinished:w,isReadableErrored:E,isWritable:S,isWritableNodeStream:T,isWritableStream:k,isWritableFinished:A,isWritableErrored:x,isNodeStream:I,willEmitClose:R,kIsClosedPromise:L}=Wi();var P=()=>{};function C(t,e,s){var f,p;if(2===arguments.length?(s=e,e=l):null==e?e=l:d(e,"options"),h(s,"callback"),u(e.signal,"options.signal"),s=c(s),_(t)||k(t))return function(t,e,s){let a=!1,o=P;if(e.signal)if(o=()=>{a=!0,s.call(t,new i(void 0,{cause:e.signal.reason}))},e.signal.aborted)n.nextTick(o);else{let n=(r=r||Bi().addAbortListener)(e.signal,o),i=s;s=c(function(){for(var e=arguments.length,r=new Array(e),s=0;s<e;s++)r[s]=arguments[s];n[m](),i.apply(t,r)})}let l=function(){for(var e=arguments.length,r=new Array(e),i=0;i<e;i++)r[i]=arguments[i];a||n.nextTick(()=>s.apply(t,r))};return g(t[L].promise,l,l),P}(t,e,s);if(!I(t))throw new a("stream",["ReadableStream","WritableStream","Stream"],t);let C=null!==(f=e.readable)&&void 0!==f?f:b(t),M=null!==(p=e.writable)&&void 0!==p?p:T(t),O=t._writableState,D=t._readableState,N=()=>{t.writable||B()},F=R(t)&&b(t)===C&&T(t)===M,U=A(t,!1),B=()=>{U=!0,t.destroyed&&(F=!1),(!F||t.readable&&!C)&&(!C||j)&&s.call(t)},j=w(t,!1),z=()=>{j=!0,t.destroyed&&(F=!1),(!F||t.writable&&!M)&&(!M||U)&&s.call(t)},W=e=>{s.call(t,e)},G=y(t),V=()=>{G=!0;let e=x(t)||E(t);return e&&"boolean"!=typeof e?s.call(t,e):C&&!j&&b(t,!0)&&!w(t,!1)?s.call(t,new o):!M||U||A(t,!1)?void s.call(t):s.call(t,new o)},H=()=>{G=!0;let e=x(t)||E(t);if(e&&"boolean"!=typeof e)return s.call(t,e);s.call(t)},K=()=>{t.req.on("finish",B)};!function(t){return t.setHeader&&"function"==typeof t.abort}(t)?M&&!O&&(t.on("end",N),t.on("close",N)):(t.on("complete",B),F||t.on("abort",V),t.req?K():t.on("request",K)),!F&&"boolean"==typeof t.aborted&&t.on("aborted",V),t.on("end",z),t.on("finish",B),!1!==e.error&&t.on("error",W),t.on("close",V),G?n.nextTick(V):null!=O&&O.errorEmitted||null!=D&&D.errorEmitted?F||n.nextTick(H):(!C&&(!F||v(t))&&(U||!1===S(t))||!M&&(!F||S(t))&&(j||!1===v(t))||D&&t.req&&t.aborted)&&n.nextTick(H);let q=()=>{s=P,t.removeListener("aborted",V),t.removeListener("complete",B),t.removeListener("abort",V),t.removeListener("request",K),t.req&&t.req.removeListener("finish",B),t.removeListener("end",N),t.removeListener("close",N),t.removeListener("finish",B),t.removeListener("end",z),t.removeListener("error",W),t.removeListener("close",V)};if(e.signal&&!G){let a=()=>{let r=s;q(),r.call(t,new i(void 0,{cause:e.signal.reason}))};if(e.signal.aborted)n.nextTick(a);else{let n=(r=r||Bi().addAbortListener)(e.signal,a),i=s;s=c(function(){for(var e=arguments.length,r=new Array(e),s=0;s<e;s++)r[s]=arguments[s];n[m](),i.apply(t,r)})}}return q}e.exports=C,e.exports.finished=function(t,e){var r;let n=!1;return null===e&&(e=l),null!==(r=e)&&void 0!==r&&r.cleanup&&(f(e.cleanup,"cleanup"),n=e.cleanup),new p((r,i)=>{let s=C(t,e,t=>{n&&s(),t?i(t):r()})})}}),Vi=kr((t,e)=>{Ir(),Ei(),oi();var r=zi(),{aggregateTwoErrors:n,codes:{ERR_MULTIPLE_CALLBACK:i},AbortError:s}=ki(),{Symbol:a}=Si(),{kIsDestroyed:o,isDestroyed:l,isFinished:c,isServerRequest:u}=Wi(),h=a("kDestroy"),d=a("kConstruct");function f(t,e,r){t&&(t.stack,e&&!e.errored&&(e.errored=t),r&&!r.errored&&(r.errored=t))}function p(t,e,n){let i=!1;function s(e){if(i)return;i=!0;let s=t._readableState,a=t._writableState;f(e,a,s),a&&(a.closed=!0),s&&(s.closed=!0),"function"==typeof n&&n(e),e?r.nextTick(g,t,e):r.nextTick(m,t)}try{t._destroy(e||null,s)}catch(a){s(a)}}function g(t,e){y(t,e),m(t)}function m(t){let e=t._readableState,r=t._writableState;r&&(r.closeEmitted=!0),e&&(e.closeEmitted=!0),(null!=r&&r.emitClose||null!=e&&e.emitClose)&&t.emit("close")}function y(t,e){let r=t._readableState,n=t._writableState;null!=n&&n.errorEmitted||null!=r&&r.errorEmitted||(n&&(n.errorEmitted=!0),r&&(r.errorEmitted=!0),t.emit("error",e))}function v(t,e,n){let i=t._readableState,s=t._writableState;if(null!=s&&s.destroyed||null!=i&&i.destroyed)return this;null!=i&&i.autoDestroy||null!=s&&s.autoDestroy?t.destroy(e):e&&(e.stack,s&&!s.errored&&(s.errored=e),i&&!i.errored&&(i.errored=e),n?r.nextTick(y,t,e):y(t,e))}function b(t){let e=!1;function n(n){if(e)return void v(t,null!==n&&void 0!==n?n:new i);e=!0;let s=t._readableState,a=t._writableState,o=a||s;s&&(s.constructed=!0),a&&(a.constructed=!0),o.destroyed?t.emit(h,n):n?v(t,n,!0):r.nextTick(_,t)}try{t._construct(t=>{r.nextTick(n,t)})}catch(s){r.nextTick(n,s)}}function _(t){t.emit(d)}function w(t){return(null===t||void 0===t?void 0:t.setHeader)&&"function"==typeof t.abort}function E(t){t.emit("close")}function S(t,e){t.emit("error",e),r.nextTick(E,t)}e.exports={construct:function(t,e){if("function"!=typeof t._construct)return;let n=t._readableState,i=t._writableState;n&&(n.constructed=!1),i&&(i.constructed=!1),t.once(d,e),!(t.listenerCount(d)>1)&&r.nextTick(b,t)},destroyer:function(t,e){!t||l(t)||(!e&&!c(t)&&(e=new s),u(t)?(t.socket=null,t.destroy(e)):w(t)?t.abort():w(t.req)?t.req.abort():"function"==typeof t.destroy?t.destroy(e):"function"==typeof t.close?t.close():e?r.nextTick(S,t,e):r.nextTick(E,t),t.destroyed||(t[o]=!0))},destroy:function(t,e){let r=this._readableState,i=this._writableState,s=i||r;return null!=i&&i.destroyed||null!=r&&r.destroyed?("function"==typeof e&&e(),this):(f(t,i,r),i&&(i.destroyed=!0),r&&(r.destroyed=!0),s.constructed?p(this,t,e):this.once(h,function(r){p(this,n(r,t),e)}),this)},undestroy:function(){let t=this._readableState,e=this._writableState;t&&(t.constructed=!0,t.closed=!1,t.closeEmitted=!1,t.destroyed=!1,t.errored=null,t.errorEmitted=!1,t.reading=!1,t.ended=!1===t.readable,t.endEmitted=!1===t.readable),e&&(e.constructed=!0,e.destroyed=!1,e.closed=!1,e.closeEmitted=!1,e.errored=null,e.errorEmitted=!1,e.finalCalled=!1,e.prefinished=!1,e.ended=!1===e.writable,e.ending=!1===e.writable,e.finished=!1===e.writable)},errorOrDestroy:v}}),Hi=kr((t,e)=>{Ir(),Ei(),oi();var{ArrayIsArray:r,ObjectSetPrototypeOf:n}=Si(),{EventEmitter:i}=(Ui(),xr(xi));function s(t){i.call(this,t)}function a(t,e,n){if("function"==typeof t.prependListener)return t.prependListener(e,n);t._events&&t._events[e]?r(t._events[e])?t._events[e].unshift(n):t._events[e]=[n,t._events[e]]:t.on(e,n)}n(s.prototype,i.prototype),n(s,i),s.prototype.pipe=function(t,e){let r=this;function n(e){t.writable&&!1===t.write(e)&&r.pause&&r.pause()}function s(){r.readable&&r.resume&&r.resume()}r.on("data",n),t.on("drain",s),!t._isStdio&&(!e||!1!==e.end)&&(r.on("end",l),r.on("close",c));let o=!1;function l(){o||(o=!0,t.end())}function c(){o||(o=!0,"function"==typeof t.destroy&&t.destroy())}function u(t){h(),0===i.listenerCount(this,"error")&&this.emit("error",t)}function h(){r.removeListener("data",n),t.removeListener("drain",s),r.removeListener("end",l),r.removeListener("close",c),r.removeListener("error",u),t.removeListener("error",u),r.removeListener("end",h),r.removeListener("close",h),t.removeListener("close",h)}return a(r,"error",u),a(t,"error",u),r.on("end",h),r.on("close",h),t.on("close",h),t.emit("pipe",r),t},e.exports={Stream:s,prependListener:a}}),Ki=kr((t,e)=>{Ir(),Ei(),oi();var r,{SymbolDispose:n}=Si(),{AbortError:i,codes:s}=ki(),{isNodeStream:a,isWebStream:o,kControllerErrorFunction:l}=Wi(),c=Gi(),{ERR_INVALID_ARG_TYPE:u}=s;e.exports.addAbortSignal=function(t,r){if(((t,e)=>{if("object"!=typeof t||!("aborted"in t))throw new u(e,"AbortSignal",t)})(t,"signal"),!a(r)&&!o(r))throw new u("stream",["ReadableStream","WritableStream","Stream"],r);return e.exports.addAbortSignalNoValidate(t,r)},e.exports.addAbortSignalNoValidate=function(t,e){if("object"!=typeof t||!("aborted"in t))return e;let s=a(e)?()=>{e.destroy(new i(void 0,{cause:t.reason}))}:()=>{e[l](new i(void 0,{cause:t.reason}))};if(t.aborted)s();else{let i=(r=r||Bi().addAbortListener)(t,s);c(e,i[n])}return e}}),qi=kr((t,e)=>{Ir(),Ei(),oi();var{StringPrototypeSlice:r,SymbolIterator:n,TypedArrayPrototypeSet:i,Uint8Array:s}=Si(),{Buffer:a}=(wi(),xr(mi)),{inspect:o}=Bi();e.exports=class{constructor(){this.head=null,this.tail=null,this.length=0}push(t){let e={data:t,next:null};this.length>0?this.tail.next=e:this.head=e,this.tail=e,++this.length}unshift(t){let e={data:t,next:this.head};0===this.length&&(this.tail=e),this.head=e,++this.length}shift(){if(0===this.length)return;let t=this.head.data;return 1===this.length?this.head=this.tail=null:this.head=this.head.next,--this.length,t}clear(){this.head=this.tail=null,this.length=0}join(t){if(0===this.length)return"";let e=this.head,r=""+e.data;for(;null!==(e=e.next);)r+=t+e.data;return r}concat(t){if(0===this.length)return a.alloc(0);let e=a.allocUnsafe(t>>>0),r=this.head,n=0;for(;r;)i(e,r.data,n),n+=r.data.length,r=r.next;return e}consume(t,e){let r=this.head.data;if(t<r.length){let e=r.slice(0,t);return this.head.data=r.slice(t),e}return t===r.length?this.shift():e?this._getString(t):this._getBuffer(t)}first(){return this.head.data}*[n](){for(let t=this.head;t;t=t.next)yield t.data}_getString(t){let e="",n=this.head,i=0;do{let s=n.data;if(!(t>s.length)){t===s.length?(e+=s,++i,n.next?this.head=n.next:this.head=this.tail=null):(e+=r(s,0,t),this.head=n,n.data=r(s,t));break}e+=s,t-=s.length,++i}while(null!==(n=n.next));return this.length-=i,e}_getBuffer(t){let e=a.allocUnsafe(t),r=t,n=this.head,o=0;do{let a=n.data;if(!(t>a.length)){t===a.length?(i(e,a,r-t),++o,n.next?this.head=n.next:this.head=this.tail=null):(i(e,new s(a.buffer,a.byteOffset,t),r-t),this.head=n,n.data=a.slice(t));break}i(e,a,r-t),t-=a.length,++o}while(null!==(n=n.next));return this.length-=o,e}[Symbol.for("nodejs.util.inspect.custom")](t,e){return o(this,c(c({},e),{},{depth:0,customInspect:!1}))}}}),Yi=kr((t,e)=>{Ir(),Ei(),oi();var{MathFloor:r,NumberIsInteger:n}=Si(),{validateInteger:i}=ji(),{ERR_INVALID_ARG_VALUE:s}=ki().codes,a=16384,o=16;function l(t){return t?o:a}e.exports={getHighWaterMark:function(t,e,i,a){let o=function(t,e,r){return null!=t.highWaterMark?t.highWaterMark:e?t[r]:null}(e,a,i);if(null!=o){if(!n(o)||o<0){let t=a?"options.".concat(i):"options.highWaterMark";throw new s(t,o)}return r(o)}return l(t.objectMode)},getDefaultHighWaterMark:l,setDefaultHighWaterMark:function(t,e){i(e,"value",0),t?o=e:a=e}}}),Qi=kr((t,e)=>{Ir(),Ei(),oi();var r=(wi(),xr(mi)),n=r.Buffer;function i(t,e){for(var r in t)e[r]=t[r]}function s(t,e,r){return n(t,e,r)}n.from&&n.alloc&&n.allocUnsafe&&n.allocUnsafeSlow?e.exports=r:(i(r,t),t.Buffer=s),s.prototype=Object.create(n.prototype),i(n,s),s.from=function(t,e,r){if("number"==typeof t)throw new TypeError("Argument must not be a number");return n(t,e,r)},s.alloc=function(t,e,r){if("number"!=typeof t)throw new TypeError("Argument must be a number");var i=n(t);return void 0!==e?"string"==typeof r?i.fill(e,r):i.fill(e):i.fill(0),i},s.allocUnsafe=function(t){if("number"!=typeof t)throw new TypeError("Argument must be a number");return n(t)},s.allocUnsafeSlow=function(t){if("number"!=typeof t)throw new TypeError("Argument must be a number");return r.SlowBuffer(t)}}),Xi=kr(t=>{Ir(),Ei(),oi();var e=Qi().Buffer,r=e.isEncoding||function(t){switch((t=""+t)&&t.toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":case"raw":return!0;default:return!1}};function n(t){var n;switch(this.encoding=function(t){var n=function(t){if(!t)return"utf8";for(var e;;)switch(t){case"utf8":case"utf-8":return"utf8";case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return"utf16le";case"latin1":case"binary":return"latin1";case"base64":case"ascii":case"hex":return t;default:if(e)return;t=(""+t).toLowerCase(),e=!0}}(t);if("string"!=typeof n&&(e.isEncoding===r||!r(t)))throw new Error("Unknown encoding: "+t);return n||t}(t),this.encoding){case"utf16le":this.text=a,this.end=o,n=4;break;case"utf8":this.fillLast=s,n=4;break;case"base64":this.text=l,this.end=c,n=3;break;default:return this.write=u,void(this.end=h)}this.lastNeed=0,this.lastTotal=0,this.lastChar=e.allocUnsafe(n)}function i(t){return t<=127?0:t>>5===6?2:t>>4===14?3:t>>3===30?4:t>>6===2?-1:-2}function s(t){var e=this.lastTotal-this.lastNeed,r=function(t,e){if(128!==(192&e[0]))return t.lastNeed=0,"\ufffd";if(t.lastNeed>1&&e.length>1){if(128!==(192&e[1]))return t.lastNeed=1,"\ufffd";if(t.lastNeed>2&&e.length>2&&128!==(192&e[2]))return t.lastNeed=2,"\ufffd"}}(this,t);return void 0!==r?r:this.lastNeed<=t.length?(t.copy(this.lastChar,e,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal)):(t.copy(this.lastChar,e,0,t.length),void(this.lastNeed-=t.length))}function a(t,e){if((t.length-e)%2===0){var r=t.toString("utf16le",e);if(r){var n=r.charCodeAt(r.length-1);if(n>=55296&&n<=56319)return this.lastNeed=2,this.lastTotal=4,this.lastChar[0]=t[t.length-2],this.lastChar[1]=t[t.length-1],r.slice(0,-1)}return r}return this.lastNeed=1,this.lastTotal=2,this.lastChar[0]=t[t.length-1],t.toString("utf16le",e,t.length-1)}function o(t){var e=t&&t.length?this.write(t):"";if(this.lastNeed){var r=this.lastTotal-this.lastNeed;return e+this.lastChar.toString("utf16le",0,r)}return e}function l(t,e){var r=(t.length-e)%3;return 0===r?t.toString("base64",e):(this.lastNeed=3-r,this.lastTotal=3,1===r?this.lastChar[0]=t[t.length-1]:(this.lastChar[0]=t[t.length-2],this.lastChar[1]=t[t.length-1]),t.toString("base64",e,t.length-r))}function c(t){var e=t&&t.length?this.write(t):"";return this.lastNeed?e+this.lastChar.toString("base64",0,3-this.lastNeed):e}function u(t){return t.toString(this.encoding)}function h(t){return t&&t.length?this.write(t):""}t.StringDecoder=n,n.prototype.write=function(t){if(0===t.length)return"";var e,r;if(this.lastNeed){if(void 0===(e=this.fillLast(t)))return"";r=this.lastNeed,this.lastNeed=0}else r=0;return r<t.length?e?e+this.text(t,r):this.text(t,r):e||""},n.prototype.end=function(t){var e=t&&t.length?this.write(t):"";return this.lastNeed?e+"\ufffd":e},n.prototype.text=function(t,e){var r=function(t,e,r){var n=e.length-1;if(n<r)return 0;var s=i(e[n]);return s>=0?(s>0&&(t.lastNeed=s-1),s):--n<r||-2===s?0:(s=i(e[n]),s>=0?(s>0&&(t.lastNeed=s-2),s):--n<r||-2===s?0:(s=i(e[n]),s>=0?(s>0&&(2===s?s=0:t.lastNeed=s-3),s):0))}(this,t,e);if(!this.lastNeed)return t.toString("utf8",e);this.lastTotal=r;var n=t.length-(r-this.lastNeed);return t.copy(this.lastChar,0,n),t.toString("utf8",e,n)},n.prototype.fillLast=function(t){if(this.lastNeed<=t.length)return t.copy(this.lastChar,this.lastTotal-this.lastNeed,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal);t.copy(this.lastChar,this.lastTotal-this.lastNeed,0,t.length),this.lastNeed-=t.length}}),$i=kr((t,e)=>{Ir(),Ei(),oi();var r=zi(),{PromisePrototypeThen:n,SymbolAsyncIterator:i,SymbolIterator:s}=Si(),{Buffer:a}=(wi(),xr(mi)),{ERR_INVALID_ARG_TYPE:o,ERR_STREAM_NULL_VALUES:l}=ki().codes;e.exports=function(t,e,u){let h,d;if("string"==typeof e||e instanceof a)return new t(c(c({objectMode:!0},u),{},{read(){this.push(e),this.push(null)}}));if(e&&e[i])d=!0,h=e[i]();else{if(!e||!e[s])throw new o("iterable",["Iterable"],e);d=!1,h=e[s]()}let f=new t(c({objectMode:!0,highWaterMark:1},u)),p=!1;return f._read=function(){p||(p=!0,async function(){for(;;){try{let{value:t,done:e}=d?await h.next():h.next();if(e)f.push(null);else{let e=t&&"function"==typeof t.then?await t:t;if(null===e)throw p=!1,new l;if(f.push(e))continue;p=!1}}catch(t){f.destroy(t)}break}}())},f._destroy=function(t,e){n(async function(t){let e=null!=t,r="function"==typeof h.throw;if(e&&r){let{value:e,done:r}=await h.throw(t);if(await e,r)return}if("function"==typeof h.return){let{value:t}=await h.return();await t}}(t),()=>r.nextTick(e,t),n=>r.nextTick(e,n||t))},f}}),Zi=kr((t,e)=>{Ir(),Ei(),oi();var r=zi(),{ArrayPrototypeIndexOf:n,NumberIsInteger:i,NumberIsNaN:s,NumberParseInt:a,ObjectDefineProperties:o,ObjectKeys:l,ObjectSetPrototypeOf:u,Promise:h,SafeSet:d,SymbolAsyncDispose:f,SymbolAsyncIterator:p,Symbol:g}=Si();e.exports=q,q.ReadableState=K;var{EventEmitter:m}=(Ui(),xr(xi)),{Stream:y,prependListener:v}=Hi(),{Buffer:b}=(wi(),xr(mi)),{addAbortSignal:_}=Ki(),w=Gi(),E=Bi().debuglog("stream",t=>{E=t}),S=qi(),T=Vi(),{getHighWaterMark:k,getDefaultHighWaterMark:A}=Yi(),{aggregateTwoErrors:x,codes:{ERR_INVALID_ARG_TYPE:I,ERR_METHOD_NOT_IMPLEMENTED:R,ERR_OUT_OF_RANGE:L,ERR_STREAM_PUSH_AFTER_EOF:P,ERR_STREAM_UNSHIFT_AFTER_END_EVENT:C},AbortError:M}=ki(),{validateObject:O}=ji(),D=g("kPaused"),{StringDecoder:N}=Xi(),F=$i();u(q.prototype,y.prototype),u(q,y);var U=()=>{},{errorOrDestroy:B}=T,j=1,z=16,W=32,G=2048,V=4096;function H(t){return{enumerable:!1,get(){return 0!==(this.state&t)},set(e){e?this.state|=t:this.state&=~t}}}function K(t,e,r){"boolean"!=typeof r&&(r=e instanceof es()),this.state=G|V|z|W,t&&t.objectMode&&(this.state|=j),r&&t&&t.readableObjectMode&&(this.state|=j),this.highWaterMark=t?k(this,t,"readableHighWaterMark",r):A(!1),this.buffer=new S,this.length=0,this.pipes=[],this.flowing=null,this[D]=null,t&&!1===t.emitClose&&(this.state&=~G),t&&!1===t.autoDestroy&&(this.state&=~V),this.errored=null,this.defaultEncoding=t&&t.defaultEncoding||"utf8",this.awaitDrainWriters=null,this.decoder=null,this.encoding=null,t&&t.encoding&&(this.decoder=new N(t.encoding),this.encoding=t.encoding)}function q(t){if(!(this instanceof q))return new q(t);let e=this instanceof es();this._readableState=new K(t,this,e),t&&("function"==typeof t.read&&(this._read=t.read),"function"==typeof t.destroy&&(this._destroy=t.destroy),"function"==typeof t.construct&&(this._construct=t.construct),t.signal&&!e&&_(t.signal,this)),y.call(this,t),T.construct(this,()=>{this._readableState.needReadable&&tt(this,this._readableState)})}function Y(t,e,r,n){E("readableAddChunk",e);let i,s=t._readableState;if(0===(s.state&j)&&("string"==typeof e?(r=r||s.defaultEncoding,s.encoding!==r&&(n&&s.encoding?e=b.from(e,r).toString(s.encoding):(e=b.from(e,r),r=""))):e instanceof b?r="":y._isUint8Array(e)?(e=y._uint8ArrayToBuffer(e),r=""):null!=e&&(i=new I("chunk",["string","Buffer","Uint8Array"],e))),i)B(t,i);else if(null===e)s.state&=-9,function(t,e){if(E("onEofChunk"),!e.ended){if(e.decoder){let t=e.decoder.end();t&&t.length&&(e.buffer.push(t),e.length+=e.objectMode?1:t.length)}e.ended=!0,e.sync?Z(t):(e.needReadable=!1,e.emittedReadable=!0,J(t))}}(t,s);else if(0!==(s.state&j)||e&&e.length>0)if(n)if(0!==(4&s.state))B(t,new C);else{if(s.destroyed||s.errored)return!1;Q(t,s,e,!0)}else if(s.ended)B(t,new P);else{if(s.destroyed||s.errored)return!1;s.state&=-9,s.decoder&&!r?(e=s.decoder.write(e),s.objectMode||0!==e.length?Q(t,s,e,!1):tt(t,s)):Q(t,s,e,!1)}else n||(s.state&=-9,tt(t,s));return!s.ended&&(s.length<s.highWaterMark||0===s.length)}function Q(t,e,r,n){e.flowing&&0===e.length&&!e.sync&&t.listenerCount("data")>0?(0!==(65536&e.state)?e.awaitDrainWriters.clear():e.awaitDrainWriters=null,e.dataEmitted=!0,t.emit("data",r)):(e.length+=e.objectMode?1:r.length,n?e.buffer.unshift(r):e.buffer.push(r),0!==(64&e.state)&&Z(t)),tt(t,e)}o(K.prototype,{objectMode:H(j),ended:H(2),endEmitted:H(4),reading:H(8),constructed:H(z),sync:H(W),needReadable:H(64),emittedReadable:H(128),readableListening:H(256),resumeScheduled:H(512),errorEmitted:H(1024),emitClose:H(G),autoDestroy:H(V),destroyed:H(8192),closed:H(16384),closeEmitted:H(32768),multiAwaitDrain:H(65536),readingMore:H(1<<17),dataEmitted:H(1<<18)}),q.prototype.destroy=T.destroy,q.prototype._undestroy=T.undestroy,q.prototype._destroy=function(t,e){e(t)},q.prototype[m.captureRejectionSymbol]=function(t){this.destroy(t)},q.prototype[f]=function(){let t;return this.destroyed||(t=this.readableEnded?null:new M,this.destroy(t)),new h((e,r)=>w(this,n=>n&&n!==t?r(n):e(null)))},q.prototype.push=function(t,e){return Y(this,t,e,!1)},q.prototype.unshift=function(t,e){return Y(this,t,e,!0)},q.prototype.isPaused=function(){let t=this._readableState;return!0===t[D]||!1===t.flowing},q.prototype.setEncoding=function(t){let e=new N(t);this._readableState.decoder=e,this._readableState.encoding=this._readableState.decoder.encoding;let r=this._readableState.buffer,n="";for(let i of r)n+=e.write(i);return r.clear(),""!==n&&r.push(n),this._readableState.length=n.length,this};var X;function $(t,e){return t<=0||0===e.length&&e.ended?0:0!==(e.state&j)?1:s(t)?e.flowing&&e.length?e.buffer.first().length:e.length:t<=e.length?t:e.ended?e.length:0}function Z(t){let e=t._readableState;E("emitReadable",e.needReadable,e.emittedReadable),e.needReadable=!1,e.emittedReadable||(E("emitReadable",e.flowing),e.emittedReadable=!0,r.nextTick(J,t))}function J(t){let e=t._readableState;E("emitReadable_",e.destroyed,e.length,e.ended),!e.destroyed&&!e.errored&&(e.length||e.ended)&&(t.emit("readable"),e.emittedReadable=!1),e.needReadable=!e.flowing&&!e.ended&&e.length<=e.highWaterMark,st(t)}function tt(t,e){!e.readingMore&&e.constructed&&(e.readingMore=!0,r.nextTick(et,t,e))}function et(t,e){for(;!e.reading&&!e.ended&&(e.length<e.highWaterMark||e.flowing&&0===e.length);){let r=e.length;if(E("maybeReadMore read 0"),t.read(0),r===e.length)break}e.readingMore=!1}function rt(t){let e=t._readableState;e.readableListening=t.listenerCount("readable")>0,e.resumeScheduled&&!1===e[D]?e.flowing=!0:t.listenerCount("data")>0?t.resume():e.readableListening||(e.flowing=null)}function nt(t){E("readable nexttick read 0"),t.read(0)}function it(t,e){E("resume",e.reading),e.reading||t.read(0),e.resumeScheduled=!1,t.emit("resume"),st(t),e.flowing&&!e.reading&&t.read(0)}function st(t){let e=t._readableState;for(E("flow",e.flowing);e.flowing&&null!==t.read(););}function at(t,e){"function"!=typeof t.read&&(t=q.wrap(t,{objectMode:!0}));let r=function(t,e){return ot.apply(this,arguments)}(t,e);return r.stream=t,r}function ot(){return(ot=mr(function*(t,e){let r=U;function n(e){this===t?(r(),r=U):r=e}t.on("readable",n);let i,s=w(t,{writable:!1},t=>{i=t?x(i,t):null,r(),r=U});try{for(;;){let e=t.destroyed?null:t.read();if(null!==e)yield e;else{if(i)throw i;if(null===i)return;yield gr(new h(n))}}}catch(a){throw i=x(i,a),i}finally{!i&&!1===(null===e||void 0===e?void 0:e.destroyOnReturn)||void 0!==i&&!t._readableState.autoDestroy?(t.off("readable",n),s()):T.destroyer(t,null)}})).apply(this,arguments)}function lt(t,e){if(0===e.length)return null;let r;return e.objectMode?r=e.buffer.shift():!t||t>=e.length?(r=e.decoder?e.buffer.join(""):1===e.buffer.length?e.buffer.first():e.buffer.concat(e.length),e.buffer.clear()):r=e.buffer.consume(t,e.decoder),r}function ct(t){let e=t._readableState;E("endReadable",e.endEmitted),e.endEmitted||(e.ended=!0,r.nextTick(ut,e,t))}function ut(t,e){if(E("endReadableNT",t.endEmitted,t.length),!t.errored&&!t.closeEmitted&&!t.endEmitted&&0===t.length)if(t.endEmitted=!0,e.emit("end"),e.writable&&!1===e.allowHalfOpen)r.nextTick(ht,e);else if(t.autoDestroy){let t=e._writableState;(!t||t.autoDestroy&&(t.finished||!1===t.writable))&&e.destroy()}}function ht(t){t.writable&&!t.writableEnded&&!t.destroyed&&t.end()}function dt(){return void 0===X&&(X={}),X}q.prototype.read=function(t){E("read",t),void 0===t?t=NaN:i(t)||(t=a(t,10));let e=this._readableState,r=t;if(t>e.highWaterMark&&(e.highWaterMark=function(t){if(t>1073741824)throw new L("size","<= 1GiB",t);return t--,t|=t>>>1,t|=t>>>2,t|=t>>>4,t|=t>>>8,t|=t>>>16,++t}(t)),0!==t&&(e.state&=-129),0===t&&e.needReadable&&((0!==e.highWaterMark?e.length>=e.highWaterMark:e.length>0)||e.ended))return E("read: emitReadable",e.length,e.ended),0===e.length&&e.ended?ct(this):Z(this),null;if(0===(t=$(t,e))&&e.ended)return 0===e.length&&ct(this),null;let n,s=0!==(64&e.state);if(E("need readable",s),(0===e.length||e.length-t<e.highWaterMark)&&(s=!0,E("length less than watermark",s)),e.ended||e.reading||e.destroyed||e.errored||!e.constructed)s=!1,E("reading, ended or constructing",s);else if(s){E("do read"),e.state|=8|W,0===e.length&&(e.state|=64);try{this._read(e.highWaterMark)}catch(o){B(this,o)}e.state&=~W,e.reading||(t=$(r,e))}return n=t>0?lt(t,e):null,null===n?(e.needReadable=e.length<=e.highWaterMark,t=0):(e.length-=t,e.multiAwaitDrain?e.awaitDrainWriters.clear():e.awaitDrainWriters=null),0===e.length&&(e.ended||(e.needReadable=!0),r!==t&&e.ended&&ct(this)),null!==n&&!e.errorEmitted&&!e.closeEmitted&&(e.dataEmitted=!0,this.emit("data",n)),n},q.prototype._read=function(t){throw new R("_read()")},q.prototype.pipe=function(t,e){let n=this,i=this._readableState;1===i.pipes.length&&(i.multiAwaitDrain||(i.multiAwaitDrain=!0,i.awaitDrainWriters=new d(i.awaitDrainWriters?[i.awaitDrainWriters]:[]))),i.pipes.push(t),E("pipe count=%d opts=%j",i.pipes.length,e);let s=e&&!1===e.end||t===r.stdout||t===r.stderr?m:o;function a(e,r){E("onunpipe"),e===n&&r&&!1===r.hasUnpiped&&(r.hasUnpiped=!0,E("cleanup"),t.removeListener("close",p),t.removeListener("finish",g),l&&t.removeListener("drain",l),t.removeListener("error",f),t.removeListener("unpipe",a),n.removeListener("end",o),n.removeListener("end",m),n.removeListener("data",h),c=!0,l&&i.awaitDrainWriters&&(!t._writableState||t._writableState.needDrain)&&l())}function o(){E("onend"),t.end()}i.endEmitted?r.nextTick(s):n.once("end",s),t.on("unpipe",a);let l,c=!1;function u(){c||(1===i.pipes.length&&i.pipes[0]===t?(E("false write response, pause",0),i.awaitDrainWriters=t,i.multiAwaitDrain=!1):i.pipes.length>1&&i.pipes.includes(t)&&(E("false write response, pause",i.awaitDrainWriters.size),i.awaitDrainWriters.add(t)),n.pause()),l||(l=function(t,e){return function(){let r=t._readableState;r.awaitDrainWriters===e?(E("pipeOnDrain",1),r.awaitDrainWriters=null):r.multiAwaitDrain&&(E("pipeOnDrain",r.awaitDrainWriters.size),r.awaitDrainWriters.delete(e)),(!r.awaitDrainWriters||0===r.awaitDrainWriters.size)&&t.listenerCount("data")&&t.resume()}}(n,t),t.on("drain",l))}function h(e){E("ondata");let r=t.write(e);E("dest.write",r),!1===r&&u()}function f(e){if(E("onerror",e),m(),t.removeListener("error",f),0===t.listenerCount("error")){let r=t._writableState||t._readableState;r&&!r.errorEmitted?B(t,e):t.emit("error",e)}}function p(){t.removeListener("finish",g),m()}function g(){E("onfinish"),t.removeListener("close",p),m()}function m(){E("unpipe"),n.unpipe(t)}return n.on("data",h),v(t,"error",f),t.once("close",p),t.once("finish",g),t.emit("pipe",n),!0===t.writableNeedDrain?u():i.flowing||(E("pipe resume"),n.resume()),t},q.prototype.unpipe=function(t){let e=this._readableState;if(0===e.pipes.length)return this;if(!t){let t=e.pipes;e.pipes=[],this.pause();for(let e=0;e<t.length;e++)t[e].emit("unpipe",this,{hasUnpiped:!1});return this}let r=n(e.pipes,t);return-1===r||(e.pipes.splice(r,1),0===e.pipes.length&&this.pause(),t.emit("unpipe",this,{hasUnpiped:!1})),this},q.prototype.on=function(t,e){let n=y.prototype.on.call(this,t,e),i=this._readableState;return"data"===t?(i.readableListening=this.listenerCount("readable")>0,!1!==i.flowing&&this.resume()):"readable"===t&&!i.endEmitted&&!i.readableListening&&(i.readableListening=i.needReadable=!0,i.flowing=!1,i.emittedReadable=!1,E("on readable",i.length,i.reading),i.length?Z(this):i.reading||r.nextTick(nt,this)),n},q.prototype.addListener=q.prototype.on,q.prototype.removeListener=function(t,e){let n=y.prototype.removeListener.call(this,t,e);return"readable"===t&&r.nextTick(rt,this),n},q.prototype.off=q.prototype.removeListener,q.prototype.removeAllListeners=function(t){let e=y.prototype.removeAllListeners.apply(this,arguments);return("readable"===t||void 0===t)&&r.nextTick(rt,this),e},q.prototype.resume=function(){let t=this._readableState;return t.flowing||(E("resume"),t.flowing=!t.readableListening,function(t,e){e.resumeScheduled||(e.resumeScheduled=!0,r.nextTick(it,t,e))}(this,t)),t[D]=!1,this},q.prototype.pause=function(){return E("call pause flowing=%j",this._readableState.flowing),!1!==this._readableState.flowing&&(E("pause"),this._readableState.flowing=!1,this.emit("pause")),this._readableState[D]=!0,this},q.prototype.wrap=function(t){let e=!1;t.on("data",r=>{!this.push(r)&&t.pause&&(e=!0,t.pause())}),t.on("end",()=>{this.push(null)}),t.on("error",t=>{B(this,t)}),t.on("close",()=>{this.destroy()}),t.on("destroy",()=>{this.destroy()}),this._read=()=>{e&&t.resume&&(e=!1,t.resume())};let r=l(t);for(let n=1;n<r.length;n++){let e=r[n];void 0===this[e]&&"function"==typeof t[e]&&(this[e]=t[e].bind(t))}return this},q.prototype[p]=function(){return at(this)},q.prototype.iterator=function(t){return void 0!==t&&O(t,"options"),at(this,t)},o(q.prototype,{readable:{__proto__:null,get(){let t=this._readableState;return!!t&&!1!==t.readable&&!t.destroyed&&!t.errorEmitted&&!t.endEmitted},set(t){this._readableState&&(this._readableState.readable=!!t)}},readableDidRead:{__proto__:null,enumerable:!1,get:function(){return this._readableState.dataEmitted}},readableAborted:{__proto__:null,enumerable:!1,get:function(){return!(!1===this._readableState.readable||!this._readableState.destroyed&&!this._readableState.errored||this._readableState.endEmitted)}},readableHighWaterMark:{__proto__:null,enumerable:!1,get:function(){return this._readableState.highWaterMark}},readableBuffer:{__proto__:null,enumerable:!1,get:function(){return this._readableState&&this._readableState.buffer}},readableFlowing:{__proto__:null,enumerable:!1,get:function(){return this._readableState.flowing},set:function(t){this._readableState&&(this._readableState.flowing=t)}},readableLength:{__proto__:null,enumerable:!1,get(){return this._readableState.length}},readableObjectMode:{__proto__:null,enumerable:!1,get(){return!!this._readableState&&this._readableState.objectMode}},readableEncoding:{__proto__:null,enumerable:!1,get(){return this._readableState?this._readableState.encoding:null}},errored:{__proto__:null,enumerable:!1,get(){return this._readableState?this._readableState.errored:null}},closed:{__proto__:null,get(){return!!this._readableState&&this._readableState.closed}},destroyed:{__proto__:null,enumerable:!1,get(){return!!this._readableState&&this._readableState.destroyed},set(t){this._readableState&&(this._readableState.destroyed=t)}},readableEnded:{__proto__:null,enumerable:!1,get(){return!!this._readableState&&this._readableState.endEmitted}}}),o(K.prototype,{pipesCount:{__proto__:null,get(){return this.pipes.length}},paused:{__proto__:null,get(){return!1!==this[D]},set(t){this[D]=!!t}}}),q._fromList=lt,q.from=function(t,e){return F(q,t,e)},q.fromWeb=function(t,e){return dt().newStreamReadableFromReadableStream(t,e)},q.toWeb=function(t,e){return dt().newReadableStreamFromStreamReadable(t,e)},q.wrap=function(t,e){var r,n;return new q(c(c({objectMode:null===(r=null!==(n=t.readableObjectMode)&&void 0!==n?n:t.objectMode)||void 0===r||r},e),{},{destroy(e,r){T.destroyer(t,e),r(e)}})).wrap(t)}}),Ji=kr((t,e)=>{Ir(),Ei(),oi();var r=zi(),{ArrayPrototypeSlice:n,Error:i,FunctionPrototypeSymbolHasInstance:s,ObjectDefineProperty:a,ObjectDefineProperties:o,ObjectSetPrototypeOf:l,StringPrototypeToLowerCase:c,Symbol:u,SymbolHasInstance:h}=Si();e.exports=M,M.WritableState=P;var{EventEmitter:d}=(Ui(),xr(xi)),f=Hi().Stream,{Buffer:p}=(wi(),xr(mi)),g=Vi(),{addAbortSignal:m}=Ki(),{getHighWaterMark:y,getDefaultHighWaterMark:v}=Yi(),{ERR_INVALID_ARG_TYPE:b,ERR_METHOD_NOT_IMPLEMENTED:_,ERR_MULTIPLE_CALLBACK:w,ERR_STREAM_CANNOT_PIPE:E,ERR_STREAM_DESTROYED:S,ERR_STREAM_ALREADY_FINISHED:T,ERR_STREAM_NULL_VALUES:k,ERR_STREAM_WRITE_AFTER_END:A,ERR_UNKNOWN_ENCODING:x}=ki().codes,{errorOrDestroy:I}=g;function R(){}l(M.prototype,f.prototype),l(M,f);var L=u("kOnFinished");function P(t,e,r){"boolean"!=typeof r&&(r=e instanceof es()),this.objectMode=!(!t||!t.objectMode),r&&(this.objectMode=this.objectMode||!(!t||!t.writableObjectMode)),this.highWaterMark=t?y(this,t,"writableHighWaterMark",r):v(!1),this.finalCalled=!1,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1,this.destroyed=!1;let n=!(!t||!1!==t.decodeStrings);this.decodeStrings=!n,this.defaultEncoding=t&&t.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.corked=0,this.sync=!0,this.bufferProcessing=!1,this.onwrite=F.bind(void 0,e),this.writecb=null,this.writelen=0,this.afterWriteTickInfo=null,C(this),this.pendingcb=0,this.constructed=!0,this.prefinished=!1,this.errorEmitted=!1,this.emitClose=!t||!1!==t.emitClose,this.autoDestroy=!t||!1!==t.autoDestroy,this.errored=null,this.closed=!1,this.closeEmitted=!1,this[L]=[]}function C(t){t.buffered=[],t.bufferedIndex=0,t.allBuffers=!0,t.allNoop=!0}function M(t){let e=this instanceof es();if(!e&&!s(M,this))return new M(t);this._writableState=new P(t,this,e),t&&("function"==typeof t.write&&(this._write=t.write),"function"==typeof t.writev&&(this._writev=t.writev),"function"==typeof t.destroy&&(this._destroy=t.destroy),"function"==typeof t.final&&(this._final=t.final),"function"==typeof t.construct&&(this._construct=t.construct),t.signal&&m(t.signal,this)),f.call(this,t),g.construct(this,()=>{let t=this._writableState;t.writing||z(this,t),V(this,t)})}function O(t,e,n,i){let s,a=t._writableState;if("function"==typeof n)i=n,n=a.defaultEncoding;else{if(n){if("buffer"!==n&&!p.isEncoding(n))throw new x(n)}else n=a.defaultEncoding;"function"!=typeof i&&(i=R)}if(null===e)throw new k;if(!a.objectMode)if("string"==typeof e)!1!==a.decodeStrings&&(e=p.from(e,n),n="buffer");else if(e instanceof p)n="buffer";else{if(!f._isUint8Array(e))throw new b("chunk",["string","Buffer","Uint8Array"],e);e=f._uint8ArrayToBuffer(e),n="buffer"}return a.ending?s=new A:a.destroyed&&(s=new S("write")),s?(r.nextTick(i,s),I(t,s,!0),s):(a.pendingcb++,function(t,e,r,n,i){let s=e.objectMode?1:r.length;e.length+=s;let a=e.length<e.highWaterMark;return a||(e.needDrain=!0),e.writing||e.corked||e.errored||!e.constructed?(e.buffered.push({chunk:r,encoding:n,callback:i}),e.allBuffers&&"buffer"!==n&&(e.allBuffers=!1),e.allNoop&&i!==R&&(e.allNoop=!1)):(e.writelen=s,e.writecb=i,e.writing=!0,e.sync=!0,t._write(r,n,e.onwrite),e.sync=!1),a&&!e.errored&&!e.destroyed}(t,a,e,n,i))}function D(t,e,r,n,i,s,a){e.writelen=n,e.writecb=a,e.writing=!0,e.sync=!0,e.destroyed?e.onwrite(new S("write")):r?t._writev(i,e.onwrite):t._write(i,s,e.onwrite),e.sync=!1}function N(t,e,r,n){--e.pendingcb,n(r),j(e),I(t,r)}function F(t,e){let n=t._writableState,i=n.sync,s=n.writecb;"function"==typeof s?(n.writing=!1,n.writecb=null,n.length-=n.writelen,n.writelen=0,e?(e.stack,n.errored||(n.errored=e),t._readableState&&!t._readableState.errored&&(t._readableState.errored=e),i?r.nextTick(N,t,n,e,s):N(t,n,e,s)):(n.buffered.length>n.bufferedIndex&&z(t,n),i?null!==n.afterWriteTickInfo&&n.afterWriteTickInfo.cb===s?n.afterWriteTickInfo.count++:(n.afterWriteTickInfo={count:1,cb:s,stream:t,state:n},r.nextTick(U,n.afterWriteTickInfo)):B(t,n,1,s))):I(t,new w)}function U(t){let{stream:e,state:r,count:n,cb:i}=t;return r.afterWriteTickInfo=null,B(e,r,n,i)}function B(t,e,r,n){for(!e.ending&&!t.destroyed&&0===e.length&&e.needDrain&&(e.needDrain=!1,t.emit("drain"));r-- >0;)e.pendingcb--,n();e.destroyed&&j(e),V(t,e)}function j(t){if(t.writing)return;for(let i=t.bufferedIndex;i<t.buffered.length;++i){var e;let{chunk:r,callback:n}=t.buffered[i],s=t.objectMode?1:r.length;t.length-=s,n(null!==(e=t.errored)&&void 0!==e?e:new S("write"))}let r=t[L].splice(0);for(let i=0;i<r.length;i++){var n;r[i](null!==(n=t.errored)&&void 0!==n?n:new S("end"))}C(t)}function z(t,e){if(e.corked||e.bufferProcessing||e.destroyed||!e.constructed)return;let{buffered:r,bufferedIndex:i,objectMode:s}=e,a=r.length-i;if(!a)return;let o=i;if(e.bufferProcessing=!0,a>1&&t._writev){e.pendingcb-=a-1;let i=e.allNoop?R:t=>{for(let e=o;e<r.length;++e)r[e].callback(t)},s=e.allNoop&&0===o?r:n(r,o);s.allBuffers=e.allBuffers,D(t,e,!0,e.length,s,"",i),C(e)}else{do{let{chunk:n,encoding:i,callback:a}=r[o];r[o++]=null,D(t,e,!1,s?1:n.length,n,i,a)}while(o<r.length&&!e.writing);o===r.length?C(e):o>256?(r.splice(0,o),e.bufferedIndex=0):e.bufferedIndex=o}e.bufferProcessing=!1}function W(t){return t.ending&&!t.destroyed&&t.constructed&&0===t.length&&!t.errored&&0===t.buffered.length&&!t.finished&&!t.writing&&!t.errorEmitted&&!t.closeEmitted}function G(t,e){!e.prefinished&&!e.finalCalled&&("function"!=typeof t._final||e.destroyed?(e.prefinished=!0,t.emit("prefinish")):(e.finalCalled=!0,function(t,e){let n=!1;function i(i){if(n)I(t,null!==i&&void 0!==i?i:w());else if(n=!0,e.pendingcb--,i){let r=e[L].splice(0);for(let t=0;t<r.length;t++)r[t](i);I(t,i,e.sync)}else W(e)&&(e.prefinished=!0,t.emit("prefinish"),e.pendingcb++,r.nextTick(H,t,e))}e.sync=!0,e.pendingcb++;try{t._final(i)}catch(s){i(s)}e.sync=!1}(t,e)))}function V(t,e,n){W(e)&&(G(t,e),0===e.pendingcb&&(n?(e.pendingcb++,r.nextTick((t,e)=>{W(e)?H(t,e):e.pendingcb--},t,e)):W(e)&&(e.pendingcb++,H(t,e))))}function H(t,e){e.pendingcb--,e.finished=!0;let r=e[L].splice(0);for(let n=0;n<r.length;n++)r[n]();if(t.emit("finish"),e.autoDestroy){let e=t._readableState;(!e||e.autoDestroy&&(e.endEmitted||!1===e.readable))&&t.destroy()}}P.prototype.getBuffer=function(){return n(this.buffered,this.bufferedIndex)},a(P.prototype,"bufferedRequestCount",{__proto__:null,get(){return this.buffered.length-this.bufferedIndex}}),a(M,h,{__proto__:null,value:function(t){return!!s(this,t)||this===M&&(t&&t._writableState instanceof P)}}),M.prototype.pipe=function(){I(this,new E)},M.prototype.write=function(t,e,r){return!0===O(this,t,e,r)},M.prototype.cork=function(){this._writableState.corked++},M.prototype.uncork=function(){let t=this._writableState;t.corked&&(t.corked--,t.writing||z(this,t))},M.prototype.setDefaultEncoding=function(t){if("string"==typeof t&&(t=c(t)),!p.isEncoding(t))throw new x(t);return this._writableState.defaultEncoding=t,this},M.prototype._write=function(t,e,r){if(!this._writev)throw new _("_write()");this._writev([{chunk:t,encoding:e}],r)},M.prototype._writev=null,M.prototype.end=function(t,e,n){let s,a=this._writableState;if("function"==typeof t?(n=t,t=null,e=null):"function"==typeof e&&(n=e,e=null),null!=t){let r=O(this,t,e);r instanceof i&&(s=r)}return a.corked&&(a.corked=1,this.uncork()),s||(a.errored||a.ending?a.finished?s=new T("end"):a.destroyed&&(s=new S("end")):(a.ending=!0,V(this,a,!0),a.ended=!0)),"function"==typeof n&&(s||a.finished?r.nextTick(n,s):a[L].push(n)),this},o(M.prototype,{closed:{__proto__:null,get(){return!!this._writableState&&this._writableState.closed}},destroyed:{__proto__:null,get(){return!!this._writableState&&this._writableState.destroyed},set(t){this._writableState&&(this._writableState.destroyed=t)}},writable:{__proto__:null,get(){let t=this._writableState;return!!t&&!1!==t.writable&&!t.destroyed&&!t.errored&&!t.ending&&!t.ended},set(t){this._writableState&&(this._writableState.writable=!!t)}},writableFinished:{__proto__:null,get(){return!!this._writableState&&this._writableState.finished}},writableObjectMode:{__proto__:null,get(){return!!this._writableState&&this._writableState.objectMode}},writableBuffer:{__proto__:null,get(){return this._writableState&&this._writableState.getBuffer()}},writableEnded:{__proto__:null,get(){return!!this._writableState&&this._writableState.ending}},writableNeedDrain:{__proto__:null,get(){let t=this._writableState;return!!t&&(!t.destroyed&&!t.ending&&t.needDrain)}},writableHighWaterMark:{__proto__:null,get(){return this._writableState&&this._writableState.highWaterMark}},writableCorked:{__proto__:null,get(){return this._writableState?this._writableState.corked:0}},writableLength:{__proto__:null,get(){return this._writableState&&this._writableState.length}},errored:{__proto__:null,enumerable:!1,get(){return this._writableState?this._writableState.errored:null}},writableAborted:{__proto__:null,enumerable:!1,get:function(){return!(!1===this._writableState.writable||!this._writableState.destroyed&&!this._writableState.errored||this._writableState.finished)}}});var K,q=g.destroy;function Y(){return void 0===K&&(K={}),K}M.prototype.destroy=function(t,e){let n=this._writableState;return!n.destroyed&&(n.bufferedIndex<n.buffered.length||n[L].length)&&r.nextTick(j,n),q.call(this,t,e),this},M.prototype._undestroy=g.undestroy,M.prototype._destroy=function(t,e){e(t)},M.prototype[d.captureRejectionSymbol]=function(t){this.destroy(t)},M.fromWeb=function(t,e){return Y().newStreamWritableFromWritableStream(t,e)},M.toWeb=function(t){return Y().newWritableStreamFromStreamWritable(t)}}),ts=kr((t,e)=>{Ir(),Ei(),oi();var r=zi(),n=(wi(),xr(mi)),{isReadable:i,isWritable:s,isIterable:a,isNodeStream:o,isReadableNodeStream:l,isWritableNodeStream:c,isDuplexNodeStream:u,isReadableStream:h,isWritableStream:d}=Wi(),f=Gi(),{AbortError:p,codes:{ERR_INVALID_ARG_TYPE:g,ERR_INVALID_RETURN_VALUE:m}}=ki(),{destroyer:y}=Vi(),v=es(),b=Zi(),_=Ji(),{createDeferredPromise:w}=Bi(),E=$i(),S=globalThis.Blob||n.Blob,T=typeof S<"u"?function(t){return t instanceof S}:function(t){return!1},k=globalThis.AbortController||Ai().AbortController,{FunctionPrototypeCall:A}=Si(),x=class extends v{constructor(t){super(t),!1===(null===t||void 0===t?void 0:t.readable)&&(this._readableState.readable=!1,this._readableState.ended=!0,this._readableState.endEmitted=!0),!1===(null===t||void 0===t?void 0:t.writable)&&(this._writableState.writable=!1,this._writableState.ending=!0,this._writableState.ended=!0,this._writableState.finished=!0)}};function I(t){let e,r,n,a,o,l=t.readable&&"function"!=typeof t.readable.read?b.wrap(t.readable):t.readable,c=t.writable,u=!!i(l),h=!!s(c);function d(t){let e=a;a=null,e?e(t):t&&o.destroy(t)}return o=new x({readableObjectMode:!(null==l||!l.readableObjectMode),writableObjectMode:!(null==c||!c.writableObjectMode),readable:u,writable:h}),h&&(f(c,t=>{h=!1,t&&y(l,t),d(t)}),o._write=function(t,r,n){c.write(t,r)?n():e=n},o._final=function(t){c.end(),r=t},c.on("drain",function(){if(e){let t=e;e=null,t()}}),c.on("finish",function(){if(r){let t=r;r=null,t()}})),u&&(f(l,t=>{u=!1,t&&y(l,t),d(t)}),l.on("readable",function(){if(n){let t=n;n=null,t()}}),l.on("end",function(){o.push(null)}),o._read=function(){for(;;){let t=l.read();if(null===t)return void(n=o._read);if(!o.push(t))return}}),o._destroy=function(t,i){!t&&null!==a&&(t=new p),n=null,e=null,r=null,null===a?i(t):(a=i,y(c,t),y(l,t))},o}e.exports=function t(e,n){if(u(e))return e;if(l(e))return I({readable:e});if(c(e))return I({writable:e});if(o(e))return I({writable:!1,readable:!1});if(h(e))return I({readable:b.fromWeb(e)});if(d(e))return I({writable:_.fromWeb(e)});if("function"==typeof e){let{value:t,write:i,final:s,destroy:o}=function(t){let{promise:e,resolve:n}=w(),i=new k,s=i.signal;return{value:t(mr(function*(){for(;;){let t=e;e=null;let{chunk:i,done:a,cb:o}=yield gr(t);if(r.nextTick(o),a)return;if(s.aborted)throw new p(void 0,{cause:s.reason});({promise:e,resolve:n}=w()),yield i}})(),{signal:s}),write(t,e,r){let i=n;n=null,i({chunk:t,done:!1,cb:r})},final(t){let e=n;n=null,e({done:!0,cb:t})},destroy(t,e){i.abort(),e(t)}}}(e);if(a(t))return E(x,t,{objectMode:!0,write:i,final:s,destroy:o});let l=null===t||void 0===t?void 0:t.then;if("function"==typeof l){let e,n=A(l,t,t=>{if(null!=t)throw new m("nully","body",t)},t=>{y(e,t)});return e=new x({objectMode:!0,readable:!1,write:i,final(t){s(async()=>{try{await n,r.nextTick(t,null)}catch(e){r.nextTick(t,e)}})},destroy:o})}throw new m("Iterable, AsyncIterable or AsyncFunction",n,t)}if(T(e))return t(e.arrayBuffer());if(a(e))return E(x,e,{objectMode:!0,writable:!1});if(h(null===e||void 0===e?void 0:e.readable)&&d(null===e||void 0===e?void 0:e.writable))return x.fromWeb(e);if("object"==typeof(null===e||void 0===e?void 0:e.writable)||"object"==typeof(null===e||void 0===e?void 0:e.readable)){return I({readable:null!=e&&e.readable?l(null===e||void 0===e?void 0:e.readable)?null===e||void 0===e?void 0:e.readable:t(e.readable):void 0,writable:null!=e&&e.writable?c(null===e||void 0===e?void 0:e.writable)?null===e||void 0===e?void 0:e.writable:t(e.writable):void 0})}let i=null===e||void 0===e?void 0:e.then;if("function"==typeof i){let t;return A(i,e,e=>{null!=e&&t.push(e),t.push(null)},e=>{y(t,e)}),t=new x({objectMode:!0,writable:!1,read(){}})}throw new g(n,["Blob","ReadableStream","WritableStream","Stream","Iterable","AsyncIterable","Function","{ readable, writable } pair","Promise"],e)}}),es=kr((t,e)=>{Ir(),Ei(),oi();var{ObjectDefineProperties:r,ObjectGetOwnPropertyDescriptor:n,ObjectKeys:i,ObjectSetPrototypeOf:s}=Si();e.exports=h;var a,o,l=Zi(),u=Ji();s(h.prototype,l.prototype),s(h,l);{let t=i(u.prototype);for(let e=0;e<t.length;e++){let r=t[e];h.prototype[r]||(h.prototype[r]=u.prototype[r])}}function h(t){if(!(this instanceof h))return new h(t);l.call(this,t),u.call(this,t),t?(this.allowHalfOpen=!1!==t.allowHalfOpen,!1===t.readable&&(this._readableState.readable=!1,this._readableState.ended=!0,this._readableState.endEmitted=!0),!1===t.writable&&(this._writableState.writable=!1,this._writableState.ending=!0,this._writableState.ended=!0,this._writableState.finished=!0)):this.allowHalfOpen=!0}function d(){return void 0===a&&(a={}),a}r(h.prototype,{writable:c({__proto__:null},n(u.prototype,"writable")),writableHighWaterMark:c({__proto__:null},n(u.prototype,"writableHighWaterMark")),writableObjectMode:c({__proto__:null},n(u.prototype,"writableObjectMode")),writableBuffer:c({__proto__:null},n(u.prototype,"writableBuffer")),writableLength:c({__proto__:null},n(u.prototype,"writableLength")),writableFinished:c({__proto__:null},n(u.prototype,"writableFinished")),writableCorked:c({__proto__:null},n(u.prototype,"writableCorked")),writableEnded:c({__proto__:null},n(u.prototype,"writableEnded")),writableNeedDrain:c({__proto__:null},n(u.prototype,"writableNeedDrain")),destroyed:{__proto__:null,get(){return void 0!==this._readableState&&void 0!==this._writableState&&(this._readableState.destroyed&&this._writableState.destroyed)},set(t){this._readableState&&this._writableState&&(this._readableState.destroyed=t,this._writableState.destroyed=t)}}}),h.fromWeb=function(t,e){return d().newStreamDuplexFromReadableWritablePair(t,e)},h.toWeb=function(t){return d().newReadableWritablePairFromDuplex(t)},h.from=function(t){return o||(o=ts()),o(t,"body")}}),rs=kr((t,e)=>{Ir(),Ei(),oi();var{ObjectSetPrototypeOf:r,Symbol:n}=Si();e.exports=l;var{ERR_METHOD_NOT_IMPLEMENTED:i}=ki().codes,s=es(),{getHighWaterMark:a}=Yi();r(l.prototype,s.prototype),r(l,s);var o=n("kCallback");function l(t){if(!(this instanceof l))return new l(t);let e=t?a(this,t,"readableHighWaterMark",!0):null;0===e&&(t=c(c({},t),{},{highWaterMark:null,readableHighWaterMark:e,writableHighWaterMark:t.writableHighWaterMark||0})),s.call(this,t),this._readableState.sync=!1,this[o]=null,t&&("function"==typeof t.transform&&(this._transform=t.transform),"function"==typeof t.flush&&(this._flush=t.flush)),this.on("prefinish",h)}function u(t){"function"!=typeof this._flush||this.destroyed?(this.push(null),t&&t()):this._flush((e,r)=>{e?t?t(e):this.destroy(e):(null!=r&&this.push(r),this.push(null),t&&t())})}function h(){this._final!==u&&u.call(this)}l.prototype._final=u,l.prototype._transform=function(t,e,r){throw new i("_transform()")},l.prototype._write=function(t,e,r){let n=this._readableState,i=this._writableState,s=n.length;this._transform(t,e,(t,e)=>{t?r(t):(null!=e&&this.push(e),i.ended||s===n.length||n.length<n.highWaterMark?r():this[o]=r)})},l.prototype._read=function(){if(this[o]){let t=this[o];this[o]=null,t()}}}),ns=kr((t,e)=>{Ir(),Ei(),oi();var{ObjectSetPrototypeOf:r}=Si();e.exports=i;var n=rs();function i(t){if(!(this instanceof i))return new i(t);n.call(this,t)}r(i.prototype,n.prototype),r(i,n),i.prototype._transform=function(t,e,r){r(null,t)}}),is=kr((t,e)=>{Ir(),Ei(),oi();var r,n,i,s=zi(),{ArrayIsArray:a,Promise:o,SymbolAsyncIterator:l,SymbolDispose:c}=Si(),u=Gi(),{once:h}=Bi(),d=Vi(),f=es(),{aggregateTwoErrors:p,codes:{ERR_INVALID_ARG_TYPE:g,ERR_INVALID_RETURN_VALUE:m,ERR_MISSING_ARGS:y,ERR_STREAM_DESTROYED:v,ERR_STREAM_PREMATURE_CLOSE:b},AbortError:_}=ki(),{validateFunction:w,validateAbortSignal:E}=ji(),{isIterable:S,isReadable:T,isReadableNodeStream:k,isNodeStream:A,isTransformStream:x,isWebStream:I,isReadableStream:R,isReadableFinished:L}=Wi(),P=globalThis.AbortController||Ai().AbortController;function C(t,e,r){let n=!1;return t.on("close",()=>{n=!0}),{destroy:e=>{n||(n=!0,d.destroyer(t,e||new v("pipe")))},cleanup:u(t,{readable:e,writable:r},t=>{n=!t})}}function M(t){if(S(t))return t;if(k(t))return function(t){return O.apply(this,arguments)}(t);throw new g("val",["Readable","Iterable","AsyncIterable"],t)}function O(){return(O=mr(function*(t){n||(n=Zi()),yield*dr(fr(n.prototype[l].call(t)))})).apply(this,arguments)}async function D(t,e,r,n){let i,{end:s}=n,a=null,l=t=>{if(t&&(i=t),a){let t=a;a=null,t()}},c=()=>new o((t,e)=>{i?e(i):a=()=>{i?e(i):t()}});e.on("drain",l);let h=u(e,{readable:!1},l);try{e.writableNeedDrain&&await c();var d,f=!1,g=!1;try{for(var m,y=fr(t);f=!(m=await y.next()).done;f=!1){let t=m.value;e.write(t)||await c()}}catch(Dd){g=!0,d=Dd}finally{try{f&&null!=y.return&&await y.return()}finally{if(g)throw d}}s&&(e.end(),await c()),r()}catch(v){r(i!==v?p(i,v):v)}finally{h(),e.off("drain",l)}}async function N(t,e,r,n){let{end:i}=n;x(e)&&(e=e.writable);let s=e.getWriter();try{var a,o=!1,l=!1;try{for(var c,u=fr(t);o=!(c=await u.next()).done;o=!1){let t=c.value;await s.ready,s.write(t).catch(()=>{})}}catch(Dd){l=!0,a=Dd}finally{try{o&&null!=u.return&&await u.return()}finally{if(l)throw a}}await s.ready,i&&await s.close(),r()}catch(h){try{await s.abort(h),r(h)}catch(d){r(d)}}}function F(t,e,n){if(1===t.length&&a(t[0])&&(t=t[0]),t.length<2)throw new y("streams");let o,l=new P,u=l.signal,h=null===n||void 0===n?void 0:n.signal,d=[];function p(){B(new _)}E(h,"options.signal"),i=i||Bi().addAbortListener,h&&(o=i(h,p));let v,b,w,L=[],O=0;function F(t){B(t,0===--O)}function B(t,r){var n;if(t&&(!v||"ERR_STREAM_PREMATURE_CLOSE"===v.code)&&(v=t),v||r){for(;L.length;)L.shift()(v);null===(n=o)||void 0===n||n[c](),l.abort(),r&&(v||d.forEach(t=>t()),s.nextTick(e,v,b))}}for(let i=0;i<t.length;i++){let e=t[i],a=i<t.length-1,o=i>0,l=a||!1!==(null===n||void 0===n?void 0:n.end),c=i===t.length-1;if(A(e)){let t=function(t){t&&"AbortError"!==t.name&&"ERR_STREAM_PREMATURE_CLOSE"!==t.code&&F(t)};if(l){let{destroy:t,cleanup:r}=C(e,a,o);L.push(t),T(e)&&c&&d.push(r)}e.on("error",t),T(e)&&c&&d.push(()=>{e.removeListener("error",t)})}if(0===i)if("function"==typeof e){if(w=e({signal:u}),!S(w))throw new m("Iterable, AsyncIterable or Stream","source",w)}else w=S(e)||k(e)||x(e)?e:f.from(e);else if("function"==typeof e){var j;if(x(w))w=M(null===(j=w)||void 0===j?void 0:j.readable);else w=M(w);if(w=e(w,{signal:u}),a){if(!S(w,!0))throw new m("AsyncIterable","transform[".concat(i-1,"]"),w)}else{var z;r||(r=ns());let t=new r({objectMode:!0}),e=null===(z=w)||void 0===z?void 0:z.then;if("function"==typeof e)O++,e.call(w,e=>{b=e,null!=e&&t.write(e),l&&t.end(),s.nextTick(F)},e=>{t.destroy(e),s.nextTick(F,e)});else if(S(w,!0))O++,D(w,t,F,{end:l});else{if(!R(w)&&!x(w))throw new m("AsyncIterable or Promise","destination",w);{let e=w.readable||w;O++,D(e,t,F,{end:l})}}w=t;let{destroy:n,cleanup:i}=C(w,!1,!0);L.push(n),c&&d.push(i)}}else if(A(e)){if(k(w)){O+=2;let t=U(w,e,F,{end:l});T(e)&&c&&d.push(t)}else if(x(w)||R(w)){let t=w.readable||w;O++,D(t,e,F,{end:l})}else{if(!S(w))throw new g("val",["Readable","Iterable","AsyncIterable","ReadableStream","TransformStream"],w);O++,D(w,e,F,{end:l})}w=e}else if(I(e)){if(k(w))O++,N(M(w),e,F,{end:l});else if(R(w)||S(w))O++,N(w,e,F,{end:l});else{if(!x(w))throw new g("val",["Readable","Iterable","AsyncIterable","ReadableStream","TransformStream"],w);O++,N(w.readable,e,F,{end:l})}w=e}else w=f.from(e)}return(null!=u&&u.aborted||null!=h&&h.aborted)&&s.nextTick(p),w}function U(t,e,r,n){let{end:i}=n,a=!1;if(e.on("close",()=>{a||r(new b)}),t.pipe(e,{end:!1}),i){let r=function(){a=!0,e.end()};L(t)?s.nextTick(r):t.once("end",r)}else r();return u(t,{readable:!0,writable:!1},e=>{let n=t._readableState;e&&"ERR_STREAM_PREMATURE_CLOSE"===e.code&&n&&n.ended&&!n.errored&&!n.errorEmitted?t.once("end",r).once("error",r):r(e)}),u(e,{readable:!1,writable:!0},r)}e.exports={pipelineImpl:F,pipeline:function(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];return F(e,h(function(t){return w(t[t.length-1],"streams[stream.length - 1]"),t.pop()}(e)))}}}),ss=kr((t,e)=>{Ir(),Ei(),oi();var{pipeline:r}=is(),n=es(),{destroyer:i}=Vi(),{isNodeStream:s,isReadable:a,isWritable:o,isWebStream:l,isTransformStream:c,isWritableStream:u,isReadableStream:h}=Wi(),{AbortError:d,codes:{ERR_INVALID_ARG_VALUE:f,ERR_MISSING_ARGS:p}}=ki(),g=Gi();e.exports=function(){for(var t=arguments.length,e=new Array(t),m=0;m<t;m++)e[m]=arguments[m];if(0===e.length)throw new p("streams");if(1===e.length)return n.from(e[0]);let y,v,b,_,w,E=[...e];if("function"==typeof e[0]&&(e[0]=n.from(e[0])),"function"==typeof e[e.length-1]){let t=e.length-1;e[t]=n.from(e[t])}for(let r=0;r<e.length;++r)if(s(e[r])||l(e[r])){if(r<e.length-1&&!(a(e[r])||h(e[r])||c(e[r])))throw new f("streams[".concat(r,"]"),E[r],"must be readable");if(r>0&&!(o(e[r])||u(e[r])||c(e[r])))throw new f("streams[".concat(r,"]"),E[r],"must be writable")}let S=e[0],T=r(e,function(t){let e=_;_=null,e?e(t):t?w.destroy(t):!A&&!k&&w.destroy()}),k=!!(o(S)||u(S)||c(S)),A=!!(a(T)||h(T)||c(T));if(w=new n({writableObjectMode:!(null==S||!S.writableObjectMode),readableObjectMode:!(null==T||!T.readableObjectMode),writable:k,readable:A}),k){if(s(S))w._write=function(t,e,r){S.write(t,e)?r():y=r},w._final=function(t){S.end(),v=t},S.on("drain",function(){if(y){let t=y;y=null,t()}});else if(l(S)){let t=(c(S)?S.writable:S).getWriter();w._write=async function(e,r,n){try{await t.ready,t.write(e).catch(()=>{}),n()}catch(i){n(i)}},w._final=async function(e){try{await t.ready,t.close().catch(()=>{}),v=e}catch(r){e(r)}}}let t=c(T)?T.readable:T;g(t,()=>{if(v){let t=v;v=null,t()}})}if(A)if(s(T))T.on("readable",function(){if(b){let t=b;b=null,t()}}),T.on("end",function(){w.push(null)}),w._read=function(){for(;;){let t=T.read();if(null===t)return void(b=w._read);if(!w.push(t))return}};else if(l(T)){let t=(c(T)?T.readable:T).getReader();w._read=async function(){for(;;)try{let{value:e,done:r}=await t.read();if(!w.push(e))return;if(r)return void w.push(null)}catch(e){return}}}return w._destroy=function(t,e){!t&&null!==_&&(t=new d),b=null,y=null,v=null,null===_?e(t):(_=e,s(T)&&i(T,t))},w}}),as=kr((t,e)=>{Ir(),Ei(),oi();var r=globalThis.AbortController||Ai().AbortController,{codes:{ERR_INVALID_ARG_VALUE:n,ERR_INVALID_ARG_TYPE:i,ERR_MISSING_ARGS:s,ERR_OUT_OF_RANGE:a},AbortError:o}=ki(),{validateAbortSignal:l,validateInteger:c,validateObject:u}=ji(),h=Si().Symbol("kWeak"),d=Si().Symbol("kResistStopPropagation"),{finished:f}=Gi(),p=ss(),{addAbortSignalNoValidate:g}=Ki(),{isWritable:m,isNodeStream:y}=Wi(),{deprecate:v}=Bi(),{ArrayPrototypePush:b,Boolean:_,MathFloor:w,Number:E,NumberIsNaN:S,Promise:T,PromiseReject:k,PromiseResolve:A,PromisePrototypeThen:x,Symbol:I}=Si(),R=I("kEmpty"),L=I("kEof");function P(t,e){if("function"!=typeof t)throw new i("fn",["Function","AsyncFunction"],t);null!=e&&u(e,"options"),null!=(null===e||void 0===e?void 0:e.signal)&&l(e.signal,"options.signal");let r=1;null!=(null===e||void 0===e?void 0:e.concurrency)&&(r=w(e.concurrency));let n=r-1;return null!=(null===e||void 0===e?void 0:e.highWaterMark)&&(n=w(e.highWaterMark)),c(r,"options.concurrency",1),c(n,"options.highWaterMark",0),n+=r,mr(function*(){let i,s,a=Bi().AbortSignalAny([null===e||void 0===e?void 0:e.signal].filter(_)),l=this,c=[],u={signal:a},h=!1,d=0;function f(){h=!0,p()}function p(){d-=1,g()}function g(){s&&!h&&d<r&&c.length<n&&(s(),s=null)}!async function(){try{var e,g=!1,m=!1;try{for(var y,v=fr(l);g=!(y=await v.next()).done;g=!1){let e=y.value;if(h)return;if(a.aborted)throw new o;try{if(e=t(e,u),e===R)continue;e=A(e)}catch(b){e=k(b)}d+=1,x(e,p,f),c.push(e),i&&(i(),i=null),!h&&(c.length>=n||d>=r)&&await new T(t=>{s=t})}}catch(Dd){m=!0,e=Dd}finally{try{g&&null!=v.return&&await v.return()}finally{if(m)throw e}}c.push(L)}catch(_){let t=k(_);x(t,p,f),c.push(t)}finally{h=!0,i&&(i(),i=null)}}();try{for(;;){for(;c.length>0;){let t=yield gr(c[0]);if(t===L)return;if(a.aborted)throw new o;t!==R&&(yield t),c.shift(),g()}yield gr(new T(t=>{i=t}))}}finally{h=!0,s&&(s(),s=null)}}).call(this)}async function C(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0;var r,n=!1,i=!1;try{for(var s,a=fr(M.call(this,t,e));n=!(s=await a.next()).done;n=!1){s.value;return!0}}catch(Dd){i=!0,r=Dd}finally{try{n&&null!=a.return&&await a.return()}finally{if(i)throw r}}return!1}function M(t,e){if("function"!=typeof t)throw new i("fn",["Function","AsyncFunction"],t);return P.call(this,async function(e,r){return await t(e,r)?e:R},e)}var O=class extends s{constructor(){super("reduce"),this.message="Reduce of an empty stream requires an initial value"}};function D(t){if(t=E(t),S(t))return 0;if(t<0)throw new a("number",">= 0",t);return t}e.exports.streamReturningOperators={asIndexedPairs:v(function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:void 0;return null!=t&&u(t,"options"),null!=(null===t||void 0===t?void 0:t.signal)&&l(t.signal,"options.signal"),mr(function*(){let e=0;var r,n=!1,i=!1;try{for(var s,a=fr(this);n=!(s=yield gr(a.next())).done;n=!1){let r=s.value;var l;if(null!=t&&null!==(l=t.signal)&&void 0!==l&&l.aborted)throw new o({cause:t.signal.reason});yield[e++,r]}}catch(Dd){i=!0,r=Dd}finally{try{n&&null!=a.return&&(yield gr(a.return()))}finally{if(i)throw r}}}).call(this)},"readable.asIndexedPairs will be removed in a future version."),drop:function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0;return null!=e&&u(e,"options"),null!=(null===e||void 0===e?void 0:e.signal)&&l(e.signal,"options.signal"),t=D(t),mr(function*(){var r;if(null!=e&&null!==(r=e.signal)&&void 0!==r&&r.aborted)throw new o;var n,i=!1,s=!1;try{for(var a,l=fr(this);i=!(a=yield gr(l.next())).done;i=!1){let r=a.value;var c;if(null!=e&&null!==(c=e.signal)&&void 0!==c&&c.aborted)throw new o;t--<=0&&(yield r)}}catch(Dd){s=!0,n=Dd}finally{try{i&&null!=l.return&&(yield gr(l.return()))}finally{if(s)throw n}}}).call(this)},filter:M,flatMap:function(t,e){let r=P.call(this,t,e);return mr(function*(){var t,e=!1,n=!1;try{for(var i,s=fr(r);e=!(i=yield gr(s.next())).done;e=!1){let t=i.value;yield*dr(fr(t))}}catch(Dd){n=!0,t=Dd}finally{try{e&&null!=s.return&&(yield gr(s.return()))}finally{if(n)throw t}}}).call(this)},map:P,take:function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0;return null!=e&&u(e,"options"),null!=(null===e||void 0===e?void 0:e.signal)&&l(e.signal,"options.signal"),t=D(t),mr(function*(){var r;if(null!=e&&null!==(r=e.signal)&&void 0!==r&&r.aborted)throw new o;var n,i=!1,s=!1;try{for(var a,l=fr(this);i=!(a=yield gr(l.next())).done;i=!1){let r=a.value;var c;if(null!=e&&null!==(c=e.signal)&&void 0!==c&&c.aborted)throw new o;if(t-- >0&&(yield r),t<=0)return}}catch(Dd){s=!0,n=Dd}finally{try{i&&null!=l.return&&(yield gr(l.return()))}finally{if(s)throw n}}}).call(this)},compose:function(t,e){if(null!=e&&u(e,"options"),null!=(null===e||void 0===e?void 0:e.signal)&&l(e.signal,"options.signal"),y(t)&&!m(t))throw new n("stream",t,"must be writable");let r=p(this,t);return null!=e&&e.signal&&g(e.signal,r),r}},e.exports.promiseReturningOperators={every:async function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0;if("function"!=typeof t)throw new i("fn",["Function","AsyncFunction"],t);return!await C.call(this,async function(){return!await t(...arguments)},e)},forEach:async function(t,e){if("function"!=typeof t)throw new i("fn",["Function","AsyncFunction"],t);var r,n=!1,s=!1;try{for(var a,o=fr(P.call(this,async function(e,r){return await t(e,r),R},e));n=!(a=await o.next()).done;n=!1){a.value}}catch(Dd){s=!0,r=Dd}finally{try{n&&null!=o.return&&await o.return()}finally{if(s)throw r}}},reduce:async function(t,e,n){var s;if("function"!=typeof t)throw new i("reducer",["Function","AsyncFunction"],t);null!=n&&u(n,"options"),null!=(null===n||void 0===n?void 0:n.signal)&&l(n.signal,"options.signal");let a=arguments.length>1;if(null!=n&&null!==(s=n.signal)&&void 0!==s&&s.aborted){let t=new o(void 0,{cause:n.signal.reason});throw this.once("error",()=>{}),await f(this.destroy(t)),t}let c=new r,p=c.signal;if(null!=n&&n.signal){let t={once:!0,[h]:this,[d]:!0};n.signal.addEventListener("abort",()=>c.abort(),t)}let g=!1;try{var m,y=!1,v=!1;try{for(var b,_=fr(this);y=!(b=await _.next()).done;y=!1){let r=b.value;var w;if(g=!0,null!=n&&null!==(w=n.signal)&&void 0!==w&&w.aborted)throw new o;a?e=await t(e,r,{signal:p}):(e=r,a=!0)}}catch(Dd){v=!0,m=Dd}finally{try{y&&null!=_.return&&await _.return()}finally{if(v)throw m}}if(!g&&!a)throw new O}finally{c.abort()}return e},toArray:async function(t){null!=t&&u(t,"options"),null!=(null===t||void 0===t?void 0:t.signal)&&l(t.signal,"options.signal");let e=[];var r,n=!1,i=!1;try{for(var s,a=fr(this);n=!(s=await a.next()).done;n=!1){let r=s.value;var c;if(null!=t&&null!==(c=t.signal)&&void 0!==c&&c.aborted)throw new o(void 0,{cause:t.signal.reason});b(e,r)}}catch(Dd){i=!0,r=Dd}finally{try{n&&null!=a.return&&await a.return()}finally{if(i)throw r}}return e},some:C,find:async function(t,e){var r,n=!1,i=!1;try{for(var s,a=fr(M.call(this,t,e));n=!(s=await a.next()).done;n=!1){return s.value}}catch(Dd){i=!0,r=Dd}finally{try{n&&null!=a.return&&await a.return()}finally{if(i)throw r}}}}}),os=kr((t,e)=>{Ir(),Ei(),oi();var{ArrayPrototypePop:r,Promise:n}=Si(),{isIterable:i,isNodeStream:s,isWebStream:a}=Wi(),{pipelineImpl:o}=is(),{finished:l}=Gi();ls(),e.exports={finished:l,pipeline:function(){for(var t=arguments.length,e=new Array(t),l=0;l<t;l++)e[l]=arguments[l];return new n((t,n)=>{let l,c,u=e[e.length-1];if(u&&"object"==typeof u&&!s(u)&&!i(u)&&!a(u)){let t=r(e);l=t.signal,c=t.end}o(e,(e,r)=>{e?n(e):t(r)},{signal:l,end:c})})}}}),ls=kr((t,e)=>{Ir(),Ei(),oi();var{Buffer:r}=(wi(),xr(mi)),{ObjectDefineProperty:n,ObjectKeys:i,ReflectApply:s}=Si(),{promisify:{custom:a}}=Bi(),{streamReturningOperators:o,promiseReturningOperators:l}=as(),{codes:{ERR_ILLEGAL_CONSTRUCTOR:c}}=ki(),u=ss(),{setDefaultHighWaterMark:h,getDefaultHighWaterMark:d}=Yi(),{pipeline:f}=is(),{destroyer:p}=Vi(),g=Gi(),m=os(),y=Wi(),v=e.exports=Hi().Stream;v.isDestroyed=y.isDestroyed,v.isDisturbed=y.isDisturbed,v.isErrored=y.isErrored,v.isReadable=y.isReadable,v.isWritable=y.isWritable,v.Readable=Zi();for(let _ of i(o)){let t=function(){if(new.target)throw c();for(var t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];return v.Readable.from(s(e,this,r))},e=o[_];n(t,"name",{__proto__:null,value:e.name}),n(t,"length",{__proto__:null,value:e.length}),n(v.Readable.prototype,_,{__proto__:null,value:t,enumerable:!1,configurable:!0,writable:!0})}for(let _ of i(l)){let t=function(){if(new.target)throw c();for(var t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];return s(e,this,r)},e=l[_];n(t,"name",{__proto__:null,value:e.name}),n(t,"length",{__proto__:null,value:e.length}),n(v.Readable.prototype,_,{__proto__:null,value:t,enumerable:!1,configurable:!0,writable:!0})}v.Writable=Ji(),v.Duplex=es(),v.Transform=rs(),v.PassThrough=ns(),v.pipeline=f;var{addAbortSignal:b}=Ki();v.addAbortSignal=b,v.finished=g,v.destroy=p,v.compose=u,v.setDefaultHighWaterMark=h,v.getDefaultHighWaterMark=d,n(v,"promises",{__proto__:null,configurable:!0,enumerable:!0,get:()=>m}),n(f,a,{__proto__:null,enumerable:!0,get:()=>m.pipeline}),n(g,a,{__proto__:null,enumerable:!0,get:()=>m.finished}),v.Stream=v,v._isUint8Array=function(t){return t instanceof Uint8Array},v._uint8ArrayToBuffer=function(t){return r.from(t.buffer,t.byteOffset,t.byteLength)}}),cs=kr((t,e)=>{Ir(),Ei(),oi();var r=ls(),n=os(),i=r.Readable.destroy;e.exports=r.Readable,e.exports._uint8ArrayToBuffer=r._uint8ArrayToBuffer,e.exports._isUint8Array=r._isUint8Array,e.exports.isDisturbed=r.isDisturbed,e.exports.isErrored=r.isErrored,e.exports.isReadable=r.isReadable,e.exports.Readable=r.Readable,e.exports.Writable=r.Writable,e.exports.Duplex=r.Duplex,e.exports.Transform=r.Transform,e.exports.PassThrough=r.PassThrough,e.exports.addAbortSignal=r.addAbortSignal,e.exports.finished=r.finished,e.exports.destroy=r.destroy,e.exports.destroy=i,e.exports.pipeline=r.pipeline,e.exports.compose=r.compose,Object.defineProperty(r,"promises",{configurable:!0,enumerable:!0,get:()=>n}),e.exports.Stream=r.Stream,e.exports.default=e.exports}),us=kr((t,e)=>{Ir(),Ei(),oi(),"function"==typeof Object.create?e.exports=function(t,e){e&&(t.super_=e,t.prototype=Object.create(e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}))}:e.exports=function(t,e){if(e){t.super_=e;var r=function(){};r.prototype=e.prototype,t.prototype=new r,t.prototype.constructor=t}}}),hs=kr((t,e)=>{Ir(),Ei(),oi();var{Buffer:r}=(wi(),xr(mi)),n=Symbol.for("BufferList");function i(t){if(!(this instanceof i))return new i(t);i._init.call(this,t)}i._init=function(t){Object.defineProperty(this,n,{value:!0}),this._bufs=[],this.length=0,t&&this.append(t)},i.prototype._new=function(t){return new i(t)},i.prototype._offset=function(t){if(0===t)return[0,0];let e=0;for(let r=0;r<this._bufs.length;r++){let n=e+this._bufs[r].length;if(t<n||r===this._bufs.length-1)return[r,t-e];e=n}},i.prototype._reverseOffset=function(t){let e=t[0],r=t[1];for(let n=0;n<e;n++)r+=this._bufs[n].length;return r},i.prototype.getBuffers=function(){return this._bufs},i.prototype.get=function(t){if(t>this.length||t<0)return;let e=this._offset(t);return this._bufs[e[0]][e[1]]},i.prototype.slice=function(t,e){return"number"==typeof t&&t<0&&(t+=this.length),"number"==typeof e&&e<0&&(e+=this.length),this.copy(null,0,t,e)},i.prototype.copy=function(t,e,n,i){if(("number"!=typeof n||n<0)&&(n=0),("number"!=typeof i||i>this.length)&&(i=this.length),n>=this.length||i<=0)return t||r.alloc(0);let s=!!t,a=this._offset(n),o=i-n,l=o,c=s&&e||0,u=a[1];if(0===n&&i===this.length){if(!s)return 1===this._bufs.length?this._bufs[0]:r.concat(this._bufs,this.length);for(let e=0;e<this._bufs.length;e++)this._bufs[e].copy(t,c),c+=this._bufs[e].length;return t}if(l<=this._bufs[a[0]].length-u)return s?this._bufs[a[0]].copy(t,e,u,u+l):this._bufs[a[0]].slice(u,u+l);s||(t=r.allocUnsafe(o));for(let r=a[0];r<this._bufs.length;r++){let e=this._bufs[r].length-u;if(!(l>e)){this._bufs[r].copy(t,c,u,u+l),c+=e;break}this._bufs[r].copy(t,c,u),c+=e,l-=e,u&&(u=0)}return t.length>c?t.slice(0,c):t},i.prototype.shallowSlice=function(t,e){if(t=t||0,e="number"!=typeof e?this.length:e,t<0&&(t+=this.length),e<0&&(e+=this.length),t===e)return this._new();let r=this._offset(t),n=this._offset(e),i=this._bufs.slice(r[0],n[0]+1);return 0===n[1]?i.pop():i[i.length-1]=i[i.length-1].slice(0,n[1]),0!==r[1]&&(i[0]=i[0].slice(r[1])),this._new(i)},i.prototype.toString=function(t,e,r){return this.slice(e,r).toString(t)},i.prototype.consume=function(t){if(t=Math.trunc(t),Number.isNaN(t)||t<=0)return this;for(;this._bufs.length;){if(!(t>=this._bufs[0].length)){this._bufs[0]=this._bufs[0].slice(t),this.length-=t;break}t-=this._bufs[0].length,this.length-=this._bufs[0].length,this._bufs.shift()}return this},i.prototype.duplicate=function(){let t=this._new();for(let e=0;e<this._bufs.length;e++)t.append(this._bufs[e]);return t},i.prototype.append=function(t){return this._attach(t,i.prototype._appendBuffer)},i.prototype.prepend=function(t){return this._attach(t,i.prototype._prependBuffer,!0)},i.prototype._attach=function(t,e,n){if(null==t)return this;if(t.buffer)e.call(this,r.from(t.buffer,t.byteOffset,t.byteLength));else if(Array.isArray(t)){let[r,i]=n?[t.length-1,-1]:[0,1];for(let s=r;s>=0&&s<t.length;s+=i)this._attach(t[s],e,n)}else if(this._isBufferList(t)){let[r,i]=n?[t._bufs.length-1,-1]:[0,1];for(let s=r;s>=0&&s<t._bufs.length;s+=i)this._attach(t._bufs[s],e,n)}else"number"==typeof t&&(t=t.toString()),e.call(this,r.from(t));return this},i.prototype._appendBuffer=function(t){this._bufs.push(t),this.length+=t.length},i.prototype._prependBuffer=function(t){this._bufs.unshift(t),this.length+=t.length},i.prototype.indexOf=function(t,e,n){if(void 0===n&&"string"==typeof e&&(n=e,e=void 0),"function"==typeof t||Array.isArray(t))throw new TypeError('The "value" argument must be one of type string, Buffer, BufferList, or Uint8Array.');if("number"==typeof t?t=r.from([t]):"string"==typeof t?t=r.from(t,n):this._isBufferList(t)?t=t.slice():Array.isArray(t.buffer)?t=r.from(t.buffer,t.byteOffset,t.byteLength):r.isBuffer(t)||(t=r.from(t)),e=Number(e||0),isNaN(e)&&(e=0),e<0&&(e=this.length+e),e<0&&(e=0),0===t.length)return e>this.length?this.length:e;let i=this._offset(e),s=i[0],a=i[1];for(;s<this._bufs.length;s++){let e=this._bufs[s];for(;a<e.length;)if(e.length-a>=t.length){let r=e.indexOf(t,a);if(-1!==r)return this._reverseOffset([s,r]);a=e.length-t.length+1}else{let e=this._reverseOffset([s,a]);if(this._match(e,t))return e;a++}a=0}return-1},i.prototype._match=function(t,e){if(this.length-t<e.length)return!1;for(let r=0;r<e.length;r++)if(this.get(t+r)!==e[r])return!1;return!0},function(){let t={readDoubleBE:8,readDoubleLE:8,readFloatBE:4,readFloatLE:4,readBigInt64BE:8,readBigInt64LE:8,readBigUInt64BE:8,readBigUInt64LE:8,readInt32BE:4,readInt32LE:4,readUInt32BE:4,readUInt32LE:4,readInt16BE:2,readInt16LE:2,readUInt16BE:2,readUInt16LE:2,readInt8:1,readUInt8:1,readIntBE:null,readIntLE:null,readUIntBE:null,readUIntLE:null};for(let e in t)(function(e){i.prototype[e]=null===t[e]?function(t,r){return this.slice(t,t+r)[e](0,r)}:function(){let r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this.slice(r,r+t[e])[e](0)}})(e)}(),i.prototype._isBufferList=function(t){return t instanceof i||i.isBufferList(t)},i.isBufferList=function(t){return null!=t&&t[n]},e.exports=i}),ds=kr((t,e)=>{Ir(),Ei(),oi();var r=cs().Duplex,n=us(),i=hs();function s(t){if(!(this instanceof s))return new s(t);if("function"==typeof t){this._callback=t;let e=function(t){this._callback&&(this._callback(t),this._callback=null)}.bind(this);this.on("pipe",function(t){t.on("error",e)}),this.on("unpipe",function(t){t.removeListener("error",e)}),t=null}i._init.call(this,t),r.call(this)}n(s,r),Object.assign(s.prototype,i.prototype),s.prototype._new=function(t){return new s(t)},s.prototype._write=function(t,e,r){this._appendBuffer(t),"function"==typeof r&&r()},s.prototype._read=function(t){if(!this.length)return this.push(null);t=Math.min(t,this.length),this.push(this.slice(0,t)),this.consume(t)},s.prototype.end=function(t){r.prototype.end.call(this,t),this._callback&&(this._callback(null,this.slice()),this._callback=null)},s.prototype._destroy=function(t,e){this._bufs.length=0,this.length=0,e(t)},s.prototype._isBufferList=function(t){return t instanceof s||t instanceof i||s.isBufferList(t)},s.isBufferList=i.isBufferList,e.exports=s,e.exports.BufferListStream=s,e.exports.BufferList=i}),fs=kr((t,e)=>{Ir(),Ei(),oi();e.exports=class{constructor(){this.cmd=null,this.retain=!1,this.qos=0,this.dup=!1,this.length=-1,this.topic=null,this.payload=null}}}),ps=kr((t,e)=>{Ir(),Ei(),oi();var r=e.exports,{Buffer:n}=(wi(),xr(mi));r.types={0:"reserved",1:"connect",2:"connack",3:"publish",4:"puback",5:"pubrec",6:"pubrel",7:"pubcomp",8:"subscribe",9:"suback",10:"unsubscribe",11:"unsuback",12:"pingreq",13:"pingresp",14:"disconnect",15:"auth"},r.requiredHeaderFlags={1:0,2:0,4:0,5:0,6:2,7:0,8:2,9:0,10:2,11:0,12:0,13:0,14:0,15:0},r.requiredHeaderFlagsErrors={};for(let s in r.requiredHeaderFlags){let t=r.requiredHeaderFlags[s];r.requiredHeaderFlagsErrors[s]="Invalid header flag bits, must be 0x"+t.toString(16)+" for "+r.types[s]+" packet"}r.codes={};for(let s in r.types){let t=r.types[s];r.codes[t]=s}r.CMD_SHIFT=4,r.CMD_MASK=240,r.DUP_MASK=8,r.QOS_MASK=3,r.QOS_SHIFT=1,r.RETAIN_MASK=1,r.VARBYTEINT_MASK=127,r.VARBYTEINT_FIN_MASK=128,r.VARBYTEINT_MAX=268435455,r.SESSIONPRESENT_MASK=1,r.SESSIONPRESENT_HEADER=n.from([r.SESSIONPRESENT_MASK]),r.CONNACK_HEADER=n.from([r.codes.connack<<r.CMD_SHIFT]),r.USERNAME_MASK=128,r.PASSWORD_MASK=64,r.WILL_RETAIN_MASK=32,r.WILL_QOS_MASK=24,r.WILL_QOS_SHIFT=3,r.WILL_FLAG_MASK=4,r.CLEAN_SESSION_MASK=2,r.CONNECT_HEADER=n.from([r.codes.connect<<r.CMD_SHIFT]),r.properties={sessionExpiryInterval:17,willDelayInterval:24,receiveMaximum:33,maximumPacketSize:39,topicAliasMaximum:34,requestResponseInformation:25,requestProblemInformation:23,userProperties:38,authenticationMethod:21,authenticationData:22,payloadFormatIndicator:1,messageExpiryInterval:2,contentType:3,responseTopic:8,correlationData:9,maximumQoS:36,retainAvailable:37,assignedClientIdentifier:18,reasonString:31,wildcardSubscriptionAvailable:40,subscriptionIdentifiersAvailable:41,sharedSubscriptionAvailable:42,serverKeepAlive:19,responseInformation:26,serverReference:28,topicAlias:35,subscriptionIdentifier:11},r.propertiesCodes={};for(let s in r.properties){let t=r.properties[s];r.propertiesCodes[t]=s}function i(t){return[0,1,2].map(e=>[0,1].map(i=>[0,1].map(s=>{let a=n.alloc(1);return a.writeUInt8(r.codes[t]<<r.CMD_SHIFT|(i?r.DUP_MASK:0)|e<<r.QOS_SHIFT|s,0,!0),a})))}r.propertiesTypes={sessionExpiryInterval:"int32",willDelayInterval:"int32",receiveMaximum:"int16",maximumPacketSize:"int32",topicAliasMaximum:"int16",requestResponseInformation:"byte",requestProblemInformation:"byte",userProperties:"pair",authenticationMethod:"string",authenticationData:"binary",payloadFormatIndicator:"byte",messageExpiryInterval:"int32",contentType:"string",responseTopic:"string",correlationData:"binary",maximumQoS:"int8",retainAvailable:"byte",assignedClientIdentifier:"string",reasonString:"string",wildcardSubscriptionAvailable:"byte",subscriptionIdentifiersAvailable:"byte",sharedSubscriptionAvailable:"byte",serverKeepAlive:"int16",responseInformation:"string",serverReference:"string",topicAlias:"int16",subscriptionIdentifier:"var"},r.PUBLISH_HEADER=i("publish"),r.SUBSCRIBE_HEADER=i("subscribe"),r.SUBSCRIBE_OPTIONS_QOS_MASK=3,r.SUBSCRIBE_OPTIONS_NL_MASK=1,r.SUBSCRIBE_OPTIONS_NL_SHIFT=2,r.SUBSCRIBE_OPTIONS_RAP_MASK=1,r.SUBSCRIBE_OPTIONS_RAP_SHIFT=3,r.SUBSCRIBE_OPTIONS_RH_MASK=3,r.SUBSCRIBE_OPTIONS_RH_SHIFT=4,r.SUBSCRIBE_OPTIONS_RH=[0,16,32],r.SUBSCRIBE_OPTIONS_NL=4,r.SUBSCRIBE_OPTIONS_RAP=8,r.SUBSCRIBE_OPTIONS_QOS=[0,1,2],r.UNSUBSCRIBE_HEADER=i("unsubscribe"),r.ACKS={unsuback:i("unsuback"),puback:i("puback"),pubcomp:i("pubcomp"),pubrel:i("pubrel"),pubrec:i("pubrec")},r.SUBACK_HEADER=n.from([r.codes.suback<<r.CMD_SHIFT]),r.VERSION3=n.from([3]),r.VERSION4=n.from([4]),r.VERSION5=n.from([5]),r.VERSION131=n.from([131]),r.VERSION132=n.from([132]),r.QOS=[0,1,2].map(t=>n.from([t])),r.EMPTY={pingreq:n.from([r.codes.pingreq<<4,0]),pingresp:n.from([r.codes.pingresp<<4,0]),disconnect:n.from([r.codes.disconnect<<4,0])},r.MQTT5_PUBACK_PUBREC_CODES={0:"Success",16:"No matching subscribers",128:"Unspecified error",131:"Implementation specific error",135:"Not authorized",144:"Topic Name invalid",145:"Packet identifier in use",151:"Quota exceeded",153:"Payload format invalid"},r.MQTT5_PUBREL_PUBCOMP_CODES={0:"Success",146:"Packet Identifier not found"},r.MQTT5_SUBACK_CODES={0:"Granted QoS 0",1:"Granted QoS 1",2:"Granted QoS 2",128:"Unspecified error",131:"Implementation specific error",135:"Not authorized",143:"Topic Filter invalid",145:"Packet Identifier in use",151:"Quota exceeded",158:"Shared Subscriptions not supported",161:"Subscription Identifiers not supported",162:"Wildcard Subscriptions not supported"},r.MQTT5_UNSUBACK_CODES={0:"Success",17:"No subscription existed",128:"Unspecified error",131:"Implementation specific error",135:"Not authorized",143:"Topic Filter invalid",145:"Packet Identifier in use"},r.MQTT5_DISCONNECT_CODES={0:"Normal disconnection",4:"Disconnect with Will Message",128:"Unspecified error",129:"Malformed Packet",130:"Protocol Error",131:"Implementation specific error",135:"Not authorized",137:"Server busy",139:"Server shutting down",141:"Keep Alive timeout",142:"Session taken over",143:"Topic Filter invalid",144:"Topic Name invalid",147:"Receive Maximum exceeded",148:"Topic Alias invalid",149:"Packet too large",150:"Message rate too high",151:"Quota exceeded",152:"Administrative action",153:"Payload format invalid",154:"Retain not supported",155:"QoS not supported",156:"Use another server",157:"Server moved",158:"Shared Subscriptions not supported",159:"Connection rate exceeded",160:"Maximum connect time",161:"Subscription Identifiers not supported",162:"Wildcard Subscriptions not supported"},r.MQTT5_AUTH_CODES={0:"Success",24:"Continue authentication",25:"Re-authenticate"}}),gs=kr((t,e)=>{Ir(),Ei(),oi();var r=1e3,n=6e4,i=60*n,s=24*i,a=7*s,o=365.25*s;function l(t,e,r,n){var i=e>=1.5*r;return Math.round(t/r)+" "+n+(i?"s":"")}e.exports=function(t,e){e=e||{};var c=typeof t;if("string"===c&&t.length>0)return function(t){if(t=String(t),!(t.length>100)){var e=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(t);if(e){var l=parseFloat(e[1]);switch((e[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return l*o;case"weeks":case"week":case"w":return l*a;case"days":case"day":case"d":return l*s;case"hours":case"hour":case"hrs":case"hr":case"h":return l*i;case"minutes":case"minute":case"mins":case"min":case"m":return l*n;case"seconds":case"second":case"secs":case"sec":case"s":return l*r;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return l;default:return}}}}(t);if("number"===c&&isFinite(t))return e.long?function(t){var e=Math.abs(t);return e>=s?l(t,e,s,"day"):e>=i?l(t,e,i,"hour"):e>=n?l(t,e,n,"minute"):e>=r?l(t,e,r,"second"):t+" ms"}(t):function(t){var e=Math.abs(t);return e>=s?Math.round(t/s)+"d":e>=i?Math.round(t/i)+"h":e>=n?Math.round(t/n)+"m":e>=r?Math.round(t/r)+"s":t+"ms"}(t);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(t))}}),ms=kr((t,e)=>{Ir(),Ei(),oi(),e.exports=function(t){function e(t){let n,i,s,a=null;function o(){for(var t=arguments.length,r=new Array(t),i=0;i<t;i++)r[i]=arguments[i];if(!o.enabled)return;let s=o,a=Number(new Date),l=a-(n||a);s.diff=l,s.prev=n,s.curr=a,n=a,r[0]=e.coerce(r[0]),"string"!=typeof r[0]&&r.unshift("%O");let c=0;r[0]=r[0].replace(/%([a-zA-Z%])/g,(t,n)=>{if("%%"===t)return"%";c++;let i=e.formatters[n];if("function"==typeof i){let e=r[c];t=i.call(s,e),r.splice(c,1),c--}return t}),e.formatArgs.call(s,r),(s.log||e.log).apply(s,r)}return o.namespace=t,o.useColors=e.useColors(),o.color=e.selectColor(t),o.extend=r,o.destroy=e.destroy,Object.defineProperty(o,"enabled",{enumerable:!0,configurable:!1,get:()=>null!==a?a:(i!==e.namespaces&&(i=e.namespaces,s=e.enabled(t)),s),set:t=>{a=t}}),"function"==typeof e.init&&e.init(o),o}function r(t,r){let n=e(this.namespace+(typeof r>"u"?":":r)+t);return n.log=this.log,n}function n(t,e){let r=0,n=0,i=-1,s=0;for(;r<t.length;)if(n<e.length&&(e[n]===t[r]||"*"===e[n]))"*"===e[n]?(i=n,s=r,n++):(r++,n++);else{if(-1===i)return!1;n=i+1,s++,r=s}for(;n<e.length&&"*"===e[n];)n++;return n===e.length}return e.debug=e,e.default=e,e.coerce=function(t){return t instanceof Error?t.stack||t.message:t},e.disable=function(){let t=[...e.names,...e.skips.map(t=>"-"+t)].join(",");return e.enable(""),t},e.enable=function(t){e.save(t),e.namespaces=t,e.names=[],e.skips=[];let r=("string"==typeof t?t:"").trim().replace(/\s+/g,",").split(",").filter(Boolean);for(let n of r)"-"===n[0]?e.skips.push(n.slice(1)):e.names.push(n)},e.enabled=function(t){for(let r of e.skips)if(n(t,r))return!1;for(let r of e.names)if(n(t,r))return!0;return!1},e.humanize=gs(),e.destroy=function(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")},Object.keys(t).forEach(r=>{e[r]=t[r]}),e.names=[],e.skips=[],e.formatters={},e.selectColor=function(t){let r=0;for(let e=0;e<t.length;e++)r=(r<<5)-r+t.charCodeAt(e),r|=0;return e.colors[Math.abs(r)%e.colors.length]},e.enable(e.load()),e}}),ys=kr((t,e)=>{Ir(),Ei(),oi(),t.formatArgs=function(t){if(t[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+t[0]+(this.useColors?"%c ":" ")+"+"+e.exports.humanize(this.diff),!this.useColors)return;let r="color: "+this.color;t.splice(1,0,r,"color: inherit");let n=0,i=0;t[0].replace(/%[a-zA-Z%]/g,t=>{"%%"!==t&&(n++,"%c"===t&&(i=n))}),t.splice(i,0,r)},t.save=function(e){try{e?t.storage.setItem("debug",e):t.storage.removeItem("debug")}catch(r){}},t.load=function(){let e;try{e=t.storage.getItem("debug")||t.storage.getItem("DEBUG")}catch(r){}return!e&&typeof Rr<"u"&&"env"in Rr&&(e=Rr.env.DEBUG),e},t.useColors=function(){if(typeof window<"u"&&window.process&&("renderer"===window.process.type||window.process.__nwjs))return!0;if(typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))return!1;let t;return typeof document<"u"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window<"u"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator<"u"&&navigator.userAgent&&(t=navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/))&&parseInt(t[1],10)>=31||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)},t.storage=function(){try{return localStorage}catch(t){}}(),t.destroy=(()=>{let t=!1;return()=>{t||(t=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})(),t.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],t.log=console.debug||console.log||(()=>{}),e.exports=ms()(t);var{formatters:r}=e.exports;r.j=function(t){try{return JSON.stringify(t)}catch(vA){return"[UnexpectedJSONParseError]: "+vA.message}}}),vs=kr((t,e)=>{Ir(),Ei(),oi();var r=ds(),{EventEmitter:n}=(Ui(),xr(xi)),i=fs(),s=ps(),a=ys()("mqtt-packet:parser");e.exports=class t extends n{constructor(){super(),this.parser=this.constructor.parser}static parser(e){return this instanceof t?(this.settings=e||{},this._states=["_parseHeader","_parseLength","_parsePayload","_newPacket"],this._resetState(),this):(new t).parser(e)}_resetState(){a("_resetState: resetting packet, error, _list, and _stateCounter"),this.packet=new i,this.error=null,this._list=r(),this._stateCounter=0}parse(t){for(this.error&&this._resetState(),this._list.append(t),a("parse: current state: %s",this._states[this._stateCounter]);(-1!==this.packet.length||this._list.length>0)&&this[this._states[this._stateCounter]]()&&!this.error;)this._stateCounter++,a("parse: state complete. _stateCounter is now: %d",this._stateCounter),a("parse: packet.length: %d, buffer list length: %d",this.packet.length,this._list.length),this._stateCounter>=this._states.length&&(this._stateCounter=0);return a("parse: exited while loop. packet: %d, buffer list length: %d",this.packet.length,this._list.length),this._list.length}_parseHeader(){let t=this._list.readUInt8(0),e=t>>s.CMD_SHIFT;this.packet.cmd=s.types[e];let r=15&t,n=s.requiredHeaderFlags[e];return null!=n&&r!==n?this._emitError(new Error(s.requiredHeaderFlagsErrors[e])):(this.packet.retain=0!==(t&s.RETAIN_MASK),this.packet.qos=t>>s.QOS_SHIFT&s.QOS_MASK,this.packet.qos>2?this._emitError(new Error("Packet must not have both QoS bits set to 1")):(this.packet.dup=0!==(t&s.DUP_MASK),a("_parseHeader: packet: %o",this.packet),this._list.consume(1),!0))}_parseLength(){let t=this._parseVarByteNum(!0);return t&&(this.packet.length=t.value,this._list.consume(t.bytes)),a("_parseLength %d",t.value),!!t}_parsePayload(){a("_parsePayload: payload %O",this._list);let t=!1;if(0===this.packet.length||this._list.length>=this.packet.length){switch(this._pos=0,this.packet.cmd){case"connect":this._parseConnect();break;case"connack":this._parseConnack();break;case"publish":this._parsePublish();break;case"puback":case"pubrec":case"pubrel":case"pubcomp":this._parseConfirmation();break;case"subscribe":this._parseSubscribe();break;case"suback":this._parseSuback();break;case"unsubscribe":this._parseUnsubscribe();break;case"unsuback":this._parseUnsuback();break;case"pingreq":case"pingresp":break;case"disconnect":this._parseDisconnect();break;case"auth":this._parseAuth();break;default:this._emitError(new Error("Not supported"))}t=!0}return a("_parsePayload complete result: %s",t),t}_parseConnect(){a("_parseConnect");let t,e,r,n,i={},o=this.packet,l=this._parseString();if(null===l)return this._emitError(new Error("Cannot parse protocolId"));if("MQTT"!==l&&"MQIsdp"!==l)return this._emitError(new Error("Invalid protocolId"));if(o.protocolId=l,this._pos>=this._list.length)return this._emitError(new Error("Packet too short"));if(o.protocolVersion=this._list.readUInt8(this._pos),o.protocolVersion>=128&&(o.bridgeMode=!0,o.protocolVersion=o.protocolVersion-128),3!==o.protocolVersion&&4!==o.protocolVersion&&5!==o.protocolVersion)return this._emitError(new Error("Invalid protocol version"));if(this._pos++,this._pos>=this._list.length)return this._emitError(new Error("Packet too short"));if(1&this._list.readUInt8(this._pos))return this._emitError(new Error("Connect flag bit 0 must be 0, but got 1"));i.username=this._list.readUInt8(this._pos)&s.USERNAME_MASK,i.password=this._list.readUInt8(this._pos)&s.PASSWORD_MASK,i.will=this._list.readUInt8(this._pos)&s.WILL_FLAG_MASK;let c=!!(this._list.readUInt8(this._pos)&s.WILL_RETAIN_MASK),u=(this._list.readUInt8(this._pos)&s.WILL_QOS_MASK)>>s.WILL_QOS_SHIFT;if(i.will)o.will={},o.will.retain=c,o.will.qos=u;else{if(c)return this._emitError(new Error("Will Retain Flag must be set to zero when Will Flag is set to 0"));if(u)return this._emitError(new Error("Will QoS must be set to zero when Will Flag is set to 0"))}if(o.clean=0!==(this._list.readUInt8(this._pos)&s.CLEAN_SESSION_MASK),this._pos++,o.keepalive=this._parseNum(),-1===o.keepalive)return this._emitError(new Error("Packet too short"));if(5===o.protocolVersion){let t=this._parseProperties();Object.getOwnPropertyNames(t).length&&(o.properties=t)}let h=this._parseString();if(null===h)return this._emitError(new Error("Packet too short"));if(o.clientId=h,a("_parseConnect: packet.clientId: %s",o.clientId),i.will){if(5===o.protocolVersion){let t=this._parseProperties();Object.getOwnPropertyNames(t).length&&(o.will.properties=t)}if(t=this._parseString(),null===t)return this._emitError(new Error("Cannot parse will topic"));if(o.will.topic=t,a("_parseConnect: packet.will.topic: %s",o.will.topic),e=this._parseBuffer(),null===e)return this._emitError(new Error("Cannot parse will payload"));o.will.payload=e,a("_parseConnect: packet.will.paylaod: %s",o.will.payload)}if(i.username){if(n=this._parseString(),null===n)return this._emitError(new Error("Cannot parse username"));o.username=n,a("_parseConnect: packet.username: %s",o.username)}if(i.password){if(r=this._parseBuffer(),null===r)return this._emitError(new Error("Cannot parse password"));o.password=r}return this.settings=o,a("_parseConnect: complete"),o}_parseConnack(){a("_parseConnack");let t=this.packet;if(this._list.length<1)return null;let e=this._list.readUInt8(this._pos++);if(e>1)return this._emitError(new Error("Invalid connack flags, bits 7-1 must be set to 0"));if(t.sessionPresent=!!(e&s.SESSIONPRESENT_MASK),5===this.settings.protocolVersion)this._list.length>=2?t.reasonCode=this._list.readUInt8(this._pos++):t.reasonCode=0;else{if(this._list.length<2)return null;t.returnCode=this._list.readUInt8(this._pos++)}if(-1===t.returnCode||-1===t.reasonCode)return this._emitError(new Error("Cannot parse return code"));if(5===this.settings.protocolVersion){let e=this._parseProperties();Object.getOwnPropertyNames(e).length&&(t.properties=e)}a("_parseConnack: complete")}_parsePublish(){a("_parsePublish");let t=this.packet;if(t.topic=this._parseString(),null===t.topic)return this._emitError(new Error("Cannot parse topic"));if(!(t.qos>0)||this._parseMessageId()){if(5===this.settings.protocolVersion){let e=this._parseProperties();Object.getOwnPropertyNames(e).length&&(t.properties=e)}t.payload=this._list.slice(this._pos,t.length),a("_parsePublish: payload from buffer list: %o",t.payload)}}_parseSubscribe(){a("_parseSubscribe");let t,e,r,n,i,o,l,c=this.packet;if(c.subscriptions=[],this._parseMessageId()){if(5===this.settings.protocolVersion){let t=this._parseProperties();Object.getOwnPropertyNames(t).length&&(c.properties=t)}if(c.length<=0)return this._emitError(new Error("Malformed subscribe, no payload specified"));for(;this._pos<c.length;){if(t=this._parseString(),null===t)return this._emitError(new Error("Cannot parse topic"));if(this._pos>=c.length)return this._emitError(new Error("Malformed Subscribe Payload"));if(e=this._parseByte(),5===this.settings.protocolVersion){if(192&e)return this._emitError(new Error("Invalid subscribe topic flag bits, bits 7-6 must be 0"))}else if(252&e)return this._emitError(new Error("Invalid subscribe topic flag bits, bits 7-2 must be 0"));if(r=e&s.SUBSCRIBE_OPTIONS_QOS_MASK,r>2)return this._emitError(new Error("Invalid subscribe QoS, must be <= 2"));if(o=0!==(e>>s.SUBSCRIBE_OPTIONS_NL_SHIFT&s.SUBSCRIBE_OPTIONS_NL_MASK),i=0!==(e>>s.SUBSCRIBE_OPTIONS_RAP_SHIFT&s.SUBSCRIBE_OPTIONS_RAP_MASK),n=e>>s.SUBSCRIBE_OPTIONS_RH_SHIFT&s.SUBSCRIBE_OPTIONS_RH_MASK,n>2)return this._emitError(new Error("Invalid retain handling, must be <= 2"));l={topic:t,qos:r},5===this.settings.protocolVersion?(l.nl=o,l.rap=i,l.rh=n):this.settings.bridgeMode&&(l.rh=0,l.rap=!0,l.nl=!0),a("_parseSubscribe: push subscription `%s` to subscription",l),c.subscriptions.push(l)}}}_parseSuback(){a("_parseSuback");let t=this.packet;if(this.packet.granted=[],this._parseMessageId()){if(5===this.settings.protocolVersion){let e=this._parseProperties();Object.getOwnPropertyNames(e).length&&(t.properties=e)}if(t.length<=0)return this._emitError(new Error("Malformed suback, no payload specified"));for(;this._pos<this.packet.length;){let t=this._list.readUInt8(this._pos++);if(5===this.settings.protocolVersion){if(!s.MQTT5_SUBACK_CODES[t])return this._emitError(new Error("Invalid suback code"))}else if(t>2&&128!==t)return this._emitError(new Error("Invalid suback QoS, must be 0, 1, 2 or 128"));this.packet.granted.push(t)}}}_parseUnsubscribe(){a("_parseUnsubscribe");let t=this.packet;if(t.unsubscriptions=[],this._parseMessageId()){if(5===this.settings.protocolVersion){let e=this._parseProperties();Object.getOwnPropertyNames(e).length&&(t.properties=e)}if(t.length<=0)return this._emitError(new Error("Malformed unsubscribe, no payload specified"));for(;this._pos<t.length;){let e=this._parseString();if(null===e)return this._emitError(new Error("Cannot parse topic"));a("_parseUnsubscribe: push topic `%s` to unsubscriptions",e),t.unsubscriptions.push(e)}}}_parseUnsuback(){a("_parseUnsuback");let t=this.packet;if(!this._parseMessageId())return this._emitError(new Error("Cannot parse messageId"));if((3===this.settings.protocolVersion||4===this.settings.protocolVersion)&&2!==t.length)return this._emitError(new Error("Malformed unsuback, payload length must be 2"));if(t.length<=0)return this._emitError(new Error("Malformed unsuback, no payload specified"));if(5===this.settings.protocolVersion){let e=this._parseProperties();for(Object.getOwnPropertyNames(e).length&&(t.properties=e),t.granted=[];this._pos<this.packet.length;){let t=this._list.readUInt8(this._pos++);if(!s.MQTT5_UNSUBACK_CODES[t])return this._emitError(new Error("Invalid unsuback code"));this.packet.granted.push(t)}}}_parseConfirmation(){a("_parseConfirmation: packet.cmd: `%s`",this.packet.cmd);let t=this.packet;if(this._parseMessageId(),5===this.settings.protocolVersion){if(t.length>2){switch(t.reasonCode=this._parseByte(),this.packet.cmd){case"puback":case"pubrec":if(!s.MQTT5_PUBACK_PUBREC_CODES[t.reasonCode])return this._emitError(new Error("Invalid "+this.packet.cmd+" reason code"));break;case"pubrel":case"pubcomp":if(!s.MQTT5_PUBREL_PUBCOMP_CODES[t.reasonCode])return this._emitError(new Error("Invalid "+this.packet.cmd+" reason code"))}a("_parseConfirmation: packet.reasonCode `%d`",t.reasonCode)}else t.reasonCode=0;if(t.length>3){let e=this._parseProperties();Object.getOwnPropertyNames(e).length&&(t.properties=e)}}return!0}_parseDisconnect(){let t=this.packet;if(a("_parseDisconnect"),5===this.settings.protocolVersion){this._list.length>0?(t.reasonCode=this._parseByte(),s.MQTT5_DISCONNECT_CODES[t.reasonCode]||this._emitError(new Error("Invalid disconnect reason code"))):t.reasonCode=0;let e=this._parseProperties();Object.getOwnPropertyNames(e).length&&(t.properties=e)}return a("_parseDisconnect result: true"),!0}_parseAuth(){a("_parseAuth");let t=this.packet;if(5!==this.settings.protocolVersion)return this._emitError(new Error("Not supported auth packet for this version MQTT"));if(t.reasonCode=this._parseByte(),!s.MQTT5_AUTH_CODES[t.reasonCode])return this._emitError(new Error("Invalid auth reason code"));let e=this._parseProperties();return Object.getOwnPropertyNames(e).length&&(t.properties=e),a("_parseAuth: result: true"),!0}_parseMessageId(){let t=this.packet;return t.messageId=this._parseNum(),null===t.messageId?(this._emitError(new Error("Cannot parse messageId")),!1):(a("_parseMessageId: packet.messageId %d",t.messageId),!0)}_parseString(t){let e=this._parseNum(),r=e+this._pos;if(-1===e||r>this._list.length||r>this.packet.length)return null;let n=this._list.toString("utf8",this._pos,r);return this._pos+=e,a("_parseString: result: %s",n),n}_parseStringPair(){return a("_parseStringPair"),{name:this._parseString(),value:this._parseString()}}_parseBuffer(){let t=this._parseNum(),e=t+this._pos;if(-1===t||e>this._list.length||e>this.packet.length)return null;let r=this._list.slice(this._pos,e);return this._pos+=t,a("_parseBuffer: result: %o",r),r}_parseNum(){if(this._list.length-this._pos<2)return-1;let t=this._list.readUInt16BE(this._pos);return this._pos+=2,a("_parseNum: result: %s",t),t}_parse4ByteNum(){if(this._list.length-this._pos<4)return-1;let t=this._list.readUInt32BE(this._pos);return this._pos+=4,a("_parse4ByteNum: result: %s",t),t}_parseVarByteNum(t){a("_parseVarByteNum");let e,r=0,n=1,i=0,o=!1,l=this._pos?this._pos:0;for(;r<4&&l+r<this._list.length;){if(e=this._list.readUInt8(l+r++),i+=n*(e&s.VARBYTEINT_MASK),n*=128,0===(e&s.VARBYTEINT_FIN_MASK)){o=!0;break}if(this._list.length<=r)break}return!o&&4===r&&this._list.length>=r&&this._emitError(new Error("Invalid variable byte integer")),l&&(this._pos+=r),o=!!o&&(t?{bytes:r,value:i}:i),a("_parseVarByteNum: result: %o",o),o}_parseByte(){let t;return this._pos<this._list.length&&(t=this._list.readUInt8(this._pos),this._pos++),a("_parseByte: result: %o",t),t}_parseByType(t){switch(a("_parseByType: type: %s",t),t){case"byte":return 0!==this._parseByte();case"int8":return this._parseByte();case"int16":return this._parseNum();case"int32":return this._parse4ByteNum();case"var":return this._parseVarByteNum();case"string":return this._parseString();case"pair":return this._parseStringPair();case"binary":return this._parseBuffer()}}_parseProperties(){a("_parseProperties");let t=this._parseVarByteNum(),e=this._pos+t,r={};for(;this._pos<e;){let t=this._parseByte();if(!t)return this._emitError(new Error("Cannot parse property code type")),!1;let e=s.propertiesCodes[t];if(!e)return this._emitError(new Error("Unknown property")),!1;if("userProperties"===e){r[e]||(r[e]=Object.create(null));let t=this._parseByType(s.propertiesTypes[e]);if(r[e][t.name])if(Array.isArray(r[e][t.name]))r[e][t.name].push(t.value);else{let n=r[e][t.name];r[e][t.name]=[n],r[e][t.name].push(t.value)}else r[e][t.name]=t.value;continue}r[e]?(Array.isArray(r[e])||(r[e]=[r[e]]),r[e].push(this._parseByType(s.propertiesTypes[e]))):r[e]=this._parseByType(s.propertiesTypes[e])}return r}_newPacket(){return a("_newPacket"),this.packet&&(this._list.consume(this.packet.length),a("_newPacket: parser emit packet: packet.cmd: %s, packet.payload: %s, packet.length: %d",this.packet.cmd,this.packet.payload,this.packet.length),this.emit("packet",this.packet)),a("_newPacket: new packet"),this.packet=new i,this._pos=0,!0}_emitError(t){a("_emitError",t),this.error=t,this.emit("error",t)}}}),bs=kr((t,e)=>{Ir(),Ei(),oi();var{Buffer:r}=(wi(),xr(mi)),n={},i=r.isBuffer(r.from([1,2]).subarray(0,1));function s(t){let e=r.allocUnsafe(2);return e.writeUInt8(t>>8,0),e.writeUInt8(255&t,1),e}e.exports={cache:n,generateCache:function(){for(let t=0;t<65536;t++)n[t]=s(t)},generateNumber:s,genBufVariableByteInt:function(t){let e=0,n=0,s=r.allocUnsafe(4);do{e=t%128|0,(t=t/128|0)>0&&(e|=128),s.writeUInt8(e,n++)}while(t>0&&n<4);return t>0&&(n=0),i?s.subarray(0,n):s.slice(0,n)},generate4ByteBuffer:function(t){let e=r.allocUnsafe(4);return e.writeUInt32BE(t,0),e}}}),_s=kr((t,e)=>{Ir(),Ei(),oi(),typeof Rr>"u"||!Rr.version||0===Rr.version.indexOf("v0.")||0===Rr.version.indexOf("v1.")&&0!==Rr.version.indexOf("v1.8.")?e.exports={nextTick:function(t,e,r,n){if("function"!=typeof t)throw new TypeError('"callback" argument must be a function');var i,s,a=arguments.length;switch(a){case 0:case 1:return Rr.nextTick(t);case 2:return Rr.nextTick(function(){t.call(null,e)});case 3:return Rr.nextTick(function(){t.call(null,e,r)});case 4:return Rr.nextTick(function(){t.call(null,e,r,n)});default:for(i=new Array(a-1),s=0;s<i.length;)i[s++]=arguments[s];return Rr.nextTick(function(){t.apply(null,i)})}}}:e.exports=Rr}),ws=kr((t,e)=>{Ir(),Ei(),oi();var r=ps(),{Buffer:n}=(wi(),xr(mi)),i=n.allocUnsafe(0),s=n.from([0]),a=bs(),o=_s().nextTick,l=ys()("mqtt-packet:writeToStream"),c=a.cache,u=a.generateNumber,h=a.generateCache,d=a.genBufVariableByteInt,f=a.generate4ByteBuffer,p=E,g=!0;function m(t,e,a){switch(l("generate called"),e.cork&&(e.cork(),o(y,e)),g&&(g=!1,h()),l("generate: packet.cmd: %s",t.cmd),t.cmd){case"connect":return function(t,e){let i=t||{},s=i.protocolId||"MQTT",a=i.protocolVersion||4,o=i.will,l=i.clean,c=i.keepalive||0,u=i.clientId||"",h=i.username,d=i.password,f=i.properties;void 0===l&&(l=!0);let g,m,y=0;if(!s||"string"!=typeof s&&!n.isBuffer(s))return e.destroy(new Error("Invalid protocolId")),!1;if(y+=s.length+2,3!==a&&4!==a&&5!==a)return e.destroy(new Error("Invalid protocol version")),!1;if(y+=1,("string"==typeof u||n.isBuffer(u))&&(u||a>=4)&&(u||l))y+=n.byteLength(u)+2;else{if(a<4)return e.destroy(new Error("clientId must be supplied before 3.1.1")),!1;if(1*l===0)return e.destroy(new Error("clientId must be given if cleanSession set to 0")),!1}if("number"!=typeof c||c<0||c>65535||c%1!==0)return e.destroy(new Error("Invalid keepalive")),!1;if(y+=2,y+=1,5===a){if(g=k(e,f),!g)return!1;y+=g.length}if(o){if("object"!=typeof o)return e.destroy(new Error("Invalid will")),!1;if(!o.topic||"string"!=typeof o.topic)return e.destroy(new Error("Invalid will topic")),!1;if(y+=n.byteLength(o.topic)+2,y+=2,o.payload){if(!(o.payload.length>=0))return e.destroy(new Error("Invalid will payload")),!1;"string"==typeof o.payload?y+=n.byteLength(o.payload):y+=o.payload.length}if(m={},5===a){if(m=k(e,o.properties),!m)return!1;y+=m.length}}let v=!1;if(null!=h){if(!L(h))return e.destroy(new Error("Invalid username")),!1;v=!0,y+=n.byteLength(h)+2}if(null!=d){if(!v)return e.destroy(new Error("Username is required to use password")),!1;if(!L(d))return e.destroy(new Error("Invalid password")),!1;y+=R(d)+2}e.write(r.CONNECT_HEADER),b(e,y),T(e,s),i.bridgeMode&&(a+=128),e.write(131===a?r.VERSION131:132===a?r.VERSION132:4===a?r.VERSION4:5===a?r.VERSION5:r.VERSION3);let w=0;return w|=null!=h?r.USERNAME_MASK:0,w|=null!=d?r.PASSWORD_MASK:0,w|=o&&o.retain?r.WILL_RETAIN_MASK:0,w|=o&&o.qos?o.qos<<r.WILL_QOS_SHIFT:0,w|=o?r.WILL_FLAG_MASK:0,w|=l?r.CLEAN_SESSION_MASK:0,e.write(n.from([w])),p(e,c),5===a&&g.write(),T(e,u),o&&(5===a&&m.write(),_(e,o.topic),T(e,o.payload)),null!=h&&T(e,h),null!=d&&T(e,d),!0}(t,e);case"connack":return function(t,e,i){var a;let o=i?i.protocolVersion:4,l=t||{},c=5===o?l.reasonCode:l.returnCode,u=l.properties,h=2;if("number"!=typeof c)return e.destroy(new Error("Invalid return code")),!1;let d=null;if(5===o){if(d=k(e,u),!d)return!1;h+=d.length}return e.write(r.CONNACK_HEADER),b(e,h),e.write(l.sessionPresent?r.SESSIONPRESENT_HEADER:s),e.write(n.from([c])),null!==(a=d)&&void 0!==a&&a.write(),!0}(t,e,a);case"publish":return function(t,e,s){var a;l("publish: packet: %o",t);let o=s?s.protocolVersion:4,c=t||{},u=c.qos||0,h=c.retain?r.RETAIN_MASK:0,d=c.topic,f=c.payload||i,g=c.messageId,m=c.properties,y=0;if("string"==typeof d)y+=n.byteLength(d)+2;else{if(!n.isBuffer(d))return e.destroy(new Error("Invalid topic")),!1;y+=d.length+2}if(n.isBuffer(f)?y+=f.length:y+=n.byteLength(f),u&&"number"!=typeof g)return e.destroy(new Error("Invalid messageId")),!1;u&&(y+=2);let v=null;if(5===o){if(v=k(e,m),!v)return!1;y+=v.length}return e.write(r.PUBLISH_HEADER[u][c.dup?1:0][h?1:0]),b(e,y),p(e,R(d)),e.write(d),u>0&&p(e,g),null!==(a=v)&&void 0!==a&&a.write(),l("publish: payload: %o",f),e.write(f)}(t,e,a);case"puback":case"pubrec":case"pubrel":case"pubcomp":return function(t,e,i){let s=i?i.protocolVersion:4,a=t||{},o=a.cmd||"puback",l=a.messageId,c=a.dup&&"pubrel"===o?r.DUP_MASK:0,u=0,h=a.reasonCode,d=a.properties,f=5===s?3:2;if("pubrel"===o&&(u=1),"number"!=typeof l)return e.destroy(new Error("Invalid messageId")),!1;let g=null;if(5===s&&"object"==typeof d){if(g=A(e,d,i,f),!g)return!1;f+=g.length}return e.write(r.ACKS[o][u][c][0]),3===f&&(f+=0!==h?1:-1),b(e,f),p(e,l),5===s&&2!==f&&e.write(n.from([h])),null!==g?g.write():4===f&&e.write(n.from([0])),!0}(t,e,a);case"subscribe":return function(t,e,i){l("subscribe: packet: ");let s=i?i.protocolVersion:4,a=t||{},o=a.dup?r.DUP_MASK:0,c=a.messageId,u=a.subscriptions,h=a.properties,d=0;if("number"!=typeof c)return e.destroy(new Error("Invalid messageId")),!1;d+=2;let f=null;if(5===s){if(f=k(e,h),!f)return!1;d+=f.length}if("object"!=typeof u||!u.length)return e.destroy(new Error("Invalid subscriptions")),!1;for(let r=0;r<u.length;r+=1){let t=u[r].topic,i=u[r].qos;if("string"!=typeof t)return e.destroy(new Error("Invalid subscriptions - invalid topic")),!1;if("number"!=typeof i)return e.destroy(new Error("Invalid subscriptions - invalid qos")),!1;if(5===s){if("boolean"!=typeof(u[r].nl||!1))return e.destroy(new Error("Invalid subscriptions - invalid No Local")),!1;if("boolean"!=typeof(u[r].rap||!1))return e.destroy(new Error("Invalid subscriptions - invalid Retain as Published")),!1;let t=u[r].rh||0;if("number"!=typeof t||t>2)return e.destroy(new Error("Invalid subscriptions - invalid Retain Handling")),!1}d+=n.byteLength(t)+2+1}l("subscribe: writing to stream: %o",r.SUBSCRIBE_HEADER),e.write(r.SUBSCRIBE_HEADER[1][o?1:0][0]),b(e,d),p(e,c),null!==f&&f.write();let g=!0;for(let l of u){let t,i=l.topic,a=l.qos,o=+l.nl,c=+l.rap,u=l.rh;_(e,i),t=r.SUBSCRIBE_OPTIONS_QOS[a],5===s&&(t|=o?r.SUBSCRIBE_OPTIONS_NL:0,t|=c?r.SUBSCRIBE_OPTIONS_RAP:0,t|=u?r.SUBSCRIBE_OPTIONS_RH[u]:0),g=e.write(n.from([t]))}return g}(t,e,a);case"suback":return function(t,e,i){let s=i?i.protocolVersion:4,a=t||{},o=a.messageId,l=a.granted,c=a.properties,u=0;if("number"!=typeof o)return e.destroy(new Error("Invalid messageId")),!1;if(u+=2,"object"!=typeof l||!l.length)return e.destroy(new Error("Invalid qos vector")),!1;for(let r=0;r<l.length;r+=1){if("number"!=typeof l[r])return e.destroy(new Error("Invalid qos vector")),!1;u+=1}let h=null;if(5===s){if(h=A(e,c,i,u),!h)return!1;u+=h.length}return e.write(r.SUBACK_HEADER),b(e,u),p(e,o),null!==h&&h.write(),e.write(n.from(l))}(t,e,a);case"unsubscribe":return function(t,e,i){let s=i?i.protocolVersion:4,a=t||{},o=a.messageId,l=a.dup?r.DUP_MASK:0,c=a.unsubscriptions,u=a.properties,h=0;if("number"!=typeof o)return e.destroy(new Error("Invalid messageId")),!1;if(h+=2,"object"!=typeof c||!c.length)return e.destroy(new Error("Invalid unsubscriptions")),!1;for(let r=0;r<c.length;r+=1){if("string"!=typeof c[r])return e.destroy(new Error("Invalid unsubscriptions")),!1;h+=n.byteLength(c[r])+2}let d=null;if(5===s){if(d=k(e,u),!d)return!1;h+=d.length}e.write(r.UNSUBSCRIBE_HEADER[1][l?1:0][0]),b(e,h),p(e,o),null!==d&&d.write();let f=!0;for(let r=0;r<c.length;r++)f=_(e,c[r]);return f}(t,e,a);case"unsuback":return function(t,e,i){let s=i?i.protocolVersion:4,a=t||{},o=a.messageId,l=a.dup?r.DUP_MASK:0,c=a.granted,u=a.properties,h=a.cmd,d=0,f=2;if("number"!=typeof o)return e.destroy(new Error("Invalid messageId")),!1;if(5===s){if("object"!=typeof c||!c.length)return e.destroy(new Error("Invalid qos vector")),!1;for(let t=0;t<c.length;t+=1){if("number"!=typeof c[t])return e.destroy(new Error("Invalid qos vector")),!1;f+=1}}let g=null;if(5===s){if(g=A(e,u,i,f),!g)return!1;f+=g.length}return e.write(r.ACKS[h][d][l][0]),b(e,f),p(e,o),null!==g&&g.write(),5===s&&e.write(n.from(c)),!0}(t,e,a);case"pingreq":case"pingresp":return function(t,e){return e.write(r.EMPTY[t.cmd])}(t,e);case"disconnect":return function(t,e,i){let s=i?i.protocolVersion:4,a=t||{},o=a.reasonCode,l=a.properties,c=5===s?1:0,u=null;if(5===s){if(u=A(e,l,i,c),!u)return!1;c+=u.length}return e.write(n.from([r.codes.disconnect<<4])),b(e,c),5===s&&e.write(n.from([o])),null!==u&&u.write(),!0}(t,e,a);case"auth":return function(t,e,i){let s=i?i.protocolVersion:4,a=t||{},o=a.reasonCode,l=a.properties,c=5===s?1:0;5!==s&&e.destroy(new Error("Invalid mqtt version for auth packet"));let u=A(e,l,i,c);return!!u&&(c+=u.length,e.write(n.from([r.codes.auth<<4])),b(e,c),e.write(n.from([o])),null!==u&&u.write(),!0)}(t,e,a);default:return e.destroy(new Error("Unknown command")),!1}}function y(t){t.uncork()}Object.defineProperty(m,"cacheNumbers",{get:()=>p===E,set(t){t?((!c||0===Object.keys(c).length)&&(g=!0),p=E):(g=!1,p=S)}});var v={};function b(t,e){if(e>r.VARBYTEINT_MAX)return t.destroy(new Error("Invalid variable byte integer: ".concat(e))),!1;let n=v[e];return n||(n=d(e),e<16384&&(v[e]=n)),l("writeVarByteInt: writing to stream: %o",n),t.write(n)}function _(t,e){let r=n.byteLength(e);return p(t,r),l("writeString: %s",e),t.write(e,"utf8")}function w(t,e,r){_(t,e),_(t,r)}function E(t,e){return l("writeNumberCached: number: %d",e),l("writeNumberCached: %o",c[e]),t.write(c[e])}function S(t,e){let r=u(e);return l("writeNumberGenerated: %o",r),t.write(r)}function T(t,e){"string"==typeof e?_(t,e):e?(p(t,e.length),t.write(e)):p(t,0)}function k(t,e){if("object"!=typeof e||null!=e.length)return{length:1,write(){I(t,{},0)}};let i=0;function s(e,i){let s=0;switch(r.propertiesTypes[e]){case"byte":if("boolean"!=typeof i)return t.destroy(new Error("Invalid ".concat(e,": ").concat(i))),!1;s+=2;break;case"int8":if("number"!=typeof i||i<0||i>255)return t.destroy(new Error("Invalid ".concat(e,": ").concat(i))),!1;s+=2;break;case"binary":if(i&&null===i)return t.destroy(new Error("Invalid ".concat(e,": ").concat(i))),!1;s+=1+n.byteLength(i)+2;break;case"int16":if("number"!=typeof i||i<0||i>65535)return t.destroy(new Error("Invalid ".concat(e,": ").concat(i))),!1;s+=3;break;case"int32":if("number"!=typeof i||i<0||i>4294967295)return t.destroy(new Error("Invalid ".concat(e,": ").concat(i))),!1;s+=5;break;case"var":if("number"!=typeof i||i<0||i>268435455)return t.destroy(new Error("Invalid ".concat(e,": ").concat(i))),!1;s+=1+n.byteLength(d(i));break;case"string":if("string"!=typeof i)return t.destroy(new Error("Invalid ".concat(e,": ").concat(i))),!1;s+=3+n.byteLength(i.toString());break;case"pair":if("object"!=typeof i)return t.destroy(new Error("Invalid ".concat(e,": ").concat(i))),!1;s+=Object.getOwnPropertyNames(i).reduce((t,e)=>{let r=i[e];return Array.isArray(r)?t+=r.reduce((t,r)=>t+=3+n.byteLength(e.toString())+2+n.byteLength(r.toString()),0):t+=3+n.byteLength(e.toString())+2+n.byteLength(i[e].toString()),t},0);break;default:return t.destroy(new Error("Invalid property ".concat(e,": ").concat(i))),!1}return s}if(e)for(let r in e){let t=0,n=0,a=e[r];if(void 0!==a){if(Array.isArray(a))for(let e=0;e<a.length;e++){if(n=s(r,a[e]),!n)return!1;t+=n}else{if(n=s(r,a),!n)return!1;t=n}if(!t)return!1;i+=t}}return{length:n.byteLength(d(i))+i,write(){I(t,e,i)}}}function A(t,e,r,n){let i=["reasonString","userProperties"],s=r&&r.properties&&r.properties.maximumPacketSize?r.properties.maximumPacketSize:0,a=k(t,e);if(s)for(;n+a.length>s;){let r=i.shift();if(!r||!e[r])return!1;delete e[r],a=k(t,e)}return a}function x(t,e,i){switch(r.propertiesTypes[e]){case"byte":t.write(n.from([r.properties[e]])),t.write(n.from([+i]));break;case"int8":t.write(n.from([r.properties[e]])),t.write(n.from([i]));break;case"binary":t.write(n.from([r.properties[e]])),T(t,i);break;case"int16":t.write(n.from([r.properties[e]])),p(t,i);break;case"int32":t.write(n.from([r.properties[e]])),function(t,e){let r=f(e);l("write4ByteNumber: %o",r),t.write(r)}(t,i);break;case"var":t.write(n.from([r.properties[e]])),b(t,i);break;case"string":t.write(n.from([r.properties[e]])),_(t,i);break;case"pair":Object.getOwnPropertyNames(i).forEach(s=>{let a=i[s];Array.isArray(a)?a.forEach(i=>{t.write(n.from([r.properties[e]])),w(t,s.toString(),i.toString())}):(t.write(n.from([r.properties[e]])),w(t,s.toString(),a.toString()))});break;default:return t.destroy(new Error("Invalid property ".concat(e," value: ").concat(i))),!1}}function I(t,e,r){b(t,r);for(let n in e)if(Object.prototype.hasOwnProperty.call(e,n)&&null!=e[n]){let r=e[n];if(Array.isArray(r))for(let e=0;e<r.length;e++)x(t,n,r[e]);else x(t,n,r)}}function R(t){return t?t instanceof n?t.length:n.byteLength(t):0}function L(t){return"string"==typeof t||t instanceof n}e.exports=m}),Es=kr((t,e)=>{Ir(),Ei(),oi();var r=ws(),{EventEmitter:n}=(Ui(),xr(xi)),{Buffer:i}=(wi(),xr(mi));var s=class extends n{constructor(){super(),this._array=new Array(20),this._i=0}write(t){return this._array[this._i++]=t,!0}concat(){let t,e=0,r=new Array(this._array.length),n=this._array,s=0;for(t=0;t<n.length&&void 0!==n[t];t++)"string"!=typeof n[t]?r[t]=n[t].length:r[t]=i.byteLength(n[t]),e+=r[t];let a=i.allocUnsafe(e);for(t=0;t<n.length&&void 0!==n[t];t++)"string"!=typeof n[t]?(n[t].copy(a,s),s+=r[t]):(a.write(n[t],s),s+=r[t]);return a}destroy(t){t&&this.emit("error",t)}};e.exports=function(t,e){let n=new s;return r(t,n,e),n.concat()}}),Ss=kr(t=>{Ir(),Ei(),oi(),t.parser=vs().parser,t.generate=Es(),t.writeToStream=ws()}),Ts=kr((t,e)=>{function r(t){return t instanceof vi?vi.from(t):new t.constructor(t.buffer.slice(),t.byteOffset,t.length)}Ir(),Ei(),oi(),e.exports=function(t){if((t=t||{}).circles)return function(t){let e=[],n=[],i=new Map;if(i.set(Date,t=>new Date(t)),i.set(Map,(t,e)=>new Map(a(Array.from(t),e))),i.set(Set,(t,e)=>new Set(a(Array.from(t),e))),t.constructorHandlers)for(let r of t.constructorHandlers)i.set(r[0],r[1]);let s=null;return t.proto?l:o;function a(t,a){let o=Object.keys(t),l=new Array(o.length);for(let c=0;c<o.length;c++){let u=o[c],h=t[u];if("object"!=typeof h||null===h)l[u]=h;else if(h.constructor!==Object&&(s=i.get(h.constructor)))l[u]=s(h,a);else if(ArrayBuffer.isView(h))l[u]=r(h);else{let t=e.indexOf(h);l[u]=-1!==t?n[t]:a(h)}}return l}function o(t){if("object"!=typeof t||null===t)return t;if(Array.isArray(t))return a(t,o);if(t.constructor!==Object&&(s=i.get(t.constructor)))return s(t,o);let l={};e.push(t),n.push(l);for(let a in t){if(!1===Object.hasOwnProperty.call(t,a))continue;let c=t[a];if("object"!=typeof c||null===c)l[a]=c;else if(c.constructor!==Object&&(s=i.get(c.constructor)))l[a]=s(c,o);else if(ArrayBuffer.isView(c))l[a]=r(c);else{let t=e.indexOf(c);l[a]=-1!==t?n[t]:o(c)}}return e.pop(),n.pop(),l}function l(t){if("object"!=typeof t||null===t)return t;if(Array.isArray(t))return a(t,l);if(t.constructor!==Object&&(s=i.get(t.constructor)))return s(t,l);let o={};e.push(t),n.push(o);for(let a in t){let c=t[a];if("object"!=typeof c||null===c)o[a]=c;else if(c.constructor!==Object&&(s=i.get(c.constructor)))o[a]=s(c,l);else if(ArrayBuffer.isView(c))o[a]=r(c);else{let t=e.indexOf(c);o[a]=-1!==t?n[t]:l(c)}}return e.pop(),n.pop(),o}}(t);let e=new Map;if(e.set(Date,t=>new Date(t)),e.set(Map,(t,e)=>new Map(i(Array.from(t),e))),e.set(Set,(t,e)=>new Set(i(Array.from(t),e))),t.constructorHandlers)for(let r of t.constructorHandlers)e.set(r[0],r[1]);let n=null;return t.proto?function t(s){if("object"!=typeof s||null===s)return s;if(Array.isArray(s))return i(s,t);if(s.constructor!==Object&&(n=e.get(s.constructor)))return n(s,t);let a={};for(let i in s){let o=s[i];"object"!=typeof o||null===o?a[i]=o:o.constructor!==Object&&(n=e.get(o.constructor))?a[i]=n(o,t):ArrayBuffer.isView(o)?a[i]=r(o):a[i]=t(o)}return a}:function t(s){if("object"!=typeof s||null===s)return s;if(Array.isArray(s))return i(s,t);if(s.constructor!==Object&&(n=e.get(s.constructor)))return n(s,t);let a={};for(let i in s){if(!1===Object.hasOwnProperty.call(s,i))continue;let o=s[i];"object"!=typeof o||null===o?a[i]=o:o.constructor!==Object&&(n=e.get(o.constructor))?a[i]=n(o,t):ArrayBuffer.isView(o)?a[i]=r(o):a[i]=t(o)}return a};function i(t,i){let s=Object.keys(t),a=new Array(s.length);for(let o=0;o<s.length;o++){let l=s[o],c=t[l];"object"!=typeof c||null===c?a[l]=c:c.constructor!==Object&&(n=e.get(c.constructor))?a[l]=n(c,i):ArrayBuffer.isView(c)?a[l]=r(c):a[l]=i(c)}return a}}}),ks=kr((t,e)=>{Ir(),Ei(),oi(),e.exports=Ts()()}),As=kr(t=>{function e(t){let e=t.split("/");for(let r=0;r<e.length;r++)if("+"!==e[r]){if("#"===e[r])return r===e.length-1;if(-1!==e[r].indexOf("+")||-1!==e[r].indexOf("#"))return!1}return!0}Ir(),Ei(),oi(),Object.defineProperty(t,"__esModule",{value:!0}),t.validateTopic=e,t.validateTopics=function(t){if(0===t.length)return"empty_topic_list";for(let r=0;r<t.length;r++)if(!e(t[r]))return t[r];return null}}),xs=kr(t=>{Ir(),Ei(),oi(),Object.defineProperty(t,"__esModule",{value:!0});var e=cs(),r={objectMode:!0},n={clean:!0};t.default=class{constructor(t){o(this,"options",void 0),o(this,"_inflights",void 0),this.options=t||{},this.options=c(c({},n),t),this._inflights=new Map}put(t,e){return this._inflights.set(t.messageId,t),e&&e(),this}createStream(){let t=new e.Readable(r),n=[],i=!1,s=0;return this._inflights.forEach((t,e)=>{n.push(t)}),t._read=()=>{!i&&s<n.length?t.push(n[s++]):t.push(null)},t.destroy=e=>{if(!i)return i=!0,setTimeout(()=>{t.emit("close")},0),t},t}del(t,e){let r=this._inflights.get(t.messageId);return r?(this._inflights.delete(t.messageId),e(null,r)):e&&e(new Error("missing packet")),this}get(t,e){let r=this._inflights.get(t.messageId);return r?e(null,r):e&&e(new Error("missing packet")),this}close(t){this.options.clean&&(this._inflights=null),t&&t()}}}),Is=kr(t=>{Ir(),Ei(),oi(),Object.defineProperty(t,"__esModule",{value:!0});var e=[0,16,128,131,135,144,145,151,153];t.default=(t,r,n)=>{t.log("handlePublish: packet %o",r),n=typeof n<"u"?n:t.noop;let i=r.topic.toString(),s=r.payload,{qos:a}=r,{messageId:o}=r,{options:l}=t;if(5===t.options.protocolVersion){let e;if(r.properties&&(e=r.properties.topicAlias),typeof e<"u")if(0===i.length){if(!(e>0&&e<=65535))return t.log("handlePublish :: topic alias out of range. alias: %d",e),void t.emit("error",new Error("Received Topic Alias is out of range"));{let r=t.topicAliasRecv.getTopicByAlias(e);if(!r)return t.log("handlePublish :: unregistered topic alias. alias: %d",e),void t.emit("error",new Error("Received unregistered Topic Alias"));i=r,t.log("handlePublish :: topic complemented by alias. topic: %s - alias: %d",i,e)}}else{if(!t.topicAliasRecv.put(i,e))return t.log("handlePublish :: topic alias out of range. alias: %d",e),void t.emit("error",new Error("Received Topic Alias is out of range"));t.log("handlePublish :: registered topic: %s - alias: %d",i,e)}}switch(t.log("handlePublish: qos %d",a),a){case 2:l.customHandleAcks(i,s,r,(i,s)=>("number"==typeof i&&(s=i,i=null),i?t.emit("error",i):-1===e.indexOf(s)?t.emit("error",new Error("Wrong reason code for pubrec")):void(s?t._sendPacket({cmd:"pubrec",messageId:o,reasonCode:s},n):t.incomingStore.put(r,()=>{t._sendPacket({cmd:"pubrec",messageId:o},n)}))));break;case 1:l.customHandleAcks(i,s,r,(a,l)=>("number"==typeof a&&(l=a,a=null),a?t.emit("error",a):-1===e.indexOf(l)?t.emit("error",new Error("Wrong reason code for puback")):(l||t.emit("message",i,s,r),void t.handleMessage(r,e=>{if(e)return n&&n(e);t._sendPacket({cmd:"puback",messageId:o,reasonCode:l},n)}))));break;case 0:t.emit("message",i,s,r),t.handleMessage(r,n);break;default:t.log("handlePublish: unknown QoS. Doing nothing.")}}}),Rs=kr((t,e)=>{e.exports={version:"5.14.1"}}),Ls=kr(t=>{Ir(),Ei(),oi(),Object.defineProperty(t,"__esModule",{value:!0}),t.MQTTJS_VERSION=t.nextTick=t.ErrorWithSubackPacket=t.ErrorWithReasonCode=void 0,t.applyMixin=function(t,e){let r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=[e];for(;;){let t=n[0],e=Object.getPrototypeOf(t);if(null===e||void 0===e||!e.prototype)break;n.unshift(e)}for(let s of n)for(let e of Object.getOwnPropertyNames(s.prototype)){var i;(r||"constructor"!==e)&&Object.defineProperty(t.prototype,e,null!==(i=Object.getOwnPropertyDescriptor(s.prototype,e))&&void 0!==i?i:Object.create(null))}};var e=class t extends Error{constructor(e,r){super(e),o(this,"code",void 0),this.code=r,Object.setPrototypeOf(this,t.prototype),Object.getPrototypeOf(this).name="ErrorWithReasonCode"}};t.ErrorWithReasonCode=e;var r=class t extends Error{constructor(e,r){super(e),o(this,"packet",void 0),this.packet=r,Object.setPrototypeOf(this,t.prototype),Object.getPrototypeOf(this).name="ErrorWithSubackPacket"}};t.ErrorWithSubackPacket=r,t.nextTick="function"==typeof(null===Rr||void 0===Rr?void 0:Rr.nextTick)?Rr.nextTick:t=>{setTimeout(t,0)},t.MQTTJS_VERSION=Rs().version}),Ps=kr(t=>{Ir(),Ei(),oi(),Object.defineProperty(t,"__esModule",{value:!0}),t.ReasonCodes=void 0;var e=Ls();t.ReasonCodes={0:"",1:"Unacceptable protocol version",2:"Identifier rejected",3:"Server unavailable",4:"Bad username or password",5:"Not authorized",16:"No matching subscribers",17:"No subscription existed",128:"Unspecified error",129:"Malformed Packet",130:"Protocol Error",131:"Implementation specific error",132:"Unsupported Protocol Version",133:"Client Identifier not valid",134:"Bad User Name or Password",135:"Not authorized",136:"Server unavailable",137:"Server busy",138:"Banned",139:"Server shutting down",140:"Bad authentication method",141:"Keep Alive timeout",142:"Session taken over",143:"Topic Filter invalid",144:"Topic Name invalid",145:"Packet identifier in use",146:"Packet Identifier not found",147:"Receive Maximum exceeded",148:"Topic Alias invalid",149:"Packet too large",150:"Message rate too high",151:"Quota exceeded",152:"Administrative action",153:"Payload format invalid",154:"Retain not supported",155:"QoS not supported",156:"Use another server",157:"Server moved",158:"Shared Subscriptions not supported",159:"Connection rate exceeded",160:"Maximum connect time",161:"Subscription Identifiers not supported",162:"Wildcard Subscriptions not supported"};t.default=(r,n)=>{let{messageId:i}=n,s=n.cmd,a=null,o=r.outgoing[i]?r.outgoing[i].cb:null,l=null;if(o){switch(r.log("_handleAck :: packet type",s),s){case"pubcomp":case"puback":{let s=n.reasonCode;s&&s>0&&16!==s?(l=new e.ErrorWithReasonCode("Publish error: ".concat(t.ReasonCodes[s]),s),r._removeOutgoingAndStoreMessage(i,()=>{o(l,n)})):r._removeOutgoingAndStoreMessage(i,o);break}case"pubrec":{a={cmd:"pubrel",qos:2,messageId:i};let s=n.reasonCode;s&&s>0&&16!==s?(l=new e.ErrorWithReasonCode("Publish error: ".concat(t.ReasonCodes[s]),s),r._removeOutgoingAndStoreMessage(i,()=>{o(l,n)})):r._sendPacket(a);break}case"suback":{delete r.outgoing[i],r.messageIdProvider.deallocate(i);let e=n.granted;for(let n=0;n<e.length;n++){let s=e[n];if(0!==(128&s)){l=new Error("Subscribe error: ".concat(t.ReasonCodes[s])),l.code=s;let e=r.messageIdToTopic[i];e&&e.forEach(t=>{delete r._resubscribeTopics[t]})}}delete r.messageIdToTopic[i],r._invokeStoreProcessingQueue(),o(l,n);break}case"unsuback":delete r.outgoing[i],r.messageIdProvider.deallocate(i),r._invokeStoreProcessingQueue(),o(null,n);break;default:r.emit("error",new Error("unrecognized packet type"))}r.disconnecting&&0===Object.keys(r.outgoing).length&&r.emit("outgoingEmpty")}else r.log("_handleAck :: Server sent an ack in error. Ignoring.")}}),Cs=kr(t=>{Ir(),Ei(),oi(),Object.defineProperty(t,"__esModule",{value:!0});var e=Ls(),r=Ps();t.default=(t,n)=>{let{options:i}=t,s=i.protocolVersion,a=5===s?n.reasonCode:n.returnCode;if(5!==s){let r=new e.ErrorWithReasonCode("Protocol error: Auth packets are only supported in MQTT 5. Your version:".concat(s),a);return void t.emit("error",r)}t.handleAuth(n,(n,i)=>{if(n)t.emit("error",n);else if(24===a)t.reconnecting=!1,t._sendPacket(i);else{let n=new e.ErrorWithReasonCode("Connection refused: ".concat(r.ReasonCodes[a]),a);t.emit("error",n)}})}}),Ms=kr(t=>{var e,r,n,s,a,l,u,h,d,f,p,g,m,y,v,b,_,w,E,S,T,k,A,x,I,R,L,P,C,M,O,D,N;Ir(),Ei(),oi(),Object.defineProperty(t,"__esModule",{value:!0}),t.LRUCache=void 0;var F="object"==typeof performance&&performance&&"function"==typeof performance.now?performance:Date,U=new Set,B="object"==typeof Rr&&Rr?Rr:{},j=(t,e,r,n)=>{"function"==typeof B.emitWarning?B.emitWarning(t,e,r,n):console.error("[".concat(r,"] ").concat(e,": ").concat(t))},z=globalThis.AbortController,W=globalThis.AbortSignal;if(typeof z>"u"){var G;W=class{constructor(){o(this,"onabort",void 0),o(this,"_onabort",[]),o(this,"reason",void 0),o(this,"aborted",!1)}addEventListener(t,e){this._onabort.push(e)}},z=class{constructor(){o(this,"signal",new W),e()}abort(t){if(!this.signal.aborted){var e,r;this.signal.reason=t,this.signal.aborted=!0;for(let e of this.signal._onabort)e(t);null===(e=(r=this.signal).onabort)||void 0===e||e.call(r,t)}}};let t="1"!==(null===(G=B.env)||void 0===G?void 0:G.LRU_CACHE_IGNORE_AC_WARNING),e=()=>{t&&(t=!1,j("AbortController is not defined. If using lru-cache in node 14, load an AbortController polyfill from the `node-abort-controller` package. A minimal polyfill is provided for use by LRUCache.fetch(), but it should not be relied upon in other contexts (eg, passing it to other APIs that use AbortController/AbortSignal might have undesirable effects). You may disable this with LRU_CACHE_IGNORE_AC_WARNING=1 in the env.","NO_ABORT_CONTROLLER","ENOTSUP",e))}}Symbol("type");var V=t=>t&&t===Math.floor(t)&&t>0&&isFinite(t),H=t=>V(t)?t<=Math.pow(2,8)?Uint8Array:t<=Math.pow(2,16)?Uint16Array:t<=Math.pow(2,32)?Uint32Array:t<=Number.MAX_SAFE_INTEGER?K:null:null,K=class extends Array{constructor(t){super(t),this.fill(0)}},q=(e=class t{static create(n){let i=H(n);if(!i)return[];r._=lr(e,t,!0);let s=new t(n,i);return r._=lr(e,t,!1),s}constructor(n,i){if(o(this,"heap",void 0),o(this,"length",void 0),!lr(e,t,r)._)throw new TypeError("instantiate Stack using Stack.create(n)");this.heap=new i(n),this.length=0}push(t){this.heap[this.length++]=t}pop(){return this.heap[--this.length]}},r={_:!1},e),Y=(n=new WeakMap,s=new WeakMap,a=new WeakMap,l=new WeakMap,u=new WeakMap,h=new WeakMap,d=new WeakMap,f=new WeakMap,p=new WeakMap,g=new WeakMap,m=new WeakMap,y=new WeakMap,v=new WeakMap,b=new WeakMap,_=new WeakMap,w=new WeakMap,E=new WeakMap,S=new WeakMap,T=new WeakMap,k=new WeakMap,A=new WeakMap,x=new WeakMap,I=new WeakMap,R=new WeakSet,L=new WeakMap,P=new WeakMap,C=new WeakMap,M=new WeakMap,O=new WeakMap,D=new WeakMap,N=new WeakMap,class t{static unsafeExposeInternals(t){return{starts:ur(T,t),ttls:ur(k,t),sizes:ur(S,t),keyMap:ur(p,t),keyList:ur(g,t),valList:ur(m,t),next:ur(y,t),prev:ur(v,t),get head(){return ur(b,t)},get tail(){return ur(_,t)},free:ur(w,t),isBackgroundFetch:e=>lr(R,t,rt).call(t,e),backgroundFetch:(e,r,n,i)=>lr(R,t,et).call(t,e,r,n,i),moveToTail:e=>lr(R,t,it).call(t,e),indexes:e=>lr(R,t,$).call(t,e),rindexes:e=>lr(R,t,Z).call(t,e),isStale:e=>ur(M,t).call(t,e)}}get max(){return ur(n,this)}get maxSize(){return ur(s,this)}get calculatedSize(){return ur(f,this)}get size(){return ur(d,this)}get fetchMethod(){return ur(u,this)}get memoMethod(){return ur(h,this)}get dispose(){return ur(a,this)}get disposeAfter(){return ur(l,this)}constructor(e){var r,i;ar(r=this,i=R),i.add(r),or(this,n,void 0),or(this,s,void 0),or(this,a,void 0),or(this,l,void 0),or(this,u,void 0),or(this,h,void 0),o(this,"ttl",void 0),o(this,"ttlResolution",void 0),o(this,"ttlAutopurge",void 0),o(this,"updateAgeOnGet",void 0),o(this,"updateAgeOnHas",void 0),o(this,"allowStale",void 0),o(this,"noDisposeOnSet",void 0),o(this,"noUpdateTTL",void 0),o(this,"maxEntrySize",void 0),o(this,"sizeCalculation",void 0),o(this,"noDeleteOnFetchRejection",void 0),o(this,"noDeleteOnStaleGet",void 0),o(this,"allowStaleOnFetchAbort",void 0),o(this,"allowStaleOnFetchRejection",void 0),o(this,"ignoreFetchAbort",void 0),or(this,d,void 0),or(this,f,void 0),or(this,p,void 0),or(this,g,void 0),or(this,m,void 0),or(this,y,void 0),or(this,v,void 0),or(this,b,void 0),or(this,_,void 0),or(this,w,void 0),or(this,E,void 0),or(this,S,void 0),or(this,T,void 0),or(this,k,void 0),or(this,A,void 0),or(this,x,void 0),or(this,I,void 0),or(this,L,()=>{}),or(this,P,()=>{}),or(this,C,()=>{}),or(this,M,()=>!1),or(this,O,t=>{}),or(this,D,(t,e,r)=>{}),or(this,N,(t,e,r,n)=>{if(r||n)throw new TypeError("cannot set size without setting maxSize or maxEntrySize on cache");return 0}),o(this,Symbol.toStringTag,"LRUCache");let{max:c=0,ttl:F,ttlResolution:B=1,ttlAutopurge:z,updateAgeOnGet:W,updateAgeOnHas:G,allowStale:K,dispose:Y,disposeAfter:$,noDisposeOnSet:Z,noUpdateTTL:J,maxSize:tt=0,maxEntrySize:et=0,sizeCalculation:rt,fetchMethod:nt,memoMethod:it,noDeleteOnFetchRejection:st,noDeleteOnStaleGet:at,allowStaleOnFetchRejection:ot,allowStaleOnFetchAbort:lt,ignoreFetchAbort:ct}=e;if(0!==c&&!V(c))throw new TypeError("max option must be a nonnegative integer");let ut=c?H(c):Array;if(!ut)throw new Error("invalid max value: "+c);if(cr(n,this,c),cr(s,this,tt),this.maxEntrySize=et||ur(s,this),this.sizeCalculation=rt,this.sizeCalculation){if(!ur(s,this)&&!this.maxEntrySize)throw new TypeError("cannot set sizeCalculation without setting maxSize or maxEntrySize");if("function"!=typeof this.sizeCalculation)throw new TypeError("sizeCalculation set to non-function")}if(void 0!==it&&"function"!=typeof it)throw new TypeError("memoMethod must be a function if defined");if(cr(h,this,it),void 0!==nt&&"function"!=typeof nt)throw new TypeError("fetchMethod must be a function if specified");if(cr(u,this,nt),cr(x,this,!!nt),cr(p,this,new Map),cr(g,this,new Array(c).fill(void 0)),cr(m,this,new Array(c).fill(void 0)),cr(y,this,new ut(c)),cr(v,this,new ut(c)),cr(b,this,0),cr(_,this,0),cr(w,this,q.create(c)),cr(d,this,0),cr(f,this,0),"function"==typeof Y&&cr(a,this,Y),"function"==typeof $?(cr(l,this,$),cr(E,this,[])):(cr(l,this,void 0),cr(E,this,void 0)),cr(A,this,!!ur(a,this)),cr(I,this,!!ur(l,this)),this.noDisposeOnSet=!!Z,this.noUpdateTTL=!!J,this.noDeleteOnFetchRejection=!!st,this.allowStaleOnFetchRejection=!!ot,this.allowStaleOnFetchAbort=!!lt,this.ignoreFetchAbort=!!ct,0!==this.maxEntrySize){if(0!==ur(s,this)&&!V(ur(s,this)))throw new TypeError("maxSize must be a positive integer if specified");if(!V(this.maxEntrySize))throw new TypeError("maxEntrySize must be a positive integer if specified");lr(R,this,X).call(this)}if(this.allowStale=!!K,this.noDeleteOnStaleGet=!!at,this.updateAgeOnGet=!!W,this.updateAgeOnHas=!!G,this.ttlResolution=V(B)||0===B?B:1,this.ttlAutopurge=!!z,this.ttl=F||0,this.ttl){if(!V(this.ttl))throw new TypeError("ttl must be a positive integer if specified");lr(R,this,Q).call(this)}if(0===ur(n,this)&&0===this.ttl&&0===ur(s,this))throw new TypeError("At least one of max, maxSize, or ttl is required");if(!this.ttlAutopurge&&!ur(n,this)&&!ur(s,this)){let e="LRU_CACHE_UNBOUNDED";(t=>!U.has(t))(e)&&(U.add(e),j("TTL caching without ttlAutopurge, max, or maxSize can result in unbounded memory consumption.","UnboundedCacheWarning",e,t))}}getRemainingTTL(t){return ur(p,this).has(t)?1/0:0}*entries(){for(let t of lr(R,this,$).call(this))void 0!==ur(m,this)[t]&&void 0!==ur(g,this)[t]&&!lr(R,this,rt).call(this,ur(m,this)[t])&&(yield[ur(g,this)[t],ur(m,this)[t]])}*rentries(){for(let t of lr(R,this,Z).call(this))void 0!==ur(m,this)[t]&&void 0!==ur(g,this)[t]&&!lr(R,this,rt).call(this,ur(m,this)[t])&&(yield[ur(g,this)[t],ur(m,this)[t]])}*keys(){for(let t of lr(R,this,$).call(this)){let e=ur(g,this)[t];void 0!==e&&!lr(R,this,rt).call(this,ur(m,this)[t])&&(yield e)}}*rkeys(){for(let t of lr(R,this,Z).call(this)){let e=ur(g,this)[t];void 0!==e&&!lr(R,this,rt).call(this,ur(m,this)[t])&&(yield e)}}*values(){for(let t of lr(R,this,$).call(this))void 0!==ur(m,this)[t]&&!lr(R,this,rt).call(this,ur(m,this)[t])&&(yield ur(m,this)[t])}*rvalues(){for(let t of lr(R,this,Z).call(this))void 0!==ur(m,this)[t]&&!lr(R,this,rt).call(this,ur(m,this)[t])&&(yield ur(m,this)[t])}[Symbol.iterator](){return this.entries()}find(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};for(let r of lr(R,this,$).call(this)){let n=ur(m,this)[r],i=lr(R,this,rt).call(this,n)?n.__staleWhileFetching:n;if(void 0!==i&&t(i,ur(g,this)[r],this))return this.get(ur(g,this)[r],e)}}forEach(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this;for(let r of lr(R,this,$).call(this)){let n=ur(m,this)[r],i=lr(R,this,rt).call(this,n)?n.__staleWhileFetching:n;void 0!==i&&t.call(e,i,ur(g,this)[r],this)}}rforEach(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this;for(let r of lr(R,this,Z).call(this)){let n=ur(m,this)[r],i=lr(R,this,rt).call(this,n)?n.__staleWhileFetching:n;void 0!==i&&t.call(e,i,ur(g,this)[r],this)}}purgeStale(){let t=!1;for(let e of lr(R,this,Z).call(this,{allowStale:!0}))ur(M,this).call(this,e)&&(lr(R,this,st).call(this,ur(g,this)[e],"expire"),t=!0);return t}info(t){let e=ur(p,this).get(t);if(void 0===e)return;let r=ur(m,this)[e],n=lr(R,this,rt).call(this,r)?r.__staleWhileFetching:r;if(void 0===n)return;let i={value:n};if(ur(k,this)&&ur(T,this)){let t=ur(k,this)[e],r=ur(T,this)[e];if(t&&r){let e=t-(F.now()-r);i.ttl=e,i.start=Date.now()}}return ur(S,this)&&(i.size=ur(S,this)[e]),i}dump(){let t=[];for(let e of lr(R,this,$).call(this,{allowStale:!0})){let r=ur(g,this)[e],n=ur(m,this)[e],i=lr(R,this,rt).call(this,n)?n.__staleWhileFetching:n;if(void 0===i||void 0===r)continue;let s={value:i};if(ur(k,this)&&ur(T,this)){s.ttl=ur(k,this)[e];let t=F.now()-ur(T,this)[e];s.start=Math.floor(Date.now()-t)}ur(S,this)&&(s.size=ur(S,this)[e]),t.unshift([r,s])}return t}load(t){this.clear();for(let[e,r]of t){if(r.start){let t=Date.now()-r.start;r.start=F.now()-t}this.set(e,r.value,r)}}set(t,e){var r;let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(void 0===e)return this.delete(t),this;let{ttl:s=this.ttl,start:o,noDisposeOnSet:c=this.noDisposeOnSet,sizeCalculation:u=this.sizeCalculation,status:h}=i,{noUpdateTTL:f=this.noUpdateTTL}=i,b=ur(N,this).call(this,t,e,i.size||0,u);if(this.maxEntrySize&&b>this.maxEntrySize)return h&&(h.set="miss",h.maxEntrySizeExceeded=!0),lr(R,this,st).call(this,t,"set"),this;let S=0===ur(d,this)?void 0:ur(p,this).get(t);if(void 0===S)S=0===ur(d,this)?ur(_,this):0!==ur(w,this).length?ur(w,this).pop():ur(d,this)===ur(n,this)?lr(R,this,tt).call(this,!1):ur(d,this),ur(g,this)[S]=t,ur(m,this)[S]=e,ur(p,this).set(t,S),ur(y,this)[ur(_,this)]=S,ur(v,this)[S]=ur(_,this),cr(_,this,S),cr(d,this,(r=ur(d,this),r++,r)),ur(D,this).call(this,S,b,h),h&&(h.set="add"),f=!1;else{lr(R,this,it).call(this,S);let r=ur(m,this)[S];if(e!==r){var T,L;if(ur(x,this)&&lr(R,this,rt).call(this,r)){var M,F;r.__abortController.abort(new Error("replaced"));let{__staleWhileFetching:e}=r;void 0!==e&&!c&&(ur(A,this)&&null!==(M=ur(a,this))&&void 0!==M&&M.call(this,e,t,"set"),ur(I,this)&&(null===(F=ur(E,this))||void 0===F||F.push([e,t,"set"])))}else c||(ur(A,this)&&null!==(T=ur(a,this))&&void 0!==T&&T.call(this,r,t,"set"),ur(I,this)&&(null===(L=ur(E,this))||void 0===L||L.push([r,t,"set"])));if(ur(O,this).call(this,S),ur(D,this).call(this,S,b,h),ur(m,this)[S]=e,h){h.set="replace";let t=r&&lr(R,this,rt).call(this,r)?r.__staleWhileFetching:r;void 0!==t&&(h.oldValue=t)}}else h&&(h.set="update")}if(0!==s&&!ur(k,this)&&lr(R,this,Q).call(this),ur(k,this)&&(f||ur(C,this).call(this,S,s,o),h&&ur(P,this).call(this,h,S)),!c&&ur(I,this)&&ur(E,this)){let t,e=ur(E,this);for(;t=null===e||void 0===e?void 0:e.shift();){var U;null===(U=ur(l,this))||void 0===U||U.call(this,...t)}}return this}pop(){try{for(;ur(d,this);){let t=ur(m,this)[ur(b,this)];if(lr(R,this,tt).call(this,!0),lr(R,this,rt).call(this,t)){if(t.__staleWhileFetching)return t.__staleWhileFetching}else if(void 0!==t)return t}}finally{if(ur(I,this)&&ur(E,this)){let e,r=ur(E,this);for(;e=null===r||void 0===r?void 0:r.shift();){var t;null===(t=ur(l,this))||void 0===t||t.call(this,...e)}}}}has(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},{updateAgeOnHas:r=this.updateAgeOnHas,status:n}=e,i=ur(p,this).get(t);if(void 0!==i){let t=ur(m,this)[i];if(lr(R,this,rt).call(this,t)&&void 0===t.__staleWhileFetching)return!1;if(!ur(M,this).call(this,i))return r&&ur(L,this).call(this,i),n&&(n.has="hit",ur(P,this).call(this,n,i)),!0;n&&(n.has="stale",ur(P,this).call(this,n,i))}else n&&(n.has="miss");return!1}peek(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},{allowStale:r=this.allowStale}=e,n=ur(p,this).get(t);if(void 0===n||!r&&ur(M,this).call(this,n))return;let i=ur(m,this)[n];return lr(R,this,rt).call(this,i)?i.__staleWhileFetching:i}async fetch(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},{allowStale:r=this.allowStale,updateAgeOnGet:n=this.updateAgeOnGet,noDeleteOnStaleGet:i=this.noDeleteOnStaleGet,ttl:s=this.ttl,noDisposeOnSet:a=this.noDisposeOnSet,size:o=0,sizeCalculation:l=this.sizeCalculation,noUpdateTTL:c=this.noUpdateTTL,noDeleteOnFetchRejection:u=this.noDeleteOnFetchRejection,allowStaleOnFetchRejection:h=this.allowStaleOnFetchRejection,ignoreFetchAbort:d=this.ignoreFetchAbort,allowStaleOnFetchAbort:f=this.allowStaleOnFetchAbort,context:g,forceRefresh:y=!1,status:v,signal:b}=e;if(!ur(x,this))return v&&(v.fetch="get"),this.get(t,{allowStale:r,updateAgeOnGet:n,noDeleteOnStaleGet:i,status:v});let _={allowStale:r,updateAgeOnGet:n,noDeleteOnStaleGet:i,ttl:s,noDisposeOnSet:a,size:o,sizeCalculation:l,noUpdateTTL:c,noDeleteOnFetchRejection:u,allowStaleOnFetchRejection:h,allowStaleOnFetchAbort:f,ignoreFetchAbort:d,status:v,signal:b},w=ur(p,this).get(t);if(void 0===w){v&&(v.fetch="miss");let e=lr(R,this,et).call(this,t,w,_,g);return e.__returned=e}{let e=ur(m,this)[w];if(lr(R,this,rt).call(this,e)){let t=r&&void 0!==e.__staleWhileFetching;return v&&(v.fetch="inflight",t&&(v.returnedStale=!0)),t?e.__staleWhileFetching:e.__returned=e}let i=ur(M,this).call(this,w);if(!y&&!i)return v&&(v.fetch="hit"),lr(R,this,it).call(this,w),n&&ur(L,this).call(this,w),v&&ur(P,this).call(this,v,w),e;let s=lr(R,this,et).call(this,t,w,_,g),a=void 0!==s.__staleWhileFetching&&r;return v&&(v.fetch=i?"stale":"refresh",a&&i&&(v.returnedStale=!0)),a?s.__staleWhileFetching:s.__returned=s}}async forceFetch(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=await this.fetch(t,e);if(void 0===r)throw new Error("fetch() returned undefined");return r}memo(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=ur(h,this);if(!r)throw new Error("no memoMethod provided to constructor");let{context:n,forceRefresh:s}=e,a=i(e,vr),o=this.get(t,a);if(!s&&void 0!==o)return o;let l=r(t,o,{options:a,context:n});return this.set(t,l,a),l}get(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},{allowStale:r=this.allowStale,updateAgeOnGet:n=this.updateAgeOnGet,noDeleteOnStaleGet:i=this.noDeleteOnStaleGet,status:s}=e,a=ur(p,this).get(t);if(void 0!==a){let e=ur(m,this)[a],o=lr(R,this,rt).call(this,e);return s&&ur(P,this).call(this,s,a),ur(M,this).call(this,a)?(s&&(s.get="stale"),o?(s&&r&&void 0!==e.__staleWhileFetching&&(s.returnedStale=!0),r?e.__staleWhileFetching:void 0):(i||lr(R,this,st).call(this,t,"expire"),s&&r&&(s.returnedStale=!0),r?e:void 0)):(s&&(s.get="hit"),o?e.__staleWhileFetching:(lr(R,this,it).call(this,a),n&&ur(L,this).call(this,a),e))}s&&(s.get="miss")}delete(t){return lr(R,this,st).call(this,t,"delete")}clear(){return lr(R,this,at).call(this,"delete")}});function Q(){var t=this;let e=new K(ur(n,this)),r=new K(ur(n,this));cr(k,this,e),cr(T,this,r),cr(C,this,function(n,i){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:F.now();if(r[n]=0!==i?s:0,e[n]=i,0!==i&&t.ttlAutopurge){let e=setTimeout(()=>{ur(M,t).call(t,n)&&lr(R,t,st).call(t,ur(g,t)[n],"expire")},i+1);e.unref&&e.unref()}}),cr(L,this,t=>{r[t]=0!==e[t]?F.now():0}),cr(P,this,(t,n)=>{if(e[n]){let a=e[n],o=r[n];if(!a||!o)return;t.ttl=a,t.start=o,t.now=i||s();let l=t.now-o;t.remainingTTL=a-l}});let i=0,s=()=>{let t=F.now();if(this.ttlResolution>0){i=t;let e=setTimeout(()=>i=0,this.ttlResolution);e.unref&&e.unref()}return t};this.getRemainingTTL=t=>{let n=ur(p,this).get(t);if(void 0===n)return 0;let a=e[n],o=r[n];return a&&o?a-((i||s())-o):1/0},cr(M,this,t=>{let n=r[t],a=e[t];return!!a&&!!n&&(i||s())-n>a})}function X(){let t=new K(ur(n,this));cr(f,this,0),cr(S,this,t),cr(O,this,e=>{cr(f,this,ur(f,this)-t[e]),t[e]=0}),cr(N,this,(t,e,r,n)=>{if(lr(R,this,rt).call(this,e))return 0;if(!V(r)){if(!n)throw new TypeError("invalid size value (must be positive integer). When maxSize or maxEntrySize is used, sizeCalculation or size must be set.");if("function"!=typeof n)throw new TypeError("sizeCalculation must be a function");if(r=n(e,t),!V(r))throw new TypeError("sizeCalculation return invalid (expect positive integer)")}return r}),cr(D,this,(e,r,n)=>{if(t[e]=r,ur(s,this)){let r=ur(s,this)-t[e];for(;ur(f,this)>r;)lr(R,this,tt).call(this,!0)}cr(f,this,ur(f,this)+t[e]),n&&(n.entrySize=r,n.totalCalculatedSize=ur(f,this))})}function $(){var t=this;let{allowStale:e=this.allowStale}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return function*(){if(ur(d,t))for(let r=ur(_,t);lr(R,t,J).call(t,r)&&((e||!ur(M,t).call(t,r))&&(yield r),r!==ur(b,t));)r=ur(v,t)[r]}()}function Z(){var t=this;let{allowStale:e=this.allowStale}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return function*(){if(ur(d,t))for(let r=ur(b,t);lr(R,t,J).call(t,r)&&((e||!ur(M,t).call(t,r))&&(yield r),r!==ur(_,t));)r=ur(y,t)[r]}()}function J(t){return void 0!==t&&ur(p,this).get(ur(g,this)[t])===t}function tt(t){var e,r,n;let i=ur(b,this),s=ur(g,this)[i],o=ur(m,this)[i];return ur(x,this)&&lr(R,this,rt).call(this,o)?o.__abortController.abort(new Error("evicted")):(ur(A,this)||ur(I,this))&&(ur(A,this)&&null!==(e=ur(a,this))&&void 0!==e&&e.call(this,o,s,"evict"),ur(I,this)&&(null===(r=ur(E,this))||void 0===r||r.push([o,s,"evict"]))),ur(O,this).call(this,i),t&&(ur(g,this)[i]=void 0,ur(m,this)[i]=void 0,ur(w,this).push(i)),1===ur(d,this)?(cr(b,this,cr(_,this,0)),ur(w,this).length=0):cr(b,this,ur(y,this)[i]),ur(p,this).delete(s),cr(d,this,(n=ur(d,this),n--,n)),i}function et(t,e,r,n){var i=this;let s=void 0===e?void 0:ur(m,this)[e];if(lr(R,this,rt).call(this,s))return s;let a=new z,{signal:o}=r;null===o||void 0===o||o.addEventListener("abort",()=>a.abort(o.reason),{signal:a.signal});let l={signal:a.signal,options:r,context:n},h=function(n){let s=arguments.length>1&&void 0!==arguments[1]&&arguments[1],{aborted:o}=a.signal,c=r.ignoreFetchAbort&&void 0!==n;if(r.status&&(o&&!s?(r.status.fetchAborted=!0,r.status.fetchError=a.signal.reason,c&&(r.status.fetchAbortIgnored=!0)):r.status.fetchResolved=!0),o&&!c&&!s)return d(a.signal.reason);let u=f;return ur(m,i)[e]===f&&(void 0===n?u.__staleWhileFetching?ur(m,i)[e]=u.__staleWhileFetching:lr(R,i,st).call(i,t,"fetch"):(r.status&&(r.status.fetchUpdated=!0),i.set(t,n,l.options))),n},d=n=>{let{aborted:i}=a.signal,s=i&&r.allowStaleOnFetchAbort,o=s||r.allowStaleOnFetchRejection,l=o||r.noDeleteOnFetchRejection,c=f;if(ur(m,this)[e]===f&&(l&&void 0!==c.__staleWhileFetching?s||(ur(m,this)[e]=c.__staleWhileFetching):lr(R,this,st).call(this,t,"fetch")),o)return r.status&&void 0!==c.__staleWhileFetching&&(r.status.returnedStale=!0),c.__staleWhileFetching;if(c.__returned===c)throw n};r.status&&(r.status.fetchDispatched=!0);let f=new Promise((e,n)=>{var i;let o=null===(i=ur(u,this))||void 0===i?void 0:i.call(this,t,s,l);o&&o instanceof Promise&&o.then(t=>e(void 0===t?void 0:t),n),a.signal.addEventListener("abort",()=>{(!r.ignoreFetchAbort||r.allowStaleOnFetchAbort)&&(e(void 0),r.allowStaleOnFetchAbort&&(e=t=>h(t,!0)))})}).then(h,t=>(r.status&&(r.status.fetchRejected=!0,r.status.fetchError=t),d(t))),g=Object.assign(f,{__abortController:a,__staleWhileFetching:s,__returned:void 0});return void 0===e?(this.set(t,g,c(c({},l.options),{},{status:void 0})),e=ur(p,this).get(t)):ur(m,this)[e]=g,g}function rt(t){if(!ur(x,this))return!1;let e=t;return!!e&&e instanceof Promise&&e.hasOwnProperty("__staleWhileFetching")&&e.__abortController instanceof z}function nt(t,e){ur(v,this)[e]=t,ur(y,this)[t]=e}function it(t){t!==ur(_,this)&&(t===ur(b,this)?cr(b,this,ur(y,this)[t]):lr(R,this,nt).call(this,ur(v,this)[t],ur(y,this)[t]),lr(R,this,nt).call(this,ur(_,this),t),cr(_,this,t))}function st(t,e){var r;let n=!1;if(0!==ur(d,this)){let r=ur(p,this).get(t);if(void 0!==r)if(n=!0,1===ur(d,this))lr(R,this,at).call(this,e);else{var i,s,o;ur(O,this).call(this,r);let n=ur(m,this)[r];if(lr(R,this,rt).call(this,n)?n.__abortController.abort(new Error("deleted")):(ur(A,this)||ur(I,this))&&(ur(A,this)&&null!==(s=ur(a,this))&&void 0!==s&&s.call(this,n,t,e),ur(I,this)&&(null===(o=ur(E,this))||void 0===o||o.push([n,t,e]))),ur(p,this).delete(t),ur(g,this)[r]=void 0,ur(m,this)[r]=void 0,r===ur(_,this))cr(_,this,ur(v,this)[r]);else if(r===ur(b,this))cr(b,this,ur(y,this)[r]);else{let t=ur(v,this)[r];ur(y,this)[t]=ur(y,this)[r];let e=ur(y,this)[r];ur(v,this)[e]=ur(v,this)[r]}cr(d,this,(i=ur(d,this),i--,i)),ur(w,this).push(r)}}if(ur(I,this)&&null!==(r=ur(E,this))&&void 0!==r&&r.length){let t,e=ur(E,this);for(;t=null===e||void 0===e?void 0:e.shift();){var c;null===(c=ur(l,this))||void 0===c||c.call(this,...t)}}return n}function at(t){for(let i of lr(R,this,Z).call(this,{allowStale:!0})){let n=ur(m,this)[i];if(lr(R,this,rt).call(this,n))n.__abortController.abort(new Error("deleted"));else{var e,r;let s=ur(g,this)[i];ur(A,this)&&null!==(e=ur(a,this))&&void 0!==e&&e.call(this,n,s,t),ur(I,this)&&(null===(r=ur(E,this))||void 0===r||r.push([n,s,t]))}}if(ur(p,this).clear(),ur(m,this).fill(void 0),ur(g,this).fill(void 0),ur(k,this)&&ur(T,this)&&(ur(k,this).fill(0),ur(T,this).fill(0)),ur(S,this)&&ur(S,this).fill(0),cr(b,this,0),cr(_,this,0),ur(w,this).length=0,cr(f,this,0),cr(d,this,0),ur(I,this)&&ur(E,this)){let t,e=ur(E,this);for(;t=null===e||void 0===e?void 0:e.shift();){var n;null===(n=ur(l,this))||void 0===n||n.call(this,...t)}}}t.LRUCache=Y}),Os=kr(t=>{Ir(),Ei(),oi(),Object.defineProperty(t,"t",{value:!0}),t.ContainerIterator=t.Container=t.Base=void 0;t.ContainerIterator=class{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;this.iteratorType=t}equals(t){return this.o===t.o}};var e=class{constructor(){this.i=0}get length(){return this.i}size(){return this.i}empty(){return 0===this.i}};t.Base=e;t.Container=class extends e{}}),Ds=kr(t=>{Ir(),Ei(),oi(),Object.defineProperty(t,"t",{value:!0}),t.default=void 0;var e=Os(),r=class extends e.Base{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];super(),this.S=[];let e=this;t.forEach(function(t){e.push(t)})}clear(){this.i=0,this.S=[]}push(t){return this.S.push(t),this.i+=1,this.i}pop(){if(0!==this.i)return this.i-=1,this.S.pop()}top(){return this.S[this.i-1]}};t.default=r}),Ns=kr(t=>{Ir(),Ei(),oi(),Object.defineProperty(t,"t",{value:!0}),t.default=void 0;var e=Os(),r=class extends e.Base{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];super(),this.j=0,this.q=[];let e=this;t.forEach(function(t){e.push(t)})}clear(){this.q=[],this.i=this.j=0}push(t){let e=this.q.length;if(this.j/e>.5&&this.j+this.i>=e&&e>4096){let e=this.i;for(let t=0;t<e;++t)this.q[t]=this.q[this.j+t];this.j=0,this.q[this.i]=t}else this.q[this.j+this.i]=t;return++this.i}pop(){if(0===this.i)return;let t=this.q[this.j++];return this.i-=1,t}front(){if(0!==this.i)return this.q[this.j]}};t.default=r}),Fs=kr(t=>{Ir(),Ei(),oi(),Object.defineProperty(t,"t",{value:!0}),t.default=void 0;var e=Os(),r=class extends e.Base{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(t,e){return t>e?-1:t<e?1:0},r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(super(),this.v=e,Array.isArray(t))this.C=r?[...t]:t;else{this.C=[];let e=this;t.forEach(function(t){e.C.push(t)})}this.i=this.C.length;let n=this.i>>1;for(let i=this.i-1>>1;i>=0;--i)this.k(i,n)}m(t){let e=this.C[t];for(;t>0;){let r=t-1>>1,n=this.C[r];if(this.v(n,e)<=0)break;this.C[t]=n,t=r}this.C[t]=e}k(t,e){let r=this.C[t];for(;t<e;){let e=t<<1|1,n=e+1,i=this.C[e];if(n<this.i&&this.v(i,this.C[n])>0&&(e=n,i=this.C[n]),this.v(i,r)>=0)break;this.C[t]=i,t=e}this.C[t]=r}clear(){this.i=0,this.C.length=0}push(t){this.C.push(t),this.m(this.i),this.i+=1}pop(){if(0===this.i)return;let t=this.C[0],e=this.C.pop();return this.i-=1,this.i&&(this.C[0]=e,this.k(0,this.i>>1)),t}top(){return this.C[0]}find(t){return this.C.indexOf(t)>=0}remove(t){let e=this.C.indexOf(t);return!(e<0)&&(0===e?this.pop():e===this.i-1?(this.C.pop(),this.i-=1):(this.C.splice(e,1,this.C.pop()),this.i-=1,this.m(e),this.k(e,this.i>>1)),!0)}updateItem(t){let e=this.C.indexOf(t);return!(e<0)&&(this.m(e),this.k(e,this.i>>1),!0)}toArray(){return[...this.C]}};t.default=r}),Us=kr(t=>{Ir(),Ei(),oi(),Object.defineProperty(t,"t",{value:!0}),t.default=void 0;var e=Os(),r=class extends e.Container{};t.default=r}),Bs=kr(t=>{Ir(),Ei(),oi(),Object.defineProperty(t,"t",{value:!0}),t.throwIteratorAccessError=function(){throw new RangeError("Iterator access denied!")}}),js=kr(t=>{Ir(),Ei(),oi(),Object.defineProperty(t,"t",{value:!0}),t.RandomIterator=void 0;var e=Os(),r=Bs(),n=class extends e.ContainerIterator{constructor(t,e){super(e),this.o=t,0===this.iteratorType?(this.pre=function(){return 0===this.o&&(0,r.throwIteratorAccessError)(),this.o-=1,this},this.next=function(){return this.o===this.container.size()&&(0,r.throwIteratorAccessError)(),this.o+=1,this}):(this.pre=function(){return this.o===this.container.size()-1&&(0,r.throwIteratorAccessError)(),this.o+=1,this},this.next=function(){return-1===this.o&&(0,r.throwIteratorAccessError)(),this.o-=1,this})}get pointer(){return this.container.getElementByPos(this.o)}set pointer(t){this.container.setElementByPos(this.o,t)}};t.RandomIterator=n}),zs=kr(t=>{Ir(),Ei(),oi(),Object.defineProperty(t,"t",{value:!0}),t.default=void 0;var e,r=(e=Us())&&e.t?e:{default:e},n=js();var i=class t extends n.RandomIterator{constructor(t,e,r){super(t,r),this.container=e}copy(){return new t(this.o,this.container,this.iteratorType)}},s=class extends r.default{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(super(),Array.isArray(t))this.J=e?[...t]:t,this.i=t.length;else{this.J=[];let e=this;t.forEach(function(t){e.pushBack(t)})}}clear(){this.i=0,this.J.length=0}begin(){return new i(0,this)}end(){return new i(this.i,this)}rBegin(){return new i(this.i-1,this,1)}rEnd(){return new i(-1,this,1)}front(){return this.J[0]}back(){return this.J[this.i-1]}getElementByPos(t){if(t<0||t>this.i-1)throw new RangeError;return this.J[t]}eraseElementByPos(t){if(t<0||t>this.i-1)throw new RangeError;return this.J.splice(t,1),this.i-=1,this.i}eraseElementByValue(t){let e=0;for(let r=0;r<this.i;++r)this.J[r]!==t&&(this.J[e++]=this.J[r]);return this.i=this.J.length=e,this.i}eraseElementByIterator(t){let e=t.o;return t=t.next(),this.eraseElementByPos(e),t}pushBack(t){return this.J.push(t),this.i+=1,this.i}popBack(){if(0!==this.i)return this.i-=1,this.J.pop()}setElementByPos(t,e){if(t<0||t>this.i-1)throw new RangeError;this.J[t]=e}insert(t,e){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;if(t<0||t>this.i)throw new RangeError;return this.J.splice(t,0,...new Array(r).fill(e)),this.i+=r,this.i}find(t){for(let e=0;e<this.i;++e)if(this.J[e]===t)return new i(e,this);return this.end()}reverse(){this.J.reverse()}unique(){let t=1;for(let e=1;e<this.i;++e)this.J[e]!==this.J[e-1]&&(this.J[t++]=this.J[e]);return this.i=this.J.length=t,this.i}sort(t){this.J.sort(t)}forEach(t){for(let e=0;e<this.i;++e)t(this.J[e],e,this)}[Symbol.iterator](){return function*(){yield*this.J}.bind(this)()}};t.default=s}),Ws=kr(t=>{Ir(),Ei(),oi(),Object.defineProperty(t,"t",{value:!0}),t.default=void 0;var e,r=(e=Us())&&e.t?e:{default:e},n=Os(),i=Bs();var s=class t extends n.ContainerIterator{constructor(t,e,r,n){super(n),this.o=t,this.h=e,this.container=r,0===this.iteratorType?(this.pre=function(){return this.o.L===this.h&&(0,i.throwIteratorAccessError)(),this.o=this.o.L,this},this.next=function(){return this.o===this.h&&(0,i.throwIteratorAccessError)(),this.o=this.o.B,this}):(this.pre=function(){return this.o.B===this.h&&(0,i.throwIteratorAccessError)(),this.o=this.o.B,this},this.next=function(){return this.o===this.h&&(0,i.throwIteratorAccessError)(),this.o=this.o.L,this})}get pointer(){return this.o===this.h&&(0,i.throwIteratorAccessError)(),this.o.l}set pointer(t){this.o===this.h&&(0,i.throwIteratorAccessError)(),this.o.l=t}copy(){return new t(this.o,this.h,this.container,this.iteratorType)}},a=class extends r.default{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];super(),this.h={},this.p=this._=this.h.L=this.h.B=this.h;let e=this;t.forEach(function(t){e.pushBack(t)})}V(t){let{L:e,B:r}=t;e.B=r,r.L=e,t===this.p&&(this.p=r),t===this._&&(this._=e),this.i-=1}G(t,e){let r=e.B,n={l:t,L:e,B:r};e.B=n,r.L=n,e===this.h&&(this.p=n),r===this.h&&(this._=n),this.i+=1}clear(){this.i=0,this.p=this._=this.h.L=this.h.B=this.h}begin(){return new s(this.p,this.h,this)}end(){return new s(this.h,this.h,this)}rBegin(){return new s(this._,this.h,this,1)}rEnd(){return new s(this.h,this.h,this,1)}front(){return this.p.l}back(){return this._.l}getElementByPos(t){if(t<0||t>this.i-1)throw new RangeError;let e=this.p;for(;t--;)e=e.B;return e.l}eraseElementByPos(t){if(t<0||t>this.i-1)throw new RangeError;let e=this.p;for(;t--;)e=e.B;return this.V(e),this.i}eraseElementByValue(t){let e=this.p;for(;e!==this.h;)e.l===t&&this.V(e),e=e.B;return this.i}eraseElementByIterator(t){let e=t.o;return e===this.h&&(0,i.throwIteratorAccessError)(),t=t.next(),this.V(e),t}pushBack(t){return this.G(t,this._),this.i}popBack(){if(0===this.i)return;let t=this._.l;return this.V(this._),t}pushFront(t){return this.G(t,this.h),this.i}popFront(){if(0===this.i)return;let t=this.p.l;return this.V(this.p),t}setElementByPos(t,e){if(t<0||t>this.i-1)throw new RangeError;let r=this.p;for(;t--;)r=r.B;r.l=e}insert(t,e){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;if(t<0||t>this.i)throw new RangeError;if(r<=0)return this.i;if(0===t)for(;r--;)this.pushFront(e);else if(t===this.i)for(;r--;)this.pushBack(e);else{let n=this.p;for(let e=1;e<t;++e)n=n.B;let i=n.B;for(this.i+=r;r--;)n.B={l:e,L:n},n.B.L=n,n=n.B;n.B=i,i.L=n}return this.i}find(t){let e=this.p;for(;e!==this.h;){if(e.l===t)return new s(e,this.h,this);e=e.B}return this.end()}reverse(){if(this.i<=1)return;let t=this.p,e=this._,r=0;for(;r<<1<this.i;){let n=t.l;t.l=e.l,e.l=n,t=t.B,e=e.L,r+=1}}unique(){if(this.i<=1)return this.i;let t=this.p;for(;t!==this.h;){let e=t;for(;e.B!==this.h&&e.l===e.B.l;)e=e.B,this.i-=1;t.B=e.B,t.B.L=t,t=t.B}return this.i}sort(t){if(this.i<=1)return;let e=[];this.forEach(function(t){e.push(t)}),e.sort(t);let r=this.p;e.forEach(function(t){r.l=t,r=r.B})}merge(t){let e=this;if(0===this.i)t.forEach(function(t){e.pushBack(t)});else{let r=this.p;t.forEach(function(t){for(;r!==e.h&&r.l<=t;)r=r.B;e.G(t,r.L)})}return this.i}forEach(t){let e=this.p,r=0;for(;e!==this.h;)t(e.l,r++,this),e=e.B}[Symbol.iterator](){return function*(){if(0===this.i)return;let t=this.p;for(;t!==this.h;)yield t.l,t=t.B}.bind(this)()}};t.default=a}),Gs=kr(t=>{Ir(),Ei(),oi(),Object.defineProperty(t,"t",{value:!0}),t.default=void 0;var e,r=(e=Us())&&e.t?e:{default:e},n=js();var i=class t extends n.RandomIterator{constructor(t,e,r){super(t,r),this.container=e}copy(){return new t(this.o,this.container,this.iteratorType)}},s=class extends r.default{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:4096;super(),this.j=0,this.D=0,this.R=0,this.N=0,this.P=0,this.A=[];let r=(()=>{if("number"==typeof t.length)return t.length;if("number"==typeof t.size)return t.size;if("function"==typeof t.size)return t.size();throw new TypeError("Cannot get the length or size of the container")})();this.F=e,this.P=Math.max(Math.ceil(r/this.F),1);for(let s=0;s<this.P;++s)this.A.push(new Array(this.F));let n=Math.ceil(r/this.F);this.j=this.R=(this.P>>1)-(n>>1),this.D=this.N=this.F-r%this.F>>1;let i=this;t.forEach(function(t){i.pushBack(t)})}T(){let t=[],e=Math.max(this.P>>1,1);for(let r=0;r<e;++r)t[r]=new Array(this.F);for(let r=this.j;r<this.P;++r)t[t.length]=this.A[r];for(let r=0;r<this.R;++r)t[t.length]=this.A[r];t[t.length]=[...this.A[this.R]],this.j=e,this.R=t.length-1;for(let r=0;r<e;++r)t[t.length]=new Array(this.F);this.A=t,this.P=t.length}O(t){let e=this.D+t+1,r=e%this.F,n=r-1,i=this.j+(e-r)/this.F;return 0===r&&(i-=1),i%=this.P,n<0&&(n+=this.F),{curNodeBucketIndex:i,curNodePointerIndex:n}}clear(){this.A=[new Array(this.F)],this.P=1,this.j=this.R=this.i=0,this.D=this.N=this.F>>1}begin(){return new i(0,this)}end(){return new i(this.i,this)}rBegin(){return new i(this.i-1,this,1)}rEnd(){return new i(-1,this,1)}front(){if(0!==this.i)return this.A[this.j][this.D]}back(){if(0!==this.i)return this.A[this.R][this.N]}pushBack(t){return this.i&&(this.N<this.F-1?this.N+=1:this.R<this.P-1?(this.R+=1,this.N=0):(this.R=0,this.N=0),this.R===this.j&&this.N===this.D&&this.T()),this.i+=1,this.A[this.R][this.N]=t,this.i}popBack(){if(0===this.i)return;let t=this.A[this.R][this.N];return 1!==this.i&&(this.N>0?this.N-=1:this.R>0?(this.R-=1,this.N=this.F-1):(this.R=this.P-1,this.N=this.F-1)),this.i-=1,t}pushFront(t){return this.i&&(this.D>0?this.D-=1:this.j>0?(this.j-=1,this.D=this.F-1):(this.j=this.P-1,this.D=this.F-1),this.j===this.R&&this.D===this.N&&this.T()),this.i+=1,this.A[this.j][this.D]=t,this.i}popFront(){if(0===this.i)return;let t=this.A[this.j][this.D];return 1!==this.i&&(this.D<this.F-1?this.D+=1:this.j<this.P-1?(this.j+=1,this.D=0):(this.j=0,this.D=0)),this.i-=1,t}getElementByPos(t){if(t<0||t>this.i-1)throw new RangeError;let{curNodeBucketIndex:e,curNodePointerIndex:r}=this.O(t);return this.A[e][r]}setElementByPos(t,e){if(t<0||t>this.i-1)throw new RangeError;let{curNodeBucketIndex:r,curNodePointerIndex:n}=this.O(t);this.A[r][n]=e}insert(t,e){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;if(t<0||t>this.i)throw new RangeError;if(0===t)for(;r--;)this.pushFront(e);else if(t===this.i)for(;r--;)this.pushBack(e);else{let n=[];for(let e=t;e<this.i;++e)n.push(this.getElementByPos(e));this.cut(t-1);for(let t=0;t<r;++t)this.pushBack(e);for(let t=0;t<n.length;++t)this.pushBack(n[t])}return this.i}cut(t){if(t<0)return this.clear(),0;let{curNodeBucketIndex:e,curNodePointerIndex:r}=this.O(t);return this.R=e,this.N=r,this.i=t+1,this.i}eraseElementByPos(t){if(t<0||t>this.i-1)throw new RangeError;if(0===t)this.popFront();else if(t===this.i-1)this.popBack();else{let e=[];for(let n=t+1;n<this.i;++n)e.push(this.getElementByPos(n));this.cut(t),this.popBack();let r=this;e.forEach(function(t){r.pushBack(t)})}return this.i}eraseElementByValue(t){if(0===this.i)return 0;let e=[];for(let n=0;n<this.i;++n){let r=this.getElementByPos(n);r!==t&&e.push(r)}let r=e.length;for(let n=0;n<r;++n)this.setElementByPos(n,e[n]);return this.cut(r-1)}eraseElementByIterator(t){let e=t.o;return this.eraseElementByPos(e),t=t.next()}find(t){for(let e=0;e<this.i;++e)if(this.getElementByPos(e)===t)return new i(e,this);return this.end()}reverse(){let t=0,e=this.i-1;for(;t<e;){let r=this.getElementByPos(t);this.setElementByPos(t,this.getElementByPos(e)),this.setElementByPos(e,r),t+=1,e-=1}}unique(){if(this.i<=1)return this.i;let t=1,e=this.getElementByPos(0);for(let r=1;r<this.i;++r){let n=this.getElementByPos(r);n!==e&&(e=n,this.setElementByPos(t++,n))}for(;this.i>t;)this.popBack();return this.i}sort(t){let e=[];for(let r=0;r<this.i;++r)e.push(this.getElementByPos(r));e.sort(t);for(let r=0;r<this.i;++r)this.setElementByPos(r,e[r])}shrinkToFit(){if(0===this.i)return;let t=[];this.forEach(function(e){t.push(e)}),this.P=Math.max(Math.ceil(this.i/this.F),1),this.i=this.j=this.R=this.D=this.N=0,this.A=[];for(let e=0;e<this.P;++e)this.A.push(new Array(this.F));for(let e=0;e<t.length;++e)this.pushBack(t[e])}forEach(t){for(let e=0;e<this.i;++e)t(this.getElementByPos(e),e,this)}[Symbol.iterator](){return function*(){for(let t=0;t<this.i;++t)yield this.getElementByPos(t)}.bind(this)()}};t.default=s}),Vs=kr(t=>{Ir(),Ei(),oi(),Object.defineProperty(t,"t",{value:!0}),t.TreeNodeEnableIndex=t.TreeNode=void 0;var e=class{constructor(t,e){this.ee=1,this.u=void 0,this.l=void 0,this.U=void 0,this.W=void 0,this.tt=void 0,this.u=t,this.l=e}L(){let t=this;if(1===t.ee&&t.tt.tt===t)t=t.W;else if(t.U)for(t=t.U;t.W;)t=t.W;else{let e=t.tt;for(;e.U===t;)t=e,e=t.tt;t=e}return t}B(){let t=this;if(t.W){for(t=t.W;t.U;)t=t.U;return t}{let e=t.tt;for(;e.W===t;)t=e,e=t.tt;return t.W!==e?e:t}}te(){let t=this.tt,e=this.W,r=e.U;return t.tt===this?t.tt=e:t.U===this?t.U=e:t.W=e,e.tt=t,e.U=this,this.tt=e,this.W=r,r&&(r.tt=this),e}se(){let t=this.tt,e=this.U,r=e.W;return t.tt===this?t.tt=e:t.U===this?t.U=e:t.W=e,e.tt=t,e.W=this,this.tt=e,this.U=r,r&&(r.tt=this),e}};t.TreeNode=e;t.TreeNodeEnableIndex=class extends e{constructor(){super(...arguments),this.rt=1}te(){let t=super.te();return this.ie(),t.ie(),t}se(){let t=super.se();return this.ie(),t.ie(),t}ie(){this.rt=1,this.U&&(this.rt+=this.U.rt),this.W&&(this.rt+=this.W.rt)}}}),Hs=kr(t=>{Ir(),Ei(),oi(),Object.defineProperty(t,"t",{value:!0}),t.default=void 0;var e=Vs(),r=Os(),n=Bs(),i=class extends r.Container{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:function(t,e){return t<e?-1:t>e?1:0},r=arguments.length>1&&void 0!==arguments[1]&&arguments[1];super(),this.Y=void 0,this.v=t,r?(this.re=e.TreeNodeEnableIndex,this.M=function(t,e,r){let n=this.ne(t,e,r);if(n){let t=n.tt;for(;t!==this.h;)t.rt+=1,t=t.tt;let e=this.he(n);if(e){let{parentNode:t,grandParent:r,curNode:n}=e;t.ie(),r.ie(),n.ie()}}return this.i},this.V=function(t){let e=this.fe(t);for(;e!==this.h;)e.rt-=1,e=e.tt}):(this.re=e.TreeNode,this.M=function(t,e,r){let n=this.ne(t,e,r);return n&&this.he(n),this.i},this.V=this.fe),this.h=new this.re}X(t,e){let r=this.h;for(;t;){let n=this.v(t.u,e);if(n<0)t=t.W;else{if(!(n>0))return t;r=t,t=t.U}}return r}Z(t,e){let r=this.h;for(;t;)this.v(t.u,e)<=0?t=t.W:(r=t,t=t.U);return r}$(t,e){let r=this.h;for(;t;){let n=this.v(t.u,e);if(n<0)r=t,t=t.W;else{if(!(n>0))return t;t=t.U}}return r}rr(t,e){let r=this.h;for(;t;)this.v(t.u,e)<0?(r=t,t=t.W):t=t.U;return r}ue(t){for(;;){let e=t.tt;if(e===this.h)return;if(1===t.ee)return void(t.ee=0);if(t===e.U){let r=e.W;if(1===r.ee)r.ee=0,e.ee=1,e===this.Y?this.Y=e.te():e.te();else{if(r.W&&1===r.W.ee)return r.ee=e.ee,e.ee=0,r.W.ee=0,void(e===this.Y?this.Y=e.te():e.te());r.U&&1===r.U.ee?(r.ee=1,r.U.ee=0,r.se()):(r.ee=1,t=e)}}else{let r=e.U;if(1===r.ee)r.ee=0,e.ee=1,e===this.Y?this.Y=e.se():e.se();else{if(r.U&&1===r.U.ee)return r.ee=e.ee,e.ee=0,r.U.ee=0,void(e===this.Y?this.Y=e.se():e.se());r.W&&1===r.W.ee?(r.ee=1,r.W.ee=0,r.te()):(r.ee=1,t=e)}}}}fe(t){if(1===this.i)return this.clear(),this.h;let e=t;for(;e.U||e.W;){if(e.W)for(e=e.W;e.U;)e=e.U;else e=e.U;[t.u,e.u]=[e.u,t.u],[t.l,e.l]=[e.l,t.l],t=e}this.h.U===e?this.h.U=e.tt:this.h.W===e&&(this.h.W=e.tt),this.ue(e);let r=e.tt;return e===r.U?r.U=void 0:r.W=void 0,this.i-=1,this.Y.ee=0,r}oe(t,e){return void 0!==t&&(!(!this.oe(t.U,e)&&!e(t))||this.oe(t.W,e))}he(t){for(;;){let e=t.tt;if(0===e.ee)return;let r=e.tt;if(e===r.U){let n=r.W;if(n&&1===n.ee){if(n.ee=e.ee=0,r===this.Y)return;r.ee=1,t=r;continue}if(t===e.W){if(t.ee=0,t.U&&(t.U.tt=e),t.W&&(t.W.tt=r),e.W=t.U,r.U=t.W,t.U=e,t.W=r,r===this.Y)this.Y=t,this.h.tt=t;else{let e=r.tt;e.U===r?e.U=t:e.W=t}return t.tt=r.tt,e.tt=t,r.tt=t,r.ee=1,{parentNode:e,grandParent:r,curNode:t}}e.ee=0,r===this.Y?this.Y=r.se():r.se(),r.ee=1}else{let n=r.U;if(n&&1===n.ee){if(n.ee=e.ee=0,r===this.Y)return;r.ee=1,t=r;continue}if(t===e.U){if(t.ee=0,t.U&&(t.U.tt=r),t.W&&(t.W.tt=e),r.W=t.U,e.U=t.W,t.U=r,t.W=e,r===this.Y)this.Y=t,this.h.tt=t;else{let e=r.tt;e.U===r?e.U=t:e.W=t}return t.tt=r.tt,e.tt=t,r.tt=t,r.ee=1,{parentNode:e,grandParent:r,curNode:t}}e.ee=0,r===this.Y?this.Y=r.te():r.te(),r.ee=1}return}}ne(t,e,r){if(void 0===this.Y)return this.i+=1,this.Y=new this.re(t,e),this.Y.ee=0,this.Y.tt=this.h,this.h.tt=this.Y,this.h.U=this.Y,void(this.h.W=this.Y);let n,i=this.h.U,s=this.v(i.u,t);if(0!==s){if(s>0)i.U=new this.re(t,e),i.U.tt=i,n=i.U,this.h.U=n;else{let i=this.h.W,s=this.v(i.u,t);if(0===s)return void(i.l=e);if(s<0)i.W=new this.re(t,e),i.W.tt=i,n=i.W,this.h.W=n;else{if(void 0!==r){let i=r.o;if(i!==this.h){let r=this.v(i.u,t);if(0===r)return void(i.l=e);if(r>0){let r=i.L(),s=this.v(r.u,t);if(0===s)return void(r.l=e);s<0&&(n=new this.re(t,e),void 0===r.W?(r.W=n,n.tt=r):(i.U=n,n.tt=i))}}}if(void 0===n)for(n=this.Y;;){let r=this.v(n.u,t);if(r>0){if(void 0===n.U){n.U=new this.re(t,e),n.U.tt=n,n=n.U;break}n=n.U}else{if(!(r<0))return void(n.l=e);if(void 0===n.W){n.W=new this.re(t,e),n.W.tt=n,n=n.W;break}n=n.W}}}}return this.i+=1,n}i.l=e}I(t,e){for(;t;){let r=this.v(t.u,e);if(r<0)t=t.W;else{if(!(r>0))return t;t=t.U}}return t||this.h}clear(){this.i=0,this.Y=void 0,this.h.tt=void 0,this.h.U=this.h.W=void 0}updateKeyByIterator(t,e){let r=t.o;if(r===this.h&&(0,n.throwIteratorAccessError)(),1===this.i)return r.u=e,!0;if(r===this.h.U)return this.v(r.B().u,e)>0&&(r.u=e,!0);if(r===this.h.W)return this.v(r.L().u,e)<0&&(r.u=e,!0);let i=r.L().u;if(this.v(i,e)>=0)return!1;let s=r.B().u;return!(this.v(s,e)<=0)&&(r.u=e,!0)}eraseElementByPos(t){if(t<0||t>this.i-1)throw new RangeError;let e=0,r=this;return this.oe(this.Y,function(n){return t===e?(r.V(n),!0):(e+=1,!1)}),this.i}eraseElementByKey(t){if(0===this.i)return!1;let e=this.I(this.Y,t);return e!==this.h&&(this.V(e),!0)}eraseElementByIterator(t){let e=t.o;e===this.h&&(0,n.throwIteratorAccessError)();let r=void 0===e.W;return 0===t.iteratorType?r&&t.next():(!r||void 0===e.U)&&t.next(),this.V(e),t}forEach(t){let e=0;for(let r of this)t(r,e++,this)}getElementByPos(t){if(t<0||t>this.i-1)throw new RangeError;let e,r=0;for(let n of this){if(r===t){e=n;break}r+=1}return e}getHeight(){if(0===this.i)return 0;let t=function(e){return e?Math.max(t(e.U),t(e.W))+1:0};return t(this.Y)}};t.default=i}),Ks=kr(t=>{Ir(),Ei(),oi(),Object.defineProperty(t,"t",{value:!0}),t.default=void 0;var e=Os(),r=Bs(),n=class extends e.ContainerIterator{constructor(t,e,n){super(n),this.o=t,this.h=e,0===this.iteratorType?(this.pre=function(){return this.o===this.h.U&&(0,r.throwIteratorAccessError)(),this.o=this.o.L(),this},this.next=function(){return this.o===this.h&&(0,r.throwIteratorAccessError)(),this.o=this.o.B(),this}):(this.pre=function(){return this.o===this.h.W&&(0,r.throwIteratorAccessError)(),this.o=this.o.B(),this},this.next=function(){return this.o===this.h&&(0,r.throwIteratorAccessError)(),this.o=this.o.L(),this})}get index(){let t=this.o,e=this.h.tt;if(t===this.h)return e?e.rt-1:0;let r=0;for(t.U&&(r+=t.U.rt);t!==e;){let e=t.tt;t===e.W&&(r+=1,e.U&&(r+=e.U.rt)),t=e}return r}};t.default=n}),qs=kr(t=>{Ir(),Ei(),oi(),Object.defineProperty(t,"t",{value:!0}),t.default=void 0;var e=i(Hs()),r=i(Ks()),n=Bs();function i(t){return t&&t.t?t:{default:t}}var s=class t extends r.default{constructor(t,e,r,n){super(t,e,n),this.container=r}get pointer(){return this.o===this.h&&(0,n.throwIteratorAccessError)(),this.o.u}copy(){return new t(this.o,this.h,this.container,this.iteratorType)}},a=class extends e.default{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];super(arguments.length>1?arguments[1]:void 0,arguments.length>2?arguments[2]:void 0);let e=this;t.forEach(function(t){e.insert(t)})}*K(t){void 0!==t&&(yield*this.K(t.U),yield t.u,yield*this.K(t.W))}begin(){return new s(this.h.U||this.h,this.h,this)}end(){return new s(this.h,this.h,this)}rBegin(){return new s(this.h.W||this.h,this.h,this,1)}rEnd(){return new s(this.h,this.h,this,1)}front(){return this.h.U?this.h.U.u:void 0}back(){return this.h.W?this.h.W.u:void 0}insert(t,e){return this.M(t,void 0,e)}find(t){let e=this.I(this.Y,t);return new s(e,this.h,this)}lowerBound(t){let e=this.X(this.Y,t);return new s(e,this.h,this)}upperBound(t){let e=this.Z(this.Y,t);return new s(e,this.h,this)}reverseLowerBound(t){let e=this.$(this.Y,t);return new s(e,this.h,this)}reverseUpperBound(t){let e=this.rr(this.Y,t);return new s(e,this.h,this)}union(t){let e=this;return t.forEach(function(t){e.insert(t)}),this.i}[Symbol.iterator](){return this.K(this.Y)}};t.default=a}),Ys=kr(t=>{Ir(),Ei(),oi(),Object.defineProperty(t,"t",{value:!0}),t.default=void 0;var e=i(Hs()),r=i(Ks()),n=Bs();function i(t){return t&&t.t?t:{default:t}}var s=class t extends r.default{constructor(t,e,r,n){super(t,e,n),this.container=r}get pointer(){this.o===this.h&&(0,n.throwIteratorAccessError)();let t=this;return new Proxy([],{get:(e,r)=>"0"===r?t.o.u:"1"===r?t.o.l:void 0,set(e,r,n){if("1"!==r)throw new TypeError("props must be 1");return t.o.l=n,!0}})}copy(){return new t(this.o,this.h,this.container,this.iteratorType)}},a=class extends e.default{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];super(arguments.length>1?arguments[1]:void 0,arguments.length>2?arguments[2]:void 0);let e=this;t.forEach(function(t){e.setElement(t[0],t[1])})}*K(t){void 0!==t&&(yield*this.K(t.U),yield[t.u,t.l],yield*this.K(t.W))}begin(){return new s(this.h.U||this.h,this.h,this)}end(){return new s(this.h,this.h,this)}rBegin(){return new s(this.h.W||this.h,this.h,this,1)}rEnd(){return new s(this.h,this.h,this,1)}front(){if(0===this.i)return;let t=this.h.U;return[t.u,t.l]}back(){if(0===this.i)return;let t=this.h.W;return[t.u,t.l]}lowerBound(t){let e=this.X(this.Y,t);return new s(e,this.h,this)}upperBound(t){let e=this.Z(this.Y,t);return new s(e,this.h,this)}reverseLowerBound(t){let e=this.$(this.Y,t);return new s(e,this.h,this)}reverseUpperBound(t){let e=this.rr(this.Y,t);return new s(e,this.h,this)}setElement(t,e,r){return this.M(t,e,r)}find(t){let e=this.I(this.Y,t);return new s(e,this.h,this)}getElementByKey(t){return this.I(this.Y,t).l}union(t){let e=this;return t.forEach(function(t){e.setElement(t[0],t[1])}),this.i}[Symbol.iterator](){return this.K(this.Y)}};t.default=a}),Qs=kr(t=>{Ir(),Ei(),oi(),Object.defineProperty(t,"t",{value:!0}),t.default=function(t){let e=typeof t;return"object"===e&&null!==t||"function"===e}}),Xs=kr(t=>{Ir(),Ei(),oi(),Object.defineProperty(t,"t",{value:!0}),t.HashContainerIterator=t.HashContainer=void 0;var e,r=Os(),n=(e=Qs())&&e.t?e:{default:e},i=Bs();var s=class extends r.ContainerIterator{constructor(t,e,r){super(r),this.o=t,this.h=e,0===this.iteratorType?(this.pre=function(){return this.o.L===this.h&&(0,i.throwIteratorAccessError)(),this.o=this.o.L,this},this.next=function(){return this.o===this.h&&(0,i.throwIteratorAccessError)(),this.o=this.o.B,this}):(this.pre=function(){return this.o.B===this.h&&(0,i.throwIteratorAccessError)(),this.o=this.o.B,this},this.next=function(){return this.o===this.h&&(0,i.throwIteratorAccessError)(),this.o=this.o.L,this})}};t.HashContainerIterator=s;var a=class extends r.Container{constructor(){super(),this.H=[],this.g={},this.HASH_TAG=Symbol("@@HASH_TAG"),Object.setPrototypeOf(this.g,null),this.h={},this.h.L=this.h.B=this.p=this._=this.h}V(t){let{L:e,B:r}=t;e.B=r,r.L=e,t===this.p&&(this.p=r),t===this._&&(this._=e),this.i-=1}M(t,e,r){let i;if(void 0===r&&(r=(0,n.default)(t)),r){let r=t[this.HASH_TAG];if(void 0!==r)return this.H[r].l=e,this.i;Object.defineProperty(t,this.HASH_TAG,{value:this.H.length,configurable:!0}),i={u:t,l:e,L:this._,B:this.h},this.H.push(i)}else{let r=this.g[t];if(r)return r.l=e,this.i;i={u:t,l:e,L:this._,B:this.h},this.g[t]=i}return 0===this.i?(this.p=i,this.h.B=i):this._.B=i,this._=i,this.h.L=i,++this.i}I(t,e){if(void 0===e&&(e=(0,n.default)(t)),e){let e=t[this.HASH_TAG];return void 0===e?this.h:this.H[e]}return this.g[t]||this.h}clear(){let t=this.HASH_TAG;this.H.forEach(function(e){delete e.u[t]}),this.H=[],this.g={},Object.setPrototypeOf(this.g,null),this.i=0,this.p=this._=this.h.L=this.h.B=this.h}eraseElementByKey(t,e){let r;if(void 0===e&&(e=(0,n.default)(t)),e){let e=t[this.HASH_TAG];if(void 0===e)return!1;delete t[this.HASH_TAG],r=this.H[e],delete this.H[e]}else{if(r=this.g[t],void 0===r)return!1;delete this.g[t]}return this.V(r),!0}eraseElementByIterator(t){let e=t.o;return e===this.h&&(0,i.throwIteratorAccessError)(),this.V(e),t.next()}eraseElementByPos(t){if(t<0||t>this.i-1)throw new RangeError;let e=this.p;for(;t--;)e=e.B;return this.V(e),this.i}};t.HashContainer=a}),$s=kr(t=>{Ir(),Ei(),oi(),Object.defineProperty(t,"t",{value:!0}),t.default=void 0;var e=Xs(),r=Bs(),n=class t extends e.HashContainerIterator{constructor(t,e,r,n){super(t,e,n),this.container=r}get pointer(){return this.o===this.h&&(0,r.throwIteratorAccessError)(),this.o.u}copy(){return new t(this.o,this.h,this.container,this.iteratorType)}},i=class extends e.HashContainer{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];super();let e=this;t.forEach(function(t){e.insert(t)})}begin(){return new n(this.p,this.h,this)}end(){return new n(this.h,this.h,this)}rBegin(){return new n(this._,this.h,this,1)}rEnd(){return new n(this.h,this.h,this,1)}front(){return this.p.u}back(){return this._.u}insert(t,e){return this.M(t,void 0,e)}getElementByPos(t){if(t<0||t>this.i-1)throw new RangeError;let e=this.p;for(;t--;)e=e.B;return e.u}find(t,e){let r=this.I(t,e);return new n(r,this.h,this)}forEach(t){let e=0,r=this.p;for(;r!==this.h;)t(r.u,e++,this),r=r.B}[Symbol.iterator](){return function*(){let t=this.p;for(;t!==this.h;)yield t.u,t=t.B}.bind(this)()}};t.default=i}),Zs=kr(t=>{Ir(),Ei(),oi(),Object.defineProperty(t,"t",{value:!0}),t.default=void 0;var e,r=Xs(),n=(e=Qs())&&e.t?e:{default:e},i=Bs();var s=class t extends r.HashContainerIterator{constructor(t,e,r,n){super(t,e,n),this.container=r}get pointer(){this.o===this.h&&(0,i.throwIteratorAccessError)();let t=this;return new Proxy([],{get:(e,r)=>"0"===r?t.o.u:"1"===r?t.o.l:void 0,set(e,r,n){if("1"!==r)throw new TypeError("props must be 1");return t.o.l=n,!0}})}copy(){return new t(this.o,this.h,this.container,this.iteratorType)}},a=class extends r.HashContainer{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];super();let e=this;t.forEach(function(t){e.setElement(t[0],t[1])})}begin(){return new s(this.p,this.h,this)}end(){return new s(this.h,this.h,this)}rBegin(){return new s(this._,this.h,this,1)}rEnd(){return new s(this.h,this.h,this,1)}front(){if(0!==this.i)return[this.p.u,this.p.l]}back(){if(0!==this.i)return[this._.u,this._.l]}setElement(t,e,r){return this.M(t,e,r)}getElementByKey(t,e){if(void 0===e&&(e=(0,n.default)(t)),e){let e=t[this.HASH_TAG];return void 0!==e?this.H[e].l:void 0}let r=this.g[t];return r?r.l:void 0}getElementByPos(t){if(t<0||t>this.i-1)throw new RangeError;let e=this.p;for(;t--;)e=e.B;return[e.u,e.l]}find(t,e){let r=this.I(t,e);return new s(r,this.h,this)}forEach(t){let e=0,r=this.p;for(;r!==this.h;)t([r.u,r.l],e++,this),r=r.B}[Symbol.iterator](){return function*(){let t=this.p;for(;t!==this.h;)yield[t.u,t.l],t=t.B}.bind(this)()}};t.default=a}),Js=kr(t=>{Ir(),Ei(),oi(),Object.defineProperty(t,"t",{value:!0}),Object.defineProperty(t,"Deque",{enumerable:!0,get:function(){return a.default}}),Object.defineProperty(t,"HashMap",{enumerable:!0,get:function(){return u.default}}),Object.defineProperty(t,"HashSet",{enumerable:!0,get:function(){return c.default}}),Object.defineProperty(t,"LinkList",{enumerable:!0,get:function(){return s.default}}),Object.defineProperty(t,"OrderedMap",{enumerable:!0,get:function(){return l.default}}),Object.defineProperty(t,"OrderedSet",{enumerable:!0,get:function(){return o.default}}),Object.defineProperty(t,"PriorityQueue",{enumerable:!0,get:function(){return n.default}}),Object.defineProperty(t,"Queue",{enumerable:!0,get:function(){return r.default}}),Object.defineProperty(t,"Stack",{enumerable:!0,get:function(){return e.default}}),Object.defineProperty(t,"Vector",{enumerable:!0,get:function(){return i.default}});var e=h(Ds()),r=h(Ns()),n=h(Fs()),i=h(zs()),s=h(Ws()),a=h(Gs()),o=h(qs()),l=h(Ys()),c=h($s()),u=h(Zs());function h(t){return t&&t.t?t:{default:t}}}),ta=kr((t,e)=>{Ir(),Ei(),oi();var r=Js().OrderedSet,n=ys()("number-allocator:trace"),i=ys()("number-allocator:error");function s(t,e){this.low=t,this.high=e}function a(t,e){if(!(this instanceof a))return new a(t,e);this.min=t,this.max=e,this.ss=new r([],(t,e)=>t.compare(e)),n("Create"),this.clear()}s.prototype.equals=function(t){return this.low===t.low&&this.high===t.high},s.prototype.compare=function(t){return this.low<t.low&&this.high<t.low?-1:t.low<this.low&&t.high<this.low?1:0},a.prototype.firstVacant=function(){return 0===this.ss.size()?null:this.ss.front().low},a.prototype.alloc=function(){if(0===this.ss.size())return n("alloc():empty"),null;let t=this.ss.begin(),e=t.pointer.low,r=t.pointer.high,i=e;return i+1<=r?this.ss.updateKeyByIterator(t,new s(e+1,r)):this.ss.eraseElementByPos(0),n("alloc():"+i),i},a.prototype.use=function(t){let e=new s(t,t),r=this.ss.lowerBound(e);if(!r.equals(this.ss.end())){let i=r.pointer.low,a=r.pointer.high;return r.pointer.equals(e)?(this.ss.eraseElementByIterator(r),n("use():"+t),!0):!(i>t)&&(i===t?(this.ss.updateKeyByIterator(r,new s(i+1,a)),n("use():"+t),!0):a===t?(this.ss.updateKeyByIterator(r,new s(i,a-1)),n("use():"+t),!0):(this.ss.updateKeyByIterator(r,new s(t+1,a)),this.ss.insert(new s(i,t-1)),n("use():"+t),!0))}return n("use():failed"),!1},a.prototype.free=function(t){if(t<this.min||t>this.max)return void i("free():"+t+" is out of range");let e=new s(t,t),r=this.ss.upperBound(e);if(r.equals(this.ss.end())){if(r.equals(this.ss.begin()))return void this.ss.insert(e);r.pre();let n=r.pointer.high;r.pointer.high+1===t?this.ss.updateKeyByIterator(r,new s(n,t)):this.ss.insert(e)}else if(r.equals(this.ss.begin()))if(t+1===r.pointer.low){let e=r.pointer.high;this.ss.updateKeyByIterator(r,new s(t,e))}else this.ss.insert(e);else{let n=r.pointer.low,i=r.pointer.high;r.pre();let a=r.pointer.low;r.pointer.high+1===t?t+1===n?(this.ss.eraseElementByIterator(r),this.ss.updateKeyByIterator(r,new s(a,i))):this.ss.updateKeyByIterator(r,new s(a,t)):t+1===n?(this.ss.eraseElementByIterator(r.next()),this.ss.insert(new s(t,i))):this.ss.insert(e)}n("free():"+t)},a.prototype.clear=function(){n("clear()"),this.ss.clear(),this.ss.insert(new s(this.min,this.max))},a.prototype.intervalCount=function(){return this.ss.size()},a.prototype.dump=function(){console.log("length:"+this.ss.size());for(let t of this.ss)console.log(t)},e.exports=a}),ea=kr((t,e)=>{Ir(),Ei(),oi();var r=ta();e.exports.NumberAllocator=r}),ra=kr(t=>{Ir(),Ei(),oi(),Object.defineProperty(t,"__esModule",{value:!0});var e=Ms(),r=ea();t.default=class{constructor(t){o(this,"aliasToTopic",void 0),o(this,"topicToAlias",void 0),o(this,"max",void 0),o(this,"numberAllocator",void 0),o(this,"length",void 0),t>0&&(this.aliasToTopic=new e.LRUCache({max:t}),this.topicToAlias={},this.numberAllocator=new r.NumberAllocator(1,t),this.max=t,this.length=0)}put(t,e){if(0===e||e>this.max)return!1;let r=this.aliasToTopic.get(e);return r&&delete this.topicToAlias[r],this.aliasToTopic.set(e,t),this.topicToAlias[t]=e,this.numberAllocator.use(e),this.length=this.aliasToTopic.size,!0}getTopicByAlias(t){return this.aliasToTopic.get(t)}getAliasByTopic(t){let e=this.topicToAlias[t];return typeof e<"u"&&this.aliasToTopic.get(e),e}clear(){this.aliasToTopic.clear(),this.topicToAlias={},this.numberAllocator.clear(),this.length=0}getLruAlias(){return this.numberAllocator.firstVacant()||[...this.aliasToTopic.keys()][this.aliasToTopic.size-1]}}}),na=kr(t=>{Ir(),Ei(),oi();var e=t&&t.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(t,"__esModule",{value:!0});var r=Ps(),n=e(ra()),i=Ls();t.default=(t,e)=>{t.log("_handleConnack");let{options:s}=t,a=5===s.protocolVersion?e.reasonCode:e.returnCode;if(clearTimeout(t.connackTimer),delete t.topicAliasSend,e.properties){if(e.properties.topicAliasMaximum){if(e.properties.topicAliasMaximum>65535)return void t.emit("error",new Error("topicAliasMaximum from broker is out of range"));e.properties.topicAliasMaximum>0&&(t.topicAliasSend=new n.default(e.properties.topicAliasMaximum))}e.properties.serverKeepAlive&&s.keepalive&&(s.keepalive=e.properties.serverKeepAlive),e.properties.maximumPacketSize&&(s.properties||(s.properties={}),s.properties.maximumPacketSize=e.properties.maximumPacketSize)}if(0===a)t.reconnecting=!1,t._onConnect(e);else if(a>0){let e=new i.ErrorWithReasonCode("Connection refused: ".concat(r.ReasonCodes[a]),a);t.emit("error",e),t.options.reconnectOnConnackError&&t._cleanUp(!0)}}}),ia=kr(t=>{Ir(),Ei(),oi(),Object.defineProperty(t,"__esModule",{value:!0});t.default=(t,e,r)=>{t.log("handling pubrel packet");let n=typeof r<"u"?r:t.noop,{messageId:i}=e,s={cmd:"pubcomp",messageId:i};t.incomingStore.get(e,(e,r)=>{e?t._sendPacket(s,n):(t.emit("message",r.topic,r.payload,r),t.handleMessage(r,e=>{if(e)return n(e);t.incomingStore.del(r,t.noop),t._sendPacket(s,n)}))})}}),sa=kr(t=>{Ir(),Ei(),oi();var e=t&&t.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(t,"__esModule",{value:!0});var r=e(Is()),n=e(Cs()),i=e(na()),s=e(Ps()),a=e(ia());t.default=(t,e,o)=>{let{options:l}=t;if(5===l.protocolVersion&&l.properties&&l.properties.maximumPacketSize&&l.properties.maximumPacketSize<e.length)return t.emit("error",new Error("exceeding packets size ".concat(e.cmd))),t.end({reasonCode:149,properties:{reasonString:"Maximum packet size was exceeded"}}),t;switch(t.log("_handlePacket :: emitting packetreceive"),t.emit("packetreceive",e),e.cmd){case"publish":(0,r.default)(t,e,o);break;case"puback":case"pubrec":case"pubcomp":case"suback":case"unsuback":t.reschedulePing(),(0,s.default)(t,e),o();break;case"pubrel":t.reschedulePing(),(0,a.default)(t,e,o);break;case"connack":(0,i.default)(t,e),o();break;case"auth":t.reschedulePing(),(0,n.default)(t,e),o();break;case"pingresp":t.log("_handlePacket :: received pingresp"),t.reschedulePing(!0),o();break;case"disconnect":t.emit("disconnect",e),o();break;default:t.log("_handlePacket :: unknown command"),o()}}}),aa=kr(t=>{Ir(),Ei(),oi(),Object.defineProperty(t,"__esModule",{value:!0});t.default=class{constructor(){o(this,"nextId",void 0),this.nextId=Math.max(1,Math.floor(65535*Math.random()))}allocate(){let t=this.nextId++;return 65536===this.nextId&&(this.nextId=1),t}getLastAllocated(){return 1===this.nextId?65535:this.nextId-1}register(t){return!0}deallocate(t){}clear(){}}}),oa=kr(t=>{Ir(),Ei(),oi(),Object.defineProperty(t,"__esModule",{value:!0});t.default=class{constructor(t){o(this,"aliasToTopic",void 0),o(this,"max",void 0),o(this,"length",void 0),this.aliasToTopic={},this.max=t}put(t,e){return!(0===e||e>this.max)&&(this.aliasToTopic[e]=t,this.length=Object.keys(this.aliasToTopic).length,!0)}getTopicByAlias(t){return this.aliasToTopic[t]}clear(){this.aliasToTopic={}}}}),la=kr(t=>{Ir(),Ei(),oi();var e=t&&t.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(t,"__esModule",{value:!0}),t.TypedEventEmitter=void 0;var r=e((Ui(),xr(xi))),n=Ls(),i=class{};t.TypedEventEmitter=i,(0,n.applyMixin)(i,r.default)}),ca=kr((t,e)=>{function r(t){return e.exports=r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},e.exports.__esModule=!0,e.exports.default=e.exports,r(t)}Ir(),Ei(),oi(),e.exports=r,e.exports.__esModule=!0,e.exports.default=e.exports}),ua=kr((t,e)=>{Ir(),Ei(),oi();var r=ca().default;e.exports=function(t,e){if("object"!=r(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var i=n.call(t,e||"default");if("object"!=r(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)},e.exports.__esModule=!0,e.exports.default=e.exports}),ha=kr((t,e)=>{Ir(),Ei(),oi();var r=ca().default,n=ua();e.exports=function(t){var e=n(t,"string");return"symbol"==r(e)?e:e+""},e.exports.__esModule=!0,e.exports.default=e.exports}),da=kr((t,e)=>{Ir(),Ei(),oi();var r=ha();e.exports=function(t,e,n){return(e=r(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t},e.exports.__esModule=!0,e.exports.default=e.exports}),fa=kr((t,e)=>{Ir(),Ei(),oi(),e.exports=function(t){if(Array.isArray(t))return t},e.exports.__esModule=!0,e.exports.default=e.exports}),pa=kr((t,e)=>{Ir(),Ei(),oi(),e.exports=function(t,e){var r=null==t?null:typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(null!=r){var n,i,s,a,o=[],l=!0,c=!1;try{if(s=(r=r.call(t)).next,0===e){if(Object(r)!==r)return;l=!1}else for(;!(l=(n=s.call(r)).done)&&(o.push(n.value),o.length!==e);l=!0);}catch(u){c=!0,i=u}finally{try{if(!l&&null!=r.return&&(a=r.return(),Object(a)!==a))return}finally{if(c)throw i}}return o}},e.exports.__esModule=!0,e.exports.default=e.exports}),ga=kr((t,e)=>{Ir(),Ei(),oi(),e.exports=function(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=Array(e);r<e;r++)n[r]=t[r];return n},e.exports.__esModule=!0,e.exports.default=e.exports}),ma=kr((t,e)=>{Ir(),Ei(),oi();var r=ga();e.exports=function(t,e){if(t){if("string"==typeof t)return r(t,e);var n={}.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?r(t,e):void 0}},e.exports.__esModule=!0,e.exports.default=e.exports}),ya=kr((t,e)=>{Ir(),Ei(),oi(),e.exports=function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")},e.exports.__esModule=!0,e.exports.default=e.exports}),va=kr((t,e)=>{Ir(),Ei(),oi();var r=fa(),n=pa(),i=ma(),s=ya();e.exports=function(t,e){return r(t)||n(t,e)||i(t,e)||s()},e.exports.__esModule=!0,e.exports.default=e.exports}),ba=kr((t,e)=>{var n,i;Ir(),Ei(),oi(),n=t,i=function(t){var e,r=void 0===Number.MAX_SAFE_INTEGER?9007199254740991:Number.MAX_SAFE_INTEGER,n=536870912,i=2*n,s=new WeakMap,a=function(t,e){return function(s){var a=e.get(s),o=void 0===a?s.size:a<i?a+1:0;if(!s.has(o))return t(s,o);if(s.size<n){for(;s.has(o);)o=Math.floor(Math.random()*i);return t(s,o)}if(s.size>r)throw new Error("Congratulations, you created a collection of unique numbers which uses all available integers!");for(;s.has(o);)o=Math.floor(Math.random()*r);return t(s,o)}}((e=s,function(t,r){return e.set(t,r),r}),s),o=function(t){return function(e){var r=t(e);return e.add(r),r}}(a);t.addUniqueNumber=o,t.generateUniqueNumber=a},"object"==typeof t&&typeof e<"u"?i(t):"function"==typeof define&&r.amdO?define(["exports"],i):i((n=typeof globalThis<"u"?globalThis:n||self).fastUniqueNumbers={})}),_a=kr((t,e)=>{function r(t,e,r,n,i,s,a){try{var o=t[s](a),l=o.value}catch(c){return void r(c)}o.done?e(l):Promise.resolve(l).then(n,i)}Ir(),Ei(),oi(),e.exports=function(t){return function(){var e=this,n=arguments;return new Promise(function(i,s){var a=t.apply(e,n);function o(t){r(a,i,s,o,l,"next",t)}function l(t){r(a,i,s,o,l,"throw",t)}o(void 0)})}},e.exports.__esModule=!0,e.exports.default=e.exports}),wa=kr((t,e)=>{Ir(),Ei(),oi(),e.exports=function(t,e){this.v=t,this.k=e},e.exports.__esModule=!0,e.exports.default=e.exports}),Ea=kr((t,e)=>{function r(t,n,i,s){var a=Object.defineProperty;try{a({},"",{})}catch(o){a=0}e.exports=r=function(t,e,n,i){function s(e,n){r(t,e,function(t){return this._invoke(e,n,t)})}e?a?a(t,e,{value:n,enumerable:!i,configurable:!i,writable:!i}):t[e]=n:(s("next",0),s("throw",1),s("return",2))},e.exports.__esModule=!0,e.exports.default=e.exports,r(t,n,i,s)}Ir(),Ei(),oi(),e.exports=r,e.exports.__esModule=!0,e.exports.default=e.exports}),Sa=kr((t,e)=>{Ir(),Ei(),oi();var r=Ea();function n(){var t,i,s="function"==typeof Symbol?Symbol:{},a=s.iterator||"@@iterator",o=s.toStringTag||"@@toStringTag";function l(e,n,s,a){var o=n&&n.prototype instanceof u?n:u,l=Object.create(o.prototype);return r(l,"_invoke",function(e,r,n){var s,a,o,l=0,u=n||[],h=!1,d={p:0,n:0,v:t,a:f,f:f.bind(t,4),d:function(e,r){return s=e,a=0,o=t,d.n=r,c}};function f(e,r){for(a=e,o=r,i=0;!h&&l&&!n&&i<u.length;i++){var n,s=u[i],f=d.p,p=s[2];e>3?(n=p===r)&&(o=s[(a=s[4])?5:(a=3,3)],s[4]=s[5]=t):s[0]<=f&&((n=e<2&&f<s[1])?(a=0,d.v=r,d.n=s[1]):f<p&&(n=e<3||s[0]>r||r>p)&&(s[4]=e,s[5]=r,d.n=p,a=0))}if(n||e>1)return c;throw h=!0,r}return function(n,u,p){if(l>1)throw TypeError("Generator is already running");for(h&&1===u&&f(u,p),a=u,o=p;(i=a<2?t:o)||!h;){s||(a?a<3?(a>1&&(d.n=-1),f(a,o)):d.n=o:d.v=o);try{if(l=2,s){if(a||(n="next"),i=s[n]){if(!(i=i.call(s,o)))throw TypeError("iterator result is not an object");if(!i.done)return i;o=i.value,a<2&&(a=0)}else 1===a&&(i=s.return)&&i.call(s),a<2&&(o=TypeError("The iterator does not provide a '"+n+"' method"),a=1);s=t}else if((i=(h=d.n<0)?o:e.call(r,d))!==c)break}catch(g){s=t,a=1,o=g}finally{l=1}}return{value:i,done:h}}}(e,s,a),!0),l}var c={};function u(){}function h(){}function d(){}i=Object.getPrototypeOf;var f=[][a]?i(i([][a]())):(r(i={},a,function(){return this}),i),p=d.prototype=u.prototype=Object.create(f);function g(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,d):(t.__proto__=d,r(t,o,"GeneratorFunction")),t.prototype=Object.create(p),t}return h.prototype=d,r(p,"constructor",d),r(d,"constructor",h),h.displayName="GeneratorFunction",r(d,o,"GeneratorFunction"),r(p),r(p,o,"Generator"),r(p,a,function(){return this}),r(p,"toString",function(){return"[object Generator]"}),(e.exports=n=function(){return{w:l,m:g}},e.exports.__esModule=!0,e.exports.default=e.exports)()}e.exports=n,e.exports.__esModule=!0,e.exports.default=e.exports}),Ta=kr((t,e)=>{Ir(),Ei(),oi();var r=wa(),n=Ea();e.exports=function t(e,i){function s(t,n,a,o){try{var l=e[t](n),c=l.value;return c instanceof r?i.resolve(c.v).then(function(t){s("next",t,a,o)},function(t){s("throw",t,a,o)}):i.resolve(c).then(function(t){l.value=t,a(l)},function(t){return s("throw",t,a,o)})}catch(u){o(u)}}var a;this.next||(n(t.prototype),n(t.prototype,"function"==typeof Symbol&&Symbol.asyncIterator||"@asyncIterator",function(){return this})),n(this,"_invoke",function(t,e,r){function n(){return new i(function(e,n){s(t,r,e,n)})}return a=a?a.then(n,n):n()},!0)},e.exports.__esModule=!0,e.exports.default=e.exports}),ka=kr((t,e)=>{Ir(),Ei(),oi();var r=Sa(),n=Ta();e.exports=function(t,e,i,s,a){return new n(r().w(t,e,i,s),a||Promise)},e.exports.__esModule=!0,e.exports.default=e.exports}),Aa=kr((t,e)=>{Ir(),Ei(),oi();var r=ka();e.exports=function(t,e,n,i,s){var a=r(t,e,n,i,s);return a.next().then(function(t){return t.done?t.value:a.next()})},e.exports.__esModule=!0,e.exports.default=e.exports}),xa=kr((t,e)=>{Ir(),Ei(),oi(),e.exports=function(t){var e=Object(t),r=[];for(var n in e)r.unshift(n);return function t(){for(;r.length;)if((n=r.pop())in e)return t.value=n,t.done=!1,t;return t.done=!0,t}},e.exports.__esModule=!0,e.exports.default=e.exports}),Ia=kr((t,e)=>{Ir(),Ei(),oi();var r=ca().default;e.exports=function(t){if(null!=t){var e=t["function"==typeof Symbol&&Symbol.iterator||"@@iterator"],n=0;if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length))return{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}}}throw new TypeError(r(t)+" is not iterable")},e.exports.__esModule=!0,e.exports.default=e.exports}),Ra=kr((t,e)=>{Ir(),Ei(),oi();var r=wa(),n=Sa(),i=Aa(),s=ka(),a=Ta(),o=xa(),l=Ia();function c(){var t=n(),u=t.m(c),h=(Object.getPrototypeOf?Object.getPrototypeOf(u):u.__proto__).constructor;function d(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===h||"GeneratorFunction"===(e.displayName||e.name))}var f={throw:1,return:2,break:3,continue:3};function p(t){var e,r;return function(n){e||(e={stop:function(){return r(n.a,2)},catch:function(){return n.v},abrupt:function(t,e){return r(n.a,f[t],e)},delegateYield:function(t,i,s){return e.resultName=i,r(n.d,l(t),s)},finish:function(t){return r(n.f,t)}},r=function(t,r,i){n.p=e.prev,n.n=e.next;try{return t(r,i)}finally{e.next=n.n}}),e.resultName&&(e[e.resultName]=n.v,e.resultName=void 0),e.sent=n.v,e.next=n.n;try{return t.call(this,e)}finally{n.p=e.prev,n.n=e.next}}}return(e.exports=c=function(){return{wrap:function(e,r,n,i){return t.w(p(e),r,n,i&&i.reverse())},isGeneratorFunction:d,mark:t.m,awrap:function(t,e){return new r(t,e)},AsyncIterator:a,async:function(t,e,r,n,a){return(d(e)?s:i)(p(t),e,r,n,a)},keys:o,values:l}},e.exports.__esModule=!0,e.exports.default=e.exports)()}e.exports=c,e.exports.__esModule=!0,e.exports.default=e.exports}),La=kr((t,e)=>{Ir(),Ei(),oi();var r=Ra()();e.exports=r;try{regeneratorRuntime=r}catch(n){"object"==typeof globalThis?globalThis.regeneratorRuntime=r:Function("r","regeneratorRuntime = r")(r)}}),Pa=kr((t,e)=>{var n,i;Ir(),Ei(),oi(),n=t,i=function(t,e,r,n,i,s){var a=new WeakMap;function o(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),r.push.apply(r,n)}return r}function l(t){for(var r=1;r<arguments.length;r++){var n=null!=arguments[r]?arguments[r]:{};r%2?o(Object(n),!0).forEach(function(r){e(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))})}return t}function c(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),r.push.apply(r,n)}return r}function u(t){for(var r=1;r<arguments.length;r++){var n=null!=arguments[r]?arguments[r]:{};r%2?c(Object(n),!0).forEach(function(r){e(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):c(Object(n)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))})}return t}var h=new WeakMap;t.createBroker=function(t){var o=function(t){return l(l({},t),{},{connect:function(t){var e=t.call;return i(s.mark(function t(){var r,n,i,o;return s.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return r=new MessageChannel,n=r.port1,i=r.port2,t.next=1,e("connect",{port:n},[n]);case 1:return o=t.sent,a.set(i,o),t.abrupt("return",i);case 2:case"end":return t.stop()}},t)}))},disconnect:function(t){var e=t.call;return function(){var t=i(s.mark(function t(r){var n;return s.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(void 0!==(n=a.get(r))){t.next=1;break}throw new Error("The given port is not connected.");case 1:return t.next=2,e("disconnect",{portId:n});case 2:case"end":return t.stop()}},t)}));return function(e){return t.apply(this,arguments)}}()},isSupported:function(t){var e=t.call;return function(){return e("isSupported")}}})}(t);return function(t){var i=function(t){if(h.has(t))return h.get(t);var e=new Map;return h.set(t,e),e}(t);t.addEventListener("message",function(t){var e=t.data,r=e.id;if(null!==r&&i.has(r)){var n=i.get(r),s=n.reject,a=n.resolve;i.delete(r),void 0===e.error?a(e.result):s(new Error(e.error.message))}}),function(t){return"function"==typeof t.start}(t)&&t.start();for(var s=function(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];return new Promise(function(a,o){var l=n.generateUniqueNumber(i);i.set(l,{reject:o,resolve:a}),null===r?t.postMessage({id:l,method:e},s):t.postMessage({id:l,method:e,params:r},s)})},a=function(e,r){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];t.postMessage({id:null,method:e,params:r},n)},l={},c=0,d=Object.entries(o);c<d.length;c++){var f=r(d[c],2),p=f[0],g=f[1];l=u(u({},l),{},e({},p,g({call:s,notify:a})))}return u({},l)}}},"object"==typeof t&&typeof e<"u"?i(t,da(),va(),ba(),_a(),La()):"function"==typeof define&&r.amdO?define(["exports","@babel/runtime/helpers/defineProperty","@babel/runtime/helpers/slicedToArray","fast-unique-numbers","@babel/runtime/helpers/asyncToGenerator","@babel/runtime/regenerator"],i):i((n=typeof globalThis<"u"?globalThis:n||self).brokerFactory={},n._defineProperty,n._slicedToArray,n.fastUniqueNumbers,n._asyncToGenerator,n._regeneratorRuntime)}),Ca=kr((t,e)=>{var n,i;Ir(),Ei(),oi(),n=t,i=function(t,e,r,n){var i=new Map([[0,null]]),s=new Map([[0,null]]),a=r.createBroker({clearInterval:function(t){var r=t.call;return function(t){"symbol"===e(i.get(t))&&(i.set(t,null),r("clear",{timerId:t,timerType:"interval"}).then(function(){i.delete(t)}))}},clearTimeout:function(t){var r=t.call;return function(t){"symbol"===e(s.get(t))&&(s.set(t,null),r("clear",{timerId:t,timerType:"timeout"}).then(function(){s.delete(t)}))}},setInterval:function(t){var e=t.call;return function(t){for(var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,s=arguments.length,a=new Array(s>2?s-2:0),o=2;o<s;o++)a[o-2]=arguments[o];var l=Symbol(),c=n.generateUniqueNumber(i);i.set(c,l);var u=function(){return e("set",{delay:r,now:performance.timeOrigin+performance.now(),timerId:c,timerType:"interval"}).then(function(){var e=i.get(c);if(void 0===e)throw new Error("The timer is in an undefined state.");e===l&&(t.apply(void 0,a),i.get(c)===l&&u())})};return u(),c}},setTimeout:function(t){var e=t.call;return function(t){for(var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length,a=new Array(i>2?i-2:0),o=2;o<i;o++)a[o-2]=arguments[o];var l=Symbol(),c=n.generateUniqueNumber(s);return s.set(c,l),e("set",{delay:r,now:performance.timeOrigin+performance.now(),timerId:c,timerType:"timeout"}).then(function(){var e=s.get(c);if(void 0===e)throw new Error("The timer is in an undefined state.");e===l&&(s.delete(c),t.apply(void 0,a))}),c}}});t.load=function(t){var e=new Worker(t);return a(e)},t.wrap=a},"object"==typeof t&&typeof e<"u"?i(t,ca(),Pa(),ba()):"function"==typeof define&&r.amdO?define(["exports","@babel/runtime/helpers/typeof","broker-factory","fast-unique-numbers"],i):i((n=typeof globalThis<"u"?globalThis:n||self).workerTimersBroker={},n._typeof,n.brokerFactory,n.fastUniqueNumbers)}),Ma=kr((t,e)=>{var n,i;Ir(),Ei(),oi(),n=t,i=function(t,e){var r=function(t,e){var r=null;return function(){if(null!==r)return r;var n=new Blob([e],{type:"application/javascript; charset=utf-8"}),i=URL.createObjectURL(n);return r=t(i),setTimeout(function(){return URL.revokeObjectURL(i)}),r}}(e.load,'(()=>{var e={45:(e,t,r)=>{var n=r(738).default;e.exports=function(e,t){if("object"!=n(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var o=r.call(e,t||"default");if("object"!=n(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)},e.exports.__esModule=!0,e.exports.default=e.exports},79:e=>{e.exports=function(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n},e.exports.__esModule=!0,e.exports.default=e.exports},122:(e,t,r)=>{var n=r(79);e.exports=function(e,t){if(e){if("string"==typeof e)return n(e,t);var r={}.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?n(e,t):void 0}},e.exports.__esModule=!0,e.exports.default=e.exports},156:e=>{e.exports=function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,o,u,a,i=[],s=!0,c=!1;try{if(u=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;s=!1}else for(;!(s=(n=u.call(r)).done)&&(i.push(n.value),i.length!==t);s=!0);}catch(e){c=!0,o=e}finally{try{if(!s&&null!=r.return&&(a=r.return(),Object(a)!==a))return}finally{if(c)throw o}}return i}},e.exports.__esModule=!0,e.exports.default=e.exports},172:e=>{e.exports=function(e,t){this.v=e,this.k=t},e.exports.__esModule=!0,e.exports.default=e.exports},293:e=>{function t(e,t,r,n,o,u,a){try{var i=e[u](a),s=i.value}catch(e){return void r(e)}i.done?t(s):Promise.resolve(s).then(n,o)}e.exports=function(e){return function(){var r=this,n=arguments;return new Promise((function(o,u){var a=e.apply(r,n);function i(e){t(a,o,u,i,s,"next",e)}function s(e){t(a,o,u,i,s,"throw",e)}i(void 0)}))}},e.exports.__esModule=!0,e.exports.default=e.exports},373:e=>{e.exports=function(e){var t=Object(e),r=[];for(var n in t)r.unshift(n);return function e(){for(;r.length;)if((n=r.pop())in t)return e.value=n,e.done=!1,e;return e.done=!0,e}},e.exports.__esModule=!0,e.exports.default=e.exports},389:function(e,t){!function(e){"use strict";var t=function(e){return function(t){var r=e(t);return t.add(r),r}},r=function(e){return function(t,r){return e.set(t,r),r}},n=void 0===Number.MAX_SAFE_INTEGER?9007199254740991:Number.MAX_SAFE_INTEGER,o=536870912,u=2*o,a=function(e,t){return function(r){var a=t.get(r),i=void 0===a?r.size:a<u?a+1:0;if(!r.has(i))return e(r,i);if(r.size<o){for(;r.has(i);)i=Math.floor(Math.random()*u);return e(r,i)}if(r.size>n)throw new Error("Congratulations, you created a collection of unique numbers which uses all available integers!");for(;r.has(i);)i=Math.floor(Math.random()*n);return e(r,i)}},i=new WeakMap,s=r(i),c=a(s,i),f=t(c);e.addUniqueNumber=f,e.generateUniqueNumber=c}(t)},472:function(e,t,r){!function(e,t,r,n){"use strict";var o=function(e,t){return function(r){var o=t.get(r);if(void 0===o)return Promise.resolve(!1);var u=n(o,2),a=u[0],i=u[1];return e(a),t.delete(r),i(!1),Promise.resolve(!0)}},u=function(e,t){var r=function(n,o,u,a){var i=n-e.now();i>0?o.set(a,[t(r,i,n,o,u,a),u]):(o.delete(a),u(!0))};return r},a=function(e,t,r,n){return function(o,u,a){var i=o+u-t.timeOrigin,s=i-t.now();return new Promise((function(t){e.set(a,[r(n,s,i,e,t,a),t])}))}},i=new Map,s=o(globalThis.clearTimeout,i),c=new Map,f=o(globalThis.clearTimeout,c),l=u(performance,globalThis.setTimeout),p=a(i,performance,globalThis.setTimeout,l),d=a(c,performance,globalThis.setTimeout,l);r.createWorker(self,{clear:function(){var r=e(t.mark((function e(r){var n,o,u;return t.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=r.timerId,o=r.timerType,e.next=1,"interval"===o?s(n):f(n);case 1:return u=e.sent,e.abrupt("return",{result:u});case 2:case"end":return e.stop()}}),e)})));function n(e){return r.apply(this,arguments)}return n}(),set:function(){var r=e(t.mark((function e(r){var n,o,u,a,i;return t.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=r.delay,o=r.now,u=r.timerId,a=r.timerType,e.next=1,("interval"===a?p:d)(n,o,u);case 1:return i=e.sent,e.abrupt("return",{result:i});case 2:case"end":return e.stop()}}),e)})));function n(e){return r.apply(this,arguments)}return n}()})}(r(293),r(756),r(623),r(715))},546:e=>{function t(r,n,o,u){var a=Object.defineProperty;try{a({},"",{})}catch(r){a=0}e.exports=t=function(e,r,n,o){if(r)a?a(e,r,{value:n,enumerable:!o,configurable:!o,writable:!o}):e[r]=n;else{var u=function(r,n){t(e,r,(function(e){return this._invoke(r,n,e)}))};u("next",0),u("throw",1),u("return",2)}},e.exports.__esModule=!0,e.exports.default=e.exports,t(r,n,o,u)}e.exports=t,e.exports.__esModule=!0,e.exports.default=e.exports},579:(e,t,r)=>{var n=r(738).default;e.exports=function(e){if(null!=e){var t=e["function"==typeof Symbol&&Symbol.iterator||"@@iterator"],r=0;if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length))return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}}}throw new TypeError(n(e)+" is not iterable")},e.exports.__esModule=!0,e.exports.default=e.exports},623:function(e,t,r){!function(e,t,r,n,o){"use strict";var u={INTERNAL_ERROR:-32603,INVALID_PARAMS:-32602,METHOD_NOT_FOUND:-32601},a=function(e,t){return Object.assign(new Error(e),{status:t})},i=function(e){return a(\'The requested method called "\'.concat(e,\'" is not supported.\'),u.METHOD_NOT_FOUND)},s=function(e){return a(\'The handler of the method called "\'.concat(e,\'" returned no required result.\'),u.INTERNAL_ERROR)},c=function(e){return a(\'The handler of the method called "\'.concat(e,\'" returned an unexpected result.\'),u.INTERNAL_ERROR)},f=function(e){return a(\'The specified parameter called "portId" with the given value "\'.concat(e,\'" does not identify a port connected to this worker.\'),u.INVALID_PARAMS)},l=function(e,n){return function(){var o=t(r.mark((function t(o){var u,a,f,l,p,d,v,x,y,b,h,m,_,g,w;return r.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(u=o.data,a=u.id,f=u.method,l=u.params,p=n[f],t.prev=1,void 0!==p){t.next=2;break}throw i(f);case 2:if(void 0!==(d=void 0===l?p():p(l))){t.next=3;break}throw s(f);case 3:if(!(d instanceof Promise)){t.next=5;break}return t.next=4,d;case 4:g=t.sent,t.next=6;break;case 5:g=d;case 6:if(v=g,null!==a){t.next=8;break}if(void 0===v.result){t.next=7;break}throw c(f);case 7:t.next=10;break;case 8:if(void 0!==v.result){t.next=9;break}throw c(f);case 9:x=v.result,y=v.transferables,b=void 0===y?[]:y,e.postMessage({id:a,result:x},b);case 10:t.next=12;break;case 11:t.prev=11,w=t.catch(1),h=w.message,m=w.status,_=void 0===m?-32603:m,e.postMessage({error:{code:_,message:h},id:a});case 12:case"end":return t.stop()}}),t,null,[[1,11]])})));return function(e){return o.apply(this,arguments)}}()},p=function(){return new Promise((function(e){var t=new ArrayBuffer(0),r=new MessageChannel,n=r.port1,o=r.port2;n.onmessage=function(t){var r=t.data;return e(null!==r)},o.postMessage(t,[t])}))};function d(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function v(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?d(Object(r),!0).forEach((function(t){n(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):d(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var x=new Map,y=function(e,n,u){return v(v({},n),{},{connect:function(t){var r=t.port;r.start();var u=e(r,n),a=o.generateUniqueNumber(x);return x.set(a,(function(){u(),r.close(),x.delete(a)})),{result:a}},disconnect:function(e){var t=e.portId,r=x.get(t);if(void 0===r)throw f(t);return r(),{result:null}},isSupported:function(){var e=t(r.mark((function e(){var t,n,o;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=1,p();case 1:if(!e.sent){e.next=5;break}if(!((t=u())instanceof Promise)){e.next=3;break}return e.next=2,t;case 2:o=e.sent,e.next=4;break;case 3:o=t;case 4:return n=o,e.abrupt("return",{result:n});case 5:return e.abrupt("return",{result:!1});case 6:case"end":return e.stop()}}),e)})));function n(){return e.apply(this,arguments)}return n}()})},b=function(e,t){var r=y(b,t,arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(){return!0}),n=l(e,r);return e.addEventListener("message",n),function(){return e.removeEventListener("message",n)}};e.createWorker=b,e.isSupported=p}(t,r(293),r(756),r(693),r(389))},633:(e,t,r)=>{var n=r(172),o=r(993),u=r(869),a=r(887),i=r(791),s=r(373),c=r(579);function f(){"use strict";var t=o(),r=t.m(f),l=(Object.getPrototypeOf?Object.getPrototypeOf(r):r.__proto__).constructor;function p(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===l||"GeneratorFunction"===(t.displayName||t.name))}var d={throw:1,return:2,break:3,continue:3};function v(e){var t,r;return function(n){t||(t={stop:function(){return r(n.a,2)},catch:function(){return n.v},abrupt:function(e,t){return r(n.a,d[e],t)},delegateYield:function(e,o,u){return t.resultName=o,r(n.d,c(e),u)},finish:function(e){return r(n.f,e)}},r=function(e,r,o){n.p=t.prev,n.n=t.next;try{return e(r,o)}finally{t.next=n.n}}),t.resultName&&(t[t.resultName]=n.v,t.resultName=void 0),t.sent=n.v,t.next=n.n;try{return e.call(this,t)}finally{n.p=t.prev,n.n=t.next}}}return(e.exports=f=function(){return{wrap:function(e,r,n,o){return t.w(v(e),r,n,o&&o.reverse())},isGeneratorFunction:p,mark:t.m,awrap:function(e,t){return new n(e,t)},AsyncIterator:i,async:function(e,t,r,n,o){return(p(t)?a:u)(v(e),t,r,n,o)},keys:s,values:c}},e.exports.__esModule=!0,e.exports.default=e.exports)()}e.exports=f,e.exports.__esModule=!0,e.exports.default=e.exports},693:(e,t,r)=>{var n=r(736);e.exports=function(e,t,r){return(t=n(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e},e.exports.__esModule=!0,e.exports.default=e.exports},715:(e,t,r)=>{var n=r(987),o=r(156),u=r(122),a=r(752);e.exports=function(e,t){return n(e)||o(e,t)||u(e,t)||a()},e.exports.__esModule=!0,e.exports.default=e.exports},736:(e,t,r)=>{var n=r(738).default,o=r(45);e.exports=function(e){var t=o(e,"string");return"symbol"==n(t)?t:t+""},e.exports.__esModule=!0,e.exports.default=e.exports},738:e=>{function t(r){return e.exports=t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e.exports.__esModule=!0,e.exports.default=e.exports,t(r)}e.exports=t,e.exports.__esModule=!0,e.exports.default=e.exports},752:e=>{e.exports=function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")},e.exports.__esModule=!0,e.exports.default=e.exports},756:(e,t,r)=>{var n=r(633)();e.exports=n;try{regeneratorRuntime=n}catch(e){"object"==typeof globalThis?globalThis.regeneratorRuntime=n:Function("r","regeneratorRuntime = r")(n)}},791:(e,t,r)=>{var n=r(172),o=r(546);e.exports=function e(t,r){function u(e,o,a,i){try{var s=t[e](o),c=s.value;return c instanceof n?r.resolve(c.v).then((function(e){u("next",e,a,i)}),(function(e){u("throw",e,a,i)})):r.resolve(c).then((function(e){s.value=e,a(s)}),(function(e){return u("throw",e,a,i)}))}catch(e){i(e)}}var a;this.next||(o(e.prototype),o(e.prototype,"function"==typeof Symbol&&Symbol.asyncIterator||"@asyncIterator",(function(){return this}))),o(this,"_invoke",(function(e,t,n){function o(){return new r((function(t,r){u(e,n,t,r)}))}return a=a?a.then(o,o):o()}),!0)},e.exports.__esModule=!0,e.exports.default=e.exports},869:(e,t,r)=>{var n=r(887);e.exports=function(e,t,r,o,u){var a=n(e,t,r,o,u);return a.next().then((function(e){return e.done?e.value:a.next()}))},e.exports.__esModule=!0,e.exports.default=e.exports},887:(e,t,r)=>{var n=r(993),o=r(791);e.exports=function(e,t,r,u,a){return new o(n().w(e,t,r,u),a||Promise)},e.exports.__esModule=!0,e.exports.default=e.exports},987:e=>{e.exports=function(e){if(Array.isArray(e))return e},e.exports.__esModule=!0,e.exports.default=e.exports},993:(e,t,r)=>{var n=r(546);function o(){var t,r,u="function"==typeof Symbol?Symbol:{},a=u.iterator||"@@iterator",i=u.toStringTag||"@@toStringTag";function s(e,o,u,a){var i=o&&o.prototype instanceof f?o:f,s=Object.create(i.prototype);return n(s,"_invoke",function(e,n,o){var u,a,i,s=0,f=o||[],l=!1,p={p:0,n:0,v:t,a:d,f:d.bind(t,4),d:function(e,r){return u=e,a=0,i=t,p.n=r,c}};function d(e,n){for(a=e,i=n,r=0;!l&&s&&!o&&r<f.length;r++){var o,u=f[r],d=p.p,v=u[2];e>3?(o=v===n)&&(i=u[(a=u[4])?5:(a=3,3)],u[4]=u[5]=t):u[0]<=d&&((o=e<2&&d<u[1])?(a=0,p.v=n,p.n=u[1]):d<v&&(o=e<3||u[0]>n||n>v)&&(u[4]=e,u[5]=n,p.n=v,a=0))}if(o||e>1)return c;throw l=!0,n}return function(o,f,v){if(s>1)throw TypeError("Generator is already running");for(l&&1===f&&d(f,v),a=f,i=v;(r=a<2?t:i)||!l;){u||(a?a<3?(a>1&&(p.n=-1),d(a,i)):p.n=i:p.v=i);try{if(s=2,u){if(a||(o="next"),r=u[o]){if(!(r=r.call(u,i)))throw TypeError("iterator result is not an object");if(!r.done)return r;i=r.value,a<2&&(a=0)}else 1===a&&(r=u.return)&&r.call(u),a<2&&(i=TypeError("The iterator does not provide a \'"+o+"\' method"),a=1);u=t}else if((r=(l=p.n<0)?i:e.call(n,p))!==c)break}catch(e){u=t,a=1,i=e}finally{s=1}}return{value:r,done:l}}}(e,u,a),!0),s}var c={};function f(){}function l(){}function p(){}r=Object.getPrototypeOf;var d=[][a]?r(r([][a]())):(n(r={},a,(function(){return this})),r),v=p.prototype=f.prototype=Object.create(d);function x(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,p):(e.__proto__=p,n(e,i,"GeneratorFunction")),e.prototype=Object.create(v),e}return l.prototype=p,n(v,"constructor",p),n(p,"constructor",l),l.displayName="GeneratorFunction",n(p,i,"GeneratorFunction"),n(v),n(v,i,"Generator"),n(v,a,(function(){return this})),n(v,"toString",(function(){return"[object Generator]"})),(e.exports=o=function(){return{w:s,m:x}},e.exports.__esModule=!0,e.exports.default=e.exports)()}e.exports=o,e.exports.__esModule=!0,e.exports.default=e.exports}},t={};function r(n){var o=t[n];if(void 0!==o)return o.exports;var u=t[n]={exports:{}};return e[n].call(u.exports,u,u.exports,r),u.exports}r.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return r.d(t,{a:t}),t},r.d=(e,t)=>{for(var n in t)r.o(t,n)&&!r.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{"use strict";r(472)})()})();');t.clearInterval=function(t){return r().clearInterval(t)},t.clearTimeout=function(t){return r().clearTimeout(t)},t.setInterval=function(){var t;return(t=r()).setInterval.apply(t,arguments)},t.setTimeout=function(){var t;return(t=r()).setTimeout.apply(t,arguments)}},"object"==typeof t&&typeof e<"u"?i(t,Ca()):"function"==typeof define&&r.amdO?define(["exports","worker-timers-broker"],i):i((n=typeof globalThis<"u"?globalThis:n||self).workerTimers={},n.workerTimersBroker)}),Oa=kr(t=>{Ir(),Ei(),oi(),Object.defineProperty(t,"__esModule",{value:!0}),t.isReactNativeBrowser=t.isWebWorker=void 0;var e=()=>{var t;return!!("object"==typeof self&&null!==(t=self)&&void 0!==t&&null!==(t=t.constructor)&&void 0!==t&&null!==(t=t.name)&&void 0!==t&&t.includes("WorkerGlobalScope")&&typeof Deno>"u")},r=()=>typeof navigator<"u"&&"ReactNative"===navigator.product,n=(()=>{var t;return typeof window<"u"&&(typeof navigator<"u"&&(null===(t=navigator.userAgent)||void 0===t?void 0:t.toLowerCase().indexOf(" electron/"))>-1&&null!==Rr&&void 0!==Rr&&Rr.versions?!Object.prototype.hasOwnProperty.call(Rr.versions,"electron"):typeof window.document<"u")})()||e()||r();t.isWebWorker=e(),t.isReactNativeBrowser=r(),t.default=n}),Da=kr(t=>{Ir(),Ei(),oi();var e=t&&t.__createBinding||(Object.create?function(t,e,r,n){void 0===n&&(n=r);var i=Object.getOwnPropertyDescriptor(e,r);(!i||("get"in i?!e.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return e[r]}}),Object.defineProperty(t,n,i)}:function(t,e,r,n){void 0===n&&(n=r),t[n]=e[r]}),r=t&&t.__setModuleDefault||(Object.create?function(t,e){Object.defineProperty(t,"default",{enumerable:!0,value:e})}:function(t,e){t.default=e}),n=t&&t.__importStar||function(){var t=function(e){return(t=Object.getOwnPropertyNames||function(t){var e=[];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[e.length]=r);return e})(e)};return function(n){if(n&&n.__esModule)return n;var i={};if(null!=n)for(var s=t(n),a=0;a<s.length;a++)"default"!==s[a]&&e(i,n,s[a]);return r(i,n),i}}();Object.defineProperty(t,"__esModule",{value:!0});var i=Ma(),s=n(Oa()),a={set:i.setInterval,clear:i.clearInterval},o={set:(t,e)=>setInterval(t,e),clear:t=>clearInterval(t)};t.default=t=>{switch(t){case"native":return o;case"worker":return a;default:return!s.default||s.isWebWorker||s.isReactNativeBrowser?o:a}}}),Na=kr(t=>{Ir(),Ei(),oi();var e=t&&t.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(t,"__esModule",{value:!0});var r=e(Da());t.default=class{get keepaliveTimeoutTimestamp(){return this._keepaliveTimeoutTimestamp}get intervalEvery(){return this._intervalEvery}get keepalive(){return this._keepalive}constructor(t,e){o(this,"_keepalive",void 0),o(this,"timerId",void 0),o(this,"timer",void 0),o(this,"destroyed",!1),o(this,"counter",void 0),o(this,"client",void 0),o(this,"_keepaliveTimeoutTimestamp",void 0),o(this,"_intervalEvery",void 0),this.client=t,this.timer="object"==typeof e&&"set"in e&&"clear"in e?e:(0,r.default)(e),this.setKeepalive(t.options.keepalive)}clear(){this.timerId&&(this.timer.clear(this.timerId),this.timerId=null)}setKeepalive(t){if(t*=1e3,isNaN(t)||t<=0||t>2147483647)throw new Error("Keepalive value must be an integer between 0 and 2147483647. Provided value is ".concat(t));this._keepalive=t,this.reschedule(),this.client.log("KeepaliveManager: set keepalive to ".concat(t,"ms"))}destroy(){this.clear(),this.destroyed=!0}reschedule(){if(this.destroyed)return;this.clear(),this.counter=0;let t=Math.ceil(1.5*this._keepalive);this._keepaliveTimeoutTimestamp=Date.now()+t,this._intervalEvery=Math.ceil(this._keepalive/2),this.timerId=this.timer.set(()=>{this.destroyed||(this.counter+=1,2===this.counter?this.client.sendPing():this.counter>2&&this.client.onKeepaliveTimeout())},this._intervalEvery)}}}),Fa=kr(t=>{var e;Ir(),Ei(),oi();var r=t&&t.__createBinding||(Object.create?function(t,e,r,n){void 0===n&&(n=r);var i=Object.getOwnPropertyDescriptor(e,r);(!i||("get"in i?!e.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return e[r]}}),Object.defineProperty(t,n,i)}:function(t,e,r,n){void 0===n&&(n=r),t[n]=e[r]}),n=t&&t.__setModuleDefault||(Object.create?function(t,e){Object.defineProperty(t,"default",{enumerable:!0,value:e})}:function(t,e){t.default=e}),i=t&&t.__importStar||function(){var t=function(e){return(t=Object.getOwnPropertyNames||function(t){var e=[];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[e.length]=r);return e})(e)};return function(e){if(e&&e.__esModule)return e;var i={};if(null!=e)for(var s=t(e),a=0;a<s.length;a++)"default"!==s[a]&&r(i,e,s[a]);return n(i,e),i}}(),s=t&&t.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(t,"__esModule",{value:!0});var a=s(Ss()),l=cs(),u=s(ks()),h=s(ys()),d=i(As()),f=s(xs()),p=s(sa()),g=s(aa()),m=s(oa()),y=Ls(),v=la(),b=s(Na()),_=i(Oa()),w=globalThis.setImmediate||function(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];let n=e.shift();(0,y.nextTick)(()=>{n(...e)})},E={keepalive:60,reschedulePings:!0,protocolId:"MQTT",protocolVersion:4,reconnectPeriod:1e3,connectTimeout:3e4,clean:!0,resubscribe:!0,subscribeBatchSize:null,writeCache:!0,timerVariant:"auto"},S=(e=class t extends v.TypedEventEmitter{static defaultId(){return"mqttjs_".concat(Math.random().toString(16).substr(2,8))}constructor(e,r){super(),o(this,"connected",void 0),o(this,"disconnecting",void 0),o(this,"disconnected",void 0),o(this,"reconnecting",void 0),o(this,"incomingStore",void 0),o(this,"outgoingStore",void 0),o(this,"options",void 0),o(this,"queueQoSZero",void 0),o(this,"_reconnectCount",void 0),o(this,"log",void 0),o(this,"messageIdProvider",void 0),o(this,"outgoing",void 0),o(this,"messageIdToTopic",void 0),o(this,"noop",void 0),o(this,"keepaliveManager",void 0),o(this,"stream",void 0),o(this,"queue",void 0),o(this,"streamBuilder",void 0),o(this,"_resubscribeTopics",void 0),o(this,"connackTimer",void 0),o(this,"reconnectTimer",void 0),o(this,"_storeProcessing",void 0),o(this,"_packetIdsDuringStoreProcessing",void 0),o(this,"_storeProcessingQueue",void 0),o(this,"_firstConnection",void 0),o(this,"topicAliasRecv",void 0),o(this,"topicAliasSend",void 0),o(this,"_deferredReconnect",void 0),o(this,"connackPacket",void 0),this.options=r||{};for(let t in E)typeof this.options[t]>"u"?this.options[t]=E[t]:this.options[t]=r[t];this.log=this.options.log||(0,h.default)("mqttjs:client"),this.noop=this._noop.bind(this),this.log("MqttClient :: version:",t.VERSION),_.isWebWorker?this.log("MqttClient :: environment","webworker"):this.log("MqttClient :: environment",_.default?"browser":"node"),this.log("MqttClient :: options.protocol",r.protocol),this.log("MqttClient :: options.protocolVersion",r.protocolVersion),this.log("MqttClient :: options.username",r.username),this.log("MqttClient :: options.keepalive",r.keepalive),this.log("MqttClient :: options.reconnectPeriod",r.reconnectPeriod),this.log("MqttClient :: options.rejectUnauthorized",r.rejectUnauthorized),this.log("MqttClient :: options.properties.topicAliasMaximum",r.properties?r.properties.topicAliasMaximum:void 0),this.options.clientId="string"==typeof r.clientId?r.clientId:t.defaultId(),this.log("MqttClient :: clientId",this.options.clientId),this.options.customHandleAcks=5===r.protocolVersion&&r.customHandleAcks?r.customHandleAcks:function(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];e[3](null,0)},this.options.writeCache||(a.default.writeToStream.cacheNumbers=!1),this.streamBuilder=e,this.messageIdProvider=typeof this.options.messageIdProvider>"u"?new g.default:this.options.messageIdProvider,this.outgoingStore=r.outgoingStore||new f.default,this.incomingStore=r.incomingStore||new f.default,this.queueQoSZero=void 0===r.queueQoSZero||r.queueQoSZero,this._resubscribeTopics={},this.messageIdToTopic={},this.keepaliveManager=null,this.connected=!1,this.disconnecting=!1,this.reconnecting=!1,this.queue=[],this.connackTimer=null,this.reconnectTimer=null,this._storeProcessing=!1,this._packetIdsDuringStoreProcessing={},this._storeProcessingQueue=[],this.outgoing={},this._firstConnection=!0,r.properties&&r.properties.topicAliasMaximum>0&&(r.properties.topicAliasMaximum>65535?this.log("MqttClient :: options.properties.topicAliasMaximum is out of range"):this.topicAliasRecv=new m.default(r.properties.topicAliasMaximum)),this.on("connect",()=>{let{queue:t}=this,e=()=>{let r=t.shift();this.log("deliver :: entry %o",r);let n=null;if(!r)return void this._resubscribe();n=r.packet,this.log("deliver :: call _sendPacket for %o",n);let i=!0;n.messageId&&0!==n.messageId&&(this.messageIdProvider.register(n.messageId)||(i=!1)),i?this._sendPacket(n,t=>{r.cb&&r.cb(t),e()}):(this.log("messageId: %d has already used. The message is skipped and removed.",n.messageId),e())};this.log("connect :: sending queued packets"),e()}),this.on("close",()=>{this.log("close :: connected set to `false`"),this.connected=!1,this.log("close :: clearing connackTimer"),clearTimeout(this.connackTimer),this._destroyKeepaliveManager(),this.topicAliasRecv&&this.topicAliasRecv.clear(),this.log("close :: calling _setupReconnect"),this._setupReconnect()}),this.options.manualConnect||(this.log("MqttClient :: setting up stream"),this.connect())}handleAuth(t,e){e()}handleMessage(t,e){e()}_nextId(){return this.messageIdProvider.allocate()}getLastMessageId(){return this.messageIdProvider.getLastAllocated()}connect(){var t;let e=new l.Writable,r=a.default.parser(this.options),n=null,i=[];this.log("connect :: calling method to clear reconnect"),this._clearReconnect(),this.disconnected&&!this.reconnecting&&(this.incomingStore=this.options.incomingStore||new f.default,this.outgoingStore=this.options.outgoingStore||new f.default,this.disconnecting=!1,this.disconnected=!1),this.log("connect :: using streamBuilder provided to client to create stream"),this.stream=this.streamBuilder(this),r.on("packet",t=>{this.log("parser :: on packet push to packets array."),i.push(t)});let s=()=>{this.log("work :: getting next packet in queue");let t=i.shift();if(t)this.log("work :: packet pulled from queue"),(0,p.default)(this,t,o);else{this.log("work :: no packets in queue");let t=n;n=null,this.log("work :: done flag is %s",!!t),t&&t()}},o=()=>{if(i.length)(0,y.nextTick)(s);else{let t=n;n=null,t()}};e._write=(t,e,i)=>{n=i,this.log("writable stream :: parsing buffer"),r.parse(t),s()};this.log("connect :: pipe stream to writable stream"),this.stream.pipe(e),this.stream.on("error",t=>{this.log("streamErrorHandler :: error",t.message),t.code?(this.log("streamErrorHandler :: emitting error"),this.emit("error",t)):this.noop(t)}),this.stream.on("close",()=>{this.log("(%s)stream :: on close",this.options.clientId),this._flushVolatile(),this.log("stream: emit close to MqttClient"),this.emit("close")}),this.log("connect: sending packet `connect`");let u={cmd:"connect",protocolId:this.options.protocolId,protocolVersion:this.options.protocolVersion,clean:this.options.clean,clientId:this.options.clientId,keepalive:this.options.keepalive,username:this.options.username,password:this.options.password,properties:this.options.properties};if(this.options.will&&(u.will=c(c({},this.options.will),{},{payload:null===(t=this.options.will)||void 0===t?void 0:t.payload})),this.topicAliasRecv&&(u.properties||(u.properties={}),this.topicAliasRecv&&(u.properties.topicAliasMaximum=this.topicAliasRecv.max)),this._writePacket(u),r.on("error",this.emit.bind(this,"error")),this.options.properties){if(!this.options.properties.authenticationMethod&&this.options.properties.authenticationData)return this.end(()=>this.emit("error",new Error("Packet has no Authentication Method"))),this;if(this.options.properties.authenticationMethod&&this.options.authPacket&&"object"==typeof this.options.authPacket){let t=c({cmd:"auth",reasonCode:0},this.options.authPacket);this._writePacket(t)}}return this.stream.setMaxListeners(1e3),clearTimeout(this.connackTimer),this.connackTimer=setTimeout(()=>{this.log("!!connectTimeout hit!! Calling _cleanUp with force `true`"),this.emit("error",new Error("connack timeout")),this._cleanUp(!0)},this.options.connectTimeout),this}publish(t,e,r,n){this.log("publish :: message `%s` to topic `%s`",e,t);let{options:i}=this;"function"==typeof r&&(n=r,r=null),r=r||{},r=c(c({},{qos:0,retain:!1,dup:!1}),r);let{qos:s,retain:a,dup:o,properties:l,cbStorePut:u}=r;if(this._checkDisconnecting(n))return this;let h=()=>{let r=0;if((1===s||2===s)&&(r=this._nextId(),null===r))return this.log("No messageId left"),!1;let c={cmd:"publish",topic:t,payload:e,qos:s,retain:a,messageId:r,dup:o};switch(5===i.protocolVersion&&(c.properties=l),this.log("publish :: qos",s),s){case 1:case 2:this.outgoing[c.messageId]={volatile:!1,cb:n||this.noop},this.log("MqttClient:publish: packet cmd: %s",c.cmd),this._sendPacket(c,void 0,u);break;default:this.log("MqttClient:publish: packet cmd: %s",c.cmd),this._sendPacket(c,n,u)}return!0};return(this._storeProcessing||this._storeProcessingQueue.length>0||!h())&&this._storeProcessingQueue.push({invoke:h,cbStorePut:r.cbStorePut,callback:n}),this}publishAsync(t,e,r){return new Promise((n,i)=>{this.publish(t,e,r,(t,e)=>{t?i(t):n(e)})})}subscribe(t,e,r){let n=this.options.protocolVersion;"function"==typeof e&&(r=e),r=r||this.noop;let i=!1,s=[];"string"==typeof t?s=t=[t]:Array.isArray(t)?s=t:"object"==typeof t&&(i=t.resubscribe,delete t.resubscribe,s=Object.keys(t));let a=d.validateTopics(s);if(null!==a)return w(r,new Error("Invalid topic ".concat(a))),this;if(this._checkDisconnecting(r))return this.log("subscribe: discconecting true"),this;let o={qos:0};5===n&&(o.nl=!1,o.rap=!1,o.rh=0),e=c(c({},o),e);let{properties:l}=e,u=[],h=(t,r)=>{if(r=r||e,!Object.prototype.hasOwnProperty.call(this._resubscribeTopics,t)||this._resubscribeTopics[t].qos<r.qos||i){let e={topic:t,qos:r.qos};5===n&&(e.nl=r.nl,e.rap=r.rap,e.rh=r.rh,e.properties=l),this.log("subscribe: pushing topic `%s` and qos `%s` to subs list",e.topic,e.qos),u.push(e)}};if(Array.isArray(t)?t.forEach(t=>{this.log("subscribe: array topic %s",t),h(t)}):Object.keys(t).forEach(e=>{this.log("subscribe: object topic %s, %o",e,t[e]),h(e,t[e])}),!u.length)return r(null,[]),this;let f=(t,e)=>{let r={cmd:"subscribe",subscriptions:t,messageId:e};if(l&&(r.properties=l),this.options.resubscribe){this.log("subscribe :: resubscribe true");let e=[];t.forEach(t=>{if(this.options.reconnectPeriod>0){let r={qos:t.qos};5===n&&(r.nl=t.nl||!1,r.rap=t.rap||!1,r.rh=t.rh||0,r.properties=t.properties),this._resubscribeTopics[t.topic]=r,e.push(t.topic)}}),this.messageIdToTopic[r.messageId]=e}let i=new Promise((e,n)=>{this.outgoing[r.messageId]={volatile:!0,cb(r,i){if(!r){let{granted:e}=i;for(let r=0;r<e.length;r+=1)t[r].qos=e[r]}r?n(new y.ErrorWithSubackPacket(r.message,i)):e(i)}}});return this.log("subscribe :: call _sendPacket"),this._sendPacket(r),i},p=()=>{var t;let e=null!==(t=this.options.subscribeBatchSize)&&void 0!==t?t:u.length,n=[];for(let r=0;r<u.length;r+=e){let t=u.slice(r,r+e),i=this._nextId();if(null===i)return this.log("No messageId left"),!1;n.push(f(t,i))}return Promise.all(n).then(t=>{r(null,u,t.at(-1))}).catch(t=>{r(t,u,t.packet)}),!0};return(this._storeProcessing||this._storeProcessingQueue.length>0||!p())&&this._storeProcessingQueue.push({invoke:p,callback:r}),this}subscribeAsync(t,e){return new Promise((r,n)=>{this.subscribe(t,e,(t,e)=>{t?n(t):r(e)})})}unsubscribe(t,e,r){"string"==typeof t&&(t=[t]),"function"==typeof e&&(r=e),r=r||this.noop;let n=d.validateTopics(t);if(null!==n)return w(r,new Error("Invalid topic ".concat(n))),this;if(this._checkDisconnecting(r))return this;let i=()=>{let n=this._nextId();if(null===n)return this.log("No messageId left"),!1;let i={cmd:"unsubscribe",messageId:n,unsubscriptions:[]};return"string"==typeof t?i.unsubscriptions=[t]:Array.isArray(t)&&(i.unsubscriptions=t),this.options.resubscribe&&i.unsubscriptions.forEach(t=>{delete this._resubscribeTopics[t]}),"object"==typeof e&&e.properties&&(i.properties=e.properties),this.outgoing[i.messageId]={volatile:!0,cb:r},this.log("unsubscribe: call _sendPacket"),this._sendPacket(i),!0};return(this._storeProcessing||this._storeProcessingQueue.length>0||!i())&&this._storeProcessingQueue.push({invoke:i,callback:r}),this}unsubscribeAsync(t,e){return new Promise((r,n)=>{this.unsubscribe(t,e,(t,e)=>{t?n(t):r(e)})})}end(t,e,r){this.log("end :: (%s)",this.options.clientId),(null==t||"boolean"!=typeof t)&&(r=r||e,e=t,t=!1),"object"!=typeof e&&(r=r||e,e=null),this.log("end :: cb? %s",!!r),(!r||"function"!=typeof r)&&(r=this.noop);let n=()=>{this.log("end :: closeStores: closing incoming and outgoing stores"),this.disconnected=!0,this.incomingStore.close(t=>{this.outgoingStore.close(e=>{if(this.log("end :: closeStores: emitting end"),this.emit("end"),r){let n=t||e;this.log("end :: closeStores: invoking callback with args"),r(n)}})}),this._deferredReconnect?this._deferredReconnect():(0===this.options.reconnectPeriod||this.options.manualConnect)&&(this.disconnecting=!1)},i=()=>{this.log("end :: (%s) :: finish :: calling _cleanUp with force %s",this.options.clientId,t),this._cleanUp(t,()=>{this.log("end :: finish :: calling process.nextTick on closeStores"),(0,y.nextTick)(n)},e)};return this.disconnecting?(r(),this):(this._clearReconnect(),this.disconnecting=!0,!t&&Object.keys(this.outgoing).length>0?(this.log("end :: (%s) :: calling finish in 10ms once outgoing is empty",this.options.clientId),this.once("outgoingEmpty",setTimeout.bind(null,i,10))):(this.log("end :: (%s) :: immediately calling finish",this.options.clientId),i()),this)}endAsync(t,e){return new Promise((r,n)=>{this.end(t,e,t=>{t?n(t):r()})})}removeOutgoingMessage(t){if(this.outgoing[t]){let{cb:e}=this.outgoing[t];this._removeOutgoingAndStoreMessage(t,()=>{e(new Error("Message removed"))})}return this}reconnect(t){this.log("client reconnect");let e=()=>{t?(this.options.incomingStore=t.incomingStore,this.options.outgoingStore=t.outgoingStore):(this.options.incomingStore=null,this.options.outgoingStore=null),this.incomingStore=this.options.incomingStore||new f.default,this.outgoingStore=this.options.outgoingStore||new f.default,this.disconnecting=!1,this.disconnected=!1,this._deferredReconnect=null,this._reconnect()};return this.disconnecting&&!this.disconnected?this._deferredReconnect=e:e(),this}_flushVolatile(){this.outgoing&&(this.log("_flushVolatile :: deleting volatile messages from the queue and setting their callbacks as error function"),Object.keys(this.outgoing).forEach(t=>{this.outgoing[t].volatile&&"function"==typeof this.outgoing[t].cb&&(this.outgoing[t].cb(new Error("Connection closed")),delete this.outgoing[t])}))}_flush(){this.outgoing&&(this.log("_flush: queue exists? %b",!!this.outgoing),Object.keys(this.outgoing).forEach(t=>{"function"==typeof this.outgoing[t].cb&&(this.outgoing[t].cb(new Error("Connection closed")),delete this.outgoing[t])}))}_removeTopicAliasAndRecoverTopicName(t){let e;t.properties&&(e=t.properties.topicAlias);let r=t.topic.toString();if(this.log("_removeTopicAliasAndRecoverTopicName :: alias %d, topic %o",e,r),0===r.length){if(typeof e>"u")return new Error("Unregistered Topic Alias");if(r=this.topicAliasSend.getTopicByAlias(e),typeof r>"u")return new Error("Unregistered Topic Alias");t.topic=r}e&&delete t.properties.topicAlias}_checkDisconnecting(t){return this.disconnecting&&(t&&t!==this.noop?t(new Error("client disconnecting")):this.emit("error",new Error("client disconnecting"))),this.disconnecting}_reconnect(){this.log("_reconnect: emitting reconnect to client"),this.emit("reconnect"),this.connected?(this.end(()=>{this.connect()}),this.log("client already connected. disconnecting first.")):(this.log("_reconnect: calling connect"),this.connect())}_setupReconnect(){!this.disconnecting&&!this.reconnectTimer&&this.options.reconnectPeriod>0?(this.reconnecting||(this.log("_setupReconnect :: emit `offline` state"),this.emit("offline"),this.log("_setupReconnect :: set `reconnecting` to `true`"),this.reconnecting=!0),this.log("_setupReconnect :: setting reconnectTimer for %d ms",this.options.reconnectPeriod),this.reconnectTimer=setInterval(()=>{this.log("reconnectTimer :: reconnect triggered!"),this._reconnect()},this.options.reconnectPeriod)):this.log("_setupReconnect :: doing nothing...")}_clearReconnect(){this.log("_clearReconnect : clearing reconnect timer"),this.reconnectTimer&&(clearInterval(this.reconnectTimer),this.reconnectTimer=null)}_cleanUp(t,e){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(e&&(this.log("_cleanUp :: done callback provided for on stream close"),this.stream.on("close",e)),this.log("_cleanUp :: forced? %s",t),t)0===this.options.reconnectPeriod&&this.options.clean&&this._flush(),this.log("_cleanUp :: (%s) :: destroying stream",this.options.clientId),this.stream.destroy();else{let t=c({cmd:"disconnect"},r);this.log("_cleanUp :: (%s) :: call _sendPacket with disconnect packet",this.options.clientId),this._sendPacket(t,()=>{this.log("_cleanUp :: (%s) :: destroying stream",this.options.clientId),w(()=>{this.stream.end(()=>{this.log("_cleanUp :: (%s) :: stream destroyed",this.options.clientId)})})})}!this.disconnecting&&!this.reconnecting&&(this.log("_cleanUp :: client not disconnecting/reconnecting. Clearing and resetting reconnect."),this._clearReconnect(),this._setupReconnect()),this._destroyKeepaliveManager(),e&&!this.connected&&(this.log("_cleanUp :: (%s) :: removing stream `done` callback `close` listener",this.options.clientId),this.stream.removeListener("close",e),e())}_storeAndSend(t,e,r){this.log("storeAndSend :: store packet with cmd %s to outgoingStore",t.cmd);let n,i=t;if("publish"===i.cmd&&(i=(0,u.default)(t),n=this._removeTopicAliasAndRecoverTopicName(i),n))return e&&e(n);this.outgoingStore.put(i,n=>{if(n)return e&&e(n);r(),this._writePacket(t,e)})}_applyTopicAlias(t){if(5===this.options.protocolVersion&&"publish"===t.cmd){let e;t.properties&&(e=t.properties.topicAlias);let r=t.topic.toString();if(this.topicAliasSend)if(e){if(0!==r.length&&(this.log("applyTopicAlias :: register topic: %s - alias: %d",r,e),!this.topicAliasSend.put(r,e)))return this.log("applyTopicAlias :: error out of range. topic: %s - alias: %d",r,e),new Error("Sending Topic Alias out of range")}else 0!==r.length&&(this.options.autoAssignTopicAlias?(e=this.topicAliasSend.getAliasByTopic(r),e?(t.topic="",t.properties=c(c({},t.properties),{},{topicAlias:e}),this.log("applyTopicAlias :: auto assign(use) topic: %s - alias: %d",r,e)):(e=this.topicAliasSend.getLruAlias(),this.topicAliasSend.put(r,e),t.properties=c(c({},t.properties),{},{topicAlias:e}),this.log("applyTopicAlias :: auto assign topic: %s - alias: %d",r,e))):this.options.autoUseTopicAlias&&(e=this.topicAliasSend.getAliasByTopic(r),e&&(t.topic="",t.properties=c(c({},t.properties),{},{topicAlias:e}),this.log("applyTopicAlias :: auto use topic: %s - alias: %d",r,e))));else if(e)return this.log("applyTopicAlias :: error out of range. topic: %s - alias: %d",r,e),new Error("Sending Topic Alias out of range")}}_noop(t){this.log("noop ::",t)}_writePacket(t,e){this.log("_writePacket :: packet: %O",t),this.log("_writePacket :: emitting `packetsend`"),this.emit("packetsend",t),this.log("_writePacket :: writing to stream");let r=a.default.writeToStream(t,this.stream,this.options);this.log("_writePacket :: writeToStream result %s",r),!r&&e&&e!==this.noop?(this.log("_writePacket :: handle events on `drain` once through callback."),this.stream.once("drain",e)):e&&(this.log("_writePacket :: invoking cb"),e())}_sendPacket(t,e,r,n){this.log("_sendPacket :: (%s) ::  start",this.options.clientId),r=r||this.noop,e=e||this.noop;let i=this._applyTopicAlias(t);if(i)e(i);else{if(!this.connected)return"auth"===t.cmd?void this._writePacket(t,e):(this.log("_sendPacket :: client not connected. Storing packet offline."),void this._storePacket(t,e,r));if(n)this._writePacket(t,e);else{switch(t.cmd){case"publish":break;case"pubrel":return void this._storeAndSend(t,e,r);default:return void this._writePacket(t,e)}switch(t.qos){case 2:case 1:this._storeAndSend(t,e,r);break;default:this._writePacket(t,e)}this.log("_sendPacket :: (%s) ::  end",this.options.clientId)}}}_storePacket(t,e,r){this.log("_storePacket :: packet: %o",t),this.log("_storePacket :: cb? %s",!!e),r=r||this.noop;let n=t;if("publish"===n.cmd){n=(0,u.default)(t);let r=this._removeTopicAliasAndRecoverTopicName(n);if(r)return e&&e(r)}let i=n.qos||0;0===i&&this.queueQoSZero||"publish"!==n.cmd?this.queue.push({packet:n,cb:e}):i>0?(e=this.outgoing[n.messageId]?this.outgoing[n.messageId].cb:null,this.outgoingStore.put(n,t=>{if(t)return e&&e(t);r()})):e&&e(new Error("No connection to broker"))}_setupKeepaliveManager(){this.log("_setupKeepaliveManager :: keepalive %d (seconds)",this.options.keepalive),!this.keepaliveManager&&this.options.keepalive&&(this.keepaliveManager=new b.default(this,this.options.timerVariant))}_destroyKeepaliveManager(){this.keepaliveManager&&(this.log("_destroyKeepaliveManager :: destroying keepalive manager"),this.keepaliveManager.destroy(),this.keepaliveManager=null)}reschedulePing(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.keepaliveManager&&this.options.keepalive&&(t||this.options.reschedulePings)&&this._reschedulePing()}_reschedulePing(){this.log("_reschedulePing :: rescheduling ping"),this.keepaliveManager.reschedule()}sendPing(){this.log("_sendPing :: sending pingreq"),this._sendPacket({cmd:"pingreq"})}onKeepaliveTimeout(){this.emit("error",new Error("Keepalive timeout")),this.log("onKeepaliveTimeout :: calling _cleanUp with force true"),this._cleanUp(!0)}_resubscribe(){this.log("_resubscribe");let t=Object.keys(this._resubscribeTopics);if(!this._firstConnection&&(this.options.clean||this.options.protocolVersion>=4&&!this.connackPacket.sessionPresent)&&t.length>0)if(this.options.resubscribe)if(5===this.options.protocolVersion){this.log("_resubscribe: protocolVersion 5");for(let e=0;e<t.length;e++){let r={};r[t[e]]=this._resubscribeTopics[t[e]],r.resubscribe=!0,this.subscribe(r,{properties:r[t[e]].properties})}}else this._resubscribeTopics.resubscribe=!0,this.subscribe(this._resubscribeTopics);else this._resubscribeTopics={};this._firstConnection=!1}_onConnect(t){if(this.disconnected)return void this.emit("connect",t);this.connackPacket=t,this.messageIdProvider.clear(),this._setupKeepaliveManager(),this.connected=!0;let e=()=>{let r=this.outgoingStore.createStream(),n=()=>{r.destroy(),r=null,this._flushStoreProcessingQueue(),i()},i=()=>{this._storeProcessing=!1,this._packetIdsDuringStoreProcessing={}};this.once("close",n),r.on("error",t=>{i(),this._flushStoreProcessingQueue(),this.removeListener("close",n),this.emit("error",t)});let s=()=>{if(!r)return;let t,e=r.read(1);e?(this._storeProcessing=!0,this._packetIdsDuringStoreProcessing[e.messageId]?s():this.disconnecting||this.reconnectTimer?r.destroy&&r.destroy():(t=this.outgoing[e.messageId]?this.outgoing[e.messageId].cb:null,this.outgoing[e.messageId]={volatile:!1,cb(e,r){t&&t(e,r),s()}},this._packetIdsDuringStoreProcessing[e.messageId]=!0,this.messageIdProvider.register(e.messageId)?this._sendPacket(e,void 0,void 0,!0):this.log("messageId: %d has already used.",e.messageId))):r.once("readable",s)};r.on("end",()=>{let r=!0;for(let t in this._packetIdsDuringStoreProcessing)if(!this._packetIdsDuringStoreProcessing[t]){r=!1;break}this.removeListener("close",n),r?(i(),this._invokeAllStoreProcessingQueue(),this.emit("connect",t)):e()}),s()};e()}_invokeStoreProcessingQueue(){if(!this._storeProcessing&&this._storeProcessingQueue.length>0){let t=this._storeProcessingQueue[0];if(t&&t.invoke())return this._storeProcessingQueue.shift(),!0}return!1}_invokeAllStoreProcessingQueue(){for(;this._invokeStoreProcessingQueue(););}_flushStoreProcessingQueue(){for(let t of this._storeProcessingQueue)t.cbStorePut&&t.cbStorePut(new Error("Connection closed")),t.callback&&t.callback(new Error("Connection closed"));this._storeProcessingQueue.splice(0)}_removeOutgoingAndStoreMessage(t,e){delete this.outgoing[t],this.outgoingStore.del({messageId:t},(r,n)=>{e(r,n),this.messageIdProvider.deallocate(t),this._invokeStoreProcessingQueue()})}},o(e,"VERSION",y.MQTTJS_VERSION),e);t.default=S}),Ua=kr(t=>{Ir(),Ei(),oi(),Object.defineProperty(t,"__esModule",{value:!0});var e=ea();t.default=class{constructor(){o(this,"numberAllocator",void 0),o(this,"lastId",void 0),this.numberAllocator=new e.NumberAllocator(1,65535)}allocate(){return this.lastId=this.numberAllocator.alloc(),this.lastId}getLastAllocated(){return this.lastId}register(t){return this.numberAllocator.use(t)}deallocate(t){this.numberAllocator.free(t)}clear(){this.numberAllocator.clear()}}});var Ba,ja,za,Wa=Tr(()=>{Ir(),Ei(),oi(),Ba={},ja=!1,za=function(){if(ja)return Ba;ja=!0;let t=2147483647,e=36,r=/^xn--/,n=/[^\0-\x7F]/,i=/[\x2E\u3002\uFF0E\uFF61]/g,s={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},a=Math.floor,o=String.fromCharCode;function l(t){throw new RangeError(s[t])}function c(t,e){let r=t.split("@"),n="";r.length>1&&(n=r[0]+"@",t=r[1]);let s=function(t,e){let r=[],n=t.length;for(;n--;)r[n]=e(t[n]);return r}((t=t.replace(i,".")).split("."),e).join(".");return n+s}function u(t){let e=[],r=0,n=t.length;for(;r<n;){let i=t.charCodeAt(r++);if(i>=55296&&i<=56319&&r<n){let n=t.charCodeAt(r++);56320==(64512&n)?e.push(((1023&i)<<10)+(1023&n)+65536):(e.push(i),r--)}else e.push(i)}return e}let h=function(t){return t>=48&&t<58?t-48+26:t>=65&&t<91?t-65:t>=97&&t<123?t-97:e},d=function(t,e){return t+22+75*(t<26)-((0!=e)<<5)},f=function(t,r,n){let i=0;for(t=n?a(t/700):t>>1,t+=a(t/r);t>455;i+=e)t=a(t/35);return a(i+36*t/(t+38))},p=function(r){let n=[],i=r.length,s=0,o=128,c=72,u=r.lastIndexOf("-");u<0&&(u=0);for(let t=0;t<u;++t)r.charCodeAt(t)>=128&&l("not-basic"),n.push(r.charCodeAt(t));for(let d=u>0?u+1:0;d<i;){let u=s;for(let n=1,o=e;;o+=e){d>=i&&l("invalid-input");let u=h(r.charCodeAt(d++));u>=e&&l("invalid-input"),u>a((t-s)/n)&&l("overflow"),s+=u*n;let f=o<=c?1:o>=c+26?26:o-c;if(u<f)break;let p=e-f;n>a(t/p)&&l("overflow"),n*=p}let p=n.length+1;c=f(s-u,p,0==u),a(s/p)>t-o&&l("overflow"),o+=a(s/p),s%=p,n.splice(s++,0,o)}return String.fromCodePoint(...n)},g=function(r){let n=[],i=(r=u(r)).length,s=128,c=0,h=72;for(let t of r)t<128&&n.push(o(t));let p=n.length,g=p;for(p&&n.push("-");g<i;){let i=t;for(let t of r)t>=s&&t<i&&(i=t);let u=g+1;i-s>a((t-c)/u)&&l("overflow"),c+=(i-s)*u,s=i;for(let m of r)if(m<s&&++c>t&&l("overflow"),m===s){let t=c;for(let r=e;;r+=e){let i=r<=h?1:r>=h+26?26:r-h;if(t<i)break;let s=t-i,l=e-i;n.push(o(d(i+s%l,0))),t=a(s/l)}n.push(o(d(t,0))),h=f(c,u,g===p),c=0,++g}++c,++s}return n.join("")};return Ba={version:"2.3.1",ucs2:{decode:u,encode:t=>String.fromCodePoint(...t)},decode:p,encode:g,toASCII:function(t){return c(t,function(t){return n.test(t)?"xn--"+g(t):t})},toUnicode:function(t){return c(t,function(t){return r.test(t)?p(t.slice(4).toLowerCase()):t})}}}(),za.decode,za.encode,za.toASCII,za.toUnicode,za.ucs2,za.version});function Ga(){return co||(co=!0,lo=SyntaxError),lo}function Va(){return ho||(ho=!0,uo=TypeError),uo}function Ha(){if(mo)return go;mo=!0;var t=typeof Symbol<"u"&&Symbol,e=(Ja||(Ja=!0,Za=function(){if("function"!=typeof Symbol||"function"!=typeof Object.getOwnPropertySymbols)return!1;if("symbol"==typeof Symbol.iterator)return!0;var t={},e=Symbol("test"),r=Object(e);if("string"==typeof e||"[object Symbol]"!==Object.prototype.toString.call(e)||"[object Symbol]"!==Object.prototype.toString.call(r))return!1;for(e in t[e]=42,t)return!1;if("function"==typeof Object.keys&&0!==Object.keys(t).length||"function"==typeof Object.getOwnPropertyNames&&0!==Object.getOwnPropertyNames(t).length)return!1;var n=Object.getOwnPropertySymbols(t);if(1!==n.length||n[0]!==e||!Object.prototype.propertyIsEnumerable.call(t,e))return!1;if("function"==typeof Object.getOwnPropertyDescriptor){var i=Object.getOwnPropertyDescriptor(t,e);if(42!==i.value||!0!==i.enumerable)return!1}return!0}),Za);return go=function(){return"function"==typeof t&&"function"==typeof Symbol&&"symbol"==typeof t("foo")&&"symbol"==typeof Symbol("bar")&&e()}}function Ka(){if(Eo)return wo;Eo=!0;var t=function(){if(_o)return bo;_o=!0;var t=Object.prototype.toString,e=Math.max,r=function(t,e){for(var r=[],n=0;n<t.length;n+=1)r[n]=t[n];for(var i=0;i<e.length;i+=1)r[i+t.length]=e[i];return r};return bo=function(n){var i=this;if("function"!=typeof i||"[object Function]"!==t.apply(i))throw new TypeError("Function.prototype.bind called on incompatible "+i);for(var s,a=function(t){for(var e=[],r=1,n=0;r<t.length;r+=1,n+=1)e[n]=t[r];return e}(arguments),o=e(0,i.length-a.length),l=[],c=0;c<o;c++)l[c]="$"+c;if(s=Function("binder","return function ("+function(t,e){for(var r="",n=0;n<t.length;n+=1)r+=t[n],n+1<t.length&&(r+=e);return r}(l,",")+"){ return binder.apply(this,arguments); }")(function(){if(this instanceof s){var t=i.apply(this,r(a,arguments));return Object(t)===t?t:this}return i.apply(n,r(a,arguments))}),i.prototype){var u=function(){};u.prototype=i.prototype,s.prototype=new u,u.prototype=null}return s},bo}();return wo=Function.prototype.bind||t}function qa(){if(Ao)return ko;Ao=!0;var t,e=(eo||(eo=!0,to=Error),to),r=(no||(no=!0,ro=EvalError),ro),n=(so||(so=!0,io=RangeError),io),i=(oo||(oo=!0,ao=ReferenceError),ao),s=Ga(),a=Va(),o=(po||(po=!0,fo=URIError),fo),l=Function,c=function(t){try{return l('"use strict"; return ('+t+").constructor;")()}catch(e){}},u=Object.getOwnPropertyDescriptor;if(u)try{u({},"")}catch(C){u=null}var h=function(){throw new a},d=u?function(){try{return h}catch(t){try{return u(arguments,"callee").get}catch(e){return h}}}():h,f=Ha()(),p=function(){if(vo)return yo;vo=!0;var t={__proto__:null,foo:{}},e=Object;return yo=function(){return{__proto__:t}.foo===t.foo&&!(t instanceof e)}}()(),g=Object.getPrototypeOf||(p?function(t){return t.__proto__}:null),m={},y=typeof Uint8Array>"u"||!g?t:g(Uint8Array),v={__proto__:null,"%AggregateError%":typeof AggregateError>"u"?t:AggregateError,"%Array%":Array,"%ArrayBuffer%":typeof ArrayBuffer>"u"?t:ArrayBuffer,"%ArrayIteratorPrototype%":f&&g?g([][Symbol.iterator]()):t,"%AsyncFromSyncIteratorPrototype%":t,"%AsyncFunction%":m,"%AsyncGenerator%":m,"%AsyncGeneratorFunction%":m,"%AsyncIteratorPrototype%":m,"%Atomics%":typeof Atomics>"u"?t:Atomics,"%BigInt%":typeof BigInt>"u"?t:BigInt,"%BigInt64Array%":typeof BigInt64Array>"u"?t:BigInt64Array,"%BigUint64Array%":typeof BigUint64Array>"u"?t:BigUint64Array,"%Boolean%":Boolean,"%DataView%":typeof DataView>"u"?t:DataView,"%Date%":Date,"%decodeURI%":decodeURI,"%decodeURIComponent%":decodeURIComponent,"%encodeURI%":encodeURI,"%encodeURIComponent%":encodeURIComponent,"%Error%":e,"%eval%":eval,"%EvalError%":r,"%Float32Array%":typeof Float32Array>"u"?t:Float32Array,"%Float64Array%":typeof Float64Array>"u"?t:Float64Array,"%FinalizationRegistry%":typeof FinalizationRegistry>"u"?t:FinalizationRegistry,"%Function%":l,"%GeneratorFunction%":m,"%Int8Array%":typeof Int8Array>"u"?t:Int8Array,"%Int16Array%":typeof Int16Array>"u"?t:Int16Array,"%Int32Array%":typeof Int32Array>"u"?t:Int32Array,"%isFinite%":isFinite,"%isNaN%":isNaN,"%IteratorPrototype%":f&&g?g(g([][Symbol.iterator]())):t,"%JSON%":"object"==typeof JSON?JSON:t,"%Map%":typeof Map>"u"?t:Map,"%MapIteratorPrototype%":typeof Map>"u"||!f||!g?t:g((new Map)[Symbol.iterator]()),"%Math%":Math,"%Number%":Number,"%Object%":Object,"%parseFloat%":parseFloat,"%parseInt%":parseInt,"%Promise%":typeof Promise>"u"?t:Promise,"%Proxy%":typeof Proxy>"u"?t:Proxy,"%RangeError%":n,"%ReferenceError%":i,"%Reflect%":typeof Reflect>"u"?t:Reflect,"%RegExp%":RegExp,"%Set%":typeof Set>"u"?t:Set,"%SetIteratorPrototype%":typeof Set>"u"||!f||!g?t:g((new Set)[Symbol.iterator]()),"%SharedArrayBuffer%":typeof SharedArrayBuffer>"u"?t:SharedArrayBuffer,"%String%":String,"%StringIteratorPrototype%":f&&g?g(""[Symbol.iterator]()):t,"%Symbol%":f?Symbol:t,"%SyntaxError%":s,"%ThrowTypeError%":d,"%TypedArray%":y,"%TypeError%":a,"%Uint8Array%":typeof Uint8Array>"u"?t:Uint8Array,"%Uint8ClampedArray%":typeof Uint8ClampedArray>"u"?t:Uint8ClampedArray,"%Uint16Array%":typeof Uint16Array>"u"?t:Uint16Array,"%Uint32Array%":typeof Uint32Array>"u"?t:Uint32Array,"%URIError%":o,"%WeakMap%":typeof WeakMap>"u"?t:WeakMap,"%WeakRef%":typeof WeakRef>"u"?t:WeakRef,"%WeakSet%":typeof WeakSet>"u"?t:WeakSet};if(g)try{null.error}catch(M){var b=g(g(M));v["%Error.prototype%"]=b}var _=function t(e){var r;if("%AsyncFunction%"===e)r=c("async function () {}");else if("%GeneratorFunction%"===e)r=c("function* () {}");else if("%AsyncGeneratorFunction%"===e)r=c("async function* () {}");else if("%AsyncGenerator%"===e){var n=t("%AsyncGeneratorFunction%");n&&(r=n.prototype)}else if("%AsyncIteratorPrototype%"===e){var i=t("%AsyncGenerator%");i&&g&&(r=g(i.prototype))}return v[e]=r,r},w={__proto__:null,"%ArrayBufferPrototype%":["ArrayBuffer","prototype"],"%ArrayPrototype%":["Array","prototype"],"%ArrayProto_entries%":["Array","prototype","entries"],"%ArrayProto_forEach%":["Array","prototype","forEach"],"%ArrayProto_keys%":["Array","prototype","keys"],"%ArrayProto_values%":["Array","prototype","values"],"%AsyncFunctionPrototype%":["AsyncFunction","prototype"],"%AsyncGenerator%":["AsyncGeneratorFunction","prototype"],"%AsyncGeneratorPrototype%":["AsyncGeneratorFunction","prototype","prototype"],"%BooleanPrototype%":["Boolean","prototype"],"%DataViewPrototype%":["DataView","prototype"],"%DatePrototype%":["Date","prototype"],"%ErrorPrototype%":["Error","prototype"],"%EvalErrorPrototype%":["EvalError","prototype"],"%Float32ArrayPrototype%":["Float32Array","prototype"],"%Float64ArrayPrototype%":["Float64Array","prototype"],"%FunctionPrototype%":["Function","prototype"],"%Generator%":["GeneratorFunction","prototype"],"%GeneratorPrototype%":["GeneratorFunction","prototype","prototype"],"%Int8ArrayPrototype%":["Int8Array","prototype"],"%Int16ArrayPrototype%":["Int16Array","prototype"],"%Int32ArrayPrototype%":["Int32Array","prototype"],"%JSONParse%":["JSON","parse"],"%JSONStringify%":["JSON","stringify"],"%MapPrototype%":["Map","prototype"],"%NumberPrototype%":["Number","prototype"],"%ObjectPrototype%":["Object","prototype"],"%ObjProto_toString%":["Object","prototype","toString"],"%ObjProto_valueOf%":["Object","prototype","valueOf"],"%PromisePrototype%":["Promise","prototype"],"%PromiseProto_then%":["Promise","prototype","then"],"%Promise_all%":["Promise","all"],"%Promise_reject%":["Promise","reject"],"%Promise_resolve%":["Promise","resolve"],"%RangeErrorPrototype%":["RangeError","prototype"],"%ReferenceErrorPrototype%":["ReferenceError","prototype"],"%RegExpPrototype%":["RegExp","prototype"],"%SetPrototype%":["Set","prototype"],"%SharedArrayBufferPrototype%":["SharedArrayBuffer","prototype"],"%StringPrototype%":["String","prototype"],"%SymbolPrototype%":["Symbol","prototype"],"%SyntaxErrorPrototype%":["SyntaxError","prototype"],"%TypedArrayPrototype%":["TypedArray","prototype"],"%TypeErrorPrototype%":["TypeError","prototype"],"%Uint8ArrayPrototype%":["Uint8Array","prototype"],"%Uint8ClampedArrayPrototype%":["Uint8ClampedArray","prototype"],"%Uint16ArrayPrototype%":["Uint16Array","prototype"],"%Uint32ArrayPrototype%":["Uint32Array","prototype"],"%URIErrorPrototype%":["URIError","prototype"],"%WeakMapPrototype%":["WeakMap","prototype"],"%WeakSetPrototype%":["WeakSet","prototype"]},E=Ka(),S=function(){if(To)return So;To=!0;var t=Function.prototype.call,e=Object.prototype.hasOwnProperty,r=Ka();return So=r.call(t,e)}(),T=E.call(Function.call,Array.prototype.concat),k=E.call(Function.apply,Array.prototype.splice),A=E.call(Function.call,String.prototype.replace),x=E.call(Function.call,String.prototype.slice),I=E.call(Function.call,RegExp.prototype.exec),R=/[^%.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|%$))/g,L=/\\(\\)?/g,P=function(t,e){var r,n=t;if(S(w,n)&&(n="%"+(r=w[n])[0]+"%"),S(v,n)){var i=v[n];if(i===m&&(i=_(n)),typeof i>"u"&&!e)throw new a("intrinsic "+t+" exists, but is not available. Please file an issue!");return{alias:r,name:n,value:i}}throw new s("intrinsic "+t+" does not exist!")};return ko=function(t,e){if("string"!=typeof t||0===t.length)throw new a("intrinsic name must be a non-empty string");if(arguments.length>1&&"boolean"!=typeof e)throw new a('"allowMissing" argument must be a boolean');if(null===I(/^%?[^%]*%?$/,t))throw new s("`%` may not be present anywhere but at the beginning and end of the intrinsic name");var r=function(t){var e=x(t,0,1),r=x(t,-1);if("%"===e&&"%"!==r)throw new s("invalid intrinsic syntax, expected closing `%`");if("%"===r&&"%"!==e)throw new s("invalid intrinsic syntax, expected opening `%`");var n=[];return A(t,R,function(t,e,r,i){n[n.length]=r?A(i,L,"$1"):e||t}),n}(t),n=r.length>0?r[0]:"",i=P("%"+n+"%",e),o=i.name,l=i.value,c=!1,h=i.alias;h&&(n=h[0],k(r,T([0,1],h)));for(var d=1,f=!0;d<r.length;d+=1){var p=r[d],g=x(p,0,1),m=x(p,-1);if(('"'===g||"'"===g||"`"===g||'"'===m||"'"===m||"`"===m)&&g!==m)throw new s("property names with quotes must have matching quotes");if(("constructor"===p||!f)&&(c=!0),S(v,o="%"+(n+="."+p)+"%"))l=v[o];else if(null!=l){if(!(p in l)){if(!e)throw new a("base intrinsic for "+t+" exists, but the property is not available.");return}if(u&&d+1>=r.length){var y=u(l,p);l=(f=!!y)&&"get"in y&&!("originalValue"in y.get)?y.get:l[p]}else f=S(l,p),l=l[p];f&&!c&&(v[o]=l)}}return l},ko}function Ya(){if(Io)return xo;Io=!0;var t=qa()("%Object.defineProperty%",!0)||!1;if(t)try{t({},"a",{value:1})}catch(e){t=!1}return xo=t}function Qa(){if(Lo)return Ro;Lo=!0;var t=qa()("%Object.getOwnPropertyDescriptor%",!0);if(t)try{t([],"length")}catch(e){t=null}return Ro=t}function Xa(){if(No)return Do;No=!0;var t=qa(),e=function(){if(Co)return Po;Co=!0;var t=Ya(),e=Ga(),r=Va(),n=Qa();return Po=function(i,s,a){if(!i||"object"!=typeof i&&"function"!=typeof i)throw new r("`obj` must be an object or a function`");if("string"!=typeof s&&"symbol"!=typeof s)throw new r("`property` must be a string or a symbol`");if(arguments.length>3&&"boolean"!=typeof arguments[3]&&null!==arguments[3])throw new r("`nonEnumerable`, if provided, must be a boolean or null");if(arguments.length>4&&"boolean"!=typeof arguments[4]&&null!==arguments[4])throw new r("`nonWritable`, if provided, must be a boolean or null");if(arguments.length>5&&"boolean"!=typeof arguments[5]&&null!==arguments[5])throw new r("`nonConfigurable`, if provided, must be a boolean or null");if(arguments.length>6&&"boolean"!=typeof arguments[6])throw new r("`loose`, if provided, must be a boolean");var o=arguments.length>3?arguments[3]:null,l=arguments.length>4?arguments[4]:null,c=arguments.length>5?arguments[5]:null,u=arguments.length>6&&arguments[6],h=!!n&&n(i,s);if(t)t(i,s,{configurable:null===c&&h?h.configurable:!c,enumerable:null===o&&h?h.enumerable:!o,value:a,writable:null===l&&h?h.writable:!l});else{if(!u&&(o||l||c))throw new e("This environment does not support defining a property as non-configurable, non-writable, or non-enumerable.");i[s]=a}},Po}(),r=function(){if(Oo)return Mo;Oo=!0;var t=Ya(),e=function(){return!!t};return e.hasArrayLengthDefineBug=function(){if(!t)return null;try{return 1!==t([],"length",{value:1}).length}catch(e){return!0}},Mo=e}()(),n=Qa(),i=Va(),s=t("%Math.floor%");return Do=function(t,a){if("function"!=typeof t)throw new i("`fn` is not a function");if("number"!=typeof a||a<0||a>4294967295||s(a)!==a)throw new i("`length` must be a positive 32-bit integer");var o=arguments.length>2&&!!arguments[2],l=!0,c=!0;if("length"in t&&n){var u=n(t,"length");u&&!u.configurable&&(l=!1),u&&!u.writable&&(c=!1)}return(l||c||!o)&&(r?e(t,"length",a,!0,!0):e(t,"length",a)),t},Do}function $a(){if(jo)return Bo;jo=!0;var t=qa(),e=function(){if(Uo)return Fo;Uo=!0;var t=Ka(),e=qa(),r=Xa(),n=Va(),i=e("%Function.prototype.apply%"),s=e("%Function.prototype.call%"),a=e("%Reflect.apply%",!0)||t.call(s,i),o=Ya(),l=e("%Math.max%");Fo=function(e){if("function"!=typeof e)throw new n("a function is required");var i=a(t,s,arguments);return r(i,1+l(0,e.length-(arguments.length-1)),!0)};var c=function(){return a(t,i,arguments)};return o?o(Fo,"apply",{value:c}):Fo.apply=c,Fo}(),r=e(t("String.prototype.indexOf"));return Bo=function(n,i){var s=t(n,!!i);return"function"==typeof s&&r(n,".prototype.")>-1?e(s):s}}var Za,Ja,to,eo,ro,no,io,so,ao,oo,lo,co,uo,ho,fo,po,go,mo,yo,vo,bo,_o,wo,Eo,So,To,ko,Ao,xo,Io,Ro,Lo,Po,Co,Mo,Oo,Do,No,Fo,Uo,Bo,jo,zo=Tr(()=>{Ir(),Ei(),oi(),Za={},Ja=!1,to={},eo=!1,ro={},no=!1,io={},so=!1,ao={},oo=!1,lo={},co=!1,uo={},ho=!1,fo={},po=!1,go={},mo=!1,yo={},vo=!1,bo={},_o=!1,wo={},Eo=!1,So={},To=!1,ko={},Ao=!1,xo={},Io=!1,Ro={},Lo=!1,Po={},Co=!1,Mo={},Oo=!1,Do={},No=!1,Fo={},Uo=!1,Bo={},jo=!1});function Wo(t){throw new Error("Node.js process "+t+" is not supported by JSPM core outside of Node.js")}function Go(){!sl||!al||(sl=!1,al.length?il=al.concat(il):ol=-1,il.length&&Vo())}function Vo(){if(!sl){var t=setTimeout(Go,0);sl=!0;for(var e=il.length;e;){for(al=il,il=[];++ol<e;)al&&al[ol].run();ol=-1,e=il.length}al=null,sl=!1,clearTimeout(t)}}function Ho(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)e[r-1]=arguments[r];il.push(new Ko(t,e)),1===il.length&&!sl&&setTimeout(Vo,0)}function Ko(t,e){this.fun=t,this.array=e}function qo(){}function Yo(t){Wo("_linkedBinding")}function Qo(t){Wo("dlopen")}function Xo(){return[]}function $o(){return[]}function Zo(t,e){if(!t)throw new Error(e||"assertion error")}function Jo(){return!1}function tl(){return Wl.now()/1e3}function el(t){var e=Math.floor(.001*(Date.now()-Wl.now())),r=.001*Wl.now(),n=Math.floor(r)+e,i=Math.floor(r%1*1e9);return t&&(n-=t[0],(i-=t[1])<0&&(n--,i+=Vl)),[n,i]}function rl(){return Hl}function nl(t){return[]}var il,sl,al,ol,ll,cl,ul,hl,dl,fl,pl,gl,ml,yl,vl,bl,_l,wl,El,Sl,Tl,kl,Al,xl,Il,Rl,Ll,Pl,Cl,Ml,Ol,Dl,Nl,Fl,Ul,Bl,jl,zl,Wl,Gl,Vl,Hl,Kl=Tr(()=>{Ir(),Ei(),oi(),il=[],sl=!1,ol=-1,Ko.prototype.run=function(){this.fun.apply(null,this.array)},ll={PATH:"/usr/bin",LANG:navigator.language+".UTF-8",PWD:"/",HOME:"/home",TMP:"/tmp"},cl=["/usr/bin/node"],ul=[],hl={},dl=function(t,e){console.warn((e?e+": ":"")+t)},fl=function(t){Wo("binding")},pl=function(t){return 0},gl=function(){return"/"},ml=function(t){},yl={name:"node",sourceUrl:"",headersUrl:"",libUrl:""},vl=qo,bl=[],_l={},wl={},El=qo,Sl=qo,kl=Tl=function(){return{}},Al=Tl,xl=qo,Il=qo,Rl=qo,Ll={},Pl={inspector:!1,debug:!1,uv:!1,ipv6:!1,tls_alpn:!1,tls_sni:!1,tls_ocsp:!1,tls:!1,cached_builtins:!0},Cl=qo,Ml=qo,Ol=qo,Dl=qo,Nl=qo,Fl=qo,Ul=qo,Bl=qo,jl=[],zl=qo,void 0===(Wl={now:typeof performance<"u"?performance.now.bind(performance):void 0,timing:typeof performance<"u"?performance.timing:void 0}).now&&(Gl=Date.now(),Wl.timing&&Wl.timing.navigationStart&&(Gl=Wl.timing.navigationStart),Wl.now=()=>Date.now()-Gl),Vl=1e9,el.bigint=function(t){var e=el(t);return typeof BigInt>"u"?e[0]*Vl+e[1]:BigInt(e[0]*Vl)+BigInt(e[1])},Hl={version:"v16.8.0",versions:hl,arch:"x64",platform:"browser",release:yl,_rawDebug:vl,moduleLoadList:bl,binding:fl,_linkedBinding:Yo,_events:{},_eventsCount:0,_maxListeners:10,on:rl,addListener:rl,once:rl,off:rl,removeListener:rl,removeAllListeners:rl,emit:qo,prependListener:rl,prependOnceListener:rl,listeners:nl,domain:_l,_exiting:false,config:wl,dlopen:Qo,uptime:tl,_getActiveRequests:Xo,_getActiveHandles:$o,reallyExit:El,_kill:Sl,cpuUsage:Tl,resourceUsage:kl,memoryUsage:Al,kill:xl,exit:Il,openStdin:Rl,allowedNodeEnvironmentFlags:Ll,assert:Zo,features:Pl,_fatalExceptions:Cl,setUncaughtExceptionCaptureCallback:Ml,hasUncaughtExceptionCaptureCallback:Jo,emitWarning:dl,nextTick:Ho,_tickCallback:Ol,_debugProcess:Dl,_debugEnd:Nl,_startProfilerIdleNotifier:Fl,_stopProfilerIdleNotifier:Ul,stdout:undefined,stdin:undefined,stderr:undefined,abort:Bl,umask:pl,chdir:ml,cwd:gl,env:ll,title:"browser",argv:cl,execArgv:ul,pid:2,ppid:1,execPath:"/bin/usr/node",debugPort:9229,hrtime:el,argv0:"node",_preload_modules:jl,setSourceMapsEnabled:zl}});var ql,Yl,Ql,Xl=Tr(()=>{Ir(),Ei(),oi(),Kl(),ql={},Yl=!1,Ql=function(){if(Yl)return ql;Yl=!0;var t=Hl;function e(t){if("string"!=typeof t)throw new TypeError("Path must be a string. Received "+JSON.stringify(t))}function r(t,e){for(var r,n="",i=0,s=-1,a=0,o=0;o<=t.length;++o){if(o<t.length)r=t.charCodeAt(o);else{if(47===r)break;r=47}if(47===r){if(s!==o-1&&1!==a)if(s!==o-1&&2===a){if(n.length<2||2!==i||46!==n.charCodeAt(n.length-1)||46!==n.charCodeAt(n.length-2))if(n.length>2){var l=n.lastIndexOf("/");if(l!==n.length-1){-1===l?(n="",i=0):i=(n=n.slice(0,l)).length-1-n.lastIndexOf("/"),s=o,a=0;continue}}else if(2===n.length||1===n.length){n="",i=0,s=o,a=0;continue}e&&(n.length>0?n+="/..":n="..",i=2)}else n.length>0?n+="/"+t.slice(s+1,o):n=t.slice(s+1,o),i=o-s-1;s=o,a=0}else 46===r&&-1!==a?++a:a=-1}return n}var n={resolve:function(){for(var n,i="",s=!1,a=arguments.length-1;a>=-1&&!s;a--){var o;a>=0?o=arguments[a]:(void 0===n&&(n=t.cwd()),o=n),e(o),0!==o.length&&(i=o+"/"+i,s=47===o.charCodeAt(0))}return i=r(i,!s),s?i.length>0?"/"+i:"/":i.length>0?i:"."},normalize:function(t){if(e(t),0===t.length)return".";var n=47===t.charCodeAt(0),i=47===t.charCodeAt(t.length-1);return 0===(t=r(t,!n)).length&&!n&&(t="."),t.length>0&&i&&(t+="/"),n?"/"+t:t},isAbsolute:function(t){return e(t),t.length>0&&47===t.charCodeAt(0)},join:function(){if(0===arguments.length)return".";for(var t,r=0;r<arguments.length;++r){var i=arguments[r];e(i),i.length>0&&(void 0===t?t=i:t+="/"+i)}return void 0===t?".":n.normalize(t)},relative:function(t,r){if(e(t),e(r),t===r||(t=n.resolve(t))===(r=n.resolve(r)))return"";for(var i=1;i<t.length&&47===t.charCodeAt(i);++i);for(var s=t.length,a=s-i,o=1;o<r.length&&47===r.charCodeAt(o);++o);for(var l=r.length-o,c=a<l?a:l,u=-1,h=0;h<=c;++h){if(h===c){if(l>c){if(47===r.charCodeAt(o+h))return r.slice(o+h+1);if(0===h)return r.slice(o+h)}else a>c&&(47===t.charCodeAt(i+h)?u=h:0===h&&(u=0));break}var d=t.charCodeAt(i+h);if(d!==r.charCodeAt(o+h))break;47===d&&(u=h)}var f="";for(h=i+u+1;h<=s;++h)(h===s||47===t.charCodeAt(h))&&(0===f.length?f+="..":f+="/..");return f.length>0?f+r.slice(o+u):(o+=u,47===r.charCodeAt(o)&&++o,r.slice(o))},_makeLong:function(t){return t},dirname:function(t){if(e(t),0===t.length)return".";for(var r=t.charCodeAt(0),n=47===r,i=-1,s=!0,a=t.length-1;a>=1;--a)if(47===(r=t.charCodeAt(a))){if(!s){i=a;break}}else s=!1;return-1===i?n?"/":".":n&&1===i?"//":t.slice(0,i)},basename:function(t,r){if(void 0!==r&&"string"!=typeof r)throw new TypeError('"ext" argument must be a string');e(t);var n,i=0,s=-1,a=!0;if(void 0!==r&&r.length>0&&r.length<=t.length){if(r.length===t.length&&r===t)return"";var o=r.length-1,l=-1;for(n=t.length-1;n>=0;--n){var c=t.charCodeAt(n);if(47===c){if(!a){i=n+1;break}}else-1===l&&(a=!1,l=n+1),o>=0&&(c===r.charCodeAt(o)?-1===--o&&(s=n):(o=-1,s=l))}return i===s?s=l:-1===s&&(s=t.length),t.slice(i,s)}for(n=t.length-1;n>=0;--n)if(47===t.charCodeAt(n)){if(!a){i=n+1;break}}else-1===s&&(a=!1,s=n+1);return-1===s?"":t.slice(i,s)},extname:function(t){e(t);for(var r=-1,n=0,i=-1,s=!0,a=0,o=t.length-1;o>=0;--o){var l=t.charCodeAt(o);if(47!==l)-1===i&&(s=!1,i=o+1),46===l?-1===r?r=o:1!==a&&(a=1):-1!==r&&(a=-1);else if(!s){n=o+1;break}}return-1===r||-1===i||0===a||1===a&&r===i-1&&r===n+1?"":t.slice(r,i)},format:function(t){if(null===t||"object"!=typeof t)throw new TypeError('The "pathObject" argument must be of type Object. Received type '+typeof t);return function(t,e){var r=e.dir||e.root,n=e.base||(e.name||"")+(e.ext||"");return r?r===e.root?r+n:r+t+n:n}("/",t)},parse:function(t){e(t);var r={root:"",dir:"",base:"",ext:"",name:""};if(0===t.length)return r;var n,i=t.charCodeAt(0),s=47===i;s?(r.root="/",n=1):n=0;for(var a=-1,o=0,l=-1,c=!0,u=t.length-1,h=0;u>=n;--u)if(47!==(i=t.charCodeAt(u)))-1===l&&(c=!1,l=u+1),46===i?-1===a?a=u:1!==h&&(h=1):-1!==a&&(h=-1);else if(!c){o=u+1;break}return-1===a||-1===l||0===h||1===h&&a===l-1&&a===o+1?-1!==l&&(r.base=r.name=0===o&&s?t.slice(1,l):t.slice(o,l)):(0===o&&s?(r.name=t.slice(1,a),r.base=t.slice(1,l)):(r.name=t.slice(o,a),r.base=t.slice(o,l)),r.ext=t.slice(a,l)),o>0?r.dir=t.slice(0,o-1):s&&(r.dir="/"),r},sep:"/",delimiter:":",win32:null,posix:null};return n.posix=n,ql=n}()}),$l={};function Zl(){if(cc)return lc;cc=!0;var t="function"==typeof Map&&Map.prototype,e=Object.getOwnPropertyDescriptor&&t?Object.getOwnPropertyDescriptor(Map.prototype,"size"):null,r=t&&e&&"function"==typeof e.get?e.get:null,n=t&&Map.prototype.forEach,i="function"==typeof Set&&Set.prototype,s=Object.getOwnPropertyDescriptor&&i?Object.getOwnPropertyDescriptor(Set.prototype,"size"):null,a=i&&s&&"function"==typeof s.get?s.get:null,o=i&&Set.prototype.forEach,l="function"==typeof WeakMap&&WeakMap.prototype?WeakMap.prototype.has:null,c="function"==typeof WeakSet&&WeakSet.prototype?WeakSet.prototype.has:null,u="function"==typeof WeakRef&&WeakRef.prototype?WeakRef.prototype.deref:null,h=Boolean.prototype.valueOf,d=Object.prototype.toString,f=Function.prototype.toString,p=String.prototype.match,g=String.prototype.slice,m=String.prototype.replace,y=String.prototype.toUpperCase,v=String.prototype.toLowerCase,b=RegExp.prototype.test,_=Array.prototype.concat,w=Array.prototype.join,E=Array.prototype.slice,S=Math.floor,T="function"==typeof BigInt?BigInt.prototype.valueOf:null,k=Object.getOwnPropertySymbols,A="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?Symbol.prototype.toString:null,x="function"==typeof Symbol&&"object"==typeof Symbol.iterator,I="function"==typeof Symbol&&Symbol.toStringTag&&(Symbol.toStringTag,1)?Symbol.toStringTag:null,R=Object.prototype.propertyIsEnumerable,L=("function"==typeof Reflect?Reflect.getPrototypeOf:Object.getPrototypeOf)||([].__proto__===Array.prototype?function(t){return t.__proto__}:null);function P(t,e){if(t===1/0||t===-1/0||t!==t||t&&t>-1e3&&t<1e3||b.call(/e/,e))return e;var r=/[0-9](?=(?:[0-9]{3})+(?![0-9]))/g;if("number"==typeof t){var n=t<0?-S(-t):S(t);if(n!==t){var i=String(n),s=g.call(e,i.length+1);return m.call(i,r,"$&_")+"."+m.call(m.call(s,/([0-9]{3})/g,"$&_"),/_$/,"")}}return m.call(e,r,"$&_")}var C=oc,M=C.custom,O=B(M)?M:null;function D(t,e,r){var n="double"===(r.quoteStyle||e)?'"':"'";return n+t+n}function N(t){return m.call(String(t),/"/g,"&quot;")}function F(t){return"[object Array]"===W(t)&&(!I||!("object"==typeof t&&I in t))}function U(t){return"[object RegExp]"===W(t)&&(!I||!("object"==typeof t&&I in t))}function B(t){if(x)return t&&"object"==typeof t&&t instanceof Symbol;if("symbol"==typeof t)return!0;if(!t||"object"!=typeof t||!A)return!1;try{return A.call(t),!0}catch(e){}return!1}lc=function t(e,i,s,d){var y=i||{};if(z(y,"quoteStyle")&&"single"!==y.quoteStyle&&"double"!==y.quoteStyle)throw new TypeError('option "quoteStyle" must be "single" or "double"');if(z(y,"maxStringLength")&&("number"==typeof y.maxStringLength?y.maxStringLength<0&&y.maxStringLength!==1/0:null!==y.maxStringLength))throw new TypeError('option "maxStringLength", if provided, must be a positive integer, Infinity, or `null`');var b=!z(y,"customInspect")||y.customInspect;if("boolean"!=typeof b&&"symbol"!==b)throw new TypeError("option \"customInspect\", if provided, must be `true`, `false`, or `'symbol'`");if(z(y,"indent")&&null!==y.indent&&"\t"!==y.indent&&!(parseInt(y.indent,10)===y.indent&&y.indent>0))throw new TypeError('option "indent" must be "\\t", an integer > 0, or `null`');if(z(y,"numericSeparator")&&"boolean"!=typeof y.numericSeparator)throw new TypeError('option "numericSeparator", if provided, must be `true` or `false`');var S=y.numericSeparator;if(typeof e>"u")return"undefined";if(null===e)return"null";if("boolean"==typeof e)return e?"true":"false";if("string"==typeof e)return V(e,y);if("number"==typeof e){if(0===e)return 1/0/e>0?"0":"-0";var k=String(e);return S?P(e,k):k}if("bigint"==typeof e){var M=String(e)+"n";return S?P(e,M):M}var j=typeof y.depth>"u"?5:y.depth;if(typeof s>"u"&&(s=0),s>=j&&j>0&&"object"==typeof e)return F(e)?"[Array]":"[Object]";var H=function(t,e){var r;if("\t"===t.indent)r="\t";else{if(!("number"==typeof t.indent&&t.indent>0))return null;r=w.call(Array(t.indent+1)," ")}return{base:r,prev:w.call(Array(e+1),r)}}(y,s);if(typeof d>"u")d=[];else if(G(d,e)>=0)return"[Circular]";function $(e,r,n){if(r&&(d=E.call(d)).push(r),n){var i={depth:y.depth};return z(y,"quoteStyle")&&(i.quoteStyle=y.quoteStyle),t(e,i,s+1,d)}return t(e,y,s+1,d)}if("function"==typeof e&&!U(e)){var Z=function(t){if(t.name)return t.name;var e=p.call(f.call(t),/^function\s*([\w$]+)/);return e?e[1]:null}(e),J=X(e,$);return"[Function"+(Z?": "+Z:" (anonymous)")+"]"+(J.length>0?" { "+w.call(J,", ")+" }":"")}if(B(e)){var tt=x?m.call(String(e),/^(Symbol\(.*\))_[^)]*$/,"$1"):A.call(e);return"object"!=typeof e||x?tt:K(tt)}if(function(t){return!(!t||"object"!=typeof t)&&(typeof HTMLElement<"u"&&t instanceof HTMLElement||"string"==typeof t.nodeName&&"function"==typeof t.getAttribute)}(e)){for(var et="<"+v.call(String(e.nodeName)),rt=e.attributes||[],nt=0;nt<rt.length;nt++)et+=" "+rt[nt].name+"="+D(N(rt[nt].value),"double",y);return et+=">",e.childNodes&&e.childNodes.length&&(et+="..."),et+="</"+v.call(String(e.nodeName))+">"}if(F(e)){if(0===e.length)return"[]";var it=X(e,$);return H&&!function(t){for(var e=0;e<t.length;e++)if(G(t[e],"\n")>=0)return!1;return!0}(it)?"["+Q(it,H)+"]":"[ "+w.call(it,", ")+" ]"}if(function(t){return"[object Error]"===W(t)&&(!I||!("object"==typeof t&&I in t))}(e)){var st=X(e,$);return"cause"in Error.prototype||!("cause"in e)||R.call(e,"cause")?0===st.length?"["+String(e)+"]":"{ ["+String(e)+"] "+w.call(st,", ")+" }":"{ ["+String(e)+"] "+w.call(_.call("[cause]: "+$(e.cause),st),", ")+" }"}if("object"==typeof e&&b){if(O&&"function"==typeof e[O]&&C)return C(e,{depth:j-s});if("symbol"!==b&&"function"==typeof e.inspect)return e.inspect()}if(function(t){if(!r||!t||"object"!=typeof t)return!1;try{r.call(t);try{a.call(t)}catch(e){return!0}return t instanceof Map}catch(n){}return!1}(e)){var at=[];return n&&n.call(e,function(t,r){at.push($(r,e,!0)+" => "+$(t,e))}),Y("Map",r.call(e),at,H)}if(function(t){if(!a||!t||"object"!=typeof t)return!1;try{a.call(t);try{r.call(t)}catch(e){return!0}return t instanceof Set}catch(n){}return!1}(e)){var ot=[];return o&&o.call(e,function(t){ot.push($(t,e))}),Y("Set",a.call(e),ot,H)}if(function(t){if(!l||!t||"object"!=typeof t)return!1;try{l.call(t,l);try{c.call(t,c)}catch(e){return!0}return t instanceof WeakMap}catch(r){}return!1}(e))return q("WeakMap");if(function(t){if(!c||!t||"object"!=typeof t)return!1;try{c.call(t,c);try{l.call(t,l)}catch(e){return!0}return t instanceof WeakSet}catch(r){}return!1}(e))return q("WeakSet");if(function(t){if(!u||!t||"object"!=typeof t)return!1;try{return u.call(t),!0}catch(e){}return!1}(e))return q("WeakRef");if(function(t){return"[object Number]"===W(t)&&(!I||!("object"==typeof t&&I in t))}(e))return K($(Number(e)));if(function(t){if(!t||"object"!=typeof t||!T)return!1;try{return T.call(t),!0}catch(e){}return!1}(e))return K($(T.call(e)));if(function(t){return"[object Boolean]"===W(t)&&(!I||!("object"==typeof t&&I in t))}(e))return K(h.call(e));if(function(t){return"[object String]"===W(t)&&(!I||!("object"==typeof t&&I in t))}(e))return K($(String(e)));if(typeof window<"u"&&e===window)return"{ [object Window] }";if(typeof globalThis<"u"&&e===globalThis||typeof uc<"u"&&e===uc)return"{ [object globalThis] }";if(!function(t){return"[object Date]"===W(t)&&(!I||!("object"==typeof t&&I in t))}(e)&&!U(e)){var lt=X(e,$),ct=L?L(e)===Object.prototype:e instanceof Object||e.constructor===Object,ut=e instanceof Object?"":"null prototype",ht=!ct&&I&&Object(e)===e&&I in e?g.call(W(e),8,-1):ut?"Object":"",dt=(ct||"function"!=typeof e.constructor?"":e.constructor.name?e.constructor.name+" ":"")+(ht||ut?"["+w.call(_.call([],ht||[],ut||[]),": ")+"] ":"");return 0===lt.length?dt+"{}":H?dt+"{"+Q(lt,H)+"}":dt+"{ "+w.call(lt,", ")+" }"}return String(e)};var j=Object.prototype.hasOwnProperty||function(t){return t in(this||uc)};function z(t,e){return j.call(t,e)}function W(t){return d.call(t)}function G(t,e){if(t.indexOf)return t.indexOf(e);for(var r=0,n=t.length;r<n;r++)if(t[r]===e)return r;return-1}function V(t,e){if(t.length>e.maxStringLength){var r=t.length-e.maxStringLength,n="... "+r+" more character"+(r>1?"s":"");return V(g.call(t,0,e.maxStringLength),e)+n}return D(m.call(m.call(t,/(['\\])/g,"\\$1"),/[\x00-\x1f]/g,H),"single",e)}function H(t){var e=t.charCodeAt(0),r={8:"b",9:"t",10:"n",12:"f",13:"r"}[e];return r?"\\"+r:"\\x"+(e<16?"0":"")+y.call(e.toString(16))}function K(t){return"Object("+t+")"}function q(t){return t+" { ? }"}function Y(t,e,r,n){return t+" ("+e+") {"+(n?Q(r,n):w.call(r,", "))+"}"}function Q(t,e){if(0===t.length)return"";var r="\n"+e.prev+e.base;return r+w.call(t,","+r)+"\n"+e.prev}function X(t,e){var r=F(t),n=[];if(r){n.length=t.length;for(var i=0;i<t.length;i++)n[i]=z(t,i)?e(t[i],t):""}var s,a="function"==typeof k?k(t):[];if(x){s={};for(var o=0;o<a.length;o++)s["$"+a[o]]=a[o]}for(var l in t)z(t,l)&&(r&&String(Number(l))===l&&l<t.length||x&&s["$"+l]instanceof Symbol||(b.call(/[^\w$]/,l)?n.push(e(l,t)+": "+e(t[l],t)):n.push(l+": "+e(t[l],t))));if("function"==typeof k)for(var c=0;c<a.length;c++)R.call(t,a[c])&&n.push("["+e(a[c])+"]: "+e(t[a[c]],t));return n}return lc}function Jl(){if(dc)return hc;dc=!0;var t=qa(),e=$a(),r=Zl(),n=Va(),i=t("%WeakMap%",!0),s=t("%Map%",!0),a=e("WeakMap.prototype.get",!0),o=e("WeakMap.prototype.set",!0),l=e("WeakMap.prototype.has",!0),c=e("Map.prototype.get",!0),u=e("Map.prototype.set",!0),h=e("Map.prototype.has",!0),d=function(t,e){for(var r,n=t;null!==(r=n.next);n=r)if(r.key===e)return n.next=r.next,r.next=t.next,t.next=r,r};return hc=function(){var t,e,f,p={assert:function(t){if(!p.has(t))throw new n("Side channel does not contain "+r(t))},get:function(r){if(i&&r&&("object"==typeof r||"function"==typeof r)){if(t)return a(t,r)}else if(s){if(e)return c(e,r)}else if(f)return function(t,e){var r=d(t,e);return r&&r.value}(f,r)},has:function(r){if(i&&r&&("object"==typeof r||"function"==typeof r)){if(t)return l(t,r)}else if(s){if(e)return h(e,r)}else if(f)return function(t,e){return!!d(t,e)}(f,r);return!1},set:function(r,n){i&&r&&("object"==typeof r||"function"==typeof r)?(t||(t=new i),o(t,r,n)):s?(e||(e=new s),u(e,r,n)):(f||(f={key:{},next:null}),function(t,e,r){var n=d(t,e);n?n.value=r:t.next={key:e,next:t.next,value:r}}(f,r,n))}};return p}}function tc(){if(pc)return fc;pc=!0;var t=String.prototype.replace,e=/%20/g,r="RFC3986";return fc={default:r,formatters:{RFC1738:function(r){return t.call(r,e,"+")},RFC3986:function(t){return String(t)}},RFC1738:"RFC1738",RFC3986:r}}function ec(){if(mc)return gc;mc=!0;var t=tc(),e=Object.prototype.hasOwnProperty,r=Array.isArray,n=function(){for(var t=[],e=0;e<256;++e)t.push("%"+((e<16?"0":"")+e.toString(16)).toUpperCase());return t}(),i=function(t,e){for(var r=e&&e.plainObjects?Object.create(null):{},n=0;n<t.length;++n)typeof t[n]<"u"&&(r[n]=t[n]);return r},s=1024;return gc={arrayToObject:i,assign:function(t,e){return Object.keys(e).reduce(function(t,r){return t[r]=e[r],t},t)},combine:function(t,e){return[].concat(t,e)},compact:function(t){for(var e=[{obj:{o:t},prop:"o"}],n=[],i=0;i<e.length;++i)for(var s=e[i],a=s.obj[s.prop],o=Object.keys(a),l=0;l<o.length;++l){var c=o[l],u=a[c];"object"==typeof u&&null!==u&&-1===n.indexOf(u)&&(e.push({obj:a,prop:c}),n.push(u))}return function(t){for(;t.length>1;){var e=t.pop(),n=e.obj[e.prop];if(r(n)){for(var i=[],s=0;s<n.length;++s)typeof n[s]<"u"&&i.push(n[s]);e.obj[e.prop]=i}}}(e),t},decode:function(t,e,r){var n=t.replace(/\+/g," ");if("iso-8859-1"===r)return n.replace(/%[0-9a-f]{2}/gi,unescape);try{return decodeURIComponent(n)}catch(i){return n}},encode:function(e,r,i,a,o){if(0===e.length)return e;var l=e;if("symbol"==typeof e?l=Symbol.prototype.toString.call(e):"string"!=typeof e&&(l=String(e)),"iso-8859-1"===i)return escape(l).replace(/%u[0-9a-f]{4}/gi,function(t){return"%26%23"+parseInt(t.slice(2),16)+"%3B"});for(var c="",u=0;u<l.length;u+=s){for(var h=l.length>=s?l.slice(u,u+s):l,d=[],f=0;f<h.length;++f){var p=h.charCodeAt(f);45===p||46===p||95===p||126===p||p>=48&&p<=57||p>=65&&p<=90||p>=97&&p<=122||o===t.RFC1738&&(40===p||41===p)?d[d.length]=h.charAt(f):p<128?d[d.length]=n[p]:p<2048?d[d.length]=n[192|p>>6]+n[128|63&p]:p<55296||p>=57344?d[d.length]=n[224|p>>12]+n[128|p>>6&63]+n[128|63&p]:(f+=1,p=65536+((1023&p)<<10|1023&h.charCodeAt(f)),d[d.length]=n[240|p>>18]+n[128|p>>12&63]+n[128|p>>6&63]+n[128|63&p])}c+=d.join("")}return c},isBuffer:function(t){return!(!t||"object"!=typeof t)&&!!(t.constructor&&t.constructor.isBuffer&&t.constructor.isBuffer(t))},isRegExp:function(t){return"[object RegExp]"===Object.prototype.toString.call(t)},maybeMap:function(t,e){if(r(t)){for(var n=[],i=0;i<t.length;i+=1)n.push(e(t[i]));return n}return e(t)},merge:function t(n,s,a){if(!s)return n;if("object"!=typeof s){if(r(n))n.push(s);else{if(!n||"object"!=typeof n)return[n,s];(a&&(a.plainObjects||a.allowPrototypes)||!e.call(Object.prototype,s))&&(n[s]=!0)}return n}if(!n||"object"!=typeof n)return[n].concat(s);var o=n;return r(n)&&!r(s)&&(o=i(n,a)),r(n)&&r(s)?(s.forEach(function(r,i){if(e.call(n,i)){var s=n[i];s&&"object"==typeof s&&r&&"object"==typeof r?n[i]=t(s,r,a):n.push(r)}else n[i]=r}),n):Object.keys(s).reduce(function(r,n){var i=s[n];return e.call(r,n)?r[n]=t(r[n],i,a):r[n]=i,r},o)}}}function rc(){if(vc)return yc;vc=!0;var t=Jl(),e=ec(),r=tc(),n=Object.prototype.hasOwnProperty,i={brackets:function(t){return t+"[]"},comma:"comma",indices:function(t,e){return t+"["+e+"]"},repeat:function(t){return t}},s=Array.isArray,a=Array.prototype.push,o=function(t,e){a.apply(t,s(e)?e:[e])},l=Date.prototype.toISOString,c=r.default,u={addQueryPrefix:!1,allowDots:!1,allowEmptyArrays:!1,arrayFormat:"indices",charset:"utf-8",charsetSentinel:!1,delimiter:"&",encode:!0,encodeDotInKeys:!1,encoder:e.encode,encodeValuesOnly:!1,format:c,formatter:r.formatters[c],indices:!1,serializeDate:function(t){return l.call(t)},skipNulls:!1,strictNullHandling:!1},h={},d=function r(n,i,a,l,c,d,f,p,g,m,y,v,b,_,w,E,S,T){for(var k=n,A=T,x=0,I=!1;void 0!==(A=A.get(h))&&!I;){var R=A.get(n);if(x+=1,typeof R<"u"){if(R===x)throw new RangeError("Cyclic object value");I=!0}typeof A.get(h)>"u"&&(x=0)}if("function"==typeof m?k=m(i,k):k instanceof Date?k=b(k):"comma"===a&&s(k)&&(k=e.maybeMap(k,function(t){return t instanceof Date?b(t):t})),null===k){if(d)return g&&!E?g(i,u.encoder,S,"key",_):i;k=""}if(function(t){return"string"==typeof t||"number"==typeof t||"boolean"==typeof t||"symbol"==typeof t||"bigint"==typeof t}(k)||e.isBuffer(k))return g?[w(E?i:g(i,u.encoder,S,"key",_))+"="+w(g(k,u.encoder,S,"value",_))]:[w(i)+"="+w(String(k))];var L,P=[];if(typeof k>"u")return P;if("comma"===a&&s(k))E&&g&&(k=e.maybeMap(k,g)),L=[{value:k.length>0?k.join(",")||null:void 0}];else if(s(m))L=m;else{var C=Object.keys(k);L=y?C.sort(y):C}var M=p?i.replace(/\./g,"%2E"):i,O=l&&s(k)&&1===k.length?M+"[]":M;if(c&&s(k)&&0===k.length)return O+"[]";for(var D=0;D<L.length;++D){var N=L[D],F="object"==typeof N&&typeof N.value<"u"?N.value:k[N];if(!f||null!==F){var U=v&&p?N.replace(/\./g,"%2E"):N,B=s(k)?"function"==typeof a?a(O,U):O:O+(v?"."+U:"["+U+"]");T.set(n,x);var j=t();j.set(h,T),o(P,r(F,B,a,l,c,d,f,p,"comma"===a&&E&&s(k)?null:g,m,y,v,b,_,w,E,S,j))}}return P};return yc=function(e,a){var l,c=e,h=function(t){if(!t)return u;if(typeof t.allowEmptyArrays<"u"&&"boolean"!=typeof t.allowEmptyArrays)throw new TypeError("`allowEmptyArrays` option can only be `true` or `false`, when provided");if(typeof t.encodeDotInKeys<"u"&&"boolean"!=typeof t.encodeDotInKeys)throw new TypeError("`encodeDotInKeys` option can only be `true` or `false`, when provided");if(null!==t.encoder&&typeof t.encoder<"u"&&"function"!=typeof t.encoder)throw new TypeError("Encoder has to be a function.");var e=t.charset||u.charset;if(typeof t.charset<"u"&&"utf-8"!==t.charset&&"iso-8859-1"!==t.charset)throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");var a=r.default;if(typeof t.format<"u"){if(!n.call(r.formatters,t.format))throw new TypeError("Unknown format option provided.");a=t.format}var o,l=r.formatters[a],c=u.filter;if(("function"==typeof t.filter||s(t.filter))&&(c=t.filter),o=t.arrayFormat in i?t.arrayFormat:"indices"in t?t.indices?"indices":"repeat":u.arrayFormat,"commaRoundTrip"in t&&"boolean"!=typeof t.commaRoundTrip)throw new TypeError("`commaRoundTrip` must be a boolean, or absent");var h=typeof t.allowDots>"u"?!0===t.encodeDotInKeys||u.allowDots:!!t.allowDots;return{addQueryPrefix:"boolean"==typeof t.addQueryPrefix?t.addQueryPrefix:u.addQueryPrefix,allowDots:h,allowEmptyArrays:"boolean"==typeof t.allowEmptyArrays?!!t.allowEmptyArrays:u.allowEmptyArrays,arrayFormat:o,charset:e,charsetSentinel:"boolean"==typeof t.charsetSentinel?t.charsetSentinel:u.charsetSentinel,commaRoundTrip:t.commaRoundTrip,delimiter:typeof t.delimiter>"u"?u.delimiter:t.delimiter,encode:"boolean"==typeof t.encode?t.encode:u.encode,encodeDotInKeys:"boolean"==typeof t.encodeDotInKeys?t.encodeDotInKeys:u.encodeDotInKeys,encoder:"function"==typeof t.encoder?t.encoder:u.encoder,encodeValuesOnly:"boolean"==typeof t.encodeValuesOnly?t.encodeValuesOnly:u.encodeValuesOnly,filter:c,format:a,formatter:l,serializeDate:"function"==typeof t.serializeDate?t.serializeDate:u.serializeDate,skipNulls:"boolean"==typeof t.skipNulls?t.skipNulls:u.skipNulls,sort:"function"==typeof t.sort?t.sort:null,strictNullHandling:"boolean"==typeof t.strictNullHandling?t.strictNullHandling:u.strictNullHandling}}(a);"function"==typeof h.filter?c=(0,h.filter)("",c):s(h.filter)&&(l=h.filter);var f=[];if("object"!=typeof c||null===c)return"";var p=i[h.arrayFormat],g="comma"===p&&h.commaRoundTrip;l||(l=Object.keys(c)),h.sort&&l.sort(h.sort);for(var m=t(),y=0;y<l.length;++y){var v=l[y];h.skipNulls&&null===c[v]||o(f,d(c[v],v,p,g,h.allowEmptyArrays,h.strictNullHandling,h.skipNulls,h.encodeDotInKeys,h.encode?h.encoder:null,h.filter,h.sort,h.allowDots,h.serializeDate,h.format,h.formatter,h.encodeValuesOnly,h.charset,m))}var b=f.join(h.delimiter),_=!0===h.addQueryPrefix?"?":"";return h.charsetSentinel&&("iso-8859-1"===h.charset?_+="utf8=%26%2310003%3B&":_+="utf8=%E2%9C%93&"),b.length>0?_+b:""}}function nc(){if(_c)return bc;_c=!0;var t=ec(),e=Object.prototype.hasOwnProperty,r=Array.isArray,n={allowDots:!1,allowEmptyArrays:!1,allowPrototypes:!1,allowSparse:!1,arrayLimit:20,charset:"utf-8",charsetSentinel:!1,comma:!1,decodeDotInKeys:!1,decoder:t.decode,delimiter:"&",depth:5,duplicates:"combine",ignoreQueryPrefix:!1,interpretNumericEntities:!1,parameterLimit:1e3,parseArrays:!0,plainObjects:!1,strictDepth:!1,strictNullHandling:!1},i=function(t){return t.replace(/&#(\d+);/g,function(t,e){return String.fromCharCode(parseInt(e,10))})},s=function(t,e){return t&&"string"==typeof t&&e.comma&&t.indexOf(",")>-1?t.split(","):t},a=function(t,r,n,i){if(t){var a=n.allowDots?t.replace(/\.([^.[]+)/g,"[$1]"):t,o=/(\[[^[\]]*])/g,l=n.depth>0&&/(\[[^[\]]*])/.exec(a),c=l?a.slice(0,l.index):a,u=[];if(c){if(!n.plainObjects&&e.call(Object.prototype,c)&&!n.allowPrototypes)return;u.push(c)}for(var h=0;n.depth>0&&null!==(l=o.exec(a))&&h<n.depth;){if(h+=1,!n.plainObjects&&e.call(Object.prototype,l[1].slice(1,-1))&&!n.allowPrototypes)return;u.push(l[1])}if(l){if(!0===n.strictDepth)throw new RangeError("Input depth exceeded depth option of "+n.depth+" and strictDepth is true");u.push("["+a.slice(l.index)+"]")}return function(t,e,r,n){for(var i=n?e:s(e,r),a=t.length-1;a>=0;--a){var o,l=t[a];if("[]"===l&&r.parseArrays)o=r.allowEmptyArrays&&(""===i||r.strictNullHandling&&null===i)?[]:[].concat(i);else{o=r.plainObjects?Object.create(null):{};var c="["===l.charAt(0)&&"]"===l.charAt(l.length-1)?l.slice(1,-1):l,u=r.decodeDotInKeys?c.replace(/%2E/g,"."):c,h=parseInt(u,10);r.parseArrays||""!==u?!isNaN(h)&&l!==u&&String(h)===u&&h>=0&&r.parseArrays&&h<=r.arrayLimit?(o=[])[h]=i:"__proto__"!==u&&(o[u]=i):o={0:i}}i=o}return i}(u,r,n,i)}};return bc=function(o,l){var c=function(e){if(!e)return n;if(typeof e.allowEmptyArrays<"u"&&"boolean"!=typeof e.allowEmptyArrays)throw new TypeError("`allowEmptyArrays` option can only be `true` or `false`, when provided");if(typeof e.decodeDotInKeys<"u"&&"boolean"!=typeof e.decodeDotInKeys)throw new TypeError("`decodeDotInKeys` option can only be `true` or `false`, when provided");if(null!==e.decoder&&typeof e.decoder<"u"&&"function"!=typeof e.decoder)throw new TypeError("Decoder has to be a function.");if(typeof e.charset<"u"&&"utf-8"!==e.charset&&"iso-8859-1"!==e.charset)throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");var r=typeof e.charset>"u"?n.charset:e.charset,i=typeof e.duplicates>"u"?n.duplicates:e.duplicates;if("combine"!==i&&"first"!==i&&"last"!==i)throw new TypeError("The duplicates option must be either combine, first, or last");return{allowDots:typeof e.allowDots>"u"?!0===e.decodeDotInKeys||n.allowDots:!!e.allowDots,allowEmptyArrays:"boolean"==typeof e.allowEmptyArrays?!!e.allowEmptyArrays:n.allowEmptyArrays,allowPrototypes:"boolean"==typeof e.allowPrototypes?e.allowPrototypes:n.allowPrototypes,allowSparse:"boolean"==typeof e.allowSparse?e.allowSparse:n.allowSparse,arrayLimit:"number"==typeof e.arrayLimit?e.arrayLimit:n.arrayLimit,charset:r,charsetSentinel:"boolean"==typeof e.charsetSentinel?e.charsetSentinel:n.charsetSentinel,comma:"boolean"==typeof e.comma?e.comma:n.comma,decodeDotInKeys:"boolean"==typeof e.decodeDotInKeys?e.decodeDotInKeys:n.decodeDotInKeys,decoder:"function"==typeof e.decoder?e.decoder:n.decoder,delimiter:"string"==typeof e.delimiter||t.isRegExp(e.delimiter)?e.delimiter:n.delimiter,depth:"number"==typeof e.depth||!1===e.depth?+e.depth:n.depth,duplicates:i,ignoreQueryPrefix:!0===e.ignoreQueryPrefix,interpretNumericEntities:"boolean"==typeof e.interpretNumericEntities?e.interpretNumericEntities:n.interpretNumericEntities,parameterLimit:"number"==typeof e.parameterLimit?e.parameterLimit:n.parameterLimit,parseArrays:!1!==e.parseArrays,plainObjects:"boolean"==typeof e.plainObjects?e.plainObjects:n.plainObjects,strictDepth:"boolean"==typeof e.strictDepth?!!e.strictDepth:n.strictDepth,strictNullHandling:"boolean"==typeof e.strictNullHandling?e.strictNullHandling:n.strictNullHandling}}(l);if(""===o||null===o||typeof o>"u")return c.plainObjects?Object.create(null):{};for(var u="string"==typeof o?function(a,o){var l={__proto__:null},c=o.ignoreQueryPrefix?a.replace(/^\?/,""):a;c=c.replace(/%5B/gi,"[").replace(/%5D/gi,"]");var u,h=o.parameterLimit===1/0?void 0:o.parameterLimit,d=c.split(o.delimiter,h),f=-1,p=o.charset;if(o.charsetSentinel)for(u=0;u<d.length;++u)0===d[u].indexOf("utf8=")&&("utf8=%E2%9C%93"===d[u]?p="utf-8":"utf8=%26%2310003%3B"===d[u]&&(p="iso-8859-1"),f=u,u=d.length);for(u=0;u<d.length;++u)if(u!==f){var g,m,y=d[u],v=y.indexOf("]="),b=-1===v?y.indexOf("="):v+1;-1===b?(g=o.decoder(y,n.decoder,p,"key"),m=o.strictNullHandling?null:""):(g=o.decoder(y.slice(0,b),n.decoder,p,"key"),m=t.maybeMap(s(y.slice(b+1),o),function(t){return o.decoder(t,n.decoder,p,"value")})),m&&o.interpretNumericEntities&&"iso-8859-1"===p&&(m=i(m)),y.indexOf("[]=")>-1&&(m=r(m)?[m]:m);var _=e.call(l,g);_&&"combine"===o.duplicates?l[g]=t.combine(l[g],m):(!_||"last"===o.duplicates)&&(l[g]=m)}return l}(o,c):o,h=c.plainObjects?Object.create(null):{},d=Object.keys(u),f=0;f<d.length;++f){var p=d[f],g=a(p,u[p],c,"string"==typeof o);h=t.merge(h,g,c)}return!0===c.allowSparse?h:t.compact(h)}}function ic(){if(Tc)return Sc;Tc=!0;var t=za;function e(){this.protocol=null,this.slashes=null,this.auth=null,this.host=null,this.port=null,this.hostname=null,this.hash=null,this.search=null,this.query=null,this.pathname=null,this.path=null,this.href=null}var r=/^([a-z0-9.+-]+:)/i,n=/:[0-9]*$/,i=/^(\/\/?(?!\/)[^?\s]*)(\?[^\s]*)?$/,s=["{","}","|","\\","^","`"].concat(["<",">",'"',"`"," ","\r","\n","\t"]),a=["'"].concat(s),o=["%","/","?",";","#"].concat(a),l=["/","?","#"],c=/^[+a-z0-9A-Z_-]{0,63}$/,u=/^([+a-z0-9A-Z_-]{0,63})(.*)$/,h={javascript:!0,"javascript:":!0},d={javascript:!0,"javascript:":!0},f={http:!0,https:!0,ftp:!0,gopher:!0,file:!0,"http:":!0,"https:":!0,"ftp:":!0,"gopher:":!0,"file:":!0},p=function(){if(Ec)return wc;Ec=!0;var t=rc(),e=nc(),r=tc();return wc={formats:r,parse:e,stringify:t}}();function g(t,r,n){if(t&&"object"==typeof t&&t instanceof e)return t;var i=new e;return i.parse(t,r,n),i}return e.prototype.parse=function(e,n,s){if("string"!=typeof e)throw new TypeError("Parameter 'url' must be a string, not "+typeof e);var g=e.indexOf("?"),m=-1!==g&&g<e.indexOf("#")?"?":"#",y=e.split(m);y[0]=y[0].replace(/\\/g,"/");var v=e=y.join(m);if(v=v.trim(),!s&&1===e.split("#").length){var b=i.exec(v);if(b)return this.path=v,this.href=v,this.pathname=b[1],b[2]?(this.search=b[2],this.query=n?p.parse(this.search.substr(1)):this.search.substr(1)):n&&(this.search="",this.query={}),this}var _=r.exec(v);if(_){var w=(_=_[0]).toLowerCase();this.protocol=w,v=v.substr(_.length)}if(s||_||v.match(/^\/\/[^@/]+@[^@/]+/)){var E="//"===v.substr(0,2);E&&(!_||!d[_])&&(v=v.substr(2),this.slashes=!0)}if(!d[_]&&(E||_&&!f[_])){for(var S=-1,T=0;T<l.length;T++){-1!==(x=v.indexOf(l[T]))&&(-1===S||x<S)&&(S=x)}var k,A;-1!==(A=-1===S?v.lastIndexOf("@"):v.lastIndexOf("@",S))&&(k=v.slice(0,A),v=v.slice(A+1),this.auth=decodeURIComponent(k)),S=-1;for(T=0;T<o.length;T++){var x;-1!==(x=v.indexOf(o[T]))&&(-1===S||x<S)&&(S=x)}-1===S&&(S=v.length),this.host=v.slice(0,S),v=v.slice(S),this.parseHost(),this.hostname=this.hostname||"";var I="["===this.hostname[0]&&"]"===this.hostname[this.hostname.length-1];if(!I)for(var R=this.hostname.split(/\./),L=(T=0,R.length);T<L;T++){var P=R[T];if(P&&!P.match(c)){for(var C="",M=0,O=P.length;M<O;M++)P.charCodeAt(M)>127?C+="x":C+=P[M];if(!C.match(c)){var D=R.slice(0,T),N=R.slice(T+1),F=P.match(u);F&&(D.push(F[1]),N.unshift(F[2])),N.length&&(v="/"+N.join(".")+v),this.hostname=D.join(".");break}}}this.hostname.length>255?this.hostname="":this.hostname=this.hostname.toLowerCase(),I||(this.hostname=t.toASCII(this.hostname));var U=this.port?":"+this.port:"",B=this.hostname||"";this.host=B+U,this.href+=this.host,I&&(this.hostname=this.hostname.substr(1,this.hostname.length-2),"/"!==v[0]&&(v="/"+v))}if(!h[w])for(T=0,L=a.length;T<L;T++){var j=a[T];if(-1!==v.indexOf(j)){var z=encodeURIComponent(j);z===j&&(z=escape(j)),v=v.split(j).join(z)}}var W=v.indexOf("#");-1!==W&&(this.hash=v.substr(W),v=v.slice(0,W));var G=v.indexOf("?");if(-1!==G?(this.search=v.substr(G),this.query=v.substr(G+1),n&&(this.query=p.parse(this.query)),v=v.slice(0,G)):n&&(this.search="",this.query={}),v&&(this.pathname=v),f[w]&&this.hostname&&!this.pathname&&(this.pathname="/"),this.pathname||this.search){U=this.pathname||"";var V=this.search||"";this.path=U+V}return this.href=this.format(),this},e.prototype.format=function(){var t=this.auth||"";t&&(t=(t=encodeURIComponent(t)).replace(/%3A/i,":"),t+="@");var e=this.protocol||"",r=this.pathname||"",n=this.hash||"",i=!1,s="";this.host?i=t+this.host:this.hostname&&(i=t+(-1===this.hostname.indexOf(":")?this.hostname:"["+this.hostname+"]"),this.port&&(i+=":"+this.port)),this.query&&"object"==typeof this.query&&Object.keys(this.query).length&&(s=p.stringify(this.query,{arrayFormat:"repeat",addQueryPrefix:!1}));var a=this.search||s&&"?"+s||"";return e&&":"!==e.substr(-1)&&(e+=":"),this.slashes||(!e||f[e])&&!1!==i?(i="//"+(i||""),r&&"/"!==r.charAt(0)&&(r="/"+r)):i||(i=""),n&&"#"!==n.charAt(0)&&(n="#"+n),a&&"?"!==a.charAt(0)&&(a="?"+a),e+i+(r=r.replace(/[?#]/g,function(t){return encodeURIComponent(t)}))+(a=a.replace("#","%23"))+n},e.prototype.resolve=function(t){return this.resolveObject(g(t,!1,!0)).format()},e.prototype.resolveObject=function(t){if("string"==typeof t){var r=new e;r.parse(t,!1,!0),t=r}for(var n=new e,i=Object.keys(this),s=0;s<i.length;s++){var a=i[s];n[a]=this[a]}if(n.hash=t.hash,""===t.href)return n.href=n.format(),n;if(t.slashes&&!t.protocol){for(var o=Object.keys(t),l=0;l<o.length;l++){var c=o[l];"protocol"!==c&&(n[c]=t[c])}return f[n.protocol]&&n.hostname&&!n.pathname&&(n.pathname="/",n.path=n.pathname),n.href=n.format(),n}if(t.protocol&&t.protocol!==n.protocol){if(!f[t.protocol]){for(var u=Object.keys(t),h=0;h<u.length;h++){var p=u[h];n[p]=t[p]}return n.href=n.format(),n}if(n.protocol=t.protocol,t.host||d[t.protocol])n.pathname=t.pathname;else{for(var g=(t.pathname||"").split("/");g.length&&!(t.host=g.shift()););t.host||(t.host=""),t.hostname||(t.hostname=""),""!==g[0]&&g.unshift(""),g.length<2&&g.unshift(""),n.pathname=g.join("/")}if(n.search=t.search,n.query=t.query,n.host=t.host||"",n.auth=t.auth,n.hostname=t.hostname||t.host,n.port=t.port,n.pathname||n.search){var m=n.pathname||"",y=n.search||"";n.path=m+y}return n.slashes=n.slashes||t.slashes,n.href=n.format(),n}var v=n.pathname&&"/"===n.pathname.charAt(0),b=t.host||t.pathname&&"/"===t.pathname.charAt(0),_=b||v||n.host&&t.pathname,w=_,E=n.pathname&&n.pathname.split("/")||[],S=(g=t.pathname&&t.pathname.split("/")||[],n.protocol&&!f[n.protocol]);if(S&&(n.hostname="",n.port=null,n.host&&(""===E[0]?E[0]=n.host:E.unshift(n.host)),n.host="",t.protocol&&(t.hostname=null,t.port=null,t.host&&(""===g[0]?g[0]=t.host:g.unshift(t.host)),t.host=null),_=_&&(""===g[0]||""===E[0])),b)n.host=t.host||""===t.host?t.host:n.host,n.hostname=t.hostname||""===t.hostname?t.hostname:n.hostname,n.search=t.search,n.query=t.query,E=g;else if(g.length)E||(E=[]),E.pop(),E=E.concat(g),n.search=t.search,n.query=t.query;else if(null!=t.search){if(S)n.host=E.shift(),n.hostname=n.host,(I=!!(n.host&&n.host.indexOf("@")>0)&&n.host.split("@"))&&(n.auth=I.shift(),n.hostname=I.shift(),n.host=n.hostname);return n.search=t.search,n.query=t.query,(null!==n.pathname||null!==n.search)&&(n.path=(n.pathname?n.pathname:"")+(n.search?n.search:"")),n.href=n.format(),n}if(!E.length)return n.pathname=null,n.search?n.path="/"+n.search:n.path=null,n.href=n.format(),n;for(var T=E.slice(-1)[0],k=(n.host||t.host||E.length>1)&&("."===T||".."===T)||""===T,A=0,x=E.length;x>=0;x--)"."===(T=E[x])?E.splice(x,1):".."===T?(E.splice(x,1),A++):A&&(E.splice(x,1),A--);if(!_&&!w)for(;A--;A)E.unshift("..");_&&""!==E[0]&&(!E[0]||"/"!==E[0].charAt(0))&&E.unshift(""),k&&"/"!==E.join("/").substr(-1)&&E.push("");var I,R=""===E[0]||E[0]&&"/"===E[0].charAt(0);S&&(n.hostname=R?"":E.length?E.shift():"",n.host=n.hostname,(I=!!(n.host&&n.host.indexOf("@")>0)&&n.host.split("@"))&&(n.auth=I.shift(),n.hostname=I.shift(),n.host=n.hostname));return(_=_||n.host&&E.length)&&!R&&E.unshift(""),E.length>0?n.pathname=E.join("/"):(n.pathname=null,n.path=null),(null!==n.pathname||null!==n.search)&&(n.path=(n.pathname?n.pathname:"")+(n.search?n.search:"")),n.auth=t.auth||n.auth,n.slashes=n.slashes||t.slashes,n.href=n.format(),n},e.prototype.parseHost=function(){var t=this.host,e=n.exec(t);e&&(":"!==(e=e[0])&&(this.port=e.substr(1)),t=t.substr(0,t.length-e.length)),t&&(this.hostname=t)},Sc.parse=g,Sc.resolve=function(t,e){return g(t,!1,!0).resolve(e)},Sc.resolveObject=function(t,e){return t?g(t,!1,!0).resolveObject(e):e},Sc.format=function(t){return"string"==typeof t&&(t=g(t)),t instanceof e?t.format():e.prototype.format.call(t)},Sc.Url=e,Sc}function sc(t){if("string"==typeof t)t=new URL(t);else if(!(t instanceof URL))throw new Deno.errors.InvalidData("invalid argument path , must be a string or URL");if("file:"!==t.protocol)throw new Deno.errors.InvalidData("invalid url scheme");return Fc?function(t){let e=t.hostname,r=t.pathname;for(let n=0;n<r.length;n++)if("%"===r[n]){let t=r.codePointAt(n+2)||32;if("2"===r[n+1]&&102===t||"5"===r[n+1]&&99===t)throw new Deno.errors.InvalidData("must not include encoded \\ or / characters")}if(r=r.replace(Uc,"\\"),r=decodeURIComponent(r),""!==e)return"\\\\".concat(e).concat(r);{let t=32|r.codePointAt(1),e=r[2];if(t<Dc||t>Nc||":"!==e)throw new Deno.errors.InvalidData("file url path must be absolute");return r.slice(1)}}(t):function(t){if(""!==t.hostname)throw new Deno.errors.InvalidData("invalid file url hostname");let e=t.pathname;for(let r=0;r<e.length;r++)if("%"===e[r]){let t=e.codePointAt(r+2)||32;if("2"===e[r+1]&&102===t)throw new Deno.errors.InvalidData("must not include encoded / characters")}return decodeURIComponent(e)}(t)}function ac(t){let e=Ql.resolve(t),r=t.charCodeAt(t.length-1);(r===Oc||Fc&&r===Mc)&&e[e.length-1]!==Ql.sep&&(e+="/");let n=new URL("file://");return e.includes("%")&&(e=e.replace(Bc,"%25")),!Fc&&e.includes("\\")&&(e=e.replace(jc,"%5C")),e.includes("\n")&&(e=e.replace(zc,"%0A")),e.includes("\r")&&(e=e.replace(Wc,"%0D")),e.includes("\t")&&(e=e.replace(Gc,"%09")),n.pathname=e,n}Ar($l,{URL:()=>Cc,Url:()=>xc,default:()=>kc,fileURLToPath:()=>sc,format:()=>Ic,parse:()=>Pc,pathToFileURL:()=>ac,resolve:()=>Rc,resolveObject:()=>Lc});var oc,lc,cc,uc,hc,dc,fc,pc,gc,mc,yc,vc,bc,_c,wc,Ec,Sc,Tc,kc,Ac,xc,Ic,Rc,Lc,Pc,Cc,Mc,Oc,Dc,Nc,Fc,Uc,Bc,jc,zc,Wc,Gc,Vc=Tr(()=>{Ir(),Ei(),oi(),Wa(),zo(),Xl(),Kl(),oc=Object.freeze(Object.create(null)),lc={},cc=!1,uc=typeof globalThis<"u"?globalThis:typeof self<"u"?self:r.g,hc={},dc=!1,fc={},pc=!1,gc={},mc=!1,yc={},vc=!1,bc={},_c=!1,wc={},Ec=!1,Sc={},Tc=!1,(kc=ic()).parse,kc.resolve,kc.resolveObject,kc.format,kc.Url,Ac=typeof Deno<"u"?"windows"===Deno.build.os?"win32":Deno.build.os:void 0,kc.URL=typeof URL<"u"?URL:null,kc.pathToFileURL=ac,kc.fileURLToPath=sc,xc=kc.Url,Ic=kc.format,Rc=kc.resolve,Lc=kc.resolveObject,Pc=kc.parse,Cc=kc.URL,Mc=92,Oc=47,Dc=97,Nc=122,Fc="win32"===Ac,Uc=/\//g,Bc=/%/g,jc=/\\/g,zc=/\n/g,Wc=/\r/g,Gc=/\t/g}),Hc=kr((t,e)=>{Ir(),Ei(),oi(),e.exports=function(){throw new Error("ws does not work in the browser. Browser clients must use the native WebSocket object")}}),Kc=kr(t=>{Ir(),Ei(),oi(),Object.defineProperty(t,"__esModule",{value:!0}),t.BufferedDuplex=void 0,t.writev=n;var e=cs(),r=(wi(),xr(mi));function n(t,e){let n=new Array(t.length);for(let i=0;i<t.length;i++)"string"==typeof t[i].chunk?n[i]=r.Buffer.from(t[i].chunk,"utf8"):n[i]=t[i].chunk;this._write(r.Buffer.concat(n),"binary",e)}var i=class extends e.Duplex{constructor(t,e,r){super({objectMode:!0}),o(this,"socket",void 0),o(this,"proxy",void 0),o(this,"isSocketOpen",void 0),o(this,"writeQueue",void 0),this.proxy=e,this.socket=r,this.writeQueue=[],t.objectMode||(this._writev=n.bind(this)),this.isSocketOpen=!1,this.proxy.on("data",t=>{!this.destroyed&&this.readable&&this.push(t)})}_read(t){this.proxy.read(t)}_write(t,e,r){this.isSocketOpen?this.writeToProxy(t,e,r):this.writeQueue.push({chunk:t,encoding:e,cb:r})}_final(t){this.writeQueue=[],this.proxy.end(t)}_destroy(t,e){this.writeQueue=[],this.proxy.destroy(),e(t)}socketReady(){this.emit("connect"),this.isSocketOpen=!0,this.processWriteQueue()}writeToProxy(t,e,r){!1===this.proxy.write(t,e)?this.proxy.once("drain",r):r()}processWriteQueue(){for(;this.writeQueue.length>0;){let{chunk:t,encoding:e,cb:r}=this.writeQueue.shift();this.writeToProxy(t,e,r)}}};t.BufferedDuplex=i}),qc=kr(t=>{Ir(),Ei(),oi();var e=t&&t.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(t,"__esModule",{value:!0}),t.streamBuilder=t.browserStreamBuilder=void 0;var r=(wi(),xr(mi)),n=e(Hc()),i=e(ys()),s=cs(),a=e(Oa()),o=Kc(),l=(0,i.default)("mqttjs:ws"),c=["rejectUnauthorized","ca","cert","key","pfx","passphrase"];function u(t,e){let r="".concat(t.protocol,"://").concat(t.hostname,":").concat(t.port).concat(t.path);return"function"==typeof t.transformWsUrl&&(r=t.transformWsUrl(r,t,e)),r}function h(t){let e=t;return t.port||("wss"===t.protocol?e.port=443:e.port=80),t.path||(e.path="/"),t.wsOptions||(e.wsOptions={}),!a.default&&!t.forceNativeWebSocket&&"wss"===t.protocol&&c.forEach(r=>{Object.prototype.hasOwnProperty.call(t,r)&&!Object.prototype.hasOwnProperty.call(t.wsOptions,r)&&(e.wsOptions[r]=t[r])}),e}t.streamBuilder=(t,e)=>{l("streamBuilder");let r=h(e);r.hostname=r.hostname||r.host||"localhost";let i=u(r,t),s=function(t,e,r){l("createWebSocket"),l("protocol: ".concat(r.protocolId," ").concat(r.protocolVersion));let i,s="MQIsdp"===r.protocolId&&3===r.protocolVersion?"mqttv3.1":"mqtt";return l("creating new Websocket for url: ".concat(e," and protocol: ").concat(s)),i=r.createWebsocket?r.createWebsocket(e,[s],r):new n.default(e,[s],r.wsOptions),i}(0,i,r),a=n.default.createWebSocketStream(s,r.wsOptions);return a.url=i,s.on("close",()=>{a.destroy()}),a};t.browserStreamBuilder=(t,e)=>{l("browserStreamBuilder");let n,i=function(t){let e=h(t);if(e.hostname||(e.hostname=e.host),!e.hostname){if(typeof document>"u")throw new Error("Could not determine host. Specify host manually.");let t=new URL(document.URL);e.hostname=t.hostname,e.port||(e.port=Number(t.port))}return void 0===e.objectMode&&(e.objectMode=!(!0===e.binary||void 0===e.binary)),e}(e).browserBufferSize||524288,a=e.browserBufferTimeout||1e3,c=!e.objectMode,d=function(t,e){let r,n="MQIsdp"===e.protocolId&&3===e.protocolVersion?"mqttv3.1":"mqtt",i=u(e,t);return r=e.createWebsocket?e.createWebsocket(i,[n],e):new WebSocket(i,[n]),r.binaryType="arraybuffer",r}(t,e),f=function(t,e,r){let n=new s.Transform({objectMode:t.objectMode});return n._write=e,n._flush=r,n}(e,function t(e,n,s){if(d.bufferedAmount>i)return void setTimeout(t,a,e,n,s);c&&"string"==typeof e&&(e=r.Buffer.from(e,"utf8"));try{d.send(e)}catch(o){return s(o)}s()},function(t){d.close(),t()});e.objectMode||(f._writev=o.writev.bind(f)),f.on("close",()=>{d.close()});let p=typeof d.addEventListener<"u";function g(){l("WebSocket onOpen"),n instanceof o.BufferedDuplex&&n.socketReady()}function m(t){l("WebSocket onClose",t),n.end(),n.destroy()}function y(t){l("WebSocket onError",t);let e=new Error("WebSocket error");e.event=t,n.destroy(e)}async function v(t){if(!f||!f.readable||!f.writable)return;let{data:e}=t;e=e instanceof ArrayBuffer?r.Buffer.from(e):e instanceof Blob?r.Buffer.from(await new Response(e).arrayBuffer()):r.Buffer.from(e,"utf8"),f.push(e)}return d.readyState===d.OPEN?(n=f,n.socket=d):(n=new o.BufferedDuplex(e,f,d),p?d.addEventListener("open",g):d.onopen=g),p?(d.addEventListener("close",m),d.addEventListener("error",y),d.addEventListener("message",v)):(d.onclose=m,d.onerror=y,d.onmessage=v),n}}),Yc={};function Qc(){throw new Error("Node.js net module is not supported by JSPM core outside of Node.js")}Ar(Yc,{Server:()=>Qc,Socket:()=>Qc,Stream:()=>Qc,_createServerHandle:()=>Qc,_normalizeArgs:()=>Qc,_setSimultaneousAccepts:()=>Qc,connect:()=>Qc,createConnection:()=>Qc,createServer:()=>Qc,default:()=>Xc,isIP:()=>Qc,isIPv4:()=>Qc,isIPv6:()=>Qc});var Xc,$c=Tr(()=>{Ir(),Ei(),oi(),Xc={_createServerHandle:Qc,_normalizeArgs:Qc,_setSimultaneousAccepts:Qc,connect:Qc,createConnection:Qc,createServer:Qc,isIP:Qc,isIPv4:Qc,isIPv6:Qc,Server:Qc,Socket:Qc,Stream:Qc}}),Zc=kr((t,e)=>{Ir(),Ei(),oi(),e.exports={}}),Jc=kr(t=>{Ir(),Ei(),oi();var e=t&&t.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(t,"__esModule",{value:!0});var r=e(($c(),xr(Yc))),n=e(ys()),i=e(Zc()),s=(0,n.default)("mqttjs:tcp");t.default=(t,e)=>{if(e.port=e.port||1883,e.hostname=e.hostname||e.host||"localhost",e.socksProxy)return(0,i.default)(e.hostname,e.port,e.socksProxy,{timeout:e.socksTimeout});let{port:n,path:a}=e,o=e.hostname;return s("port %d and host %s",n,o),r.default.createConnection({port:n,host:o,path:a})}}),tu={};Ar(tu,{default:()=>eu});var eu,ru=Tr(()=>{Ir(),Ei(),oi(),eu={}}),nu=kr(t=>{Ir(),Ei(),oi();var e=t&&t.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(t,"__esModule",{value:!0});var r=(ru(),xr(tu)),n=e(($c(),xr(Yc))),s=e(ys()),a=e(Zc()),o=(0,s.default)("mqttjs:tls");t.default=(t,e)=>{e.port=e.port||8883,e.host=e.hostname||e.host||"localhost",0===n.default.isIP(e.host)&&(e.servername=e.host),e.rejectUnauthorized=!1!==e.rejectUnauthorized,delete e.path,o("port %d host %s rejectUnauthorized %b",e.port,e.host,e.rejectUnauthorized);let s=function(t){let{host:e,port:n,socksProxy:s}=t,o=i(t,br);if(void 0!==s){let i=(0,a.default)(e,n,s,{timeout:t.socksTimeout});return(0,r.connect)(c(c({},o),{},{socket:i}))}return(0,r.connect)(t)}(e);function l(r){e.rejectUnauthorized&&t.emit("error",r),s.end()}return s.on("secureConnect",()=>{e.rejectUnauthorized&&!s.authorized?s.emit("error",new Error("TLS not authorized")):s.removeListener("error",l)}),s.on("error",l),s}}),iu=kr(t=>{Ir(),Ei(),oi(),Object.defineProperty(t,"__esModule",{value:!0});var e,r,n,i=(wi(),xr(mi)),s=cs(),a=Kc();t.default=(t,o)=>{if(o.hostname=o.hostname||o.host,!o.hostname)throw new Error("Could not determine host. Specify host manually.");let l="MQIsdp"===o.protocolId&&3===o.protocolVersion?"mqttv3.1":"mqtt";!function(t){t.hostname||(t.hostname="localhost"),t.path||(t.path="/"),t.wsOptions||(t.wsOptions={})}(o);let c=function(t,e){let r="wxs"===t.protocol?"wss":"ws",n="".concat(r,"://").concat(t.hostname).concat(t.path);return t.port&&80!==t.port&&443!==t.port&&(n="".concat(r,"://").concat(t.hostname,":").concat(t.port).concat(t.path)),"function"==typeof t.transformWsUrl&&(n=t.transformWsUrl(n,t,e)),n}(o,t);e=wx.connectSocket({url:c,protocols:[l]}),r=function(){let t=new s.Transform;return t._write=(t,r,n)=>{e.send({data:t.buffer,success(){n()},fail(t){n(new Error(t))}})},t._flush=t=>{e.close({success(){t()}})},t}(),(n=new a.BufferedDuplex(o,r,e))._destroy=(t,r)=>{e.close({success(){r&&r(t)}})};let u=n.destroy;return n.destroy=(t,r)=>(n.destroy=u,setTimeout(()=>{e.close({fail(){n._destroy(t,r)}})},0),n),e.onOpen(()=>{n.socketReady()}),e.onMessage(t=>{let{data:e}=t;e=e instanceof ArrayBuffer?i.Buffer.from(e):i.Buffer.from(e,"utf8"),r.push(e)}),e.onClose(()=>{n.emit("close"),n.end(),n.destroy()}),e.onError(t=>{let e=new Error(t.errMsg);n.destroy(e)}),n}}),su=kr(t=>{Ir(),Ei(),oi(),Object.defineProperty(t,"__esModule",{value:!0});var e,r,n,i=(wi(),xr(mi)),s=cs(),a=Kc(),o=!1;t.default=(t,l)=>{if(l.hostname=l.hostname||l.host,!l.hostname)throw new Error("Could not determine host. Specify host manually.");let c="MQIsdp"===l.protocolId&&3===l.protocolVersion?"mqttv3.1":"mqtt";!function(t){t.hostname||(t.hostname="localhost"),t.path||(t.path="/"),t.wsOptions||(t.wsOptions={})}(l);let u=function(t,e){let r="alis"===t.protocol?"wss":"ws",n="".concat(r,"://").concat(t.hostname).concat(t.path);return t.port&&80!==t.port&&443!==t.port&&(n="".concat(r,"://").concat(t.hostname,":").concat(t.port).concat(t.path)),"function"==typeof t.transformWsUrl&&(n=t.transformWsUrl(n,t,e)),n}(l,t);return(e=l.my).connectSocket({url:u,protocols:c}),r=function(){let t=new s.Transform;return t._write=(t,r,n)=>{e.sendSocketMessage({data:t.buffer,success(){n()},fail(){n(new Error)}})},t._flush=t=>{e.closeSocket({success(){t()}})},t}(),n=new a.BufferedDuplex(l,r,e),o||(o=!0,e.onSocketOpen(()=>{n.socketReady()}),e.onSocketMessage(t=>{if("string"==typeof t.data){let e=i.Buffer.from(t.data,"base64");r.push(e)}else{let e=new FileReader;e.addEventListener("load",()=>{e.result instanceof ArrayBuffer?r.push(i.Buffer.from(e.result)):r.push(i.Buffer.from(e.result,"utf-8"))}),e.readAsArrayBuffer(t.data)}}),e.onSocketClose(()=>{n.end(),n.destroy()}),e.onSocketError(t=>{n.destroy(t)})),n}}),au=kr(t=>{Ir(),Ei(),oi();var e=t&&t.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(t,"__esModule",{value:!0}),t.connectAsync=function(t,e){let r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return new Promise((n,i)=>{let s=l(t,e),a={connect:t=>{o(),n(s)},end:()=>{o(),n(s)},error:t=>{o(),s.end(),i(t)}};function o(){Object.keys(a).forEach(t=>{s.off(t,a[t])})}!1===r&&(a.close=()=>{a.error(new Error("Couldn't connect to server"))}),Object.keys(a).forEach(t=>{s.on(t,a[t])})})};var r=e(ys()),n=e((Vc(),xr($l))),i=e(Fa()),s=e(Oa());"function"!=typeof(null===Rr||void 0===Rr?void 0:Rr.nextTick)&&(Rr.nextTick=setImmediate);var a=(0,r.default)("mqttjs"),o=null;function l(t,e){var r,l,u;if(a("connecting to an MQTT broker..."),"object"==typeof t&&!e&&(e=t,t=""),e=e||{},t&&"string"==typeof t){let r=n.default.parse(t,!0),i={};if(null!=r.port&&(i.port=Number(r.port)),i.host=r.hostname,i.query=r.query,i.auth=r.auth,i.protocol=r.protocol,i.path=r.path,!(e=c(c({},i),e)).protocol)throw new Error("Missing protocol");e.protocol=e.protocol.replace(/:$/,"")}if(e.unixSocket=e.unixSocket||(null===(r=e.protocol)||void 0===r?void 0:r.includes("+unix")),e.unixSocket?e.protocol=e.protocol.replace("+unix",""):!(null!==(l=e.protocol)&&void 0!==l&&l.startsWith("ws"))&&!(null!==(u=e.protocol)&&void 0!==u&&u.startsWith("wx"))&&delete e.path,function(t){let e;if(t.auth)if(e=t.auth.match(/^(.+):(.+)$/),e){let[,r,n]=e;t.username=r,t.password=n}else t.username=t.auth}(e),e.query&&"string"==typeof e.query.clientId&&(e.clientId=e.query.clientId),s.default||e.unixSocket?e.socksProxy=void 0:void 0===e.socksProxy&&typeof Rr<"u"&&(e.socksProxy=Rr.env.MQTTJS_SOCKS_PROXY),e.cert&&e.key){if(!e.protocol)throw new Error("Missing secure protocol key");if(-1===["mqtts","wss","wxs","alis"].indexOf(e.protocol))switch(e.protocol){case"mqtt":e.protocol="mqtts";break;case"ws":e.protocol="wss";break;case"wx":e.protocol="wxs";break;case"ali":e.protocol="alis";break;default:throw new Error('Unknown protocol for secure connection: "'.concat(e.protocol,'"!'))}}if(o||(o={},s.default||e.forceNativeWebSocket?(o.ws=qc().browserStreamBuilder,o.wss=qc().browserStreamBuilder,o.wx=iu().default,o.wxs=iu().default,o.ali=su().default,o.alis=su().default):(o.ws=qc().streamBuilder,o.wss=qc().streamBuilder,o.mqtt=Jc().default,o.tcp=Jc().default,o.ssl=nu().default,o.tls=o.ssl,o.mqtts=nu().default)),!o[e.protocol]){let t=-1!==["mqtts","wss"].indexOf(e.protocol);e.protocol=["mqtt","mqtts","ws","wss","wx","wxs","ali","alis"].filter((e,r)=>(!t||r%2!==0)&&"function"==typeof o[e])[0]}if(!1===e.clean&&!e.clientId)throw new Error("Missing clientId for unclean clients");e.protocol&&(e.defaultProtocol=e.protocol);let h=new i.default(function(t){return e.servers&&((!t._reconnectCount||t._reconnectCount===e.servers.length)&&(t._reconnectCount=0),e.host=e.servers[t._reconnectCount].host,e.port=e.servers[t._reconnectCount].port,e.protocol=e.servers[t._reconnectCount].protocol?e.servers[t._reconnectCount].protocol:e.defaultProtocol,e.hostname=e.host,t._reconnectCount++),a("calling streambuilder for",e.protocol),o[e.protocol](t,e)},e);return h.on("error",()=>{}),h}t.default=l}),ou=kr(t=>{Ir(),Ei(),oi();var e=t&&t.__createBinding||(Object.create?function(t,e,r,n){void 0===n&&(n=r);var i=Object.getOwnPropertyDescriptor(e,r);(!i||("get"in i?!e.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return e[r]}}),Object.defineProperty(t,n,i)}:function(t,e,r,n){void 0===n&&(n=r),t[n]=e[r]}),r=t&&t.__setModuleDefault||(Object.create?function(t,e){Object.defineProperty(t,"default",{enumerable:!0,value:e})}:function(t,e){t.default=e}),n=t&&t.__importStar||function(){var t=function(e){return(t=Object.getOwnPropertyNames||function(t){var e=[];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[e.length]=r);return e})(e)};return function(n){if(n&&n.__esModule)return n;var i={};if(null!=n)for(var s=t(n),a=0;a<s.length;a++)"default"!==s[a]&&e(i,n,s[a]);return r(i,n),i}}(),i=t&&t.__exportStar||function(t,r){for(var n in t)"default"!==n&&!Object.prototype.hasOwnProperty.call(r,n)&&e(r,t,n)},s=t&&t.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(t,"__esModule",{value:!0}),t.ReasonCodes=t.KeepaliveManager=t.UniqueMessageIdProvider=t.DefaultMessageIdProvider=t.Store=t.MqttClient=t.connectAsync=t.connect=t.Client=void 0;var a=s(Fa());t.MqttClient=a.default;var o=s(aa());t.DefaultMessageIdProvider=o.default;var l=s(Ua());t.UniqueMessageIdProvider=l.default;var c=s(xs());t.Store=c.default;var u=n(au());t.connect=u.default,Object.defineProperty(t,"connectAsync",{enumerable:!0,get:function(){return u.connectAsync}});var h=s(Na());t.KeepaliveManager=h.default,t.Client=a.default,i(Fa(),t),i(Ls(),t);var d=Ps();Object.defineProperty(t,"ReasonCodes",{enumerable:!0,get:function(){return d.ReasonCodes}})});const lu=kr(t=>{Ir(),Ei(),oi();var e=t&&t.__createBinding||(Object.create?function(t,e,r,n){void 0===n&&(n=r);var i=Object.getOwnPropertyDescriptor(e,r);(!i||("get"in i?!e.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return e[r]}}),Object.defineProperty(t,n,i)}:function(t,e,r,n){void 0===n&&(n=r),t[n]=e[r]}),r=t&&t.__setModuleDefault||(Object.create?function(t,e){Object.defineProperty(t,"default",{enumerable:!0,value:e})}:function(t,e){t.default=e}),n=t&&t.__importStar||function(){var t=function(e){return(t=Object.getOwnPropertyNames||function(t){var e=[];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[e.length]=r);return e})(e)};return function(n){if(n&&n.__esModule)return n;var i={};if(null!=n)for(var s=t(n),a=0;a<s.length;a++)"default"!==s[a]&&e(i,n,s[a]);return r(i,n),i}}(),i=t&&t.__exportStar||function(t,r){for(var n in t)"default"!==n&&!Object.prototype.hasOwnProperty.call(r,n)&&e(r,t,n)};Object.defineProperty(t,"__esModule",{value:!0});var s=n(ou());t.default=s,i(ou(),t)})(),cu={MQTT_PROTOCOL:"wss",MQTT_SERVER_IP:"mqtt_bot1_bridge.jampenglab.tw",MQTT_USERNAME:"web_client",MQTT_PASSWORD:"test@1234",MQTT_CLIENT_ID:"web_to_mqtt",RECONNECTION_TIMER:3e3,CONNECT_TIMEOUT_MS:4e3,KEEPALIVE_SECONDS:60,ODOM_TOPIC:"robot1/odom",POSE_TOPIC:"robot1/amcl_pose",IMU_TOPIC:"robot1/imu",MAP_INFO_TOPIC:"robot1/map/info",MAP_UPDATE_TOPIC:"robot1/map/update",CMD_VEL_TOPIC:"robot1/cmd_vel",SAFETY_STOP_TOPIC:"robot1/safety_stop",EMERGENCY_CANCEL_NAV_TOPIC:"robot1/emergency_cancel_nav",WEB_GOAL_POSE_TOPIC:"robot1/web_goal_pose"};const uu=new class{constructor(){this.client=null,this.topics={},this.connected=!1,this.connecting=!1}connect(){var t,e;if(this.connected||this.connecting)return;this.connecting=!0;const r="".concat(cu.MQTT_PROTOCOL,"://").concat(cu.MQTT_SERVER_IP);this.client=lu.connect(r,{username:cu.MQTT_USERNAME,password:cu.MQTT_PASSWORD,clientId:cu.MQTT_CLIENT_ID,clean:!1,reconnectPeriod:null!==(t=cu.RECONNECTION_TIMER)&&void 0!==t?t:5e3,connectTimeout:null!==(e=cu.CONNECT_TIMEOUT_MS)&&void 0!==e?e:3e4}),this.client.on("connect",()=>{this.connected=!0,this.connecting=!1,Object.keys(this.topics).forEach(t=>{this.topics[t].size>0&&this.client.subscribe(t,{qos:0})})}),this.client.on("close",()=>{this.connected=!1}),this.client.on("reconnect",()=>{this.connecting=!0}),this.client.on("error",t=>{this.connected=!1,this.connecting=!1}),this.client.on("message",(t,e)=>{try{const r=JSON.parse(e.toString()),n=this.topics[t];n&&n.forEach(t=>t(r))}catch(Dd){console.error("[MQTT] JSON Parse Error on topic ".concat(t))}})}publish(t,e){var r;let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;null!==(r=this.client)&&void 0!==r&&r.connected&&this.client.publish(t,JSON.stringify(e),{qos:n})}subscribe(t,e){var r;this.topics[t]||(this.topics[t]=new Set),this.topics[t].add(e),null!==(r=this.client)&&void 0!==r&&r.connected&&1===this.topics[t].size&&this.client.subscribe(t,{qos:0})}unsubscribe(t,e){const r=this.topics[t];r&&r.delete(e)}},hu=uu;class du extends t.Component{constructor(t){super(t),this.state={percent:0},this.timer=null}componentDidMount(){const{duration:t=5e3}=this.props,e=t/50;let r=0;this.timer=setInterval(()=>{r++;const t=Math.min(100,Math.floor(r/e*100));this.setState({percent:t}),t>=100&&(clearInterval(this.timer),this.props.onComplete&&this.props.onComplete())},50)}componentWillUnmount(){this.timer&&clearInterval(this.timer)}render(){const{percent:t}=this.state;return(0,Me.jsx)("div",{className:"loading-overlay",children:(0,Me.jsxs)("div",{className:"loading-container",children:[(0,Me.jsx)("div",{className:"loading-bar",children:(0,Me.jsx)("div",{className:"loading-fill",style:{width:"".concat(t,"%"),background:"linear-gradient(to right, #4caf50, #8bc34a)"}})}),(0,Me.jsxs)("div",{className:"loading-text",children:[t,"%"]}),(0,Me.jsx)("div",{className:"loading-subtext",children:this.props.message||"\u6b63\u5728\u555f\u52d5 ROS..."})]})})}}const fu=du;class pu extends t.Component{constructor(){super(...arguments),this.state={visible:!0}}componentDidMount(){const{duration:t=3e3}=this.props;this.timer=setTimeout(()=>this.setState({visible:!1}),t)}componentWillUnmount(){clearTimeout(this.timer)}render(){const{message:t="\u6e2c\u8a66",type:e="success"}=this.props,{visible:r}=this.state;if(!r)return null;const n={success:"#0dd286ff",warning:"#f7c110ff",error:"#ff4444"},i=n[e]||n.error;return(0,Me.jsx)("div",{className:"toast-box",style:{backgroundColor:i},children:t})}}const gu=pu;class mu extends t.Component{render(){const{toasts:t=[]}=this.props;return(0,Me.jsx)("div",{className:"toast-container",children:t.map(t=>(0,Me.jsx)(gu,{type:t.type,message:t.message,duration:t.duration},t.id))})}}const yu=mu;var vu=r(173),bu=r.n(vu);const _u=["as","className","type","tooltip"],wu={type:bu().string,tooltip:bu().bool,as:bu().elementType},Eu=t.forwardRef((t,e)=>{let{as:r="div",className:n,type:s="valid",tooltip:a=!1}=t,o=i(t,_u);return(0,Me.jsx)(r,c(c({},o),{},{ref:e,className:Ue()(n,"".concat(s,"-").concat(a?"tooltip":"feedback"))}))});Eu.displayName="Feedback",Eu.propTypes=wu;const Su=Eu,Tu=t.createContext({}),ku=["id","bsPrefix","className","type","isValid","isInvalid","as"],Au=t.forwardRef((e,r)=>{let{id:n,bsPrefix:s,className:a,type:o="checkbox",isValid:l=!1,isInvalid:u=!1,as:h="input"}=e,d=i(e,ku);const{controlId:f}=(0,t.useContext)(Tu);return s=Ve(s,"form-check-input"),(0,Me.jsx)(h,c(c({},d),{},{ref:r,type:o,id:n||f,className:Ue()(a,s,l&&"is-valid",u&&"is-invalid")}))});Au.displayName="FormCheckInput";const xu=Au,Iu=["bsPrefix","className","htmlFor"],Ru=t.forwardRef((e,r)=>{let{bsPrefix:n,className:s,htmlFor:a}=e,o=i(e,Iu);const{controlId:l}=(0,t.useContext)(Tu);return n=Ve(n,"form-check-label"),(0,Me.jsx)("label",c(c({},o),{},{ref:r,htmlFor:a||l,className:Ue()(s,n)}))});Ru.displayName="FormCheckLabel";const Lu=Ru;const Pu=["id","bsPrefix","bsSwitchPrefix","inline","reverse","disabled","isValid","isInvalid","feedbackTooltip","feedback","feedbackType","className","style","title","type","label","children","as"],Cu=t.forwardRef((e,r)=>{let{id:n,bsPrefix:s,bsSwitchPrefix:a,inline:o=!1,reverse:l=!1,disabled:u=!1,isValid:h=!1,isInvalid:d=!1,feedbackTooltip:f=!1,feedback:p,feedbackType:g,className:m,style:y,title:v="",type:b="checkbox",label:_,children:w,as:E="input"}=e,S=i(e,Pu);s=Ve(s,"form-check"),a=Ve(a,"form-switch");const{controlId:T}=(0,t.useContext)(Tu),k=(0,t.useMemo)(()=>({controlId:n||T}),[T,n]),A=!w&&null!=_&&!1!==_||function(e,r){return t.Children.toArray(e).some(e=>t.isValidElement(e)&&e.type===r)}(w,Lu),x=(0,Me.jsx)(xu,c(c({},S),{},{type:"switch"===b?"checkbox":b,ref:r,isValid:h,isInvalid:d,disabled:u,as:E}));return(0,Me.jsx)(Tu.Provider,{value:k,children:(0,Me.jsx)("div",{style:y,className:Ue()(m,A&&s,o&&"".concat(s,"-inline"),l&&"".concat(s,"-reverse"),"switch"===b&&a),children:w||(0,Me.jsxs)(Me.Fragment,{children:[x,A&&(0,Me.jsx)(Lu,{title:v,children:_}),p&&(0,Me.jsx)(Su,{type:g,tooltip:f,children:p})]})})})});Cu.displayName="FormCheck";const Mu=Object.assign(Cu,{Input:xu,Label:Lu});r(440);const Ou=["bsPrefix","type","size","htmlSize","id","className","isValid","isInvalid","plaintext","readOnly","as"],Du=t.forwardRef((e,r)=>{let{bsPrefix:n,type:s,size:a,htmlSize:o,id:l,className:u,isValid:h=!1,isInvalid:d=!1,plaintext:f,readOnly:p,as:g="input"}=e,m=i(e,Ou);const{controlId:y}=(0,t.useContext)(Tu);return n=Ve(n,"form-control"),(0,Me.jsx)(g,c(c({},m),{},{type:s,size:o,ref:r,readOnly:p,id:l||y,className:Ue()(u,f?"".concat(n,"-plaintext"):n,a&&"".concat(n,"-").concat(a),"color"===s&&"".concat(n,"-color"),h&&"is-valid",d&&"is-invalid")}))});Du.displayName="FormControl";const Nu=Object.assign(Du,{Feedback:Su}),Fu=["className","bsPrefix","as"],Uu=t.forwardRef((t,e)=>{let{className:r,bsPrefix:n,as:s="div"}=t,a=i(t,Fu);return n=Ve(n,"form-floating"),(0,Me.jsx)(s,c({ref:e,className:Ue()(r,n)},a))});Uu.displayName="FormFloating";const Bu=Uu,ju=["controlId","as"],zu=t.forwardRef((e,r)=>{let{controlId:n,as:s="div"}=e,a=i(e,ju);const o=(0,t.useMemo)(()=>({controlId:n}),[n]);return(0,Me.jsx)(Tu.Provider,{value:o,children:(0,Me.jsx)(s,c(c({},a),{},{ref:r}))})});zu.displayName="FormGroup";const Wu=zu,Gu=["as","bsPrefix","className"],Vu=["className"];function Hu(e){let{as:r,bsPrefix:n,className:s}=e,a=i(e,Gu);n=Ve(n,"col");const o=function(){const{breakpoints:e}=(0,t.useContext)(ze);return e}(),l=function(){const{minBreakpoint:e}=(0,t.useContext)(ze);return e}(),u=[],h=[];return o.forEach(t=>{const e=a[t];let r,i,s;delete a[t],"object"===typeof e&&null!=e?({span:r,offset:i,order:s}=e):r=e;const o=t!==l?"-".concat(t):"";r&&u.push(!0===r?"".concat(n).concat(o):"".concat(n).concat(o,"-").concat(r)),null!=s&&h.push("order".concat(o,"-").concat(s)),null!=i&&h.push("offset".concat(o,"-").concat(i))}),[c(c({},a),{},{className:Ue()(s,...u,...h)}),{as:r,bsPrefix:n,spans:u}]}const Ku=t.forwardRef((t,e)=>{const[r,{as:n="div",bsPrefix:s,spans:a}]=Hu(t),{className:o}=r,l=i(r,Vu);return(0,Me.jsx)(n,c(c({},l),{},{ref:e,className:Ue()(o,!a.length&&s)}))});Ku.displayName="Col";const qu=Ku,Yu=["as","bsPrefix","column","visuallyHidden","className","htmlFor"],Qu=t.forwardRef((e,r)=>{let{as:n="label",bsPrefix:s,column:a=!1,visuallyHidden:o=!1,className:l,htmlFor:u}=e,h=i(e,Yu);const{controlId:d}=(0,t.useContext)(Tu);s=Ve(s,"form-label");let f="col-form-label";"string"===typeof a&&(f="".concat(f," ").concat(f,"-").concat(a));const p=Ue()(l,s,o&&"visually-hidden",a&&f);return u=u||d,a?(0,Me.jsx)(qu,c({ref:r,as:"label",className:p,htmlFor:u},h)):(0,Me.jsx)(n,c({ref:r,className:p,htmlFor:u},h))});Qu.displayName="FormLabel";const Xu=Qu,$u=["bsPrefix","className","id"],Zu=t.forwardRef((e,r)=>{let{bsPrefix:n,className:s,id:a}=e,o=i(e,$u);const{controlId:l}=(0,t.useContext)(Tu);return n=Ve(n,"form-range"),(0,Me.jsx)("input",c(c({},o),{},{type:"range",ref:r,className:Ue()(s,n),id:a||l}))});Zu.displayName="FormRange";const Ju=Zu,th=["bsPrefix","size","htmlSize","className","isValid","isInvalid","id"],eh=t.forwardRef((e,r)=>{let{bsPrefix:n,size:s,htmlSize:a,className:o,isValid:l=!1,isInvalid:u=!1,id:h}=e,d=i(e,th);const{controlId:f}=(0,t.useContext)(Tu);return n=Ve(n,"form-select"),(0,Me.jsx)("select",c(c({},d),{},{size:a,ref:r,className:Ue()(o,n,s&&"".concat(n,"-").concat(s),l&&"is-valid",u&&"is-invalid"),id:h||f}))});eh.displayName="FormSelect";const rh=eh,nh=["bsPrefix","className","as","muted"],ih=t.forwardRef((t,e)=>{let{bsPrefix:r,className:n,as:s="small",muted:a}=t,o=i(t,nh);return r=Ve(r,"form-text"),(0,Me.jsx)(s,c(c({},o),{},{ref:e,className:Ue()(n,r,a&&"text-muted")}))});ih.displayName="FormText";const sh=ih,ah=t.forwardRef((t,e)=>(0,Me.jsx)(Mu,c(c({},t),{},{ref:e,type:"switch"})));ah.displayName="Switch";const oh=Object.assign(ah,{Input:Mu.Input,Label:Mu.Label}),lh=["bsPrefix","className","children","controlId","label"],ch=t.forwardRef((t,e)=>{let{bsPrefix:r,className:n,children:s,controlId:a,label:o}=t,l=i(t,lh);return r=Ve(r,"form-floating"),(0,Me.jsxs)(Wu,c(c({ref:e,className:Ue()(n,r),controlId:a},l),{},{children:[s,(0,Me.jsx)("label",{htmlFor:a,children:o})]}))});ch.displayName="FloatingLabel";const uh=ch,hh=["className","validated","as"],dh={_ref:bu().any,validated:bu().bool,as:bu().elementType},fh=t.forwardRef((t,e)=>{let{className:r,validated:n,as:s="form"}=t,a=i(t,hh);return(0,Me.jsx)(s,c(c({},a),{},{ref:e,className:Ue()(r,n&&"was-validated")}))});fh.displayName="Form",fh.propTypes=dh;const ph=Object.assign(fh,{Group:Wu,Control:Nu,Floating:Bu,Check:Mu,Switch:oh,Label:Xu,Text:sh,Range:Ju,Select:rh,FloatingLabel:uh});class gh extends t.Component{constructor(t){var e;super(t),e=this,this.handleStartMode=async function(t){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(e.props.onCloseSidebar&&e.props.onCloseSidebar(),0!==e.state.maps.length)if("idle"===e.props.currentMode){e.props.showLoading("slam"===t?"\u555f\u52d5\u5efa\u5716\u4e2d ...":"\u555f\u52d5\u5c0e\u822a\u4e2d ...",1e4);try{const n=await sr.startMode(t,r);e.props.addToast(n,"success"),"slam"===t?e.props.setSlamming(!0):e.props.setSlamming(!1),e.props.onModeChange&&e.props.onModeChange(t)}catch(Dd){e.props.addToast(Dd.message||Dd.toString(),"error")}}else e.props.addToast("\u5df2\u5728 ".concat(e.props.currentMode," \u6a21\u5f0f"),"warning");else e.props.addToast("\u5c1a\u672a\u9023\u7dda\uff0c\u7121\u6cd5\u555f\u52d5","warning")},this.handleStopMode=async()=>{if(this.props.onCloseSidebar&&this.props.onCloseSidebar(),0!==this.state.maps.length)try{const t=await sr.stopMode();this.props.addToast(t,"success"),this.props.onModeChange&&this.props.onModeChange("idle"),this.props.setSlamming(!1)}catch(Dd){this.props.addToast(Dd.message||Dd.toString(),"error")}else this.props.addToast("\u5c1a\u672a\u9023\u7dda\uff0c\u4e0d\u9700\u8981\u505c\u6b62","warning")},this.confirmSaveMap=async()=>{const{folderName:t}=this.state;if(t.trim()){this.setState({saving:!0});try{const e=await sr.saveMap(t);this.props.addToast(e,"success"),this.props.onCloseSidebar&&this.props.onCloseSidebar()}catch(Dd){this.props.addToast(Dd.message||Dd.toString(),"error")}finally{this.setState({saving:!1,showSavePopup:!1,folderName:""})}}else this.props.addToast("\u8acb\u8f38\u5165\u5730\u5716\u540d\u7a31\uff01","error")},this.cancelSave=()=>{this.setState({showSavePopup:!1,folderName:""})},this.state={folderName:"",saving:!1,maps:[],mapLoaded:!1,navOpen:!1,showSavePopup:!1}}async componentDidMount(){try{const t=await sr.getMaps();this.setState({maps:t,mapLoaded:!0})}catch(Dd){this.setState({maps:[],mapLoaded:!0})}}render(){const{folderName:t,saving:e,maps:r,mapLoaded:n,navOpen:i,showSavePopup:s}=this.state;return(0,Me.jsxs)("div",{className:"ros-controls-bar",children:[(0,Me.jsxs)("div",{className:"ros-controls-group",children:[(0,Me.jsx)("span",{className:"ros-btn ros-btn-slam",onClick:()=>this.handleStartMode("slam"),children:"\u555f\u52d5\u5efa\u5716"}),(0,Me.jsx)("div",{className:"ros-save-group",children:(0,Me.jsx)("span",{className:"ros-btn ros-btn-save ".concat(this.props.isSlamming?"":"disabled"),onClick:()=>{this.props.isSlamming&&this.setState({showSavePopup:!0})},children:"\u5132\u5b58\u5730\u5716"})}),(0,Me.jsxs)("div",{className:"nav-dropdown-wrapper",children:[(0,Me.jsx)("span",{className:"ros-btn ros-btn-nav",onClick:()=>this.setState({navOpen:!i}),children:"\u555f\u52d5\u5c0e\u822a \u25be"}),i&&(0,Me.jsxs)("div",{className:"nav-dropdown",children:[!n&&(0,Me.jsx)("div",{className:"nav-item disabled",children:"\u8f09\u5165\u4e2d..."}),n&&0===r.length&&(0,Me.jsx)("div",{className:"nav-item disabled",children:"\u6c92\u6709\u5730\u5716"}),r.map(t=>(0,Me.jsx)("div",{className:"nav-item",onClick:()=>{this.setState({navOpen:!1}),this.handleStartMode("nav",t),this.props.onCloseSidebar&&this.props.onCloseSidebar()},children:t},t))]})]}),(0,Me.jsx)("span",{className:"ros-btn ros-btn-stop",onClick:this.handleStopMode,children:"\u505c\u6b62 ROS"})]}),s&&(0,Me.jsx)("div",{className:"save-popup-overlay",children:(0,Me.jsxs)("div",{className:"save-popup",children:[(0,Me.jsx)("div",{className:"save-popup-title",children:(0,Me.jsx)("span",{children:"\u5132\u5b58\u5730\u5716"})}),(0,Me.jsx)(ph.Control,{type:"text",placeholder:"\u8f38\u5165\u5730\u5716\u540d\u7a31",value:t,onChange:t=>this.setState({folderName:t.target.value}),disabled:e}),(0,Me.jsxs)("div",{className:"popup-buttons",children:[(0,Me.jsx)("button",{className:"popup-btn cancel",onClick:this.cancelSave,children:"\u53d6\u6d88"}),(0,Me.jsx)("button",{className:"popup-btn confirm",onClick:this.confirmSaveMap,disabled:e,children:e?"\u5132\u5b58\u4e2d...":"\u78ba\u8a8d"})]})]})})]})}}const mh=gh;function yh(t){let e=t.length;for(;--e>=0;)t[e]=0}const vh=256,bh=286,_h=30,wh=15,Eh=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),Sh=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),Th=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),kh=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),Ah=new Array(576);yh(Ah);const xh=new Array(60);yh(xh);const Ih=new Array(512);yh(Ih);const Rh=new Array(256);yh(Rh);const Lh=new Array(29);yh(Lh);const Ph=new Array(_h);function Ch(t,e,r,n,i){this.static_tree=t,this.extra_bits=e,this.extra_base=r,this.elems=n,this.max_length=i,this.has_stree=t&&t.length}let Mh,Oh,Dh;function Nh(t,e){this.dyn_tree=t,this.max_code=0,this.stat_desc=e}yh(Ph);const Fh=t=>t<256?Ih[t]:Ih[256+(t>>>7)],Uh=(t,e)=>{t.pending_buf[t.pending++]=255&e,t.pending_buf[t.pending++]=e>>>8&255},Bh=(t,e,r)=>{t.bi_valid>16-r?(t.bi_buf|=e<<t.bi_valid&65535,Uh(t,t.bi_buf),t.bi_buf=e>>16-t.bi_valid,t.bi_valid+=r-16):(t.bi_buf|=e<<t.bi_valid&65535,t.bi_valid+=r)},jh=(t,e,r)=>{Bh(t,r[2*e],r[2*e+1])},zh=(t,e)=>{let r=0;do{r|=1&t,t>>>=1,r<<=1}while(--e>0);return r>>>1},Wh=(t,e,r)=>{const n=new Array(16);let i,s,a=0;for(i=1;i<=wh;i++)a=a+r[i-1]<<1,n[i]=a;for(s=0;s<=e;s++){let e=t[2*s+1];0!==e&&(t[2*s]=zh(n[e]++,e))}},Gh=t=>{let e;for(e=0;e<bh;e++)t.dyn_ltree[2*e]=0;for(e=0;e<_h;e++)t.dyn_dtree[2*e]=0;for(e=0;e<19;e++)t.bl_tree[2*e]=0;t.dyn_ltree[512]=1,t.opt_len=t.static_len=0,t.sym_next=t.matches=0},Vh=t=>{t.bi_valid>8?Uh(t,t.bi_buf):t.bi_valid>0&&(t.pending_buf[t.pending++]=t.bi_buf),t.bi_buf=0,t.bi_valid=0},Hh=(t,e,r,n)=>{const i=2*e,s=2*r;return t[i]<t[s]||t[i]===t[s]&&n[e]<=n[r]},Kh=(t,e,r)=>{const n=t.heap[r];let i=r<<1;for(;i<=t.heap_len&&(i<t.heap_len&&Hh(e,t.heap[i+1],t.heap[i],t.depth)&&i++,!Hh(e,n,t.heap[i],t.depth));)t.heap[r]=t.heap[i],r=i,i<<=1;t.heap[r]=n},qh=(t,e,r)=>{let n,i,s,a,o=0;if(0!==t.sym_next)do{n=255&t.pending_buf[t.sym_buf+o++],n+=(255&t.pending_buf[t.sym_buf+o++])<<8,i=t.pending_buf[t.sym_buf+o++],0===n?jh(t,i,e):(s=Rh[i],jh(t,s+vh+1,e),a=Eh[s],0!==a&&(i-=Lh[s],Bh(t,i,a)),n--,s=Fh(n),jh(t,s,r),a=Sh[s],0!==a&&(n-=Ph[s],Bh(t,n,a)))}while(o<t.sym_next);jh(t,256,e)},Yh=(t,e)=>{const r=e.dyn_tree,n=e.stat_desc.static_tree,i=e.stat_desc.has_stree,s=e.stat_desc.elems;let a,o,l,c=-1;for(t.heap_len=0,t.heap_max=573,a=0;a<s;a++)0!==r[2*a]?(t.heap[++t.heap_len]=c=a,t.depth[a]=0):r[2*a+1]=0;for(;t.heap_len<2;)l=t.heap[++t.heap_len]=c<2?++c:0,r[2*l]=1,t.depth[l]=0,t.opt_len--,i&&(t.static_len-=n[2*l+1]);for(e.max_code=c,a=t.heap_len>>1;a>=1;a--)Kh(t,r,a);l=s;do{a=t.heap[1],t.heap[1]=t.heap[t.heap_len--],Kh(t,r,1),o=t.heap[1],t.heap[--t.heap_max]=a,t.heap[--t.heap_max]=o,r[2*l]=r[2*a]+r[2*o],t.depth[l]=(t.depth[a]>=t.depth[o]?t.depth[a]:t.depth[o])+1,r[2*a+1]=r[2*o+1]=l,t.heap[1]=l++,Kh(t,r,1)}while(t.heap_len>=2);t.heap[--t.heap_max]=t.heap[1],((t,e)=>{const r=e.dyn_tree,n=e.max_code,i=e.stat_desc.static_tree,s=e.stat_desc.has_stree,a=e.stat_desc.extra_bits,o=e.stat_desc.extra_base,l=e.stat_desc.max_length;let c,u,h,d,f,p,g=0;for(d=0;d<=wh;d++)t.bl_count[d]=0;for(r[2*t.heap[t.heap_max]+1]=0,c=t.heap_max+1;c<573;c++)u=t.heap[c],d=r[2*r[2*u+1]+1]+1,d>l&&(d=l,g++),r[2*u+1]=d,u>n||(t.bl_count[d]++,f=0,u>=o&&(f=a[u-o]),p=r[2*u],t.opt_len+=p*(d+f),s&&(t.static_len+=p*(i[2*u+1]+f)));if(0!==g){do{for(d=l-1;0===t.bl_count[d];)d--;t.bl_count[d]--,t.bl_count[d+1]+=2,t.bl_count[l]--,g-=2}while(g>0);for(d=l;0!==d;d--)for(u=t.bl_count[d];0!==u;)h=t.heap[--c],h>n||(r[2*h+1]!==d&&(t.opt_len+=(d-r[2*h+1])*r[2*h],r[2*h+1]=d),u--)}})(t,e),Wh(r,c,t.bl_count)},Qh=(t,e,r)=>{let n,i,s=-1,a=e[1],o=0,l=7,c=4;for(0===a&&(l=138,c=3),e[2*(r+1)+1]=65535,n=0;n<=r;n++)i=a,a=e[2*(n+1)+1],++o<l&&i===a||(o<c?t.bl_tree[2*i]+=o:0!==i?(i!==s&&t.bl_tree[2*i]++,t.bl_tree[32]++):o<=10?t.bl_tree[34]++:t.bl_tree[36]++,o=0,s=i,0===a?(l=138,c=3):i===a?(l=6,c=3):(l=7,c=4))},Xh=(t,e,r)=>{let n,i,s=-1,a=e[1],o=0,l=7,c=4;for(0===a&&(l=138,c=3),n=0;n<=r;n++)if(i=a,a=e[2*(n+1)+1],!(++o<l&&i===a)){if(o<c)do{jh(t,i,t.bl_tree)}while(0!==--o);else 0!==i?(i!==s&&(jh(t,i,t.bl_tree),o--),jh(t,16,t.bl_tree),Bh(t,o-3,2)):o<=10?(jh(t,17,t.bl_tree),Bh(t,o-3,3)):(jh(t,18,t.bl_tree),Bh(t,o-11,7));o=0,s=i,0===a?(l=138,c=3):i===a?(l=6,c=3):(l=7,c=4)}};let $h=!1;const Zh=(t,e,r,n)=>{Bh(t,0+(n?1:0),3),Vh(t),Uh(t,r),Uh(t,~r),r&&t.pending_buf.set(t.window.subarray(e,e+r),t.pending),t.pending+=r};var Jh=(t,e,r,n)=>{let i,s,a=0;t.level>0?(2===t.strm.data_type&&(t.strm.data_type=(t=>{let e,r=4093624447;for(e=0;e<=31;e++,r>>>=1)if(1&r&&0!==t.dyn_ltree[2*e])return 0;if(0!==t.dyn_ltree[18]||0!==t.dyn_ltree[20]||0!==t.dyn_ltree[26])return 1;for(e=32;e<vh;e++)if(0!==t.dyn_ltree[2*e])return 1;return 0})(t)),Yh(t,t.l_desc),Yh(t,t.d_desc),a=(t=>{let e;for(Qh(t,t.dyn_ltree,t.l_desc.max_code),Qh(t,t.dyn_dtree,t.d_desc.max_code),Yh(t,t.bl_desc),e=18;e>=3&&0===t.bl_tree[2*kh[e]+1];e--);return t.opt_len+=3*(e+1)+5+5+4,e})(t),i=t.opt_len+3+7>>>3,s=t.static_len+3+7>>>3,s<=i&&(i=s)):i=s=r+5,r+4<=i&&-1!==e?Zh(t,e,r,n):4===t.strategy||s===i?(Bh(t,2+(n?1:0),3),qh(t,Ah,xh)):(Bh(t,4+(n?1:0),3),((t,e,r,n)=>{let i;for(Bh(t,e-257,5),Bh(t,r-1,5),Bh(t,n-4,4),i=0;i<n;i++)Bh(t,t.bl_tree[2*kh[i]+1],3);Xh(t,t.dyn_ltree,e-1),Xh(t,t.dyn_dtree,r-1)})(t,t.l_desc.max_code+1,t.d_desc.max_code+1,a+1),qh(t,t.dyn_ltree,t.dyn_dtree)),Gh(t),n&&Vh(t)},td=(t,e,r)=>(t.pending_buf[t.sym_buf+t.sym_next++]=e,t.pending_buf[t.sym_buf+t.sym_next++]=e>>8,t.pending_buf[t.sym_buf+t.sym_next++]=r,0===e?t.dyn_ltree[2*r]++:(t.matches++,e--,t.dyn_ltree[2*(Rh[r]+vh+1)]++,t.dyn_dtree[2*Fh(e)]++),t.sym_next===t.sym_end),ed={_tr_init:t=>{$h||((()=>{let t,e,r,n,i;const s=new Array(16);for(r=0,n=0;n<28;n++)for(Lh[n]=r,t=0;t<1<<Eh[n];t++)Rh[r++]=n;for(Rh[r-1]=n,i=0,n=0;n<16;n++)for(Ph[n]=i,t=0;t<1<<Sh[n];t++)Ih[i++]=n;for(i>>=7;n<_h;n++)for(Ph[n]=i<<7,t=0;t<1<<Sh[n]-7;t++)Ih[256+i++]=n;for(e=0;e<=wh;e++)s[e]=0;for(t=0;t<=143;)Ah[2*t+1]=8,t++,s[8]++;for(;t<=255;)Ah[2*t+1]=9,t++,s[9]++;for(;t<=279;)Ah[2*t+1]=7,t++,s[7]++;for(;t<=287;)Ah[2*t+1]=8,t++,s[8]++;for(Wh(Ah,287,s),t=0;t<_h;t++)xh[2*t+1]=5,xh[2*t]=zh(t,5);Mh=new Ch(Ah,Eh,257,bh,wh),Oh=new Ch(xh,Sh,0,_h,wh),Dh=new Ch(new Array(0),Th,0,19,7)})(),$h=!0),t.l_desc=new Nh(t.dyn_ltree,Mh),t.d_desc=new Nh(t.dyn_dtree,Oh),t.bl_desc=new Nh(t.bl_tree,Dh),t.bi_buf=0,t.bi_valid=0,Gh(t)},_tr_stored_block:Zh,_tr_flush_block:Jh,_tr_tally:td,_tr_align:t=>{Bh(t,2,3),jh(t,256,Ah),(t=>{16===t.bi_valid?(Uh(t,t.bi_buf),t.bi_buf=0,t.bi_valid=0):t.bi_valid>=8&&(t.pending_buf[t.pending++]=255&t.bi_buf,t.bi_buf>>=8,t.bi_valid-=8)})(t)}};var rd=(t,e,r,n)=>{let i=65535&t,s=t>>>16&65535,a=0;for(;0!==r;){a=r>2e3?2e3:r,r-=a;do{i=i+e[n++]|0,s=s+i|0}while(--a);i%=65521,s%=65521}return i|s<<16};const nd=new Uint32Array((()=>{let t,e=[];for(var r=0;r<256;r++){t=r;for(var n=0;n<8;n++)t=1&t?3988292384^t>>>1:t>>>1;e[r]=t}return e})());var id=(t,e,r,n)=>{const i=nd,s=n+r;t^=-1;for(let a=n;a<s;a++)t=t>>>8^i[255&(t^e[a])];return-1^t},sd={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},ad={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8};const{_tr_init:od,_tr_stored_block:ld,_tr_flush_block:cd,_tr_tally:ud,_tr_align:hd}=ed,{Z_NO_FLUSH:dd,Z_PARTIAL_FLUSH:fd,Z_FULL_FLUSH:pd,Z_FINISH:gd,Z_BLOCK:md,Z_OK:yd,Z_STREAM_END:vd,Z_STREAM_ERROR:bd,Z_DATA_ERROR:_d,Z_BUF_ERROR:wd,Z_DEFAULT_COMPRESSION:Ed,Z_FILTERED:Sd,Z_HUFFMAN_ONLY:Td,Z_RLE:kd,Z_FIXED:Ad,Z_DEFAULT_STRATEGY:xd,Z_UNKNOWN:Id,Z_DEFLATED:Rd}=ad,Ld=258,Pd=262,Cd=42,Md=113,Od=666,Dd=(t,e)=>(t.msg=sd[e],e),Nd=t=>2*t-(t>4?9:0),Fd=t=>{let e=t.length;for(;--e>=0;)t[e]=0},Ud=t=>{let e,r,n,i=t.w_size;e=t.hash_size,n=e;do{r=t.head[--n],t.head[n]=r>=i?r-i:0}while(--e);e=i,n=e;do{r=t.prev[--n],t.prev[n]=r>=i?r-i:0}while(--e)};let Bd=(t,e,r)=>(e<<t.hash_shift^r)&t.hash_mask;const jd=t=>{const e=t.state;let r=e.pending;r>t.avail_out&&(r=t.avail_out),0!==r&&(t.output.set(e.pending_buf.subarray(e.pending_out,e.pending_out+r),t.next_out),t.next_out+=r,e.pending_out+=r,t.total_out+=r,t.avail_out-=r,e.pending-=r,0===e.pending&&(e.pending_out=0))},zd=(t,e)=>{cd(t,t.block_start>=0?t.block_start:-1,t.strstart-t.block_start,e),t.block_start=t.strstart,jd(t.strm)},Wd=(t,e)=>{t.pending_buf[t.pending++]=e},Gd=(t,e)=>{t.pending_buf[t.pending++]=e>>>8&255,t.pending_buf[t.pending++]=255&e},Vd=(t,e,r,n)=>{let i=t.avail_in;return i>n&&(i=n),0===i?0:(t.avail_in-=i,e.set(t.input.subarray(t.next_in,t.next_in+i),r),1===t.state.wrap?t.adler=rd(t.adler,e,i,r):2===t.state.wrap&&(t.adler=id(t.adler,e,i,r)),t.next_in+=i,t.total_in+=i,i)},Hd=(t,e)=>{let r,n,i=t.max_chain_length,s=t.strstart,a=t.prev_length,o=t.nice_match;const l=t.strstart>t.w_size-Pd?t.strstart-(t.w_size-Pd):0,c=t.window,u=t.w_mask,h=t.prev,d=t.strstart+Ld;let f=c[s+a-1],p=c[s+a];t.prev_length>=t.good_match&&(i>>=2),o>t.lookahead&&(o=t.lookahead);do{if(r=e,c[r+a]===p&&c[r+a-1]===f&&c[r]===c[s]&&c[++r]===c[s+1]){s+=2,r++;do{}while(c[++s]===c[++r]&&c[++s]===c[++r]&&c[++s]===c[++r]&&c[++s]===c[++r]&&c[++s]===c[++r]&&c[++s]===c[++r]&&c[++s]===c[++r]&&c[++s]===c[++r]&&s<d);if(n=Ld-(d-s),s=d-Ld,n>a){if(t.match_start=e,a=n,n>=o)break;f=c[s+a-1],p=c[s+a]}}}while((e=h[e&u])>l&&0!==--i);return a<=t.lookahead?a:t.lookahead},Kd=t=>{const e=t.w_size;let r,n,i;do{if(n=t.window_size-t.lookahead-t.strstart,t.strstart>=e+(e-Pd)&&(t.window.set(t.window.subarray(e,e+e-n),0),t.match_start-=e,t.strstart-=e,t.block_start-=e,t.insert>t.strstart&&(t.insert=t.strstart),Ud(t),n+=e),0===t.strm.avail_in)break;if(r=Vd(t.strm,t.window,t.strstart+t.lookahead,n),t.lookahead+=r,t.lookahead+t.insert>=3)for(i=t.strstart-t.insert,t.ins_h=t.window[i],t.ins_h=Bd(t,t.ins_h,t.window[i+1]);t.insert&&(t.ins_h=Bd(t,t.ins_h,t.window[i+3-1]),t.prev[i&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=i,i++,t.insert--,!(t.lookahead+t.insert<3)););}while(t.lookahead<Pd&&0!==t.strm.avail_in)},qd=(t,e)=>{let r,n,i,s=t.pending_buf_size-5>t.w_size?t.w_size:t.pending_buf_size-5,a=0,o=t.strm.avail_in;do{if(r=65535,i=t.bi_valid+42>>3,t.strm.avail_out<i)break;if(i=t.strm.avail_out-i,n=t.strstart-t.block_start,r>n+t.strm.avail_in&&(r=n+t.strm.avail_in),r>i&&(r=i),r<s&&(0===r&&e!==gd||e===dd||r!==n+t.strm.avail_in))break;a=e===gd&&r===n+t.strm.avail_in?1:0,ld(t,0,0,a),t.pending_buf[t.pending-4]=r,t.pending_buf[t.pending-3]=r>>8,t.pending_buf[t.pending-2]=~r,t.pending_buf[t.pending-1]=~r>>8,jd(t.strm),n&&(n>r&&(n=r),t.strm.output.set(t.window.subarray(t.block_start,t.block_start+n),t.strm.next_out),t.strm.next_out+=n,t.strm.avail_out-=n,t.strm.total_out+=n,t.block_start+=n,r-=n),r&&(Vd(t.strm,t.strm.output,t.strm.next_out,r),t.strm.next_out+=r,t.strm.avail_out-=r,t.strm.total_out+=r)}while(0===a);return o-=t.strm.avail_in,o&&(o>=t.w_size?(t.matches=2,t.window.set(t.strm.input.subarray(t.strm.next_in-t.w_size,t.strm.next_in),0),t.strstart=t.w_size,t.insert=t.strstart):(t.window_size-t.strstart<=o&&(t.strstart-=t.w_size,t.window.set(t.window.subarray(t.w_size,t.w_size+t.strstart),0),t.matches<2&&t.matches++,t.insert>t.strstart&&(t.insert=t.strstart)),t.window.set(t.strm.input.subarray(t.strm.next_in-o,t.strm.next_in),t.strstart),t.strstart+=o,t.insert+=o>t.w_size-t.insert?t.w_size-t.insert:o),t.block_start=t.strstart),t.high_water<t.strstart&&(t.high_water=t.strstart),a?4:e!==dd&&e!==gd&&0===t.strm.avail_in&&t.strstart===t.block_start?2:(i=t.window_size-t.strstart,t.strm.avail_in>i&&t.block_start>=t.w_size&&(t.block_start-=t.w_size,t.strstart-=t.w_size,t.window.set(t.window.subarray(t.w_size,t.w_size+t.strstart),0),t.matches<2&&t.matches++,i+=t.w_size,t.insert>t.strstart&&(t.insert=t.strstart)),i>t.strm.avail_in&&(i=t.strm.avail_in),i&&(Vd(t.strm,t.window,t.strstart,i),t.strstart+=i,t.insert+=i>t.w_size-t.insert?t.w_size-t.insert:i),t.high_water<t.strstart&&(t.high_water=t.strstart),i=t.bi_valid+42>>3,i=t.pending_buf_size-i>65535?65535:t.pending_buf_size-i,s=i>t.w_size?t.w_size:i,n=t.strstart-t.block_start,(n>=s||(n||e===gd)&&e!==dd&&0===t.strm.avail_in&&n<=i)&&(r=n>i?i:n,a=e===gd&&0===t.strm.avail_in&&r===n?1:0,ld(t,t.block_start,r,a),t.block_start+=r,jd(t.strm)),a?3:1)},Yd=(t,e)=>{let r,n;for(;;){if(t.lookahead<Pd){if(Kd(t),t.lookahead<Pd&&e===dd)return 1;if(0===t.lookahead)break}if(r=0,t.lookahead>=3&&(t.ins_h=Bd(t,t.ins_h,t.window[t.strstart+3-1]),r=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),0!==r&&t.strstart-r<=t.w_size-Pd&&(t.match_length=Hd(t,r)),t.match_length>=3)if(n=ud(t,t.strstart-t.match_start,t.match_length-3),t.lookahead-=t.match_length,t.match_length<=t.max_lazy_match&&t.lookahead>=3){t.match_length--;do{t.strstart++,t.ins_h=Bd(t,t.ins_h,t.window[t.strstart+3-1]),r=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart}while(0!==--t.match_length);t.strstart++}else t.strstart+=t.match_length,t.match_length=0,t.ins_h=t.window[t.strstart],t.ins_h=Bd(t,t.ins_h,t.window[t.strstart+1]);else n=ud(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++;if(n&&(zd(t,!1),0===t.strm.avail_out))return 1}return t.insert=t.strstart<2?t.strstart:2,e===gd?(zd(t,!0),0===t.strm.avail_out?3:4):t.sym_next&&(zd(t,!1),0===t.strm.avail_out)?1:2},Qd=(t,e)=>{let r,n,i;for(;;){if(t.lookahead<Pd){if(Kd(t),t.lookahead<Pd&&e===dd)return 1;if(0===t.lookahead)break}if(r=0,t.lookahead>=3&&(t.ins_h=Bd(t,t.ins_h,t.window[t.strstart+3-1]),r=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),t.prev_length=t.match_length,t.prev_match=t.match_start,t.match_length=2,0!==r&&t.prev_length<t.max_lazy_match&&t.strstart-r<=t.w_size-Pd&&(t.match_length=Hd(t,r),t.match_length<=5&&(t.strategy===Sd||3===t.match_length&&t.strstart-t.match_start>4096)&&(t.match_length=2)),t.prev_length>=3&&t.match_length<=t.prev_length){i=t.strstart+t.lookahead-3,n=ud(t,t.strstart-1-t.prev_match,t.prev_length-3),t.lookahead-=t.prev_length-1,t.prev_length-=2;do{++t.strstart<=i&&(t.ins_h=Bd(t,t.ins_h,t.window[t.strstart+3-1]),r=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart)}while(0!==--t.prev_length);if(t.match_available=0,t.match_length=2,t.strstart++,n&&(zd(t,!1),0===t.strm.avail_out))return 1}else if(t.match_available){if(n=ud(t,0,t.window[t.strstart-1]),n&&zd(t,!1),t.strstart++,t.lookahead--,0===t.strm.avail_out)return 1}else t.match_available=1,t.strstart++,t.lookahead--}return t.match_available&&(n=ud(t,0,t.window[t.strstart-1]),t.match_available=0),t.insert=t.strstart<2?t.strstart:2,e===gd?(zd(t,!0),0===t.strm.avail_out?3:4):t.sym_next&&(zd(t,!1),0===t.strm.avail_out)?1:2};function Xd(t,e,r,n,i){this.good_length=t,this.max_lazy=e,this.nice_length=r,this.max_chain=n,this.func=i}const $d=[new Xd(0,0,0,0,qd),new Xd(4,4,8,4,Yd),new Xd(4,5,16,8,Yd),new Xd(4,6,32,32,Yd),new Xd(4,4,16,16,Qd),new Xd(8,16,32,32,Qd),new Xd(8,16,128,128,Qd),new Xd(8,32,128,256,Qd),new Xd(32,128,258,1024,Qd),new Xd(32,258,258,4096,Qd)];function Zd(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=Rd,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(1146),this.dyn_dtree=new Uint16Array(122),this.bl_tree=new Uint16Array(78),Fd(this.dyn_ltree),Fd(this.dyn_dtree),Fd(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(16),this.heap=new Uint16Array(573),Fd(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(573),Fd(this.depth),this.sym_buf=0,this.lit_bufsize=0,this.sym_next=0,this.sym_end=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const Jd=t=>{if(!t)return 1;const e=t.state;return!e||e.strm!==t||e.status!==Cd&&57!==e.status&&69!==e.status&&73!==e.status&&91!==e.status&&103!==e.status&&e.status!==Md&&e.status!==Od?1:0},tf=t=>{if(Jd(t))return Dd(t,bd);t.total_in=t.total_out=0,t.data_type=Id;const e=t.state;return e.pending=0,e.pending_out=0,e.wrap<0&&(e.wrap=-e.wrap),e.status=2===e.wrap?57:e.wrap?Cd:Md,t.adler=2===e.wrap?0:1,e.last_flush=-2,od(e),yd},ef=t=>{const e=tf(t);var r;return e===yd&&((r=t.state).window_size=2*r.w_size,Fd(r.head),r.max_lazy_match=$d[r.level].max_lazy,r.good_match=$d[r.level].good_length,r.nice_match=$d[r.level].nice_length,r.max_chain_length=$d[r.level].max_chain,r.strstart=0,r.block_start=0,r.lookahead=0,r.insert=0,r.match_length=r.prev_length=2,r.match_available=0,r.ins_h=0),e},rf=(t,e,r,n,i,s)=>{if(!t)return bd;let a=1;if(e===Ed&&(e=6),n<0?(a=0,n=-n):n>15&&(a=2,n-=16),i<1||i>9||r!==Rd||n<8||n>15||e<0||e>9||s<0||s>Ad||8===n&&1!==a)return Dd(t,bd);8===n&&(n=9);const o=new Zd;return t.state=o,o.strm=t,o.status=Cd,o.wrap=a,o.gzhead=null,o.w_bits=n,o.w_size=1<<o.w_bits,o.w_mask=o.w_size-1,o.hash_bits=i+7,o.hash_size=1<<o.hash_bits,o.hash_mask=o.hash_size-1,o.hash_shift=~~((o.hash_bits+3-1)/3),o.window=new Uint8Array(2*o.w_size),o.head=new Uint16Array(o.hash_size),o.prev=new Uint16Array(o.w_size),o.lit_bufsize=1<<i+6,o.pending_buf_size=4*o.lit_bufsize,o.pending_buf=new Uint8Array(o.pending_buf_size),o.sym_buf=o.lit_bufsize,o.sym_end=3*(o.lit_bufsize-1),o.level=e,o.strategy=s,o.method=r,ef(t)};var nf={deflateInit:(t,e)=>rf(t,e,Rd,15,8,xd),deflateInit2:rf,deflateReset:ef,deflateResetKeep:tf,deflateSetHeader:(t,e)=>Jd(t)||2!==t.state.wrap?bd:(t.state.gzhead=e,yd),deflate:(t,e)=>{if(Jd(t)||e>md||e<0)return t?Dd(t,bd):bd;const r=t.state;if(!t.output||0!==t.avail_in&&!t.input||r.status===Od&&e!==gd)return Dd(t,0===t.avail_out?wd:bd);const n=r.last_flush;if(r.last_flush=e,0!==r.pending){if(jd(t),0===t.avail_out)return r.last_flush=-1,yd}else if(0===t.avail_in&&Nd(e)<=Nd(n)&&e!==gd)return Dd(t,wd);if(r.status===Od&&0!==t.avail_in)return Dd(t,wd);if(r.status===Cd&&0===r.wrap&&(r.status=Md),r.status===Cd){let e=Rd+(r.w_bits-8<<4)<<8,n=-1;if(n=r.strategy>=Td||r.level<2?0:r.level<6?1:6===r.level?2:3,e|=n<<6,0!==r.strstart&&(e|=32),e+=31-e%31,Gd(r,e),0!==r.strstart&&(Gd(r,t.adler>>>16),Gd(r,65535&t.adler)),t.adler=1,r.status=Md,jd(t),0!==r.pending)return r.last_flush=-1,yd}if(57===r.status)if(t.adler=0,Wd(r,31),Wd(r,139),Wd(r,8),r.gzhead)Wd(r,(r.gzhead.text?1:0)+(r.gzhead.hcrc?2:0)+(r.gzhead.extra?4:0)+(r.gzhead.name?8:0)+(r.gzhead.comment?16:0)),Wd(r,255&r.gzhead.time),Wd(r,r.gzhead.time>>8&255),Wd(r,r.gzhead.time>>16&255),Wd(r,r.gzhead.time>>24&255),Wd(r,9===r.level?2:r.strategy>=Td||r.level<2?4:0),Wd(r,255&r.gzhead.os),r.gzhead.extra&&r.gzhead.extra.length&&(Wd(r,255&r.gzhead.extra.length),Wd(r,r.gzhead.extra.length>>8&255)),r.gzhead.hcrc&&(t.adler=id(t.adler,r.pending_buf,r.pending,0)),r.gzindex=0,r.status=69;else if(Wd(r,0),Wd(r,0),Wd(r,0),Wd(r,0),Wd(r,0),Wd(r,9===r.level?2:r.strategy>=Td||r.level<2?4:0),Wd(r,3),r.status=Md,jd(t),0!==r.pending)return r.last_flush=-1,yd;if(69===r.status){if(r.gzhead.extra){let e=r.pending,n=(65535&r.gzhead.extra.length)-r.gzindex;for(;r.pending+n>r.pending_buf_size;){let i=r.pending_buf_size-r.pending;if(r.pending_buf.set(r.gzhead.extra.subarray(r.gzindex,r.gzindex+i),r.pending),r.pending=r.pending_buf_size,r.gzhead.hcrc&&r.pending>e&&(t.adler=id(t.adler,r.pending_buf,r.pending-e,e)),r.gzindex+=i,jd(t),0!==r.pending)return r.last_flush=-1,yd;e=0,n-=i}let i=new Uint8Array(r.gzhead.extra);r.pending_buf.set(i.subarray(r.gzindex,r.gzindex+n),r.pending),r.pending+=n,r.gzhead.hcrc&&r.pending>e&&(t.adler=id(t.adler,r.pending_buf,r.pending-e,e)),r.gzindex=0}r.status=73}if(73===r.status){if(r.gzhead.name){let e,n=r.pending;do{if(r.pending===r.pending_buf_size){if(r.gzhead.hcrc&&r.pending>n&&(t.adler=id(t.adler,r.pending_buf,r.pending-n,n)),jd(t),0!==r.pending)return r.last_flush=-1,yd;n=0}e=r.gzindex<r.gzhead.name.length?255&r.gzhead.name.charCodeAt(r.gzindex++):0,Wd(r,e)}while(0!==e);r.gzhead.hcrc&&r.pending>n&&(t.adler=id(t.adler,r.pending_buf,r.pending-n,n)),r.gzindex=0}r.status=91}if(91===r.status){if(r.gzhead.comment){let e,n=r.pending;do{if(r.pending===r.pending_buf_size){if(r.gzhead.hcrc&&r.pending>n&&(t.adler=id(t.adler,r.pending_buf,r.pending-n,n)),jd(t),0!==r.pending)return r.last_flush=-1,yd;n=0}e=r.gzindex<r.gzhead.comment.length?255&r.gzhead.comment.charCodeAt(r.gzindex++):0,Wd(r,e)}while(0!==e);r.gzhead.hcrc&&r.pending>n&&(t.adler=id(t.adler,r.pending_buf,r.pending-n,n))}r.status=103}if(103===r.status){if(r.gzhead.hcrc){if(r.pending+2>r.pending_buf_size&&(jd(t),0!==r.pending))return r.last_flush=-1,yd;Wd(r,255&t.adler),Wd(r,t.adler>>8&255),t.adler=0}if(r.status=Md,jd(t),0!==r.pending)return r.last_flush=-1,yd}if(0!==t.avail_in||0!==r.lookahead||e!==dd&&r.status!==Od){let n=0===r.level?qd(r,e):r.strategy===Td?((t,e)=>{let r;for(;;){if(0===t.lookahead&&(Kd(t),0===t.lookahead)){if(e===dd)return 1;break}if(t.match_length=0,r=ud(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++,r&&(zd(t,!1),0===t.strm.avail_out))return 1}return t.insert=0,e===gd?(zd(t,!0),0===t.strm.avail_out?3:4):t.sym_next&&(zd(t,!1),0===t.strm.avail_out)?1:2})(r,e):r.strategy===kd?((t,e)=>{let r,n,i,s;const a=t.window;for(;;){if(t.lookahead<=Ld){if(Kd(t),t.lookahead<=Ld&&e===dd)return 1;if(0===t.lookahead)break}if(t.match_length=0,t.lookahead>=3&&t.strstart>0&&(i=t.strstart-1,n=a[i],n===a[++i]&&n===a[++i]&&n===a[++i])){s=t.strstart+Ld;do{}while(n===a[++i]&&n===a[++i]&&n===a[++i]&&n===a[++i]&&n===a[++i]&&n===a[++i]&&n===a[++i]&&n===a[++i]&&i<s);t.match_length=Ld-(s-i),t.match_length>t.lookahead&&(t.match_length=t.lookahead)}if(t.match_length>=3?(r=ud(t,1,t.match_length-3),t.lookahead-=t.match_length,t.strstart+=t.match_length,t.match_length=0):(r=ud(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++),r&&(zd(t,!1),0===t.strm.avail_out))return 1}return t.insert=0,e===gd?(zd(t,!0),0===t.strm.avail_out?3:4):t.sym_next&&(zd(t,!1),0===t.strm.avail_out)?1:2})(r,e):$d[r.level].func(r,e);if(3!==n&&4!==n||(r.status=Od),1===n||3===n)return 0===t.avail_out&&(r.last_flush=-1),yd;if(2===n&&(e===fd?hd(r):e!==md&&(ld(r,0,0,!1),e===pd&&(Fd(r.head),0===r.lookahead&&(r.strstart=0,r.block_start=0,r.insert=0))),jd(t),0===t.avail_out))return r.last_flush=-1,yd}return e!==gd?yd:r.wrap<=0?vd:(2===r.wrap?(Wd(r,255&t.adler),Wd(r,t.adler>>8&255),Wd(r,t.adler>>16&255),Wd(r,t.adler>>24&255),Wd(r,255&t.total_in),Wd(r,t.total_in>>8&255),Wd(r,t.total_in>>16&255),Wd(r,t.total_in>>24&255)):(Gd(r,t.adler>>>16),Gd(r,65535&t.adler)),jd(t),r.wrap>0&&(r.wrap=-r.wrap),0!==r.pending?yd:vd)},deflateEnd:t=>{if(Jd(t))return bd;const e=t.state.status;return t.state=null,e===Md?Dd(t,_d):yd},deflateSetDictionary:(t,e)=>{let r=e.length;if(Jd(t))return bd;const n=t.state,i=n.wrap;if(2===i||1===i&&n.status!==Cd||n.lookahead)return bd;if(1===i&&(t.adler=rd(t.adler,e,r,0)),n.wrap=0,r>=n.w_size){0===i&&(Fd(n.head),n.strstart=0,n.block_start=0,n.insert=0);let t=new Uint8Array(n.w_size);t.set(e.subarray(r-n.w_size,r),0),e=t,r=n.w_size}const s=t.avail_in,a=t.next_in,o=t.input;for(t.avail_in=r,t.next_in=0,t.input=e,Kd(n);n.lookahead>=3;){let t=n.strstart,e=n.lookahead-2;do{n.ins_h=Bd(n,n.ins_h,n.window[t+3-1]),n.prev[t&n.w_mask]=n.head[n.ins_h],n.head[n.ins_h]=t,t++}while(--e);n.strstart=t,n.lookahead=2,Kd(n)}return n.strstart+=n.lookahead,n.block_start=n.strstart,n.insert=n.lookahead,n.lookahead=0,n.match_length=n.prev_length=2,n.match_available=0,t.next_in=a,t.input=o,t.avail_in=s,n.wrap=i,yd},deflateInfo:"pako deflate (from Nodeca project)"};const sf=(t,e)=>Object.prototype.hasOwnProperty.call(t,e);var af=function(t){const e=Array.prototype.slice.call(arguments,1);for(;e.length;){const r=e.shift();if(r){if("object"!==typeof r)throw new TypeError(r+"must be non-object");for(const e in r)sf(r,e)&&(t[e]=r[e])}}return t},of=t=>{let e=0;for(let n=0,i=t.length;n<i;n++)e+=t[n].length;const r=new Uint8Array(e);for(let n=0,i=0,s=t.length;n<s;n++){let e=t[n];r.set(e,i),i+=e.length}return r};let lf=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(bA){lf=!1}const cf=new Uint8Array(256);for(let r=0;r<256;r++)cf[r]=r>=252?6:r>=248?5:r>=240?4:r>=224?3:r>=192?2:1;cf[254]=cf[254]=1;var uf=t=>{if("function"===typeof TextEncoder&&TextEncoder.prototype.encode)return(new TextEncoder).encode(t);let e,r,n,i,s,a=t.length,o=0;for(i=0;i<a;i++)r=t.charCodeAt(i),55296===(64512&r)&&i+1<a&&(n=t.charCodeAt(i+1),56320===(64512&n)&&(r=65536+(r-55296<<10)+(n-56320),i++)),o+=r<128?1:r<2048?2:r<65536?3:4;for(e=new Uint8Array(o),s=0,i=0;s<o;i++)r=t.charCodeAt(i),55296===(64512&r)&&i+1<a&&(n=t.charCodeAt(i+1),56320===(64512&n)&&(r=65536+(r-55296<<10)+(n-56320),i++)),r<128?e[s++]=r:r<2048?(e[s++]=192|r>>>6,e[s++]=128|63&r):r<65536?(e[s++]=224|r>>>12,e[s++]=128|r>>>6&63,e[s++]=128|63&r):(e[s++]=240|r>>>18,e[s++]=128|r>>>12&63,e[s++]=128|r>>>6&63,e[s++]=128|63&r);return e},hf=(t,e)=>{const r=e||t.length;if("function"===typeof TextDecoder&&TextDecoder.prototype.decode)return(new TextDecoder).decode(t.subarray(0,e));let n,i;const s=new Array(2*r);for(i=0,n=0;n<r;){let e=t[n++];if(e<128){s[i++]=e;continue}let a=cf[e];if(a>4)s[i++]=65533,n+=a-1;else{for(e&=2===a?31:3===a?15:7;a>1&&n<r;)e=e<<6|63&t[n++],a--;a>1?s[i++]=65533:e<65536?s[i++]=e:(e-=65536,s[i++]=55296|e>>10&1023,s[i++]=56320|1023&e)}}return((t,e)=>{if(e<65534&&t.subarray&&lf)return String.fromCharCode.apply(null,t.length===e?t:t.subarray(0,e));let r="";for(let n=0;n<e;n++)r+=String.fromCharCode(t[n]);return r})(s,i)},df=(t,e)=>{(e=e||t.length)>t.length&&(e=t.length);let r=e-1;for(;r>=0&&128===(192&t[r]);)r--;return r<0||0===r?e:r+cf[t[r]]>e?r:e};var ff=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0};const pf=Object.prototype.toString,{Z_NO_FLUSH:gf,Z_SYNC_FLUSH:mf,Z_FULL_FLUSH:yf,Z_FINISH:vf,Z_OK:bf,Z_STREAM_END:_f,Z_DEFAULT_COMPRESSION:wf,Z_DEFAULT_STRATEGY:Ef,Z_DEFLATED:Sf}=ad;function Tf(t){this.options=af({level:wf,method:Sf,chunkSize:16384,windowBits:15,memLevel:8,strategy:Ef},t||{});let e=this.options;e.raw&&e.windowBits>0?e.windowBits=-e.windowBits:e.gzip&&e.windowBits>0&&e.windowBits<16&&(e.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new ff,this.strm.avail_out=0;let r=nf.deflateInit2(this.strm,e.level,e.method,e.windowBits,e.memLevel,e.strategy);if(r!==bf)throw new Error(sd[r]);if(e.header&&nf.deflateSetHeader(this.strm,e.header),e.dictionary){let t;if(t="string"===typeof e.dictionary?uf(e.dictionary):"[object ArrayBuffer]"===pf.call(e.dictionary)?new Uint8Array(e.dictionary):e.dictionary,r=nf.deflateSetDictionary(this.strm,t),r!==bf)throw new Error(sd[r]);this._dict_set=!0}}function kf(t,e){const r=new Tf(e);if(r.push(t,!0),r.err)throw r.msg||sd[r.err];return r.result}Tf.prototype.push=function(t,e){const r=this.strm,n=this.options.chunkSize;let i,s;if(this.ended)return!1;for(s=e===~~e?e:!0===e?vf:gf,"string"===typeof t?r.input=uf(t):"[object ArrayBuffer]"===pf.call(t)?r.input=new Uint8Array(t):r.input=t,r.next_in=0,r.avail_in=r.input.length;;)if(0===r.avail_out&&(r.output=new Uint8Array(n),r.next_out=0,r.avail_out=n),(s===mf||s===yf)&&r.avail_out<=6)this.onData(r.output.subarray(0,r.next_out)),r.avail_out=0;else{if(i=nf.deflate(r,s),i===_f)return r.next_out>0&&this.onData(r.output.subarray(0,r.next_out)),i=nf.deflateEnd(this.strm),this.onEnd(i),this.ended=!0,i===bf;if(0!==r.avail_out){if(s>0&&r.next_out>0)this.onData(r.output.subarray(0,r.next_out)),r.avail_out=0;else if(0===r.avail_in)break}else this.onData(r.output)}return!0},Tf.prototype.onData=function(t){this.chunks.push(t)},Tf.prototype.onEnd=function(t){t===bf&&(this.result=of(this.chunks)),this.chunks=[],this.err=t,this.msg=this.strm.msg};var Af={Deflate:Tf,deflate:kf,deflateRaw:function(t,e){return(e=e||{}).raw=!0,kf(t,e)},gzip:function(t,e){return(e=e||{}).gzip=!0,kf(t,e)},constants:ad};const xf=16209;var If=function(t,e){let r,n,i,s,a,o,l,c,u,h,d,f,p,g,m,y,v,b,_,w,E,S,T,k;const A=t.state;r=t.next_in,T=t.input,n=r+(t.avail_in-5),i=t.next_out,k=t.output,s=i-(e-t.avail_out),a=i+(t.avail_out-257),o=A.dmax,l=A.wsize,c=A.whave,u=A.wnext,h=A.window,d=A.hold,f=A.bits,p=A.lencode,g=A.distcode,m=(1<<A.lenbits)-1,y=(1<<A.distbits)-1;t:do{f<15&&(d+=T[r++]<<f,f+=8,d+=T[r++]<<f,f+=8),v=p[d&m];e:for(;;){if(b=v>>>24,d>>>=b,f-=b,b=v>>>16&255,0===b)k[i++]=65535&v;else{if(!(16&b)){if(0===(64&b)){v=p[(65535&v)+(d&(1<<b)-1)];continue e}if(32&b){A.mode=16191;break t}t.msg="invalid literal/length code",A.mode=xf;break t}_=65535&v,b&=15,b&&(f<b&&(d+=T[r++]<<f,f+=8),_+=d&(1<<b)-1,d>>>=b,f-=b),f<15&&(d+=T[r++]<<f,f+=8,d+=T[r++]<<f,f+=8),v=g[d&y];r:for(;;){if(b=v>>>24,d>>>=b,f-=b,b=v>>>16&255,!(16&b)){if(0===(64&b)){v=g[(65535&v)+(d&(1<<b)-1)];continue r}t.msg="invalid distance code",A.mode=xf;break t}if(w=65535&v,b&=15,f<b&&(d+=T[r++]<<f,f+=8,f<b&&(d+=T[r++]<<f,f+=8)),w+=d&(1<<b)-1,w>o){t.msg="invalid distance too far back",A.mode=xf;break t}if(d>>>=b,f-=b,b=i-s,w>b){if(b=w-b,b>c&&A.sane){t.msg="invalid distance too far back",A.mode=xf;break t}if(E=0,S=h,0===u){if(E+=l-b,b<_){_-=b;do{k[i++]=h[E++]}while(--b);E=i-w,S=k}}else if(u<b){if(E+=l+u-b,b-=u,b<_){_-=b;do{k[i++]=h[E++]}while(--b);if(E=0,u<_){b=u,_-=b;do{k[i++]=h[E++]}while(--b);E=i-w,S=k}}}else if(E+=u-b,b<_){_-=b;do{k[i++]=h[E++]}while(--b);E=i-w,S=k}for(;_>2;)k[i++]=S[E++],k[i++]=S[E++],k[i++]=S[E++],_-=3;_&&(k[i++]=S[E++],_>1&&(k[i++]=S[E++]))}else{E=i-w;do{k[i++]=k[E++],k[i++]=k[E++],k[i++]=k[E++],_-=3}while(_>2);_&&(k[i++]=k[E++],_>1&&(k[i++]=k[E++]))}break}}break}}while(r<n&&i<a);_=f>>3,r-=_,f-=_<<3,d&=(1<<f)-1,t.next_in=r,t.next_out=i,t.avail_in=r<n?n-r+5:5-(r-n),t.avail_out=i<a?a-i+257:257-(i-a),A.hold=d,A.bits=f};const Rf=15,Lf=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),Pf=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),Cf=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),Mf=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);var Of=(t,e,r,n,i,s,a,o)=>{const l=o.bits;let c,u,h,d,f,p,g=0,m=0,y=0,v=0,b=0,_=0,w=0,E=0,S=0,T=0,k=null;const A=new Uint16Array(16),x=new Uint16Array(16);let I,R,L,P=null;for(g=0;g<=Rf;g++)A[g]=0;for(m=0;m<n;m++)A[e[r+m]]++;for(b=l,v=Rf;v>=1&&0===A[v];v--);if(b>v&&(b=v),0===v)return i[s++]=20971520,i[s++]=20971520,o.bits=1,0;for(y=1;y<v&&0===A[y];y++);for(b<y&&(b=y),E=1,g=1;g<=Rf;g++)if(E<<=1,E-=A[g],E<0)return-1;if(E>0&&(0===t||1!==v))return-1;for(x[1]=0,g=1;g<Rf;g++)x[g+1]=x[g]+A[g];for(m=0;m<n;m++)0!==e[r+m]&&(a[x[e[r+m]]++]=m);if(0===t?(k=P=a,p=20):1===t?(k=Lf,P=Pf,p=257):(k=Cf,P=Mf,p=0),T=0,m=0,g=y,f=s,_=b,w=0,h=-1,S=1<<b,d=S-1,1===t&&S>852||2===t&&S>592)return 1;for(;;){I=g-w,a[m]+1<p?(R=0,L=a[m]):a[m]>=p?(R=P[a[m]-p],L=k[a[m]-p]):(R=96,L=0),c=1<<g-w,u=1<<_,y=u;do{u-=c,i[f+(T>>w)+u]=I<<24|R<<16|L}while(0!==u);for(c=1<<g-1;T&c;)c>>=1;if(0!==c?(T&=c-1,T+=c):T=0,m++,0===--A[g]){if(g===v)break;g=e[r+a[m]]}if(g>b&&(T&d)!==h){for(0===w&&(w=b),f+=y,_=g-w,E=1<<_;_+w<v&&(E-=A[_+w],!(E<=0));)_++,E<<=1;if(S+=1<<_,1===t&&S>852||2===t&&S>592)return 1;h=T&d,i[h]=b<<24|_<<16|f-s}}return 0!==T&&(i[f+T]=g-w<<24|64<<16),o.bits=b,0};const{Z_FINISH:Df,Z_BLOCK:Nf,Z_TREES:Ff,Z_OK:Uf,Z_STREAM_END:Bf,Z_NEED_DICT:jf,Z_STREAM_ERROR:zf,Z_DATA_ERROR:Wf,Z_MEM_ERROR:Gf,Z_BUF_ERROR:Vf,Z_DEFLATED:Hf}=ad,Kf=16180,qf=16190,Yf=16191,Qf=16192,Xf=16194,$f=16199,Zf=16200,Jf=16206,tp=16209,ep=t=>(t>>>24&255)+(t>>>8&65280)+((65280&t)<<8)+((255&t)<<24);function rp(){this.strm=null,this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const np=t=>{if(!t)return 1;const e=t.state;return!e||e.strm!==t||e.mode<Kf||e.mode>16211?1:0},ip=t=>{if(np(t))return zf;const e=t.state;return t.total_in=t.total_out=e.total=0,t.msg="",e.wrap&&(t.adler=1&e.wrap),e.mode=Kf,e.last=0,e.havedict=0,e.flags=-1,e.dmax=32768,e.head=null,e.hold=0,e.bits=0,e.lencode=e.lendyn=new Int32Array(852),e.distcode=e.distdyn=new Int32Array(592),e.sane=1,e.back=-1,Uf},sp=t=>{if(np(t))return zf;const e=t.state;return e.wsize=0,e.whave=0,e.wnext=0,ip(t)},ap=(t,e)=>{let r;if(np(t))return zf;const n=t.state;return e<0?(r=0,e=-e):(r=5+(e>>4),e<48&&(e&=15)),e&&(e<8||e>15)?zf:(null!==n.window&&n.wbits!==e&&(n.window=null),n.wrap=r,n.wbits=e,sp(t))},op=(t,e)=>{if(!t)return zf;const r=new rp;t.state=r,r.strm=t,r.window=null,r.mode=Kf;const n=ap(t,e);return n!==Uf&&(t.state=null),n};let lp,cp,up=!0;const hp=t=>{if(up){lp=new Int32Array(512),cp=new Int32Array(32);let e=0;for(;e<144;)t.lens[e++]=8;for(;e<256;)t.lens[e++]=9;for(;e<280;)t.lens[e++]=7;for(;e<288;)t.lens[e++]=8;for(Of(1,t.lens,0,288,lp,0,t.work,{bits:9}),e=0;e<32;)t.lens[e++]=5;Of(2,t.lens,0,32,cp,0,t.work,{bits:5}),up=!1}t.lencode=lp,t.lenbits=9,t.distcode=cp,t.distbits=5},dp=(t,e,r,n)=>{let i;const s=t.state;return null===s.window&&(s.wsize=1<<s.wbits,s.wnext=0,s.whave=0,s.window=new Uint8Array(s.wsize)),n>=s.wsize?(s.window.set(e.subarray(r-s.wsize,r),0),s.wnext=0,s.whave=s.wsize):(i=s.wsize-s.wnext,i>n&&(i=n),s.window.set(e.subarray(r-n,r-n+i),s.wnext),(n-=i)?(s.window.set(e.subarray(r-n,r),0),s.wnext=n,s.whave=s.wsize):(s.wnext+=i,s.wnext===s.wsize&&(s.wnext=0),s.whave<s.wsize&&(s.whave+=i))),0};var fp={inflateReset:sp,inflateReset2:ap,inflateResetKeep:ip,inflateInit:t=>op(t,15),inflateInit2:op,inflate:(t,e)=>{let r,n,i,s,a,o,l,c,u,h,d,f,p,g,m,y,v,b,_,w,E,S,T=0;const k=new Uint8Array(4);let A,x;const I=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(np(t)||!t.output||!t.input&&0!==t.avail_in)return zf;r=t.state,r.mode===Yf&&(r.mode=Qf),a=t.next_out,i=t.output,l=t.avail_out,s=t.next_in,n=t.input,o=t.avail_in,c=r.hold,u=r.bits,h=o,d=l,S=Uf;t:for(;;)switch(r.mode){case Kf:if(0===r.wrap){r.mode=Qf;break}for(;u<16;){if(0===o)break t;o--,c+=n[s++]<<u,u+=8}if(2&r.wrap&&35615===c){0===r.wbits&&(r.wbits=15),r.check=0,k[0]=255&c,k[1]=c>>>8&255,r.check=id(r.check,k,2,0),c=0,u=0,r.mode=16181;break}if(r.head&&(r.head.done=!1),!(1&r.wrap)||(((255&c)<<8)+(c>>8))%31){t.msg="incorrect header check",r.mode=tp;break}if((15&c)!==Hf){t.msg="unknown compression method",r.mode=tp;break}if(c>>>=4,u-=4,E=8+(15&c),0===r.wbits&&(r.wbits=E),E>15||E>r.wbits){t.msg="invalid window size",r.mode=tp;break}r.dmax=1<<r.wbits,r.flags=0,t.adler=r.check=1,r.mode=512&c?16189:Yf,c=0,u=0;break;case 16181:for(;u<16;){if(0===o)break t;o--,c+=n[s++]<<u,u+=8}if(r.flags=c,(255&r.flags)!==Hf){t.msg="unknown compression method",r.mode=tp;break}if(57344&r.flags){t.msg="unknown header flags set",r.mode=tp;break}r.head&&(r.head.text=c>>8&1),512&r.flags&&4&r.wrap&&(k[0]=255&c,k[1]=c>>>8&255,r.check=id(r.check,k,2,0)),c=0,u=0,r.mode=16182;case 16182:for(;u<32;){if(0===o)break t;o--,c+=n[s++]<<u,u+=8}r.head&&(r.head.time=c),512&r.flags&&4&r.wrap&&(k[0]=255&c,k[1]=c>>>8&255,k[2]=c>>>16&255,k[3]=c>>>24&255,r.check=id(r.check,k,4,0)),c=0,u=0,r.mode=16183;case 16183:for(;u<16;){if(0===o)break t;o--,c+=n[s++]<<u,u+=8}r.head&&(r.head.xflags=255&c,r.head.os=c>>8),512&r.flags&&4&r.wrap&&(k[0]=255&c,k[1]=c>>>8&255,r.check=id(r.check,k,2,0)),c=0,u=0,r.mode=16184;case 16184:if(1024&r.flags){for(;u<16;){if(0===o)break t;o--,c+=n[s++]<<u,u+=8}r.length=c,r.head&&(r.head.extra_len=c),512&r.flags&&4&r.wrap&&(k[0]=255&c,k[1]=c>>>8&255,r.check=id(r.check,k,2,0)),c=0,u=0}else r.head&&(r.head.extra=null);r.mode=16185;case 16185:if(1024&r.flags&&(f=r.length,f>o&&(f=o),f&&(r.head&&(E=r.head.extra_len-r.length,r.head.extra||(r.head.extra=new Uint8Array(r.head.extra_len)),r.head.extra.set(n.subarray(s,s+f),E)),512&r.flags&&4&r.wrap&&(r.check=id(r.check,n,f,s)),o-=f,s+=f,r.length-=f),r.length))break t;r.length=0,r.mode=16186;case 16186:if(2048&r.flags){if(0===o)break t;f=0;do{E=n[s+f++],r.head&&E&&r.length<65536&&(r.head.name+=String.fromCharCode(E))}while(E&&f<o);if(512&r.flags&&4&r.wrap&&(r.check=id(r.check,n,f,s)),o-=f,s+=f,E)break t}else r.head&&(r.head.name=null);r.length=0,r.mode=16187;case 16187:if(4096&r.flags){if(0===o)break t;f=0;do{E=n[s+f++],r.head&&E&&r.length<65536&&(r.head.comment+=String.fromCharCode(E))}while(E&&f<o);if(512&r.flags&&4&r.wrap&&(r.check=id(r.check,n,f,s)),o-=f,s+=f,E)break t}else r.head&&(r.head.comment=null);r.mode=16188;case 16188:if(512&r.flags){for(;u<16;){if(0===o)break t;o--,c+=n[s++]<<u,u+=8}if(4&r.wrap&&c!==(65535&r.check)){t.msg="header crc mismatch",r.mode=tp;break}c=0,u=0}r.head&&(r.head.hcrc=r.flags>>9&1,r.head.done=!0),t.adler=r.check=0,r.mode=Yf;break;case 16189:for(;u<32;){if(0===o)break t;o--,c+=n[s++]<<u,u+=8}t.adler=r.check=ep(c),c=0,u=0,r.mode=qf;case qf:if(0===r.havedict)return t.next_out=a,t.avail_out=l,t.next_in=s,t.avail_in=o,r.hold=c,r.bits=u,jf;t.adler=r.check=1,r.mode=Yf;case Yf:if(e===Nf||e===Ff)break t;case Qf:if(r.last){c>>>=7&u,u-=7&u,r.mode=Jf;break}for(;u<3;){if(0===o)break t;o--,c+=n[s++]<<u,u+=8}switch(r.last=1&c,c>>>=1,u-=1,3&c){case 0:r.mode=16193;break;case 1:if(hp(r),r.mode=$f,e===Ff){c>>>=2,u-=2;break t}break;case 2:r.mode=16196;break;case 3:t.msg="invalid block type",r.mode=tp}c>>>=2,u-=2;break;case 16193:for(c>>>=7&u,u-=7&u;u<32;){if(0===o)break t;o--,c+=n[s++]<<u,u+=8}if((65535&c)!==(c>>>16^65535)){t.msg="invalid stored block lengths",r.mode=tp;break}if(r.length=65535&c,c=0,u=0,r.mode=Xf,e===Ff)break t;case Xf:r.mode=16195;case 16195:if(f=r.length,f){if(f>o&&(f=o),f>l&&(f=l),0===f)break t;i.set(n.subarray(s,s+f),a),o-=f,s+=f,l-=f,a+=f,r.length-=f;break}r.mode=Yf;break;case 16196:for(;u<14;){if(0===o)break t;o--,c+=n[s++]<<u,u+=8}if(r.nlen=257+(31&c),c>>>=5,u-=5,r.ndist=1+(31&c),c>>>=5,u-=5,r.ncode=4+(15&c),c>>>=4,u-=4,r.nlen>286||r.ndist>30){t.msg="too many length or distance symbols",r.mode=tp;break}r.have=0,r.mode=16197;case 16197:for(;r.have<r.ncode;){for(;u<3;){if(0===o)break t;o--,c+=n[s++]<<u,u+=8}r.lens[I[r.have++]]=7&c,c>>>=3,u-=3}for(;r.have<19;)r.lens[I[r.have++]]=0;if(r.lencode=r.lendyn,r.lenbits=7,A={bits:r.lenbits},S=Of(0,r.lens,0,19,r.lencode,0,r.work,A),r.lenbits=A.bits,S){t.msg="invalid code lengths set",r.mode=tp;break}r.have=0,r.mode=16198;case 16198:for(;r.have<r.nlen+r.ndist;){for(;T=r.lencode[c&(1<<r.lenbits)-1],m=T>>>24,y=T>>>16&255,v=65535&T,!(m<=u);){if(0===o)break t;o--,c+=n[s++]<<u,u+=8}if(v<16)c>>>=m,u-=m,r.lens[r.have++]=v;else{if(16===v){for(x=m+2;u<x;){if(0===o)break t;o--,c+=n[s++]<<u,u+=8}if(c>>>=m,u-=m,0===r.have){t.msg="invalid bit length repeat",r.mode=tp;break}E=r.lens[r.have-1],f=3+(3&c),c>>>=2,u-=2}else if(17===v){for(x=m+3;u<x;){if(0===o)break t;o--,c+=n[s++]<<u,u+=8}c>>>=m,u-=m,E=0,f=3+(7&c),c>>>=3,u-=3}else{for(x=m+7;u<x;){if(0===o)break t;o--,c+=n[s++]<<u,u+=8}c>>>=m,u-=m,E=0,f=11+(127&c),c>>>=7,u-=7}if(r.have+f>r.nlen+r.ndist){t.msg="invalid bit length repeat",r.mode=tp;break}for(;f--;)r.lens[r.have++]=E}}if(r.mode===tp)break;if(0===r.lens[256]){t.msg="invalid code -- missing end-of-block",r.mode=tp;break}if(r.lenbits=9,A={bits:r.lenbits},S=Of(1,r.lens,0,r.nlen,r.lencode,0,r.work,A),r.lenbits=A.bits,S){t.msg="invalid literal/lengths set",r.mode=tp;break}if(r.distbits=6,r.distcode=r.distdyn,A={bits:r.distbits},S=Of(2,r.lens,r.nlen,r.ndist,r.distcode,0,r.work,A),r.distbits=A.bits,S){t.msg="invalid distances set",r.mode=tp;break}if(r.mode=$f,e===Ff)break t;case $f:r.mode=Zf;case Zf:if(o>=6&&l>=258){t.next_out=a,t.avail_out=l,t.next_in=s,t.avail_in=o,r.hold=c,r.bits=u,If(t,d),a=t.next_out,i=t.output,l=t.avail_out,s=t.next_in,n=t.input,o=t.avail_in,c=r.hold,u=r.bits,r.mode===Yf&&(r.back=-1);break}for(r.back=0;T=r.lencode[c&(1<<r.lenbits)-1],m=T>>>24,y=T>>>16&255,v=65535&T,!(m<=u);){if(0===o)break t;o--,c+=n[s++]<<u,u+=8}if(y&&0===(240&y)){for(b=m,_=y,w=v;T=r.lencode[w+((c&(1<<b+_)-1)>>b)],m=T>>>24,y=T>>>16&255,v=65535&T,!(b+m<=u);){if(0===o)break t;o--,c+=n[s++]<<u,u+=8}c>>>=b,u-=b,r.back+=b}if(c>>>=m,u-=m,r.back+=m,r.length=v,0===y){r.mode=16205;break}if(32&y){r.back=-1,r.mode=Yf;break}if(64&y){t.msg="invalid literal/length code",r.mode=tp;break}r.extra=15&y,r.mode=16201;case 16201:if(r.extra){for(x=r.extra;u<x;){if(0===o)break t;o--,c+=n[s++]<<u,u+=8}r.length+=c&(1<<r.extra)-1,c>>>=r.extra,u-=r.extra,r.back+=r.extra}r.was=r.length,r.mode=16202;case 16202:for(;T=r.distcode[c&(1<<r.distbits)-1],m=T>>>24,y=T>>>16&255,v=65535&T,!(m<=u);){if(0===o)break t;o--,c+=n[s++]<<u,u+=8}if(0===(240&y)){for(b=m,_=y,w=v;T=r.distcode[w+((c&(1<<b+_)-1)>>b)],m=T>>>24,y=T>>>16&255,v=65535&T,!(b+m<=u);){if(0===o)break t;o--,c+=n[s++]<<u,u+=8}c>>>=b,u-=b,r.back+=b}if(c>>>=m,u-=m,r.back+=m,64&y){t.msg="invalid distance code",r.mode=tp;break}r.offset=v,r.extra=15&y,r.mode=16203;case 16203:if(r.extra){for(x=r.extra;u<x;){if(0===o)break t;o--,c+=n[s++]<<u,u+=8}r.offset+=c&(1<<r.extra)-1,c>>>=r.extra,u-=r.extra,r.back+=r.extra}if(r.offset>r.dmax){t.msg="invalid distance too far back",r.mode=tp;break}r.mode=16204;case 16204:if(0===l)break t;if(f=d-l,r.offset>f){if(f=r.offset-f,f>r.whave&&r.sane){t.msg="invalid distance too far back",r.mode=tp;break}f>r.wnext?(f-=r.wnext,p=r.wsize-f):p=r.wnext-f,f>r.length&&(f=r.length),g=r.window}else g=i,p=a-r.offset,f=r.length;f>l&&(f=l),l-=f,r.length-=f;do{i[a++]=g[p++]}while(--f);0===r.length&&(r.mode=Zf);break;case 16205:if(0===l)break t;i[a++]=r.length,l--,r.mode=Zf;break;case Jf:if(r.wrap){for(;u<32;){if(0===o)break t;o--,c|=n[s++]<<u,u+=8}if(d-=l,t.total_out+=d,r.total+=d,4&r.wrap&&d&&(t.adler=r.check=r.flags?id(r.check,i,d,a-d):rd(r.check,i,d,a-d)),d=l,4&r.wrap&&(r.flags?c:ep(c))!==r.check){t.msg="incorrect data check",r.mode=tp;break}c=0,u=0}r.mode=16207;case 16207:if(r.wrap&&r.flags){for(;u<32;){if(0===o)break t;o--,c+=n[s++]<<u,u+=8}if(4&r.wrap&&c!==(4294967295&r.total)){t.msg="incorrect length check",r.mode=tp;break}c=0,u=0}r.mode=16208;case 16208:S=Bf;break t;case tp:S=Wf;break t;case 16210:return Gf;default:return zf}return t.next_out=a,t.avail_out=l,t.next_in=s,t.avail_in=o,r.hold=c,r.bits=u,(r.wsize||d!==t.avail_out&&r.mode<tp&&(r.mode<Jf||e!==Df))&&dp(t,t.output,t.next_out,d-t.avail_out),h-=t.avail_in,d-=t.avail_out,t.total_in+=h,t.total_out+=d,r.total+=d,4&r.wrap&&d&&(t.adler=r.check=r.flags?id(r.check,i,d,t.next_out-d):rd(r.check,i,d,t.next_out-d)),t.data_type=r.bits+(r.last?64:0)+(r.mode===Yf?128:0)+(r.mode===$f||r.mode===Xf?256:0),(0===h&&0===d||e===Df)&&S===Uf&&(S=Vf),S},inflateEnd:t=>{if(np(t))return zf;let e=t.state;return e.window&&(e.window=null),t.state=null,Uf},inflateGetHeader:(t,e)=>{if(np(t))return zf;const r=t.state;return 0===(2&r.wrap)?zf:(r.head=e,e.done=!1,Uf)},inflateSetDictionary:(t,e)=>{const r=e.length;let n,i,s;return np(t)?zf:(n=t.state,0!==n.wrap&&n.mode!==qf?zf:n.mode===qf&&(i=1,i=rd(i,e,r,0),i!==n.check)?Wf:(s=dp(t,e,r,r),s?(n.mode=16210,Gf):(n.havedict=1,Uf)))},inflateInfo:"pako inflate (from Nodeca project)"};var pp=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1};const gp=Object.prototype.toString,{Z_NO_FLUSH:mp,Z_FINISH:yp,Z_OK:vp,Z_STREAM_END:bp,Z_NEED_DICT:_p,Z_STREAM_ERROR:wp,Z_DATA_ERROR:Ep,Z_MEM_ERROR:Sp}=ad;function Tp(t){this.options=af({chunkSize:65536,windowBits:15,to:""},t||{});const e=this.options;e.raw&&e.windowBits>=0&&e.windowBits<16&&(e.windowBits=-e.windowBits,0===e.windowBits&&(e.windowBits=-15)),!(e.windowBits>=0&&e.windowBits<16)||t&&t.windowBits||(e.windowBits+=32),e.windowBits>15&&e.windowBits<48&&0===(15&e.windowBits)&&(e.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new ff,this.strm.avail_out=0;let r=fp.inflateInit2(this.strm,e.windowBits);if(r!==vp)throw new Error(sd[r]);if(this.header=new pp,fp.inflateGetHeader(this.strm,this.header),e.dictionary&&("string"===typeof e.dictionary?e.dictionary=uf(e.dictionary):"[object ArrayBuffer]"===gp.call(e.dictionary)&&(e.dictionary=new Uint8Array(e.dictionary)),e.raw&&(r=fp.inflateSetDictionary(this.strm,e.dictionary),r!==vp)))throw new Error(sd[r])}function kp(t,e){const r=new Tp(e);if(r.push(t),r.err)throw r.msg||sd[r.err];return r.result}Tp.prototype.push=function(t,e){const r=this.strm,n=this.options.chunkSize,i=this.options.dictionary;let s,a,o;if(this.ended)return!1;for(a=e===~~e?e:!0===e?yp:mp,"[object ArrayBuffer]"===gp.call(t)?r.input=new Uint8Array(t):r.input=t,r.next_in=0,r.avail_in=r.input.length;;){for(0===r.avail_out&&(r.output=new Uint8Array(n),r.next_out=0,r.avail_out=n),s=fp.inflate(r,a),s===_p&&i&&(s=fp.inflateSetDictionary(r,i),s===vp?s=fp.inflate(r,a):s===Ep&&(s=_p));r.avail_in>0&&s===bp&&r.state.wrap>0&&0!==t[r.next_in];)fp.inflateReset(r),s=fp.inflate(r,a);switch(s){case wp:case Ep:case _p:case Sp:return this.onEnd(s),this.ended=!0,!1}if(o=r.avail_out,r.next_out&&(0===r.avail_out||s===bp))if("string"===this.options.to){let t=df(r.output,r.next_out),e=r.next_out-t,i=hf(r.output,t);r.next_out=e,r.avail_out=n-e,e&&r.output.set(r.output.subarray(t,t+e),0),this.onData(i)}else this.onData(r.output.length===r.next_out?r.output:r.output.subarray(0,r.next_out));if(s!==vp||0!==o){if(s===bp)return s=fp.inflateEnd(this.strm),this.onEnd(s),this.ended=!0,!0;if(0===r.avail_in)break}}return!0},Tp.prototype.onData=function(t){this.chunks.push(t)},Tp.prototype.onEnd=function(t){t===vp&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=of(this.chunks)),this.chunks=[],this.err=t,this.msg=this.strm.msg};var Ap={Inflate:Tp,inflate:kp,inflateRaw:function(t,e){return(e=e||{}).raw=!0,kp(t,e)},ungzip:kp,constants:ad};const{Deflate:xp,deflate:Ip,deflateRaw:Rp,gzip:Lp}=Af,{Inflate:Pp,inflate:Cp,inflateRaw:Mp,ungzip:Op}=Ap;var Dp={Deflate:xp,deflate:Ip,deflateRaw:Rp,gzip:Lp,Inflate:Pp,inflate:Cp,inflateRaw:Mp,ungzip:Op,constants:ad};class Np{constructor(t){this.canvas=t,this.ctx=t.getContext("2d"),this.mapCanvas=document.createElement("canvas"),this.mapCtx=this.mapCanvas.getContext("2d"),this.mapWidth=0,this.mapHeight=0,this.mapResolution=null,this.mapOrigin=null,this.lastRobotPose=null,this.robotPose=null,this.targetPose=null,this.goal=null,this.tempGoalPos=null,this.tempGoalYaw=0,this.choosingYaw=!1,this.scale=1,this.rotation=0,this.offsetX=0,this.offsetY=0,this.dragMode=null,this.isDragging=!1,this.lastMouseX=0,this.lastMouseY=0,this.interactionMode="pan",this._animating=!1,this._animationReq=null,this._bound_onWheel=this._onWheel.bind(this),this._bound_onMouseDown=this._onMouseDown.bind(this),this._bound_onMouseMove=this._onMouseMove.bind(this),this._bound_onMouseUp=this._onMouseUp.bind(this),this._bound_onDoubleClick=this._onDoubleClick.bind(this),this._bound_onContextMenu=t=>{t.preventDefault()},this.bindEvents()}destroy(){const t=this.canvas;t.removeEventListener("wheel",this._bound_onWheel),t.removeEventListener("mousedown",this._bound_onMouseDown),window.removeEventListener("mousemove",this._bound_onMouseMove),window.removeEventListener("mouseup",this._bound_onMouseUp),t.removeEventListener("dblclick",this._bound_onDoubleClick),t.removeEventListener("contextmenu",this._bound_onContextMenu),this._animating=!1,this._animationReq&&(cancelAnimationFrame(this._animationReq),this._animationReq=null)}quaternionToYaw(t){const e=2*(t.w*t.z+t.x*t.y),r=1-2*(t.y*t.y+t.z*t.z);return Math.atan2(e,r)}normalizeAngle(t){for(;t>Math.PI;)t-=2*Math.PI;for(;t<-Math.PI;)t+=2*Math.PI;return t}resetView(){this.scale=1,this.rotation=0,this.offsetX=0,this.offsetY=0}resetMap(){this.resetView(),this.mapWidth=0,this.mapHeight=0,this.mapResolution=null,this.mapOrigin=null,this.mapCanvas.width=0,this.mapCanvas.height=0,this.robotPose=null,this.targetPose=this.lastRobotPose?c({},this.lastRobotPose):null,this.goal=null,this.tempGoalPos=null,this.choosingYaw=!1,this.draw()}updateRobotPose(t){if(!t||!t.pose||!t.pose.position||!t.pose.orientation)return;const e={x:t.pose.position.x,y:t.pose.position.y,yaw:this.quaternionToYaw(t.pose.orientation)};this.lastRobotPose=c({},e),this.mapWidth&&this.mapHeight&&this.mapResolution&&this.mapOrigin&&(this.robotPose?this.targetPose=c({},e):(this.robotPose=c({},e),this.targetPose=c({},e),this.centerViewOnRobot(),this.startAnimationLoop()))}updateStaticMap(t){this.resetView();const e=t.info;this.mapWidth=e.width,this.mapHeight=e.height,this.mapResolution=e.resolution,this.mapOrigin={x:e.origin.position.x,y:e.origin.position.y},this.mapCanvas.width=this.mapWidth,this.mapCanvas.height=this.mapHeight;let r=t.data;if("string"===typeof r)try{r=JSON.parse(r)}catch(vA){return void console.warn("Map data parse error",vA)}if(!Array.isArray(r)||r.length!==this.mapWidth*this.mapHeight)return void console.warn("Map data length mismatch");const n=this.mapCtx.createImageData(this.mapWidth,this.mapHeight);for(let i=0;i<r.length;i++){const t=r[i];let e=200;100===t?e=0:0===t&&(e=255);const s=Math.floor(i/this.mapWidth),a=i%this.mapWidth,o=(this.mapHeight-s-1)*this.mapWidth+a;n.data[4*o+0]=e,n.data[4*o+1]=e,n.data[4*o+2]=e,n.data[4*o+3]=255}this.mapCtx.putImageData(n,0,0),this.goal=null,this.tempGoalPos=null,this.choosingYaw=!1,this.lastRobotPose&&this.updateRobotPose({pose:{position:{x:this.lastRobotPose.x,y:this.lastRobotPose.y,z:0},orientation:{x:0,y:0,z:Math.sin(this.lastRobotPose.yaw/2),w:Math.cos(this.lastRobotPose.yaw/2)}},twist:{linear:{x:0},angular:{z:0}}}),this.draw()}applyMapUpdate(t){if(null===t||void 0===t||!t.update)return;if(!this.mapCanvas||!this.mapWidth||!this.mapHeight)return;const{x:e,y:r,width:n,height:i,encoding:s,data_b64:a,orig_len:o}=t.update;if("zlib+base64"!==s)return void console.warn("Unsupported map update encoding:",s);let l,c;try{const t=atob(a);l=new Uint8Array(t.length);for(let e=0;e<t.length;e++)l[e]=t.charCodeAt(e)}catch(vA){return void console.warn("Base64 decode error",vA)}try{c=Dp.inflate(l)}catch(vA){return void console.warn("zlib decompress error",vA)}if(c.length!==o)return void console.warn("Map update length mismatch",c.length,o);const u=this.mapCtx.getImageData(0,0,this.mapWidth,this.mapHeight);for(let h=0;h<i;h++)for(let t=0;t<n;t++){const i=c[h*n+t];let s=200;100===i?s=0:0===i&&(s=255);const a=r+h,o=e+t;if(a>=this.mapHeight||o>=this.mapWidth)continue;const l=(this.mapHeight-a-1)*this.mapWidth+o;u.data[4*l+0]=s,u.data[4*l+1]=s,u.data[4*l+2]=s,u.data[4*l+3]=255}this.mapCtx.putImageData(u,0,0),this.draw()}centerViewOnRobot(){if(!this.robotPose||!this.mapWidth||!this.mapHeight)return;const t=(this.robotPose.x-this.mapOrigin.x)/this.mapResolution,e=(this.robotPose.y-this.mapOrigin.y)/this.mapResolution,r=this.mapWidth/2,n=this.mapHeight/2;this.offsetX=r-t,this.offsetY=-(n-e)}startAnimationLoop(){if(this._animating)return;this._animating=!0;const t=()=>{if(this._animating){if(this.robotPose&&this.targetPose){const t=(t,e,r)=>t+(e-t)*r,e=.2;this.robotPose.x=t(this.robotPose.x,this.targetPose.x,e),this.robotPose.y=t(this.robotPose.y,this.targetPose.y,e);let r=this.normalizeAngle(this.targetPose.yaw-this.robotPose.yaw);this.robotPose.yaw+=r*e}this.draw(),this._animationReq=requestAnimationFrame(t)}};this._animationReq=requestAnimationFrame(t)}setInteractionMode(t){this.interactionMode=t,"set_goal"!==t&&(this.tempGoalPos=null,this.choosingYaw=!1,this.draw())}bindEvents(){const t=this.canvas;t.addEventListener("wheel",this._bound_onWheel,{passive:!1}),t.addEventListener("mousedown",this._bound_onMouseDown),window.addEventListener("mousemove",this._bound_onMouseMove),window.addEventListener("mouseup",this._bound_onMouseUp),t.addEventListener("dblclick",this._bound_onDoubleClick),t.addEventListener("contextmenu",this._bound_onContextMenu)}_onWheel(t){t.preventDefault();t.deltaY<0?this.scale*=1.1:this.scale/=1.1,this.draw()}_onMouseDown(t){if(2===t.button)return this.dragMode="rotate",this.isDragging=!0,this.lastMouseX=t.clientX,void(this.lastMouseY=t.clientY);if(0===t.button)if("set_goal"===this.interactionMode){const e=this.screenToWorld(t.clientX,t.clientY);this.tempGoalPos=e,this.choosingYaw=!0,this.tempGoalYaw=0,this.canvas.style.cursor="crosshair"}else this.dragMode="pan",this.isDragging=!0,this.lastMouseX=t.clientX,this.lastMouseY=t.clientY,this.canvas.style.cursor="grab"}_onMouseMove(t){if(this.choosingYaw&&this.tempGoalPos){const e=this.screenToWorld(t.clientX,t.clientY),r=e.x-this.tempGoalPos.x,n=e.y-this.tempGoalPos.y;this.tempGoalYaw=Math.atan2(n,r),this.draw()}else if(this.isDragging){const e=t.clientX-this.lastMouseX,r=t.clientY-this.lastMouseY;this.lastMouseX=t.clientX,this.lastMouseY=t.clientY,"pan"===this.dragMode?(this.offsetX+=e,this.offsetY+=r):"rotate"===this.dragMode&&(this.rotation+=.005*e),this.draw()}}_onMouseUp(t){if(2===t.button)return this.isDragging=!1,this.dragMode=null,void(this.canvas.style.cursor="default");0===t.button&&(this.choosingYaw&&this.tempGoalPos&&(this.goal={x:this.tempGoalPos.x,y:this.tempGoalPos.y,yaw:this.tempGoalYaw},this.onGoalSelected&&this.onGoalSelected(this.goal),this.tempGoalPos=null,this.choosingYaw=!1,this.interactionMode="pan",this.canvas.style.cursor="grab",this.draw()),this.isDragging=!1,this.dragMode=null)}_onDoubleClick(t){this.resetView(),this.draw()}screenToWorld(t,e){if(!this.mapWidth||!this.mapHeight||!this.mapResolution||!this.mapOrigin)return{x:0,y:0};const r=this.canvas.getBoundingClientRect(),n=t-r.left,i=e-r.top,s=this.canvas.parentElement,a=s.clientWidth,o=s.clientHeight,l=Math.min(a/this.mapWidth,o/this.mapHeight),c=a/2+this.offsetX,u=o/2+this.offsetY,h=(n-c)/(l*this.scale),d=(i-u)/(l*this.scale),f=Math.cos(-this.rotation),p=Math.sin(-this.rotation),g=h*f-d*p,m=h*p+d*f,y=this.mapWidth/2+g,v=this.mapHeight/2-m;return{x:this.mapOrigin.x+y*this.mapResolution,y:this.mapOrigin.y+v*this.mapResolution}}draw(){if(!this.mapCanvas||!this.mapResolution||!this.mapOrigin)return;const t=this.canvas,e=this.ctx,r=t.parentElement,n=r.clientWidth,i=r.clientHeight,s=window.devicePixelRatio||1;t.width=Math.round(n*s),t.height=Math.round(i*s),e.setTransform(1,0,0,1,0,0),e.scale(s,s),e.imageSmoothingEnabled=!1,e.clearRect(0,0,n,i);const a=Math.min(n/this.mapWidth,i/this.mapHeight);if(e.save(),e.translate(n/2+this.offsetX,i/2+this.offsetY),e.scale(a*this.scale,a*this.scale),e.rotate(this.rotation),e.drawImage(this.mapCanvas,-this.mapWidth/2,-this.mapHeight/2),this.robotPose){const t=(this.robotPose.x-this.mapOrigin.x)/this.mapResolution,r=(this.robotPose.y-this.mapOrigin.y)/this.mapResolution,n=t-this.mapWidth/2,i=-(r-this.mapHeight/2);e.save(),e.translate(n,i),e.rotate(-this.robotPose.yaw+Math.PI/2);const s=8;e.fillStyle="red",e.beginPath(),e.moveTo(0,-s),e.lineTo(.6*s,s),e.lineTo(.6*-s,s),e.closePath(),e.fill(),e.restore()}if(this.goal){const t=(this.goal.x-this.mapOrigin.x)/this.mapResolution,r=(this.goal.y-this.mapOrigin.y)/this.mapResolution,n=t-this.mapWidth/2,i=-(r-this.mapHeight/2);e.save(),e.translate(n,i),e.rotate(this.goal.yaw||0),e.strokeStyle="limegreen",e.fillStyle="limegreen",e.lineWidth=2/this.scale,e.beginPath(),e.moveTo(-20/this.scale,0),e.lineTo(0,0),e.stroke(),e.beginPath(),e.moveTo(0,0),e.lineTo(-5/this.scale,-5/this.scale),e.lineTo(-5/this.scale,5/this.scale),e.closePath(),e.fill(),e.restore()}if(this.choosingYaw&&this.tempGoalPos){const t=(this.tempGoalPos.x-this.mapOrigin.x)/this.mapResolution,r=(this.tempGoalPos.y-this.mapOrigin.y)/this.mapResolution,n=t-this.mapWidth/2,i=-(r-this.mapHeight/2);e.save(),e.translate(n,i),e.rotate(this.tempGoalYaw),e.strokeStyle="limegreen",e.fillStyle="limegreen",e.lineWidth=2/this.scale,e.beginPath(),e.moveTo(-20/this.scale,0),e.lineTo(0,0),e.stroke(),e.beginPath(),e.moveTo(0,0),e.lineTo(-5/this.scale,-5/this.scale),e.lineTo(-5/this.scale,5/this.scale),e.closePath(),e.fill(),e.restore()}e.restore()}}let Fp=null;class Up extends t.Component{constructor(e){super(e),this.state={connected:!1,mapReady:!1},this.canvasRef=(0,t.createRef)(),this.renderer=null,this.initialized=!1,this.mapInfoCallback=null,this.mapUpdateCallback=null,this.odomCallback=null}componentDidMount(){this.interval=setInterval(()=>{var t;const e=(null===(t=hu.client)||void 0===t?void 0:t.connected)||!1;e!==this.state.connected&&this.setState({connected:e,mapReady:!1})},500)}componentDidUpdate(){!this.initialized&&this.state.connected&&this.canvasRef.current&&(this.renderer=new Np(this.canvasRef.current),this.initMapSubscriptions(),this.initOdomSubscription(),this.initialized=!0)}componentWillUnmount(){var t;clearInterval(this.interval),this.mapInfoCallback&&hu.unsubscribe(cu.MAP_INFO_TOPIC,this.mapInfoCallback),this.mapUpdateCallback&&hu.unsubscribe(cu.MAP_UPDATE_TOPIC,this.mapUpdateCallback),this.odomCallback&&hu.unsubscribe(cu.ODOM_TOPIC,this.odomCallback),this.mapInfoCallback=null,this.mapUpdateCallback=null,this.odomCallback=null,null===(t=this.renderer)||void 0===t||t.destroy(),this.renderer=null,this.initialized=!1}initMapSubscriptions(){const t=this.props.currentMode;this.switchMapTopic(t),this.renderer&&(this.renderer.onGoalSelected=t=>{this.publishGoal(t),this.props.onGoalSelected&&this.props.onGoalSelected(t)})}publishGoal(t){const e=-t.yaw,r=(n=e,{x:0,y:0,z:Math.sin(n/2),w:Math.cos(n/2)});var n;const i=Date.now(),s={header:{frame_id:"map",stamp:{secs:Math.floor(i/1e3),nsecs:i%1e3*1e6}},pose:{position:{x:t.x,y:t.y,z:0},orientation:r}};hu.publish(cu.WEB_GOAL_POSE_TOPIC,s)}switchMapTopic(t){var e;this.mapInfoCallback&&hu.unsubscribe(cu.MAP_INFO_TOPIC,this.mapInfoCallback),this.mapUpdateCallback&&hu.unsubscribe(cu.MAP_UPDATE_TOPIC,this.mapUpdateCallback),this.mapInfoCallback=null,this.mapUpdateCallback=null,null===(e=this.renderer)||void 0===e||e.resetMap(),this.setState({mapReady:!1}),"slam"===t?(this.mapInfoCallback=t=>{null!==t&&void 0!==t&&t.info&&null!==t&&void 0!==t&&t.data&&(this.renderer.updateStaticMap(t),this.state.mapReady||this.setState({mapReady:!0}))},hu.subscribe(cu.MAP_INFO_TOPIC,this.mapInfoCallback),this.mapUpdateCallback=t=>{null!==t&&void 0!==t&&t.map_version&&this.renderer.applyMapUpdate(t)},hu.subscribe(cu.MAP_UPDATE_TOPIC,this.mapUpdateCallback)):"nav"===t&&(Fp&&!this.state.mapReady&&(this.renderer.updateStaticMap(Fp),this.setState({mapReady:!0})),this.mapInfoCallback=t=>{null!==t&&void 0!==t&&t.info&&null!==t&&void 0!==t&&t.data&&(Fp=t,this.renderer.updateStaticMap(t),this.state.mapReady||this.setState({mapReady:!0}))},hu.subscribe(cu.MAP_INFO_TOPIC,this.mapInfoCallback))}initOdomSubscription(){this.odomCallback=t=>{var e;null!==t&&void 0!==t&&t.pose&&(null===(e=this.renderer)||void 0===e||e.updateRobotPose(t))},hu.subscribe(cu.ODOM_TOPIC,this.odomCallback)}setGoalMode(t){this.renderer&&this.canvasRef.current&&(this.renderer.setInteractionMode(t?"set_goal":"pan"),this.canvasRef.current.style.cursor=t?"crosshair":"grab")}render(){const{connected:t,mapReady:e}=this.state;let r="",n="";return t?e||(r="waiting-map",n="MAP \u7121\u6578\u64da ..."):(r="waiting-ros",n="\u7b49\u5f85\u9023\u7dda\u4e2d ..."),(0,Me.jsxs)("div",{className:"map-container",children:[(0,Me.jsx)("canvas",{className:"map-canvas",ref:this.canvasRef,onContextMenu:t=>t.preventDefault(),style:{opacity:e?1:.3,filter:e?"none":"blur(2px)",transition:"opacity 0.5s ease"}}),(!t||!e)&&(0,Me.jsx)("div",{children:(0,Me.jsx)("span",{className:"map-status ".concat(r),children:n})})]})}}const Bp=Up,jp=1e3,zp=1001,Wp=1002,Gp=1006,Vp=1008,Hp=1009,Kp=1023,qp=2300,Yp=2301,Qp=2302,Xp=2400,$p=2401,Zp=2402,Jp="srgb",tg="srgb-linear",eg="linear",rg="srgb",ng=2e3,ig=2001;Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array;function sg(t){return document.createElementNS("http://www.w3.org/1999/xhtml",t)}const ag={};let og=null;function lg(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];const n="THREE."+e.shift();og?og("warn",n,...e):console.warn(n,...e)}function cg(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];const n="THREE."+e.shift();og?og("error",n,...e):console.error(n,...e)}function ug(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];const n=e.join(" ");n in ag||(ag[n]=!0,lg(...e))}class hg{addEventListener(t,e){void 0===this._listeners&&(this._listeners={});const r=this._listeners;void 0===r[t]&&(r[t]=[]),-1===r[t].indexOf(e)&&r[t].push(e)}hasEventListener(t,e){const r=this._listeners;return void 0!==r&&(void 0!==r[t]&&-1!==r[t].indexOf(e))}removeEventListener(t,e){const r=this._listeners;if(void 0===r)return;const n=r[t];if(void 0!==n){const t=n.indexOf(e);-1!==t&&n.splice(t,1)}}dispatchEvent(t){const e=this._listeners;if(void 0===e)return;const r=e[t.type];if(void 0!==r){t.target=this;const e=r.slice(0);for(let r=0,n=e.length;r<n;r++)e[r].call(this,t);t.target=null}}}const dg=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"];Math.PI,Math.PI;function fg(){const t=4294967295*Math.random()|0,e=4294967295*Math.random()|0,r=4294967295*Math.random()|0,n=4294967295*Math.random()|0;return(dg[255&t]+dg[t>>8&255]+dg[t>>16&255]+dg[t>>24&255]+"-"+dg[255&e]+dg[e>>8&255]+"-"+dg[e>>16&15|64]+dg[e>>24&255]+"-"+dg[63&r|128]+dg[r>>8&255]+"-"+dg[r>>16&255]+dg[r>>24&255]+dg[255&n]+dg[n>>8&255]+dg[n>>16&255]+dg[n>>24&255]).toLowerCase()}function pg(t,e,r){return Math.max(e,Math.min(r,t))}function gg(t,e){return(t%e+e)%e}function mg(t,e,r){return(1-r)*t+r*e}class yg{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;yg.prototype.isVector2=!0,this.x=t,this.y=e}get width(){return this.x}set width(t){this.x=t}get height(){return this.y}set height(t){this.y=t}set(t,e){return this.x=t,this.y=e,this}setScalar(t){return this.x=t,this.y=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y)}copy(t){return this.x=t.x,this.y=t.y,this}add(t){return this.x+=t.x,this.y+=t.y,this}addScalar(t){return this.x+=t,this.y+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this}sub(t){return this.x-=t.x,this.y-=t.y,this}subScalar(t){return this.x-=t,this.y-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this}multiply(t){return this.x*=t.x,this.y*=t.y,this}multiplyScalar(t){return this.x*=t,this.y*=t,this}divide(t){return this.x/=t.x,this.y/=t.y,this}divideScalar(t){return this.multiplyScalar(1/t)}applyMatrix3(t){const e=this.x,r=this.y,n=t.elements;return this.x=n[0]*e+n[3]*r+n[6],this.y=n[1]*e+n[4]*r+n[7],this}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this}clamp(t,e){return this.x=pg(this.x,t.x,e.x),this.y=pg(this.y,t.y,e.y),this}clampScalar(t,e){return this.x=pg(this.x,t,e),this.y=pg(this.y,t,e),this}clampLength(t,e){const r=this.length();return this.divideScalar(r||1).multiplyScalar(pg(r,t,e))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(t){return this.x*t.x+this.y*t.y}cross(t){return this.x*t.y-this.y*t.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}angleTo(t){const e=Math.sqrt(this.lengthSq()*t.lengthSq());if(0===e)return Math.PI/2;const r=this.dot(t)/e;return Math.acos(pg(r,-1,1))}distanceTo(t){return Math.sqrt(this.distanceToSquared(t))}distanceToSquared(t){const e=this.x-t.x,r=this.y-t.y;return e*e+r*r}manhattanDistanceTo(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this}lerpVectors(t,e,r){return this.x=t.x+(e.x-t.x)*r,this.y=t.y+(e.y-t.y)*r,this}equals(t){return t.x===this.x&&t.y===this.y}fromArray(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.x=t[e],this.y=t[e+1],this}toArray(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return t[e]=this.x,t[e+1]=this.y,t}fromBufferAttribute(t,e){return this.x=t.getX(e),this.y=t.getY(e),this}rotateAround(t,e){const r=Math.cos(e),n=Math.sin(e),i=this.x-t.x,s=this.y-t.y;return this.x=i*r-s*n+t.x,this.y=i*n+s*r+t.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}class vg{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;this.isQuaternion=!0,this._x=t,this._y=e,this._z=r,this._w=n}static slerpFlat(t,e,r,n,i,s,a){let o=r[n+0],l=r[n+1],c=r[n+2],u=r[n+3],h=i[s+0],d=i[s+1],f=i[s+2],p=i[s+3];if(a<=0)return t[e+0]=o,t[e+1]=l,t[e+2]=c,void(t[e+3]=u);if(a>=1)return t[e+0]=h,t[e+1]=d,t[e+2]=f,void(t[e+3]=p);if(u!==p||o!==h||l!==d||c!==f){let t=o*h+l*d+c*f+u*p;t<0&&(h=-h,d=-d,f=-f,p=-p,t=-t);let e=1-a;if(t<.9995){const r=Math.acos(t),n=Math.sin(r);e=Math.sin(e*r)/n,o=o*e+h*(a=Math.sin(a*r)/n),l=l*e+d*a,c=c*e+f*a,u=u*e+p*a}else{o=o*e+h*a,l=l*e+d*a,c=c*e+f*a,u=u*e+p*a;const t=1/Math.sqrt(o*o+l*l+c*c+u*u);o*=t,l*=t,c*=t,u*=t}}t[e]=o,t[e+1]=l,t[e+2]=c,t[e+3]=u}static multiplyQuaternionsFlat(t,e,r,n,i,s){const a=r[n],o=r[n+1],l=r[n+2],c=r[n+3],u=i[s],h=i[s+1],d=i[s+2],f=i[s+3];return t[e]=a*f+c*u+o*d-l*h,t[e+1]=o*f+c*h+l*u-a*d,t[e+2]=l*f+c*d+a*h-o*u,t[e+3]=c*f-a*u-o*h-l*d,t}get x(){return this._x}set x(t){this._x=t,this._onChangeCallback()}get y(){return this._y}set y(t){this._y=t,this._onChangeCallback()}get z(){return this._z}set z(t){this._z=t,this._onChangeCallback()}get w(){return this._w}set w(t){this._w=t,this._onChangeCallback()}set(t,e,r,n){return this._x=t,this._y=e,this._z=r,this._w=n,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(t){return this._x=t.x,this._y=t.y,this._z=t.z,this._w=t.w,this._onChangeCallback(),this}setFromEuler(t){let e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const r=t._x,n=t._y,i=t._z,s=t._order,a=Math.cos,o=Math.sin,l=a(r/2),c=a(n/2),u=a(i/2),h=o(r/2),d=o(n/2),f=o(i/2);switch(s){case"XYZ":this._x=h*c*u+l*d*f,this._y=l*d*u-h*c*f,this._z=l*c*f+h*d*u,this._w=l*c*u-h*d*f;break;case"YXZ":this._x=h*c*u+l*d*f,this._y=l*d*u-h*c*f,this._z=l*c*f-h*d*u,this._w=l*c*u+h*d*f;break;case"ZXY":this._x=h*c*u-l*d*f,this._y=l*d*u+h*c*f,this._z=l*c*f+h*d*u,this._w=l*c*u-h*d*f;break;case"ZYX":this._x=h*c*u-l*d*f,this._y=l*d*u+h*c*f,this._z=l*c*f-h*d*u,this._w=l*c*u+h*d*f;break;case"YZX":this._x=h*c*u+l*d*f,this._y=l*d*u+h*c*f,this._z=l*c*f-h*d*u,this._w=l*c*u-h*d*f;break;case"XZY":this._x=h*c*u-l*d*f,this._y=l*d*u-h*c*f,this._z=l*c*f+h*d*u,this._w=l*c*u+h*d*f;break;default:lg("Quaternion: .setFromEuler() encountered an unknown order: "+s)}return!0===e&&this._onChangeCallback(),this}setFromAxisAngle(t,e){const r=e/2,n=Math.sin(r);return this._x=t.x*n,this._y=t.y*n,this._z=t.z*n,this._w=Math.cos(r),this._onChangeCallback(),this}setFromRotationMatrix(t){const e=t.elements,r=e[0],n=e[4],i=e[8],s=e[1],a=e[5],o=e[9],l=e[2],c=e[6],u=e[10],h=r+a+u;if(h>0){const t=.5/Math.sqrt(h+1);this._w=.25/t,this._x=(c-o)*t,this._y=(i-l)*t,this._z=(s-n)*t}else if(r>a&&r>u){const t=2*Math.sqrt(1+r-a-u);this._w=(c-o)/t,this._x=.25*t,this._y=(n+s)/t,this._z=(i+l)/t}else if(a>u){const t=2*Math.sqrt(1+a-r-u);this._w=(i-l)/t,this._x=(n+s)/t,this._y=.25*t,this._z=(o+c)/t}else{const t=2*Math.sqrt(1+u-r-a);this._w=(s-n)/t,this._x=(i+l)/t,this._y=(o+c)/t,this._z=.25*t}return this._onChangeCallback(),this}setFromUnitVectors(t,e){let r=t.dot(e)+1;return r<1e-8?(r=0,Math.abs(t.x)>Math.abs(t.z)?(this._x=-t.y,this._y=t.x,this._z=0,this._w=r):(this._x=0,this._y=-t.z,this._z=t.y,this._w=r)):(this._x=t.y*e.z-t.z*e.y,this._y=t.z*e.x-t.x*e.z,this._z=t.x*e.y-t.y*e.x,this._w=r),this.normalize()}angleTo(t){return 2*Math.acos(Math.abs(pg(this.dot(t),-1,1)))}rotateTowards(t,e){const r=this.angleTo(t);if(0===r)return this;const n=Math.min(1,e/r);return this.slerp(t,n),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(t){return this._x*t._x+this._y*t._y+this._z*t._z+this._w*t._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let t=this.length();return 0===t?(this._x=0,this._y=0,this._z=0,this._w=1):(t=1/t,this._x=this._x*t,this._y=this._y*t,this._z=this._z*t,this._w=this._w*t),this._onChangeCallback(),this}multiply(t){return this.multiplyQuaternions(this,t)}premultiply(t){return this.multiplyQuaternions(t,this)}multiplyQuaternions(t,e){const r=t._x,n=t._y,i=t._z,s=t._w,a=e._x,o=e._y,l=e._z,c=e._w;return this._x=r*c+s*a+n*l-i*o,this._y=n*c+s*o+i*a-r*l,this._z=i*c+s*l+r*o-n*a,this._w=s*c-r*a-n*o-i*l,this._onChangeCallback(),this}slerp(t,e){if(e<=0)return this;if(e>=1)return this.copy(t);let r=t._x,n=t._y,i=t._z,s=t._w,a=this.dot(t);a<0&&(r=-r,n=-n,i=-i,s=-s,a=-a);let o=1-e;if(a<.9995){const t=Math.acos(a),l=Math.sin(t);o=Math.sin(o*t)/l,e=Math.sin(e*t)/l,this._x=this._x*o+r*e,this._y=this._y*o+n*e,this._z=this._z*o+i*e,this._w=this._w*o+s*e,this._onChangeCallback()}else this._x=this._x*o+r*e,this._y=this._y*o+n*e,this._z=this._z*o+i*e,this._w=this._w*o+s*e,this.normalize();return this}slerpQuaternions(t,e,r){return this.copy(t).slerp(e,r)}random(){const t=2*Math.PI*Math.random(),e=2*Math.PI*Math.random(),r=Math.random(),n=Math.sqrt(1-r),i=Math.sqrt(r);return this.set(n*Math.sin(t),n*Math.cos(t),i*Math.sin(e),i*Math.cos(e))}equals(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._w===this._w}fromArray(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this._x=t[e],this._y=t[e+1],this._z=t[e+2],this._w=t[e+3],this._onChangeCallback(),this}toArray(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._w,t}fromBufferAttribute(t,e){return this._x=t.getX(e),this._y=t.getY(e),this._z=t.getZ(e),this._w=t.getW(e),this._onChangeCallback(),this}toJSON(){return this.toArray()}_onChange(t){return this._onChangeCallback=t,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}}class bg{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;bg.prototype.isVector3=!0,this.x=t,this.y=e,this.z=r}set(t,e,r){return void 0===r&&(r=this.z),this.x=t,this.y=e,this.z=r,this}setScalar(t){return this.x=t,this.y=t,this.z=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setZ(t){return this.z=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this}add(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this}addScalar(t){return this.x+=t,this.y+=t,this.z+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this}sub(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this}subScalar(t){return this.x-=t,this.y-=t,this.z-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this}multiply(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this}multiplyScalar(t){return this.x*=t,this.y*=t,this.z*=t,this}multiplyVectors(t,e){return this.x=t.x*e.x,this.y=t.y*e.y,this.z=t.z*e.z,this}applyEuler(t){return this.applyQuaternion(wg.setFromEuler(t))}applyAxisAngle(t,e){return this.applyQuaternion(wg.setFromAxisAngle(t,e))}applyMatrix3(t){const e=this.x,r=this.y,n=this.z,i=t.elements;return this.x=i[0]*e+i[3]*r+i[6]*n,this.y=i[1]*e+i[4]*r+i[7]*n,this.z=i[2]*e+i[5]*r+i[8]*n,this}applyNormalMatrix(t){return this.applyMatrix3(t).normalize()}applyMatrix4(t){const e=this.x,r=this.y,n=this.z,i=t.elements,s=1/(i[3]*e+i[7]*r+i[11]*n+i[15]);return this.x=(i[0]*e+i[4]*r+i[8]*n+i[12])*s,this.y=(i[1]*e+i[5]*r+i[9]*n+i[13])*s,this.z=(i[2]*e+i[6]*r+i[10]*n+i[14])*s,this}applyQuaternion(t){const e=this.x,r=this.y,n=this.z,i=t.x,s=t.y,a=t.z,o=t.w,l=2*(s*n-a*r),c=2*(a*e-i*n),u=2*(i*r-s*e);return this.x=e+o*l+s*u-a*c,this.y=r+o*c+a*l-i*u,this.z=n+o*u+i*c-s*l,this}project(t){return this.applyMatrix4(t.matrixWorldInverse).applyMatrix4(t.projectionMatrix)}unproject(t){return this.applyMatrix4(t.projectionMatrixInverse).applyMatrix4(t.matrixWorld)}transformDirection(t){const e=this.x,r=this.y,n=this.z,i=t.elements;return this.x=i[0]*e+i[4]*r+i[8]*n,this.y=i[1]*e+i[5]*r+i[9]*n,this.z=i[2]*e+i[6]*r+i[10]*n,this.normalize()}divide(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this}divideScalar(t){return this.multiplyScalar(1/t)}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this}clamp(t,e){return this.x=pg(this.x,t.x,e.x),this.y=pg(this.y,t.y,e.y),this.z=pg(this.z,t.z,e.z),this}clampScalar(t,e){return this.x=pg(this.x,t,e),this.y=pg(this.y,t,e),this.z=pg(this.z,t,e),this}clampLength(t,e){const r=this.length();return this.divideScalar(r||1).multiplyScalar(pg(r,t,e))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this}lerpVectors(t,e,r){return this.x=t.x+(e.x-t.x)*r,this.y=t.y+(e.y-t.y)*r,this.z=t.z+(e.z-t.z)*r,this}cross(t){return this.crossVectors(this,t)}crossVectors(t,e){const r=t.x,n=t.y,i=t.z,s=e.x,a=e.y,o=e.z;return this.x=n*o-i*a,this.y=i*s-r*o,this.z=r*a-n*s,this}projectOnVector(t){const e=t.lengthSq();if(0===e)return this.set(0,0,0);const r=t.dot(this)/e;return this.copy(t).multiplyScalar(r)}projectOnPlane(t){return _g.copy(this).projectOnVector(t),this.sub(_g)}reflect(t){return this.sub(_g.copy(t).multiplyScalar(2*this.dot(t)))}angleTo(t){const e=Math.sqrt(this.lengthSq()*t.lengthSq());if(0===e)return Math.PI/2;const r=this.dot(t)/e;return Math.acos(pg(r,-1,1))}distanceTo(t){return Math.sqrt(this.distanceToSquared(t))}distanceToSquared(t){const e=this.x-t.x,r=this.y-t.y,n=this.z-t.z;return e*e+r*r+n*n}manhattanDistanceTo(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)+Math.abs(this.z-t.z)}setFromSpherical(t){return this.setFromSphericalCoords(t.radius,t.phi,t.theta)}setFromSphericalCoords(t,e,r){const n=Math.sin(e)*t;return this.x=n*Math.sin(r),this.y=Math.cos(e)*t,this.z=n*Math.cos(r),this}setFromCylindrical(t){return this.setFromCylindricalCoords(t.radius,t.theta,t.y)}setFromCylindricalCoords(t,e,r){return this.x=t*Math.sin(e),this.y=r,this.z=t*Math.cos(e),this}setFromMatrixPosition(t){const e=t.elements;return this.x=e[12],this.y=e[13],this.z=e[14],this}setFromMatrixScale(t){const e=this.setFromMatrixColumn(t,0).length(),r=this.setFromMatrixColumn(t,1).length(),n=this.setFromMatrixColumn(t,2).length();return this.x=e,this.y=r,this.z=n,this}setFromMatrixColumn(t,e){return this.fromArray(t.elements,4*e)}setFromMatrix3Column(t,e){return this.fromArray(t.elements,3*e)}setFromEuler(t){return this.x=t._x,this.y=t._y,this.z=t._z,this}setFromColor(t){return this.x=t.r,this.y=t.g,this.z=t.b,this}equals(t){return t.x===this.x&&t.y===this.y&&t.z===this.z}fromArray(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.x=t[e],this.y=t[e+1],this.z=t[e+2],this}toArray(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t}fromBufferAttribute(t,e){return this.x=t.getX(e),this.y=t.getY(e),this.z=t.getZ(e),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const t=Math.random()*Math.PI*2,e=2*Math.random()-1,r=Math.sqrt(1-e*e);return this.x=r*Math.cos(t),this.y=e,this.z=r*Math.sin(t),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}const _g=new bg,wg=new vg;class Eg{constructor(t,e,r,n,i,s,a,o,l){Eg.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1],void 0!==t&&this.set(t,e,r,n,i,s,a,o,l)}set(t,e,r,n,i,s,a,o,l){const c=this.elements;return c[0]=t,c[1]=n,c[2]=a,c[3]=e,c[4]=i,c[5]=o,c[6]=r,c[7]=s,c[8]=l,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(t){const e=this.elements,r=t.elements;return e[0]=r[0],e[1]=r[1],e[2]=r[2],e[3]=r[3],e[4]=r[4],e[5]=r[5],e[6]=r[6],e[7]=r[7],e[8]=r[8],this}extractBasis(t,e,r){return t.setFromMatrix3Column(this,0),e.setFromMatrix3Column(this,1),r.setFromMatrix3Column(this,2),this}setFromMatrix4(t){const e=t.elements;return this.set(e[0],e[4],e[8],e[1],e[5],e[9],e[2],e[6],e[10]),this}multiply(t){return this.multiplyMatrices(this,t)}premultiply(t){return this.multiplyMatrices(t,this)}multiplyMatrices(t,e){const r=t.elements,n=e.elements,i=this.elements,s=r[0],a=r[3],o=r[6],l=r[1],c=r[4],u=r[7],h=r[2],d=r[5],f=r[8],p=n[0],g=n[3],m=n[6],y=n[1],v=n[4],b=n[7],_=n[2],w=n[5],E=n[8];return i[0]=s*p+a*y+o*_,i[3]=s*g+a*v+o*w,i[6]=s*m+a*b+o*E,i[1]=l*p+c*y+u*_,i[4]=l*g+c*v+u*w,i[7]=l*m+c*b+u*E,i[2]=h*p+d*y+f*_,i[5]=h*g+d*v+f*w,i[8]=h*m+d*b+f*E,this}multiplyScalar(t){const e=this.elements;return e[0]*=t,e[3]*=t,e[6]*=t,e[1]*=t,e[4]*=t,e[7]*=t,e[2]*=t,e[5]*=t,e[8]*=t,this}determinant(){const t=this.elements,e=t[0],r=t[1],n=t[2],i=t[3],s=t[4],a=t[5],o=t[6],l=t[7],c=t[8];return e*s*c-e*a*l-r*i*c+r*a*o+n*i*l-n*s*o}invert(){const t=this.elements,e=t[0],r=t[1],n=t[2],i=t[3],s=t[4],a=t[5],o=t[6],l=t[7],c=t[8],u=c*s-a*l,h=a*o-c*i,d=l*i-s*o,f=e*u+r*h+n*d;if(0===f)return this.set(0,0,0,0,0,0,0,0,0);const p=1/f;return t[0]=u*p,t[1]=(n*l-c*r)*p,t[2]=(a*r-n*s)*p,t[3]=h*p,t[4]=(c*e-n*o)*p,t[5]=(n*i-a*e)*p,t[6]=d*p,t[7]=(r*o-l*e)*p,t[8]=(s*e-r*i)*p,this}transpose(){let t;const e=this.elements;return t=e[1],e[1]=e[3],e[3]=t,t=e[2],e[2]=e[6],e[6]=t,t=e[5],e[5]=e[7],e[7]=t,this}getNormalMatrix(t){return this.setFromMatrix4(t).invert().transpose()}transposeIntoArray(t){const e=this.elements;return t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8],this}setUvTransform(t,e,r,n,i,s,a){const o=Math.cos(i),l=Math.sin(i);return this.set(r*o,r*l,-r*(o*s+l*a)+s+t,-n*l,n*o,-n*(-l*s+o*a)+a+e,0,0,1),this}scale(t,e){return this.premultiply(Sg.makeScale(t,e)),this}rotate(t){return this.premultiply(Sg.makeRotation(-t)),this}translate(t,e){return this.premultiply(Sg.makeTranslation(t,e)),this}makeTranslation(t,e){return t.isVector2?this.set(1,0,t.x,0,1,t.y,0,0,1):this.set(1,0,t,0,1,e,0,0,1),this}makeRotation(t){const e=Math.cos(t),r=Math.sin(t);return this.set(e,-r,0,r,e,0,0,0,1),this}makeScale(t,e){return this.set(t,0,0,0,e,0,0,0,1),this}equals(t){const e=this.elements,r=t.elements;for(let n=0;n<9;n++)if(e[n]!==r[n])return!1;return!0}fromArray(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;for(let r=0;r<9;r++)this.elements[r]=t[r+e];return this}toArray(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const r=this.elements;return t[e]=r[0],t[e+1]=r[1],t[e+2]=r[2],t[e+3]=r[3],t[e+4]=r[4],t[e+5]=r[5],t[e+6]=r[6],t[e+7]=r[7],t[e+8]=r[8],t}clone(){return(new this.constructor).fromArray(this.elements)}}const Sg=new Eg,Tg=(new Eg).set(.4123908,.3575843,.1804808,.212639,.7151687,.0721923,.0193308,.1191948,.9505322),kg=(new Eg).set(3.2409699,-1.5373832,-.4986108,-.9692436,1.8759675,.0415551,.0556301,-.203977,1.0569715);function Ag(){const t={enabled:!0,workingColorSpace:tg,spaces:{},convert:function(t,e,r){return!1!==this.enabled&&e!==r&&e&&r?(this.spaces[e].transfer===rg&&(t.r=Ig(t.r),t.g=Ig(t.g),t.b=Ig(t.b)),this.spaces[e].primaries!==this.spaces[r].primaries&&(t.applyMatrix3(this.spaces[e].toXYZ),t.applyMatrix3(this.spaces[r].fromXYZ)),this.spaces[r].transfer===rg&&(t.r=Rg(t.r),t.g=Rg(t.g),t.b=Rg(t.b)),t):t},workingToColorSpace:function(t,e){return this.convert(t,this.workingColorSpace,e)},colorSpaceToWorking:function(t,e){return this.convert(t,e,this.workingColorSpace)},getPrimaries:function(t){return this.spaces[t].primaries},getTransfer:function(t){return""===t?eg:this.spaces[t].transfer},getToneMappingMode:function(t){return this.spaces[t].outputColorSpaceConfig.toneMappingMode||"standard"},getLuminanceCoefficients:function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.workingColorSpace;return t.fromArray(this.spaces[e].luminanceCoefficients)},define:function(t){Object.assign(this.spaces,t)},_getMatrix:function(t,e,r){return t.copy(this.spaces[e].toXYZ).multiply(this.spaces[r].fromXYZ)},_getDrawingBufferColorSpace:function(t){return this.spaces[t].outputColorSpaceConfig.drawingBufferColorSpace},_getUnpackColorSpace:function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.workingColorSpace;return this.spaces[t].workingColorSpaceConfig.unpackColorSpace},fromWorkingColorSpace:function(e,r){return ug("ColorManagement: .fromWorkingColorSpace() has been renamed to .workingToColorSpace()."),t.workingToColorSpace(e,r)},toWorkingColorSpace:function(e,r){return ug("ColorManagement: .toWorkingColorSpace() has been renamed to .colorSpaceToWorking()."),t.colorSpaceToWorking(e,r)}},e=[.64,.33,.3,.6,.15,.06],r=[.2126,.7152,.0722],n=[.3127,.329];return t.define({[tg]:{primaries:e,whitePoint:n,transfer:eg,toXYZ:Tg,fromXYZ:kg,luminanceCoefficients:r,workingColorSpaceConfig:{unpackColorSpace:Jp},outputColorSpaceConfig:{drawingBufferColorSpace:Jp}},[Jp]:{primaries:e,whitePoint:n,transfer:rg,toXYZ:Tg,fromXYZ:kg,luminanceCoefficients:r,outputColorSpaceConfig:{drawingBufferColorSpace:Jp}}}),t}const xg=Ag();function Ig(t){return t<.04045?.0773993808*t:Math.pow(.9478672986*t+.0521327014,2.4)}function Rg(t){return t<.0031308?12.92*t:1.055*Math.pow(t,.41666)-.055}let Lg;class Pg{static getDataURL(t){let e,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"image/png";if(/^data:/i.test(t.src))return t.src;if("undefined"===typeof HTMLCanvasElement)return t.src;if(t instanceof HTMLCanvasElement)e=t;else{void 0===Lg&&(Lg=sg("canvas")),Lg.width=t.width,Lg.height=t.height;const r=Lg.getContext("2d");t instanceof ImageData?r.putImageData(t,0,0):r.drawImage(t,0,0,t.width,t.height),e=Lg}return e.toDataURL(r)}static sRGBToLinear(t){if("undefined"!==typeof HTMLImageElement&&t instanceof HTMLImageElement||"undefined"!==typeof HTMLCanvasElement&&t instanceof HTMLCanvasElement||"undefined"!==typeof ImageBitmap&&t instanceof ImageBitmap){const e=sg("canvas");e.width=t.width,e.height=t.height;const r=e.getContext("2d");r.drawImage(t,0,0,t.width,t.height);const n=r.getImageData(0,0,t.width,t.height),i=n.data;for(let t=0;t<i.length;t++)i[t]=255*Ig(i[t]/255);return r.putImageData(n,0,0),e}if(t.data){const e=t.data.slice(0);for(let t=0;t<e.length;t++)e instanceof Uint8Array||e instanceof Uint8ClampedArray?e[t]=Math.floor(255*Ig(e[t]/255)):e[t]=Ig(e[t]);return{data:e,width:t.width,height:t.height}}return lg("ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),t}}let Cg=0;class Mg{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.isSource=!0,Object.defineProperty(this,"id",{value:Cg++}),this.uuid=fg(),this.data=t,this.dataReady=!0,this.version=0}getSize(t){const e=this.data;return"undefined"!==typeof HTMLVideoElement&&e instanceof HTMLVideoElement?t.set(e.videoWidth,e.videoHeight,0):e instanceof VideoFrame?t.set(e.displayHeight,e.displayWidth,0):null!==e?t.set(e.width,e.height,e.depth||0):t.set(0,0,0),t}set needsUpdate(t){!0===t&&this.version++}toJSON(t){const e=void 0===t||"string"===typeof t;if(!e&&void 0!==t.images[this.uuid])return t.images[this.uuid];const r={uuid:this.uuid,url:""},n=this.data;if(null!==n){let t;if(Array.isArray(n)){t=[];for(let e=0,r=n.length;e<r;e++)n[e].isDataTexture?t.push(Og(n[e].image)):t.push(Og(n[e]))}else t=Og(n);r.url=t}return e||(t.images[this.uuid]=r),r}}function Og(t){return"undefined"!==typeof HTMLImageElement&&t instanceof HTMLImageElement||"undefined"!==typeof HTMLCanvasElement&&t instanceof HTMLCanvasElement||"undefined"!==typeof ImageBitmap&&t instanceof ImageBitmap?Pg.getDataURL(t):t.data?{data:Array.from(t.data),width:t.width,height:t.height,type:t.data.constructor.name}:(lg("Texture: Unable to serialize Texture."),{})}let Dg=0;const Ng=new bg;class Fg extends hg{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Fg.DEFAULT_IMAGE,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Fg.DEFAULT_MAPPING,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:zp,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:zp,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:Gp,s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:Vp,a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:Kp,o=arguments.length>7&&void 0!==arguments[7]?arguments[7]:Hp,l=arguments.length>8&&void 0!==arguments[8]?arguments[8]:Fg.DEFAULT_ANISOTROPY,c=arguments.length>9&&void 0!==arguments[9]?arguments[9]:"";super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:Dg++}),this.uuid=fg(),this.name="",this.source=new Mg(t),this.mipmaps=[],this.mapping=e,this.channel=0,this.wrapS=r,this.wrapT=n,this.magFilter=i,this.minFilter=s,this.anisotropy=l,this.format=a,this.internalFormat=null,this.type=o,this.offset=new yg(0,0),this.repeat=new yg(1,1),this.center=new yg(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new Eg,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.colorSpace=c,this.userData={},this.updateRanges=[],this.version=0,this.onUpdate=null,this.renderTarget=null,this.isRenderTargetTexture=!1,this.isArrayTexture=!!(t&&t.depth&&t.depth>1),this.pmremVersion=0}get width(){return this.source.getSize(Ng).x}get height(){return this.source.getSize(Ng).y}get depth(){return this.source.getSize(Ng).z}get image(){return this.source.data}set image(t){void 0===t&&(t=null),this.source.data=t}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}addUpdateRange(t,e){this.updateRanges.push({start:t,count:e})}clearUpdateRanges(){this.updateRanges.length=0}clone(){return(new this.constructor).copy(this)}copy(t){return this.name=t.name,this.source=t.source,this.mipmaps=t.mipmaps.slice(0),this.mapping=t.mapping,this.channel=t.channel,this.wrapS=t.wrapS,this.wrapT=t.wrapT,this.magFilter=t.magFilter,this.minFilter=t.minFilter,this.anisotropy=t.anisotropy,this.format=t.format,this.internalFormat=t.internalFormat,this.type=t.type,this.offset.copy(t.offset),this.repeat.copy(t.repeat),this.center.copy(t.center),this.rotation=t.rotation,this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrix.copy(t.matrix),this.generateMipmaps=t.generateMipmaps,this.premultiplyAlpha=t.premultiplyAlpha,this.flipY=t.flipY,this.unpackAlignment=t.unpackAlignment,this.colorSpace=t.colorSpace,this.renderTarget=t.renderTarget,this.isRenderTargetTexture=t.isRenderTargetTexture,this.isArrayTexture=t.isArrayTexture,this.userData=JSON.parse(JSON.stringify(t.userData)),this.needsUpdate=!0,this}setValues(t){for(const e in t){const r=t[e];if(void 0===r){lg("Texture.setValues(): parameter '".concat(e,"' has value of undefined."));continue}const n=this[e];void 0!==n?n&&r&&n.isVector2&&r.isVector2||n&&r&&n.isVector3&&r.isVector3||n&&r&&n.isMatrix3&&r.isMatrix3?n.copy(r):this[e]=r:lg("Texture.setValues(): property '".concat(e,"' does not exist."))}}toJSON(t){const e=void 0===t||"string"===typeof t;if(!e&&void 0!==t.textures[this.uuid])return t.textures[this.uuid];const r={metadata:{version:4.7,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(t).uuid,mapping:this.mapping,channel:this.channel,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,internalFormat:this.internalFormat,type:this.type,colorSpace:this.colorSpace,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,generateMipmaps:this.generateMipmaps,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return Object.keys(this.userData).length>0&&(r.userData=this.userData),e||(t.textures[this.uuid]=r),r}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(t){if(300!==this.mapping)return t;if(t.applyMatrix3(this.matrix),t.x<0||t.x>1)switch(this.wrapS){case jp:t.x=t.x-Math.floor(t.x);break;case zp:t.x=t.x<0?0:1;break;case Wp:1===Math.abs(Math.floor(t.x)%2)?t.x=Math.ceil(t.x)-t.x:t.x=t.x-Math.floor(t.x)}if(t.y<0||t.y>1)switch(this.wrapT){case jp:t.y=t.y-Math.floor(t.y);break;case zp:t.y=t.y<0?0:1;break;case Wp:1===Math.abs(Math.floor(t.y)%2)?t.y=Math.ceil(t.y)-t.y:t.y=t.y-Math.floor(t.y)}return this.flipY&&(t.y=1-t.y),t}set needsUpdate(t){!0===t&&(this.version++,this.source.needsUpdate=!0)}set needsPMREMUpdate(t){!0===t&&this.pmremVersion++}}Fg.DEFAULT_IMAGE=null,Fg.DEFAULT_MAPPING=300,Fg.DEFAULT_ANISOTROPY=1;Symbol.iterator;class Ug{constructor(t,e,r,n,i,s,a,o,l,c,u,h,d,f,p,g){Ug.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],void 0!==t&&this.set(t,e,r,n,i,s,a,o,l,c,u,h,d,f,p,g)}set(t,e,r,n,i,s,a,o,l,c,u,h,d,f,p,g){const m=this.elements;return m[0]=t,m[4]=e,m[8]=r,m[12]=n,m[1]=i,m[5]=s,m[9]=a,m[13]=o,m[2]=l,m[6]=c,m[10]=u,m[14]=h,m[3]=d,m[7]=f,m[11]=p,m[15]=g,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return(new Ug).fromArray(this.elements)}copy(t){const e=this.elements,r=t.elements;return e[0]=r[0],e[1]=r[1],e[2]=r[2],e[3]=r[3],e[4]=r[4],e[5]=r[5],e[6]=r[6],e[7]=r[7],e[8]=r[8],e[9]=r[9],e[10]=r[10],e[11]=r[11],e[12]=r[12],e[13]=r[13],e[14]=r[14],e[15]=r[15],this}copyPosition(t){const e=this.elements,r=t.elements;return e[12]=r[12],e[13]=r[13],e[14]=r[14],this}setFromMatrix3(t){const e=t.elements;return this.set(e[0],e[3],e[6],0,e[1],e[4],e[7],0,e[2],e[5],e[8],0,0,0,0,1),this}extractBasis(t,e,r){return t.setFromMatrixColumn(this,0),e.setFromMatrixColumn(this,1),r.setFromMatrixColumn(this,2),this}makeBasis(t,e,r){return this.set(t.x,e.x,r.x,0,t.y,e.y,r.y,0,t.z,e.z,r.z,0,0,0,0,1),this}extractRotation(t){const e=this.elements,r=t.elements,n=1/Bg.setFromMatrixColumn(t,0).length(),i=1/Bg.setFromMatrixColumn(t,1).length(),s=1/Bg.setFromMatrixColumn(t,2).length();return e[0]=r[0]*n,e[1]=r[1]*n,e[2]=r[2]*n,e[3]=0,e[4]=r[4]*i,e[5]=r[5]*i,e[6]=r[6]*i,e[7]=0,e[8]=r[8]*s,e[9]=r[9]*s,e[10]=r[10]*s,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this}makeRotationFromEuler(t){const e=this.elements,r=t.x,n=t.y,i=t.z,s=Math.cos(r),a=Math.sin(r),o=Math.cos(n),l=Math.sin(n),c=Math.cos(i),u=Math.sin(i);if("XYZ"===t.order){const t=s*c,r=s*u,n=a*c,i=a*u;e[0]=o*c,e[4]=-o*u,e[8]=l,e[1]=r+n*l,e[5]=t-i*l,e[9]=-a*o,e[2]=i-t*l,e[6]=n+r*l,e[10]=s*o}else if("YXZ"===t.order){const t=o*c,r=o*u,n=l*c,i=l*u;e[0]=t+i*a,e[4]=n*a-r,e[8]=s*l,e[1]=s*u,e[5]=s*c,e[9]=-a,e[2]=r*a-n,e[6]=i+t*a,e[10]=s*o}else if("ZXY"===t.order){const t=o*c,r=o*u,n=l*c,i=l*u;e[0]=t-i*a,e[4]=-s*u,e[8]=n+r*a,e[1]=r+n*a,e[5]=s*c,e[9]=i-t*a,e[2]=-s*l,e[6]=a,e[10]=s*o}else if("ZYX"===t.order){const t=s*c,r=s*u,n=a*c,i=a*u;e[0]=o*c,e[4]=n*l-r,e[8]=t*l+i,e[1]=o*u,e[5]=i*l+t,e[9]=r*l-n,e[2]=-l,e[6]=a*o,e[10]=s*o}else if("YZX"===t.order){const t=s*o,r=s*l,n=a*o,i=a*l;e[0]=o*c,e[4]=i-t*u,e[8]=n*u+r,e[1]=u,e[5]=s*c,e[9]=-a*c,e[2]=-l*c,e[6]=r*u+n,e[10]=t-i*u}else if("XZY"===t.order){const t=s*o,r=s*l,n=a*o,i=a*l;e[0]=o*c,e[4]=-u,e[8]=l*c,e[1]=t*u+i,e[5]=s*c,e[9]=r*u-n,e[2]=n*u-r,e[6]=a*c,e[10]=i*u+t}return e[3]=0,e[7]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this}makeRotationFromQuaternion(t){return this.compose(zg,t,Wg)}lookAt(t,e,r){const n=this.elements;return Hg.subVectors(t,e),0===Hg.lengthSq()&&(Hg.z=1),Hg.normalize(),Gg.crossVectors(r,Hg),0===Gg.lengthSq()&&(1===Math.abs(r.z)?Hg.x+=1e-4:Hg.z+=1e-4,Hg.normalize(),Gg.crossVectors(r,Hg)),Gg.normalize(),Vg.crossVectors(Hg,Gg),n[0]=Gg.x,n[4]=Vg.x,n[8]=Hg.x,n[1]=Gg.y,n[5]=Vg.y,n[9]=Hg.y,n[2]=Gg.z,n[6]=Vg.z,n[10]=Hg.z,this}multiply(t){return this.multiplyMatrices(this,t)}premultiply(t){return this.multiplyMatrices(t,this)}multiplyMatrices(t,e){const r=t.elements,n=e.elements,i=this.elements,s=r[0],a=r[4],o=r[8],l=r[12],c=r[1],u=r[5],h=r[9],d=r[13],f=r[2],p=r[6],g=r[10],m=r[14],y=r[3],v=r[7],b=r[11],_=r[15],w=n[0],E=n[4],S=n[8],T=n[12],k=n[1],A=n[5],x=n[9],I=n[13],R=n[2],L=n[6],P=n[10],C=n[14],M=n[3],O=n[7],D=n[11],N=n[15];return i[0]=s*w+a*k+o*R+l*M,i[4]=s*E+a*A+o*L+l*O,i[8]=s*S+a*x+o*P+l*D,i[12]=s*T+a*I+o*C+l*N,i[1]=c*w+u*k+h*R+d*M,i[5]=c*E+u*A+h*L+d*O,i[9]=c*S+u*x+h*P+d*D,i[13]=c*T+u*I+h*C+d*N,i[2]=f*w+p*k+g*R+m*M,i[6]=f*E+p*A+g*L+m*O,i[10]=f*S+p*x+g*P+m*D,i[14]=f*T+p*I+g*C+m*N,i[3]=y*w+v*k+b*R+_*M,i[7]=y*E+v*A+b*L+_*O,i[11]=y*S+v*x+b*P+_*D,i[15]=y*T+v*I+b*C+_*N,this}multiplyScalar(t){const e=this.elements;return e[0]*=t,e[4]*=t,e[8]*=t,e[12]*=t,e[1]*=t,e[5]*=t,e[9]*=t,e[13]*=t,e[2]*=t,e[6]*=t,e[10]*=t,e[14]*=t,e[3]*=t,e[7]*=t,e[11]*=t,e[15]*=t,this}determinant(){const t=this.elements,e=t[0],r=t[4],n=t[8],i=t[12],s=t[1],a=t[5],o=t[9],l=t[13],c=t[2],u=t[6],h=t[10],d=t[14];return t[3]*(+i*o*u-n*l*u-i*a*h+r*l*h+n*a*d-r*o*d)+t[7]*(+e*o*d-e*l*h+i*s*h-n*s*d+n*l*c-i*o*c)+t[11]*(+e*l*u-e*a*d-i*s*u+r*s*d+i*a*c-r*l*c)+t[15]*(-n*a*c-e*o*u+e*a*h+n*s*u-r*s*h+r*o*c)}transpose(){const t=this.elements;let e;return e=t[1],t[1]=t[4],t[4]=e,e=t[2],t[2]=t[8],t[8]=e,e=t[6],t[6]=t[9],t[9]=e,e=t[3],t[3]=t[12],t[12]=e,e=t[7],t[7]=t[13],t[13]=e,e=t[11],t[11]=t[14],t[14]=e,this}setPosition(t,e,r){const n=this.elements;return t.isVector3?(n[12]=t.x,n[13]=t.y,n[14]=t.z):(n[12]=t,n[13]=e,n[14]=r),this}invert(){const t=this.elements,e=t[0],r=t[1],n=t[2],i=t[3],s=t[4],a=t[5],o=t[6],l=t[7],c=t[8],u=t[9],h=t[10],d=t[11],f=t[12],p=t[13],g=t[14],m=t[15],y=u*g*l-p*h*l+p*o*d-a*g*d-u*o*m+a*h*m,v=f*h*l-c*g*l-f*o*d+s*g*d+c*o*m-s*h*m,b=c*p*l-f*u*l+f*a*d-s*p*d-c*a*m+s*u*m,_=f*u*o-c*p*o-f*a*h+s*p*h+c*a*g-s*u*g,w=e*y+r*v+n*b+i*_;if(0===w)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const E=1/w;return t[0]=y*E,t[1]=(p*h*i-u*g*i-p*n*d+r*g*d+u*n*m-r*h*m)*E,t[2]=(a*g*i-p*o*i+p*n*l-r*g*l-a*n*m+r*o*m)*E,t[3]=(u*o*i-a*h*i-u*n*l+r*h*l+a*n*d-r*o*d)*E,t[4]=v*E,t[5]=(c*g*i-f*h*i+f*n*d-e*g*d-c*n*m+e*h*m)*E,t[6]=(f*o*i-s*g*i-f*n*l+e*g*l+s*n*m-e*o*m)*E,t[7]=(s*h*i-c*o*i+c*n*l-e*h*l-s*n*d+e*o*d)*E,t[8]=b*E,t[9]=(f*u*i-c*p*i-f*r*d+e*p*d+c*r*m-e*u*m)*E,t[10]=(s*p*i-f*a*i+f*r*l-e*p*l-s*r*m+e*a*m)*E,t[11]=(c*a*i-s*u*i-c*r*l+e*u*l+s*r*d-e*a*d)*E,t[12]=_*E,t[13]=(c*p*n-f*u*n+f*r*h-e*p*h-c*r*g+e*u*g)*E,t[14]=(f*a*n-s*p*n-f*r*o+e*p*o+s*r*g-e*a*g)*E,t[15]=(s*u*n-c*a*n+c*r*o-e*u*o-s*r*h+e*a*h)*E,this}scale(t){const e=this.elements,r=t.x,n=t.y,i=t.z;return e[0]*=r,e[4]*=n,e[8]*=i,e[1]*=r,e[5]*=n,e[9]*=i,e[2]*=r,e[6]*=n,e[10]*=i,e[3]*=r,e[7]*=n,e[11]*=i,this}getMaxScaleOnAxis(){const t=this.elements,e=t[0]*t[0]+t[1]*t[1]+t[2]*t[2],r=t[4]*t[4]+t[5]*t[5]+t[6]*t[6],n=t[8]*t[8]+t[9]*t[9]+t[10]*t[10];return Math.sqrt(Math.max(e,r,n))}makeTranslation(t,e,r){return t.isVector3?this.set(1,0,0,t.x,0,1,0,t.y,0,0,1,t.z,0,0,0,1):this.set(1,0,0,t,0,1,0,e,0,0,1,r,0,0,0,1),this}makeRotationX(t){const e=Math.cos(t),r=Math.sin(t);return this.set(1,0,0,0,0,e,-r,0,0,r,e,0,0,0,0,1),this}makeRotationY(t){const e=Math.cos(t),r=Math.sin(t);return this.set(e,0,r,0,0,1,0,0,-r,0,e,0,0,0,0,1),this}makeRotationZ(t){const e=Math.cos(t),r=Math.sin(t);return this.set(e,-r,0,0,r,e,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(t,e){const r=Math.cos(e),n=Math.sin(e),i=1-r,s=t.x,a=t.y,o=t.z,l=i*s,c=i*a;return this.set(l*s+r,l*a-n*o,l*o+n*a,0,l*a+n*o,c*a+r,c*o-n*s,0,l*o-n*a,c*o+n*s,i*o*o+r,0,0,0,0,1),this}makeScale(t,e,r){return this.set(t,0,0,0,0,e,0,0,0,0,r,0,0,0,0,1),this}makeShear(t,e,r,n,i,s){return this.set(1,r,i,0,t,1,s,0,e,n,1,0,0,0,0,1),this}compose(t,e,r){const n=this.elements,i=e._x,s=e._y,a=e._z,o=e._w,l=i+i,c=s+s,u=a+a,h=i*l,d=i*c,f=i*u,p=s*c,g=s*u,m=a*u,y=o*l,v=o*c,b=o*u,_=r.x,w=r.y,E=r.z;return n[0]=(1-(p+m))*_,n[1]=(d+b)*_,n[2]=(f-v)*_,n[3]=0,n[4]=(d-b)*w,n[5]=(1-(h+m))*w,n[6]=(g+y)*w,n[7]=0,n[8]=(f+v)*E,n[9]=(g-y)*E,n[10]=(1-(h+p))*E,n[11]=0,n[12]=t.x,n[13]=t.y,n[14]=t.z,n[15]=1,this}decompose(t,e,r){const n=this.elements;let i=Bg.set(n[0],n[1],n[2]).length();const s=Bg.set(n[4],n[5],n[6]).length(),a=Bg.set(n[8],n[9],n[10]).length();this.determinant()<0&&(i=-i),t.x=n[12],t.y=n[13],t.z=n[14],jg.copy(this);const o=1/i,l=1/s,c=1/a;return jg.elements[0]*=o,jg.elements[1]*=o,jg.elements[2]*=o,jg.elements[4]*=l,jg.elements[5]*=l,jg.elements[6]*=l,jg.elements[8]*=c,jg.elements[9]*=c,jg.elements[10]*=c,e.setFromRotationMatrix(jg),r.x=i,r.y=s,r.z=a,this}makePerspective(t,e,r,n,i,s){let a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:ng,o=arguments.length>7&&void 0!==arguments[7]&&arguments[7];const l=this.elements,c=2*i/(e-t),u=2*i/(r-n),h=(e+t)/(e-t),d=(r+n)/(r-n);let f,p;if(o)f=i/(s-i),p=s*i/(s-i);else if(a===ng)f=-(s+i)/(s-i),p=-2*s*i/(s-i);else{if(a!==ig)throw new Error("THREE.Matrix4.makePerspective(): Invalid coordinate system: "+a);f=-s/(s-i),p=-s*i/(s-i)}return l[0]=c,l[4]=0,l[8]=h,l[12]=0,l[1]=0,l[5]=u,l[9]=d,l[13]=0,l[2]=0,l[6]=0,l[10]=f,l[14]=p,l[3]=0,l[7]=0,l[11]=-1,l[15]=0,this}makeOrthographic(t,e,r,n,i,s){let a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:ng,o=arguments.length>7&&void 0!==arguments[7]&&arguments[7];const l=this.elements,c=2/(e-t),u=2/(r-n),h=-(e+t)/(e-t),d=-(r+n)/(r-n);let f,p;if(o)f=1/(s-i),p=s/(s-i);else if(a===ng)f=-2/(s-i),p=-(s+i)/(s-i);else{if(a!==ig)throw new Error("THREE.Matrix4.makeOrthographic(): Invalid coordinate system: "+a);f=-1/(s-i),p=-i/(s-i)}return l[0]=c,l[4]=0,l[8]=0,l[12]=h,l[1]=0,l[5]=u,l[9]=0,l[13]=d,l[2]=0,l[6]=0,l[10]=f,l[14]=p,l[3]=0,l[7]=0,l[11]=0,l[15]=1,this}equals(t){const e=this.elements,r=t.elements;for(let n=0;n<16;n++)if(e[n]!==r[n])return!1;return!0}fromArray(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;for(let r=0;r<16;r++)this.elements[r]=t[r+e];return this}toArray(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const r=this.elements;return t[e]=r[0],t[e+1]=r[1],t[e+2]=r[2],t[e+3]=r[3],t[e+4]=r[4],t[e+5]=r[5],t[e+6]=r[6],t[e+7]=r[7],t[e+8]=r[8],t[e+9]=r[9],t[e+10]=r[10],t[e+11]=r[11],t[e+12]=r[12],t[e+13]=r[13],t[e+14]=r[14],t[e+15]=r[15],t}}const Bg=new bg,jg=new Ug,zg=new bg(0,0,0),Wg=new bg(1,1,1),Gg=new bg,Vg=new bg,Hg=new bg,Kg=new Ug,qg=new vg;class Yg{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:Yg.DEFAULT_ORDER;this.isEuler=!0,this._x=t,this._y=e,this._z=r,this._order=n}get x(){return this._x}set x(t){this._x=t,this._onChangeCallback()}get y(){return this._y}set y(t){this._y=t,this._onChangeCallback()}get z(){return this._z}set z(t){this._z=t,this._onChangeCallback()}get order(){return this._order}set order(t){this._order=t,this._onChangeCallback()}set(t,e,r){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:this._order;return this._x=t,this._y=e,this._z=r,this._order=n,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(t){return this._x=t._x,this._y=t._y,this._z=t._z,this._order=t._order,this._onChangeCallback(),this}setFromRotationMatrix(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this._order,r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const n=t.elements,i=n[0],s=n[4],a=n[8],o=n[1],l=n[5],c=n[9],u=n[2],h=n[6],d=n[10];switch(e){case"XYZ":this._y=Math.asin(pg(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(-c,d),this._z=Math.atan2(-s,i)):(this._x=Math.atan2(h,l),this._z=0);break;case"YXZ":this._x=Math.asin(-pg(c,-1,1)),Math.abs(c)<.9999999?(this._y=Math.atan2(a,d),this._z=Math.atan2(o,l)):(this._y=Math.atan2(-u,i),this._z=0);break;case"ZXY":this._x=Math.asin(pg(h,-1,1)),Math.abs(h)<.9999999?(this._y=Math.atan2(-u,d),this._z=Math.atan2(-s,l)):(this._y=0,this._z=Math.atan2(o,i));break;case"ZYX":this._y=Math.asin(-pg(u,-1,1)),Math.abs(u)<.9999999?(this._x=Math.atan2(h,d),this._z=Math.atan2(o,i)):(this._x=0,this._z=Math.atan2(-s,l));break;case"YZX":this._z=Math.asin(pg(o,-1,1)),Math.abs(o)<.9999999?(this._x=Math.atan2(-c,l),this._y=Math.atan2(-u,i)):(this._x=0,this._y=Math.atan2(a,d));break;case"XZY":this._z=Math.asin(-pg(s,-1,1)),Math.abs(s)<.9999999?(this._x=Math.atan2(h,l),this._y=Math.atan2(a,i)):(this._x=Math.atan2(-c,d),this._y=0);break;default:lg("Euler: .setFromRotationMatrix() encountered an unknown order: "+e)}return this._order=e,!0===r&&this._onChangeCallback(),this}setFromQuaternion(t,e,r){return Kg.makeRotationFromQuaternion(t),this.setFromRotationMatrix(Kg,e,r)}setFromVector3(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this._order;return this.set(t.x,t.y,t.z,e)}reorder(t){return qg.setFromEuler(this),this.setFromQuaternion(qg,t)}equals(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._order===this._order}fromArray(t){return this._x=t[0],this._y=t[1],this._z=t[2],void 0!==t[3]&&(this._order=t[3]),this._onChangeCallback(),this}toArray(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._order,t}_onChange(t){return this._onChangeCallback=t,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}}Yg.DEFAULT_ORDER="XYZ";class Qg{constructor(){this.mask=1}set(t){this.mask=1<<t>>>0}enable(t){this.mask|=1<<t}enableAll(){this.mask=-1}toggle(t){this.mask^=1<<t}disable(t){this.mask&=~(1<<t)}disableAll(){this.mask=0}test(t){return 0!==(this.mask&t.mask)}isEnabled(t){return 0!==(this.mask&1<<t)}}let Xg=0;const $g=new bg,Zg=new vg,Jg=new Ug,tm=new bg,em=new bg,rm=new bg,nm=new vg,im=new bg(1,0,0),sm=new bg(0,1,0),am=new bg(0,0,1),om={type:"added"},lm={type:"removed"},cm={type:"childadded",child:null},um={type:"childremoved",child:null};class hm extends hg{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:Xg++}),this.uuid=fg(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=hm.DEFAULT_UP.clone();const t=new bg,e=new Yg,r=new vg,n=new bg(1,1,1);e._onChange(function(){r.setFromEuler(e,!1)}),r._onChange(function(){e.setFromQuaternion(r,void 0,!1)}),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:t},rotation:{configurable:!0,enumerable:!0,value:e},quaternion:{configurable:!0,enumerable:!0,value:r},scale:{configurable:!0,enumerable:!0,value:n},modelViewMatrix:{value:new Ug},normalMatrix:{value:new Eg}}),this.matrix=new Ug,this.matrixWorld=new Ug,this.matrixAutoUpdate=hm.DEFAULT_MATRIX_AUTO_UPDATE,this.matrixWorldAutoUpdate=hm.DEFAULT_MATRIX_WORLD_AUTO_UPDATE,this.matrixWorldNeedsUpdate=!1,this.layers=new Qg,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.customDepthMaterial=void 0,this.customDistanceMaterial=void 0,this.userData={}}onBeforeShadow(){}onAfterShadow(){}onBeforeRender(){}onAfterRender(){}applyMatrix4(t){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(t),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(t){return this.quaternion.premultiply(t),this}setRotationFromAxisAngle(t,e){this.quaternion.setFromAxisAngle(t,e)}setRotationFromEuler(t){this.quaternion.setFromEuler(t,!0)}setRotationFromMatrix(t){this.quaternion.setFromRotationMatrix(t)}setRotationFromQuaternion(t){this.quaternion.copy(t)}rotateOnAxis(t,e){return Zg.setFromAxisAngle(t,e),this.quaternion.multiply(Zg),this}rotateOnWorldAxis(t,e){return Zg.setFromAxisAngle(t,e),this.quaternion.premultiply(Zg),this}rotateX(t){return this.rotateOnAxis(im,t)}rotateY(t){return this.rotateOnAxis(sm,t)}rotateZ(t){return this.rotateOnAxis(am,t)}translateOnAxis(t,e){return $g.copy(t).applyQuaternion(this.quaternion),this.position.add($g.multiplyScalar(e)),this}translateX(t){return this.translateOnAxis(im,t)}translateY(t){return this.translateOnAxis(sm,t)}translateZ(t){return this.translateOnAxis(am,t)}localToWorld(t){return this.updateWorldMatrix(!0,!1),t.applyMatrix4(this.matrixWorld)}worldToLocal(t){return this.updateWorldMatrix(!0,!1),t.applyMatrix4(Jg.copy(this.matrixWorld).invert())}lookAt(t,e,r){t.isVector3?tm.copy(t):tm.set(t,e,r);const n=this.parent;this.updateWorldMatrix(!0,!1),em.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?Jg.lookAt(em,tm,this.up):Jg.lookAt(tm,em,this.up),this.quaternion.setFromRotationMatrix(Jg),n&&(Jg.extractRotation(n.matrixWorld),Zg.setFromRotationMatrix(Jg),this.quaternion.premultiply(Zg.invert()))}add(t){if(arguments.length>1){for(let t=0;t<arguments.length;t++)this.add(arguments[t]);return this}return t===this?(cg("Object3D.add: object can't be added as a child of itself.",t),this):(t&&t.isObject3D?(t.removeFromParent(),t.parent=this,this.children.push(t),t.dispatchEvent(om),cm.child=t,this.dispatchEvent(cm),cm.child=null):cg("Object3D.add: object not an instance of THREE.Object3D.",t),this)}remove(t){if(arguments.length>1){for(let t=0;t<arguments.length;t++)this.remove(arguments[t]);return this}const e=this.children.indexOf(t);return-1!==e&&(t.parent=null,this.children.splice(e,1),t.dispatchEvent(lm),um.child=t,this.dispatchEvent(um),um.child=null),this}removeFromParent(){const t=this.parent;return null!==t&&t.remove(this),this}clear(){return this.remove(...this.children)}attach(t){return this.updateWorldMatrix(!0,!1),Jg.copy(this.matrixWorld).invert(),null!==t.parent&&(t.parent.updateWorldMatrix(!0,!1),Jg.multiply(t.parent.matrixWorld)),t.applyMatrix4(Jg),t.removeFromParent(),t.parent=this,this.children.push(t),t.updateWorldMatrix(!1,!0),t.dispatchEvent(om),cm.child=t,this.dispatchEvent(cm),cm.child=null,this}getObjectById(t){return this.getObjectByProperty("id",t)}getObjectByName(t){return this.getObjectByProperty("name",t)}getObjectByProperty(t,e){if(this[t]===e)return this;for(let r=0,n=this.children.length;r<n;r++){const n=this.children[r].getObjectByProperty(t,e);if(void 0!==n)return n}}getObjectsByProperty(t,e){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];this[t]===e&&r.push(this);const n=this.children;for(let i=0,s=n.length;i<s;i++)n[i].getObjectsByProperty(t,e,r);return r}getWorldPosition(t){return this.updateWorldMatrix(!0,!1),t.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(t){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(em,t,rm),t}getWorldScale(t){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(em,nm,t),t}getWorldDirection(t){this.updateWorldMatrix(!0,!1);const e=this.matrixWorld.elements;return t.set(e[8],e[9],e[10]).normalize()}raycast(){}traverse(t){t(this);const e=this.children;for(let r=0,n=e.length;r<n;r++)e[r].traverse(t)}traverseVisible(t){if(!1===this.visible)return;t(this);const e=this.children;for(let r=0,n=e.length;r<n;r++)e[r].traverseVisible(t)}traverseAncestors(t){const e=this.parent;null!==e&&(t(e),e.traverseAncestors(t))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(t){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||t)&&(!0===this.matrixWorldAutoUpdate&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)),this.matrixWorldNeedsUpdate=!1,t=!0);const e=this.children;for(let r=0,n=e.length;r<n;r++){e[r].updateMatrixWorld(t)}}updateWorldMatrix(t,e){const r=this.parent;if(!0===t&&null!==r&&r.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),!0===this.matrixWorldAutoUpdate&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)),!0===e){const t=this.children;for(let e=0,r=t.length;e<r;e++){t[e].updateWorldMatrix(!1,!0)}}}toJSON(t){const e=void 0===t||"string"===typeof t,r={};e&&(t={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},r.metadata={version:4.7,type:"Object",generator:"Object3D.toJSON"});const n={};function i(e,r){return void 0===e[r.uuid]&&(e[r.uuid]=r.toJSON(t)),r.uuid}if(n.uuid=this.uuid,n.type=this.type,""!==this.name&&(n.name=this.name),!0===this.castShadow&&(n.castShadow=!0),!0===this.receiveShadow&&(n.receiveShadow=!0),!1===this.visible&&(n.visible=!1),!1===this.frustumCulled&&(n.frustumCulled=!1),0!==this.renderOrder&&(n.renderOrder=this.renderOrder),Object.keys(this.userData).length>0&&(n.userData=this.userData),n.layers=this.layers.mask,n.matrix=this.matrix.toArray(),n.up=this.up.toArray(),!1===this.matrixAutoUpdate&&(n.matrixAutoUpdate=!1),this.isInstancedMesh&&(n.type="InstancedMesh",n.count=this.count,n.instanceMatrix=this.instanceMatrix.toJSON(),null!==this.instanceColor&&(n.instanceColor=this.instanceColor.toJSON())),this.isBatchedMesh&&(n.type="BatchedMesh",n.perObjectFrustumCulled=this.perObjectFrustumCulled,n.sortObjects=this.sortObjects,n.drawRanges=this._drawRanges,n.reservedRanges=this._reservedRanges,n.geometryInfo=this._geometryInfo.map(t=>c(c({},t),{},{boundingBox:t.boundingBox?t.boundingBox.toJSON():void 0,boundingSphere:t.boundingSphere?t.boundingSphere.toJSON():void 0})),n.instanceInfo=this._instanceInfo.map(t=>c({},t)),n.availableInstanceIds=this._availableInstanceIds.slice(),n.availableGeometryIds=this._availableGeometryIds.slice(),n.nextIndexStart=this._nextIndexStart,n.nextVertexStart=this._nextVertexStart,n.geometryCount=this._geometryCount,n.maxInstanceCount=this._maxInstanceCount,n.maxVertexCount=this._maxVertexCount,n.maxIndexCount=this._maxIndexCount,n.geometryInitialized=this._geometryInitialized,n.matricesTexture=this._matricesTexture.toJSON(t),n.indirectTexture=this._indirectTexture.toJSON(t),null!==this._colorsTexture&&(n.colorsTexture=this._colorsTexture.toJSON(t)),null!==this.boundingSphere&&(n.boundingSphere=this.boundingSphere.toJSON()),null!==this.boundingBox&&(n.boundingBox=this.boundingBox.toJSON())),this.isScene)this.background&&(this.background.isColor?n.background=this.background.toJSON():this.background.isTexture&&(n.background=this.background.toJSON(t).uuid)),this.environment&&this.environment.isTexture&&!0!==this.environment.isRenderTargetTexture&&(n.environment=this.environment.toJSON(t).uuid);else if(this.isMesh||this.isLine||this.isPoints){n.geometry=i(t.geometries,this.geometry);const e=this.geometry.parameters;if(void 0!==e&&void 0!==e.shapes){const r=e.shapes;if(Array.isArray(r))for(let e=0,n=r.length;e<n;e++){const n=r[e];i(t.shapes,n)}else i(t.shapes,r)}}if(this.isSkinnedMesh&&(n.bindMode=this.bindMode,n.bindMatrix=this.bindMatrix.toArray(),void 0!==this.skeleton&&(i(t.skeletons,this.skeleton),n.skeleton=this.skeleton.uuid)),void 0!==this.material)if(Array.isArray(this.material)){const e=[];for(let r=0,n=this.material.length;r<n;r++)e.push(i(t.materials,this.material[r]));n.material=e}else n.material=i(t.materials,this.material);if(this.children.length>0){n.children=[];for(let e=0;e<this.children.length;e++)n.children.push(this.children[e].toJSON(t).object)}if(this.animations.length>0){n.animations=[];for(let e=0;e<this.animations.length;e++){const r=this.animations[e];n.animations.push(i(t.animations,r))}}if(e){const e=s(t.geometries),n=s(t.materials),i=s(t.textures),a=s(t.images),o=s(t.shapes),l=s(t.skeletons),c=s(t.animations),u=s(t.nodes);e.length>0&&(r.geometries=e),n.length>0&&(r.materials=n),i.length>0&&(r.textures=i),a.length>0&&(r.images=a),o.length>0&&(r.shapes=o),l.length>0&&(r.skeletons=l),c.length>0&&(r.animations=c),u.length>0&&(r.nodes=u)}return r.object=n,r;function s(t){const e=[];for(const r in t){const n=t[r];delete n.metadata,e.push(n)}return e}}clone(t){return(new this.constructor).copy(this,t)}copy(t){let e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.name=t.name,this.up.copy(t.up),this.position.copy(t.position),this.rotation.order=t.rotation.order,this.quaternion.copy(t.quaternion),this.scale.copy(t.scale),this.matrix.copy(t.matrix),this.matrixWorld.copy(t.matrixWorld),this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrixWorldAutoUpdate=t.matrixWorldAutoUpdate,this.matrixWorldNeedsUpdate=t.matrixWorldNeedsUpdate,this.layers.mask=t.layers.mask,this.visible=t.visible,this.castShadow=t.castShadow,this.receiveShadow=t.receiveShadow,this.frustumCulled=t.frustumCulled,this.renderOrder=t.renderOrder,this.animations=t.animations.slice(),this.userData=JSON.parse(JSON.stringify(t.userData)),!0===e)for(let r=0;r<t.children.length;r++){const e=t.children[r];this.add(e.clone())}return this}}hm.DEFAULT_UP=new bg(0,1,0),hm.DEFAULT_MATRIX_AUTO_UPDATE=!0,hm.DEFAULT_MATRIX_WORLD_AUTO_UPDATE=!0;const dm={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},fm={h:0,s:0,l:0},pm={h:0,s:0,l:0};function gm(t,e,r){return r<0&&(r+=1),r>1&&(r-=1),r<1/6?t+6*(e-t)*r:r<.5?e:r<2/3?t+6*(e-t)*(2/3-r):t}class mm{constructor(t,e,r){return this.isColor=!0,this.r=1,this.g=1,this.b=1,this.set(t,e,r)}set(t,e,r){if(void 0===e&&void 0===r){const e=t;e&&e.isColor?this.copy(e):"number"===typeof e?this.setHex(e):"string"===typeof e&&this.setStyle(e)}else this.setRGB(t,e,r);return this}setScalar(t){return this.r=t,this.g=t,this.b=t,this}setHex(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Jp;return t=Math.floor(t),this.r=(t>>16&255)/255,this.g=(t>>8&255)/255,this.b=(255&t)/255,xg.colorSpaceToWorking(this,e),this}setRGB(t,e,r){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:xg.workingColorSpace;return this.r=t,this.g=e,this.b=r,xg.colorSpaceToWorking(this,n),this}setHSL(t,e,r){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:xg.workingColorSpace;if(t=gg(t,1),e=pg(e,0,1),r=pg(r,0,1),0===e)this.r=this.g=this.b=r;else{const n=r<=.5?r*(1+e):r+e-r*e,i=2*r-n;this.r=gm(i,n,t+1/3),this.g=gm(i,n,t),this.b=gm(i,n,t-1/3)}return xg.colorSpaceToWorking(this,n),this}setStyle(t){let e,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Jp;function n(e){void 0!==e&&parseFloat(e)<1&&lg("Color: Alpha component of "+t+" will be ignored.")}if(e=/^(\w+)\(([^\)]*)\)/.exec(t)){let i;const s=e[1],a=e[2];switch(s){case"rgb":case"rgba":if(i=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return n(i[4]),this.setRGB(Math.min(255,parseInt(i[1],10))/255,Math.min(255,parseInt(i[2],10))/255,Math.min(255,parseInt(i[3],10))/255,r);if(i=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return n(i[4]),this.setRGB(Math.min(100,parseInt(i[1],10))/100,Math.min(100,parseInt(i[2],10))/100,Math.min(100,parseInt(i[3],10))/100,r);break;case"hsl":case"hsla":if(i=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return n(i[4]),this.setHSL(parseFloat(i[1])/360,parseFloat(i[2])/100,parseFloat(i[3])/100,r);break;default:lg("Color: Unknown color model "+t)}}else if(e=/^\#([A-Fa-f\d]+)$/.exec(t)){const n=e[1],i=n.length;if(3===i)return this.setRGB(parseInt(n.charAt(0),16)/15,parseInt(n.charAt(1),16)/15,parseInt(n.charAt(2),16)/15,r);if(6===i)return this.setHex(parseInt(n,16),r);lg("Color: Invalid hex color "+t)}else if(t&&t.length>0)return this.setColorName(t,r);return this}setColorName(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Jp;const r=dm[t.toLowerCase()];return void 0!==r?this.setHex(r,e):lg("Color: Unknown color "+t),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(t){return this.r=t.r,this.g=t.g,this.b=t.b,this}copySRGBToLinear(t){return this.r=Ig(t.r),this.g=Ig(t.g),this.b=Ig(t.b),this}copyLinearToSRGB(t){return this.r=Rg(t.r),this.g=Rg(t.g),this.b=Rg(t.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Jp;return xg.workingToColorSpace(ym.copy(this),t),65536*Math.round(pg(255*ym.r,0,255))+256*Math.round(pg(255*ym.g,0,255))+Math.round(pg(255*ym.b,0,255))}getHexString(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Jp;return("000000"+this.getHex(t).toString(16)).slice(-6)}getHSL(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:xg.workingColorSpace;xg.workingToColorSpace(ym.copy(this),e);const r=ym.r,n=ym.g,i=ym.b,s=Math.max(r,n,i),a=Math.min(r,n,i);let o,l;const c=(a+s)/2;if(a===s)o=0,l=0;else{const t=s-a;switch(l=c<=.5?t/(s+a):t/(2-s-a),s){case r:o=(n-i)/t+(n<i?6:0);break;case n:o=(i-r)/t+2;break;case i:o=(r-n)/t+4}o/=6}return t.h=o,t.s=l,t.l=c,t}getRGB(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:xg.workingColorSpace;return xg.workingToColorSpace(ym.copy(this),e),t.r=ym.r,t.g=ym.g,t.b=ym.b,t}getStyle(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Jp;xg.workingToColorSpace(ym.copy(this),t);const e=ym.r,r=ym.g,n=ym.b;return t!==Jp?"color(".concat(t," ").concat(e.toFixed(3)," ").concat(r.toFixed(3)," ").concat(n.toFixed(3),")"):"rgb(".concat(Math.round(255*e),",").concat(Math.round(255*r),",").concat(Math.round(255*n),")")}offsetHSL(t,e,r){return this.getHSL(fm),this.setHSL(fm.h+t,fm.s+e,fm.l+r)}add(t){return this.r+=t.r,this.g+=t.g,this.b+=t.b,this}addColors(t,e){return this.r=t.r+e.r,this.g=t.g+e.g,this.b=t.b+e.b,this}addScalar(t){return this.r+=t,this.g+=t,this.b+=t,this}sub(t){return this.r=Math.max(0,this.r-t.r),this.g=Math.max(0,this.g-t.g),this.b=Math.max(0,this.b-t.b),this}multiply(t){return this.r*=t.r,this.g*=t.g,this.b*=t.b,this}multiplyScalar(t){return this.r*=t,this.g*=t,this.b*=t,this}lerp(t,e){return this.r+=(t.r-this.r)*e,this.g+=(t.g-this.g)*e,this.b+=(t.b-this.b)*e,this}lerpColors(t,e,r){return this.r=t.r+(e.r-t.r)*r,this.g=t.g+(e.g-t.g)*r,this.b=t.b+(e.b-t.b)*r,this}lerpHSL(t,e){this.getHSL(fm),t.getHSL(pm);const r=mg(fm.h,pm.h,e),n=mg(fm.s,pm.s,e),i=mg(fm.l,pm.l,e);return this.setHSL(r,n,i),this}setFromVector3(t){return this.r=t.x,this.g=t.y,this.b=t.z,this}applyMatrix3(t){const e=this.r,r=this.g,n=this.b,i=t.elements;return this.r=i[0]*e+i[3]*r+i[6]*n,this.g=i[1]*e+i[4]*r+i[7]*n,this.b=i[2]*e+i[5]*r+i[8]*n,this}equals(t){return t.r===this.r&&t.g===this.g&&t.b===this.b}fromArray(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.r=t[e],this.g=t[e+1],this.b=t[e+2],this}toArray(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return t[e]=this.r,t[e+1]=this.g,t[e+2]=this.b,t}fromBufferAttribute(t,e){return this.r=t.getX(e),this.g=t.getY(e),this.b=t.getZ(e),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}}const ym=new mm;mm.NAMES=dm;function vm(t,e){return t&&t.constructor!==e?"number"===typeof e.BYTES_PER_ELEMENT?new e(t):Array.prototype.slice.call(t):t}function bm(t){return ArrayBuffer.isView(t)&&!(t instanceof DataView)}class _m{constructor(t,e,r,n){this.parameterPositions=t,this._cachedIndex=0,this.resultBuffer=void 0!==n?n:new e.constructor(r),this.sampleValues=e,this.valueSize=r,this.settings=null,this.DefaultSettings_={}}evaluate(t){const e=this.parameterPositions;let r=this._cachedIndex,n=e[r],i=e[r-1];t:{e:{let s;r:{n:if(!(t<n)){for(let s=r+2;;){if(void 0===n){if(t<i)break n;return r=e.length,this._cachedIndex=r,this.copySampleValue_(r-1)}if(r===s)break;if(i=n,n=e[++r],t<n)break e}s=e.length;break r}if(!(t>=i)){const a=e[1];t<a&&(r=2,i=a);for(let s=r-2;;){if(void 0===i)return this._cachedIndex=0,this.copySampleValue_(0);if(r===s)break;if(n=i,i=e[--r-1],t>=i)break e}s=r,r=0;break r}break t}for(;r<s;){const n=r+s>>>1;t<e[n]?s=n:r=n+1}if(n=e[r],i=e[r-1],void 0===i)return this._cachedIndex=0,this.copySampleValue_(0);if(void 0===n)return r=e.length,this._cachedIndex=r,this.copySampleValue_(r-1)}this._cachedIndex=r,this.intervalChanged_(r,i,n)}return this.interpolate_(r,i,t,n)}getSettings_(){return this.settings||this.DefaultSettings_}copySampleValue_(t){const e=this.resultBuffer,r=this.sampleValues,n=this.valueSize,i=t*n;for(let s=0;s!==n;++s)e[s]=r[i+s];return e}interpolate_(){throw new Error("call to abstract method")}intervalChanged_(){}}class wm extends _m{constructor(t,e,r,n){super(t,e,r,n),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0,this.DefaultSettings_={endingStart:Xp,endingEnd:Xp}}intervalChanged_(t,e,r){const n=this.parameterPositions;let i=t-2,s=t+1,a=n[i],o=n[s];if(void 0===a)switch(this.getSettings_().endingStart){case $p:i=t,a=2*e-r;break;case Zp:i=n.length-2,a=e+n[i]-n[i+1];break;default:i=t,a=r}if(void 0===o)switch(this.getSettings_().endingEnd){case $p:s=t,o=2*r-e;break;case Zp:s=1,o=r+n[1]-n[0];break;default:s=t-1,o=e}const l=.5*(r-e),c=this.valueSize;this._weightPrev=l/(e-a),this._weightNext=l/(o-r),this._offsetPrev=i*c,this._offsetNext=s*c}interpolate_(t,e,r,n){const i=this.resultBuffer,s=this.sampleValues,a=this.valueSize,o=t*a,l=o-a,c=this._offsetPrev,u=this._offsetNext,h=this._weightPrev,d=this._weightNext,f=(r-e)/(n-e),p=f*f,g=p*f,m=-h*g+2*h*p-h*f,y=(1+h)*g+(-1.5-2*h)*p+(-.5+h)*f+1,v=(-1-d)*g+(1.5+d)*p+.5*f,b=d*g-d*p;for(let _=0;_!==a;++_)i[_]=m*s[c+_]+y*s[l+_]+v*s[o+_]+b*s[u+_];return i}}class Em extends _m{constructor(t,e,r,n){super(t,e,r,n)}interpolate_(t,e,r,n){const i=this.resultBuffer,s=this.sampleValues,a=this.valueSize,o=t*a,l=o-a,c=(r-e)/(n-e),u=1-c;for(let h=0;h!==a;++h)i[h]=s[l+h]*u+s[o+h]*c;return i}}class Sm extends _m{constructor(t,e,r,n){super(t,e,r,n)}interpolate_(t){return this.copySampleValue_(t-1)}}class Tm{constructor(t,e,r,n){if(void 0===t)throw new Error("THREE.KeyframeTrack: track name is undefined");if(void 0===e||0===e.length)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+t);this.name=t,this.times=vm(e,this.TimeBufferType),this.values=vm(r,this.ValueBufferType),this.setInterpolation(n||this.DefaultInterpolation)}static toJSON(t){const e=t.constructor;let r;if(e.toJSON!==this.toJSON)r=e.toJSON(t);else{r={name:t.name,times:vm(t.times,Array),values:vm(t.values,Array)};const e=t.getInterpolation();e!==t.DefaultInterpolation&&(r.interpolation=e)}return r.type=t.ValueTypeName,r}InterpolantFactoryMethodDiscrete(t){return new Sm(this.times,this.values,this.getValueSize(),t)}InterpolantFactoryMethodLinear(t){return new Em(this.times,this.values,this.getValueSize(),t)}InterpolantFactoryMethodSmooth(t){return new wm(this.times,this.values,this.getValueSize(),t)}setInterpolation(t){let e;switch(t){case qp:e=this.InterpolantFactoryMethodDiscrete;break;case Yp:e=this.InterpolantFactoryMethodLinear;break;case Qp:e=this.InterpolantFactoryMethodSmooth}if(void 0===e){const e="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(void 0===this.createInterpolant){if(t===this.DefaultInterpolation)throw new Error(e);this.setInterpolation(this.DefaultInterpolation)}return lg("KeyframeTrack:",e),this}return this.createInterpolant=e,this}getInterpolation(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return qp;case this.InterpolantFactoryMethodLinear:return Yp;case this.InterpolantFactoryMethodSmooth:return Qp}}getValueSize(){return this.values.length/this.times.length}shift(t){if(0!==t){const e=this.times;for(let r=0,n=e.length;r!==n;++r)e[r]+=t}return this}scale(t){if(1!==t){const e=this.times;for(let r=0,n=e.length;r!==n;++r)e[r]*=t}return this}trim(t,e){const r=this.times,n=r.length;let i=0,s=n-1;for(;i!==n&&r[i]<t;)++i;for(;-1!==s&&r[s]>e;)--s;if(++s,0!==i||s!==n){i>=s&&(s=Math.max(s,1),i=s-1);const t=this.getValueSize();this.times=r.slice(i,s),this.values=this.values.slice(i*t,s*t)}return this}validate(){let t=!0;const e=this.getValueSize();e-Math.floor(e)!==0&&(cg("KeyframeTrack: Invalid value size in track.",this),t=!1);const r=this.times,n=this.values,i=r.length;0===i&&(cg("KeyframeTrack: Track is empty.",this),t=!1);let s=null;for(let a=0;a!==i;a++){const e=r[a];if("number"===typeof e&&isNaN(e)){cg("KeyframeTrack: Time is not a valid number.",this,a,e),t=!1;break}if(null!==s&&s>e){cg("KeyframeTrack: Out of order keys.",this,a,e,s),t=!1;break}s=e}if(void 0!==n&&bm(n))for(let a=0,o=n.length;a!==o;++a){const e=n[a];if(isNaN(e)){cg("KeyframeTrack: Value is not a valid number.",this,a,e),t=!1;break}}return t}optimize(){const t=this.times.slice(),e=this.values.slice(),r=this.getValueSize(),n=this.getInterpolation()===Qp,i=t.length-1;let s=1;for(let a=1;a<i;++a){let i=!1;const o=t[a];if(o!==t[a+1]&&(1!==a||o!==t[0]))if(n)i=!0;else{const t=a*r,n=t-r,s=t+r;for(let a=0;a!==r;++a){const r=e[t+a];if(r!==e[n+a]||r!==e[s+a]){i=!0;break}}}if(i){if(a!==s){t[s]=t[a];const n=a*r,i=s*r;for(let t=0;t!==r;++t)e[i+t]=e[n+t]}++s}}if(i>0){t[s]=t[i];for(let t=i*r,n=s*r,a=0;a!==r;++a)e[n+a]=e[t+a];++s}return s!==t.length?(this.times=t.slice(0,s),this.values=e.slice(0,s*r)):(this.times=t,this.values=e),this}clone(){const t=this.times.slice(),e=this.values.slice(),r=new(0,this.constructor)(this.name,t,e);return r.createInterpolant=this.createInterpolant,r}}Tm.prototype.ValueTypeName="",Tm.prototype.TimeBufferType=Float32Array,Tm.prototype.ValueBufferType=Float32Array,Tm.prototype.DefaultInterpolation=Yp;class km extends Tm{constructor(t,e,r){super(t,e,r)}}km.prototype.ValueTypeName="bool",km.prototype.ValueBufferType=Array,km.prototype.DefaultInterpolation=qp,km.prototype.InterpolantFactoryMethodLinear=void 0,km.prototype.InterpolantFactoryMethodSmooth=void 0;class Am extends Tm{constructor(t,e,r,n){super(t,e,r,n)}}Am.prototype.ValueTypeName="color";class xm extends Tm{constructor(t,e,r,n){super(t,e,r,n)}}xm.prototype.ValueTypeName="number";class Im extends _m{constructor(t,e,r,n){super(t,e,r,n)}interpolate_(t,e,r,n){const i=this.resultBuffer,s=this.sampleValues,a=this.valueSize,o=(r-e)/(n-e);let l=t*a;for(let c=l+a;l!==c;l+=4)vg.slerpFlat(i,0,s,l-a,s,l,o);return i}}class Rm extends Tm{constructor(t,e,r,n){super(t,e,r,n)}InterpolantFactoryMethodLinear(t){return new Im(this.times,this.values,this.getValueSize(),t)}}Rm.prototype.ValueTypeName="quaternion",Rm.prototype.InterpolantFactoryMethodSmooth=void 0;class Lm extends Tm{constructor(t,e,r){super(t,e,r)}}Lm.prototype.ValueTypeName="string",Lm.prototype.ValueBufferType=Array,Lm.prototype.DefaultInterpolation=qp,Lm.prototype.InterpolantFactoryMethodLinear=void 0,Lm.prototype.InterpolantFactoryMethodSmooth=void 0;class Pm extends Tm{constructor(t,e,r,n){super(t,e,r,n)}}Pm.prototype.ValueTypeName="vector";class Cm{constructor(t,e,r){const n=this;let i,s=!1,a=0,o=0;const l=[];this.onStart=void 0,this.onLoad=t,this.onProgress=e,this.onError=r,this._abortController=null,this.itemStart=function(t){o++,!1===s&&void 0!==n.onStart&&n.onStart(t,a,o),s=!0},this.itemEnd=function(t){a++,void 0!==n.onProgress&&n.onProgress(t,a,o),a===o&&(s=!1,void 0!==n.onLoad&&n.onLoad())},this.itemError=function(t){void 0!==n.onError&&n.onError(t)},this.resolveURL=function(t){return i?i(t):t},this.setURLModifier=function(t){return i=t,this},this.addHandler=function(t,e){return l.push(t,e),this},this.removeHandler=function(t){const e=l.indexOf(t);return-1!==e&&l.splice(e,2),this},this.getHandler=function(t){for(let e=0,r=l.length;e<r;e+=2){const r=l[e],n=l[e+1];if(r.global&&(r.lastIndex=0),r.test(t))return n}return null},this.abort=function(){return this.abortController.abort(),this._abortController=null,this}}get abortController(){return this._abortController||(this._abortController=new AbortController),this._abortController}}const Mm=new Cm;class Om{constructor(t){this.manager=void 0!==t?t:Mm,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(t,e){const r=this;return new Promise(function(n,i){r.load(t,n,e,i)})}parse(){}setCrossOrigin(t){return this.crossOrigin=t,this}setWithCredentials(t){return this.withCredentials=t,this}setPath(t){return this.path=t,this}setResourcePath(t){return this.resourcePath=t,this}setRequestHeader(t){return this.requestHeader=t,this}abort(){return this}}Om.DEFAULT_MATERIAL_NAME="__DEFAULT";Error;new WeakMap;new WeakMap;const Dm="\\[\\]\\.:\\/",Nm=new RegExp("["+Dm+"]","g"),Fm="[^"+Dm+"]",Um="[^"+Dm.replace("\\.","")+"]",Bm=new RegExp("^"+/((?:WC+[\/:])*)/.source.replace("WC",Fm)+/(WCOD+)?/.source.replace("WCOD",Um)+/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",Fm)+/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",Fm)+"$"),jm=["material","materials","bones","map"];class zm{constructor(t,e,r){this.path=e,this.parsedPath=r||zm.parseTrackName(e),this.node=zm.findNode(t,this.parsedPath.nodeName),this.rootNode=t,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}static create(t,e,r){return t&&t.isAnimationObjectGroup?new zm.Composite(t,e,r):new zm(t,e,r)}static sanitizeNodeName(t){return t.replace(/\s/g,"_").replace(Nm,"")}static parseTrackName(t){const e=Bm.exec(t);if(null===e)throw new Error("PropertyBinding: Cannot parse trackName: "+t);const r={nodeName:e[2],objectName:e[3],objectIndex:e[4],propertyName:e[5],propertyIndex:e[6]},n=r.nodeName&&r.nodeName.lastIndexOf(".");if(void 0!==n&&-1!==n){const t=r.nodeName.substring(n+1);-1!==jm.indexOf(t)&&(r.nodeName=r.nodeName.substring(0,n),r.objectName=t)}if(null===r.propertyName||0===r.propertyName.length)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+t);return r}static findNode(t,e){if(void 0===e||""===e||"."===e||-1===e||e===t.name||e===t.uuid)return t;if(t.skeleton){const r=t.skeleton.getBoneByName(e);if(void 0!==r)return r}if(t.children){const r=function(t){for(let n=0;n<t.length;n++){const i=t[n];if(i.name===e||i.uuid===e)return i;const s=r(i.children);if(s)return s}return null},n=r(t.children);if(n)return n}return null}_getValue_unavailable(){}_setValue_unavailable(){}_getValue_direct(t,e){t[e]=this.targetObject[this.propertyName]}_getValue_array(t,e){const r=this.resolvedProperty;for(let n=0,i=r.length;n!==i;++n)t[e++]=r[n]}_getValue_arrayElement(t,e){t[e]=this.resolvedProperty[this.propertyIndex]}_getValue_toArray(t,e){this.resolvedProperty.toArray(t,e)}_setValue_direct(t,e){this.targetObject[this.propertyName]=t[e]}_setValue_direct_setNeedsUpdate(t,e){this.targetObject[this.propertyName]=t[e],this.targetObject.needsUpdate=!0}_setValue_direct_setMatrixWorldNeedsUpdate(t,e){this.targetObject[this.propertyName]=t[e],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_array(t,e){const r=this.resolvedProperty;for(let n=0,i=r.length;n!==i;++n)r[n]=t[e++]}_setValue_array_setNeedsUpdate(t,e){const r=this.resolvedProperty;for(let n=0,i=r.length;n!==i;++n)r[n]=t[e++];this.targetObject.needsUpdate=!0}_setValue_array_setMatrixWorldNeedsUpdate(t,e){const r=this.resolvedProperty;for(let n=0,i=r.length;n!==i;++n)r[n]=t[e++];this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_arrayElement(t,e){this.resolvedProperty[this.propertyIndex]=t[e]}_setValue_arrayElement_setNeedsUpdate(t,e){this.resolvedProperty[this.propertyIndex]=t[e],this.targetObject.needsUpdate=!0}_setValue_arrayElement_setMatrixWorldNeedsUpdate(t,e){this.resolvedProperty[this.propertyIndex]=t[e],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_fromArray(t,e){this.resolvedProperty.fromArray(t,e)}_setValue_fromArray_setNeedsUpdate(t,e){this.resolvedProperty.fromArray(t,e),this.targetObject.needsUpdate=!0}_setValue_fromArray_setMatrixWorldNeedsUpdate(t,e){this.resolvedProperty.fromArray(t,e),this.targetObject.matrixWorldNeedsUpdate=!0}_getValue_unbound(t,e){this.bind(),this.getValue(t,e)}_setValue_unbound(t,e){this.bind(),this.setValue(t,e)}bind(){let t=this.node;const e=this.parsedPath,r=e.objectName,n=e.propertyName;let i=e.propertyIndex;if(t||(t=zm.findNode(this.rootNode,e.nodeName),this.node=t),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!t)return void lg("PropertyBinding: No target node found for track: "+this.path+".");if(r){let n=e.objectIndex;switch(r){case"materials":if(!t.material)return void cg("PropertyBinding: Can not bind to material as node does not have a material.",this);if(!t.material.materials)return void cg("PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);t=t.material.materials;break;case"bones":if(!t.skeleton)return void cg("PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);t=t.skeleton.bones;for(let e=0;e<t.length;e++)if(t[e].name===n){n=e;break}break;case"map":if("map"in t){t=t.map;break}if(!t.material)return void cg("PropertyBinding: Can not bind to material as node does not have a material.",this);if(!t.material.map)return void cg("PropertyBinding: Can not bind to material.map as node.material does not have a map.",this);t=t.material.map;break;default:if(void 0===t[r])return void cg("PropertyBinding: Can not bind to objectName of node undefined.",this);t=t[r]}if(void 0!==n){if(void 0===t[n])return void cg("PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,t);t=t[n]}}const s=t[n];if(void 0===s){return void cg("PropertyBinding: Trying to update property for track: "+e.nodeName+"."+n+" but it wasn't found.",t)}let a=this.Versioning.None;this.targetObject=t,!0===t.isMaterial?a=this.Versioning.NeedsUpdate:!0===t.isObject3D&&(a=this.Versioning.MatrixWorldNeedsUpdate);let o=this.BindingType.Direct;if(void 0!==i){if("morphTargetInfluences"===n){if(!t.geometry)return void cg("PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);if(!t.geometry.morphAttributes)return void cg("PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);void 0!==t.morphTargetDictionary[i]&&(i=t.morphTargetDictionary[i])}o=this.BindingType.ArrayElement,this.resolvedProperty=s,this.propertyIndex=i}else void 0!==s.fromArray&&void 0!==s.toArray?(o=this.BindingType.HasFromToArray,this.resolvedProperty=s):Array.isArray(s)?(o=this.BindingType.EntireArray,this.resolvedProperty=s):this.propertyName=n;this.getValue=this.GetterByBindingType[o],this.setValue=this.SetterByBindingTypeAndVersioning[o][a]}unbind(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}zm.Composite=class{constructor(t,e,r){const n=r||zm.parseTrackName(e);this._targetGroup=t,this._bindings=t.subscribe_(e,n)}getValue(t,e){this.bind();const r=this._targetGroup.nCachedObjects_,n=this._bindings[r];void 0!==n&&n.getValue(t,e)}setValue(t,e){const r=this._bindings;for(let n=this._targetGroup.nCachedObjects_,i=r.length;n!==i;++n)r[n].setValue(t,e)}bind(){const t=this._bindings;for(let e=this._targetGroup.nCachedObjects_,r=t.length;e!==r;++e)t[e].bind()}unbind(){const t=this._bindings;for(let e=this._targetGroup.nCachedObjects_,r=t.length;e!==r;++e)t[e].unbind()}},zm.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},zm.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},zm.prototype.GetterByBindingType=[zm.prototype._getValue_direct,zm.prototype._getValue_array,zm.prototype._getValue_arrayElement,zm.prototype._getValue_toArray],zm.prototype.SetterByBindingTypeAndVersioning=[[zm.prototype._setValue_direct,zm.prototype._setValue_direct_setNeedsUpdate,zm.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[zm.prototype._setValue_array,zm.prototype._setValue_array_setNeedsUpdate,zm.prototype._setValue_array_setMatrixWorldNeedsUpdate],[zm.prototype._setValue_arrayElement,zm.prototype._setValue_arrayElement_setNeedsUpdate,zm.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[zm.prototype._setValue_fromArray,zm.prototype._setValue_fromArray_setNeedsUpdate,zm.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]];new Float32Array(1);"undefined"!==typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:"181"}})),"undefined"!==typeof window&&(window.__THREE__?lg("WARNING: Multiple instances of Three.js being imported."):window.__THREE__="181");class Wm extends t.Component{constructor(){super(...arguments),this.canvasRef=(0,t.createRef)(),this.lastWidth=0,this.lastHeight=0,this.rafId=null,this.resizeAndDraw=()=>{this.rafId||(this.rafId=requestAnimationFrame(()=>{this.rafId=null,this.resizeCanvas(),this.draw()}))}}componentDidMount(){this.resizeAndDraw(),window.addEventListener("resize",this.resizeAndDraw)}componentDidUpdate(){this.resizeAndDraw()}componentWillUnmount(){window.removeEventListener("resize",this.resizeAndDraw),this.rafId&&cancelAnimationFrame(this.rafId)}resizeCanvas(){const t=this.canvasRef.current;if(!t)return;const e=t.parentElement;if(!e)return;const r=e.clientWidth,n=e.clientHeight;0!==r&&0!==n&&(r===this.lastWidth&&n===this.lastHeight||(this.lastWidth=r,this.lastHeight=n,t.width=r,t.height=n))}draw(){const t=this.canvasRef.current;if(!t)return;const e=t.getContext("2d"),r=t.width,n=t.height;if(0===r||0===n)return;e.clearRect(0,0,r,n);const i=.42*Math.min(r,n),s=.12*i,a=.22*i,o=.14*i,l=r/2,c=n-.15*i,{value:u=0,max:h=1,label:d="",unit:f=""}=this.props;let p=Math.abs(u)/h*100;p=Math.max(0,Math.min(p,100));let g="#444";p>0&&(g=p<=40?"#00ff9f":p<=55?"#e5fe00":p<=65?"#ff6600":p<=75?"#ff2200":"#ff00cc"),e.beginPath(),e.arc(l,c,i,Math.PI,2*Math.PI),e.lineWidth=2*s,e.strokeStyle="#444",e.stroke(),p>0&&(e.beginPath(),e.arc(l,c,i,Math.PI,Math.PI+p/100*Math.PI),e.lineWidth=2*s,e.strokeStyle=g,e.stroke()),e.fillStyle="#e0e7ff",e.font="".concat(2.2*a,"px Arial"),e.textAlign="center",e.textBaseline="middle",e.fillText(p.toFixed(1),l,c-.15*i),e.fillStyle="#aaa",e.font="".concat(2.4*o,"px Arial"),e.fillText("".concat(d," (").concat(f,")"),l,c-1.5*i)}render(){return(0,Me.jsx)("div",{className:"gauge-wrapper",children:(0,Me.jsx)("canvas",{ref:this.canvasRef,style:{width:"100%",height:"100%",display:"block"}})})}}const Gm=Wm;class Vm extends t.Component{constructor(t){super(t),this.state={roll:0,pitch:0,heading:0,connected:!1},this.imuTopic=cu.IMU_TOPIC}componentDidMount(){const t=()=>{const t=hu.client&&hu.client.connected;t&&!this.state.connected?this.setState({connected:!0},()=>this.initSubscriber()):!t&&this.state.connected&&(this.setState({connected:!1,roll:0,pitch:0,heading:0}),this.imuSubscription&&hu.unsubscribe(this.imuTopic))};this.interval=setInterval(t,2e3),t()}componentWillUnmount(){clearInterval(this.interval),this.imuSubscription&&hu.unsubscribe(this.imuTopic)}initSubscriber(){this.imuSubscription=t=>{const e=t.imu.orientation,r=new vg(e.x,e.y,e.z,e.w),n=(new Yg).setFromQuaternion(r,"ZYX"),i=n.x*(180/Math.PI),s=n.y*(180/Math.PI),a=n.z*(180/Math.PI);this.setState({roll:i,pitch:s,heading:a})},hu.subscribe(this.imuTopic,this.imuSubscription)}render(){const{connected:t,roll:e,pitch:r,heading:n}=this.state,i=Math.abs(e)>30||Math.abs(r)>30;return(0,Me.jsx)("div",{className:"imu-indicator-wrapper",children:t?(0,Me.jsxs)("div",{className:"imu-indicator ".concat(i?"imu-alert":""),children:[(0,Me.jsx)("div",{className:"attitude",children:(0,Me.jsxs)("svg",{viewBox:"-60 -60 120 120",className:"attitude-svg",children:[(0,Me.jsx)("rect",{x:"-60",y:"-56",width:"120",height:"56",fill:"#6115efff"}),(0,Me.jsx)("rect",{x:"-60",y:"0",width:"120",height:"57",fill:"#1dc081ff"}),(0,Me.jsx)("line",{x1:"-50",y1:"0",x2:"50",y2:"0",stroke:"#fff",strokeWidth:"0.5"}),(0,Me.jsxs)("g",{className:"attitude-group",transform:"translate(0,".concat(.5*r,") rotate(").concat(e,")"),children:[(0,Me.jsx)("line",{x1:"-70",y1:"0",x2:"70",y2:"0",stroke:"#fff",strokeWidth:"0.5"}),(0,Me.jsx)("line",{x1:"-70",y1:"0",x2:"-65",y2:"5",stroke:"#fff"}),(0,Me.jsx)("line",{x1:"70",y1:"0",x2:"65",y2:"-5",stroke:"#fff"})]}),(0,Me.jsx)("g",{transform:"translate(0,".concat(1*r,") rotate(").concat(.5*e,")"),children:[-30,-20,-10,0,10,20,30].map(t=>(0,Me.jsxs)("g",{transform:"translate(0,".concat(1*-t,")"),children:[(0,Me.jsx)("line",{x1:"-15",y1:"0",x2:"15",y2:"0",stroke:"#fff",strokeWidth:"0.8"}),0!==t&&(0,Me.jsx)("text",{x:"20",y:"2",fill:"#fff",fontSize:"5.5",children:t>0?"+".concat(t):t})]},t))}),[-30,-20,-10,10,20,30].map(t=>(0,Me.jsxs)("g",{children:[(0,Me.jsxs)("g",{transform:"rotate(".concat(t,") translate(-48 ,10)"),children:[(0,Me.jsx)("line",{x1:"0",y1:"0",x2:"0",y2:"-6",stroke:"#fff",strokeWidth:"0.1"}),(0,Me.jsx)("text",{x:"-3",y:"-8",fill:"#fff",fontSize:"5.0",textAnchor:"end",children:Math.abs(t)})]}),(0,Me.jsxs)("g",{transform:"rotate(".concat(-t,") translate(48,10)"),children:[(0,Me.jsx)("line",{x1:"0",y1:"0",x2:"0",y2:"-6",stroke:"#fff",strokeWidth:"0.1"}),(0,Me.jsx)("text",{x:"3",y:"-8",fill:"#fff",fontSize:"5.0",textAnchor:"start",children:Math.abs(t)})]})]},t)),(0,Me.jsx)("polygon",{points:"0,-5 -5,5 5,5",fill:"#ff0000",transform:"rotate(".concat(-n,")")}),(0,Me.jsx)("circle",{cx:"0",cy:"0",r:"48",fill:"none",stroke:"#fff",strokeWidth:"0.5"})]})}),(0,Me.jsxs)("div",{className:"values",children:[(0,Me.jsxs)("span",{children:["Roll: ",e.toFixed(1),"\xb0"]}),(0,Me.jsxs)("span",{children:["Pitch: ",r.toFixed(1),"\xb0"]}),(0,Me.jsxs)("span",{children:["Yaw: ",Math.round(n),"\xb0"]})]})]}):(0,Me.jsx)("div",{className:" imu-status-block",children:(0,Me.jsx)("span",{className:"imu-status",children:"\u7b49\u5f85\u9023\u7dda\u4e2d \u2026"})})})}}const Hm=Vm;class Km extends t.Component{constructor(t){super(t),this.handleResize=()=>{this.setState({width:window.innerWidth})},this.state={width:window.innerWidth,connected:!1,x:0,y:0,orientation:0,linear_velocity:0,angular_velocity:0},this.odomTopic=cu.ODOM_TOPIC,this.odomSubscription=null}componentDidMount(){window.addEventListener("resize",this.handleResize),this.checkInterval=setInterval(()=>{var t;const e=(null===(t=hu.client)||void 0===t?void 0:t.connected)||!1;e&&!this.state.connected?this.setState({connected:!0},()=>this.initSubscriber()):!e&&this.state.connected&&this.setState({connected:!1,x:0,y:0,orientation:0,linear_velocity:0,angular_velocity:0})},2e3)}componentWillUnmount(){window.removeEventListener("resize",this.handleResize),clearInterval(this.checkInterval),this.odomSubscription&&(hu.unsubscribe(this.odomTopic,this.odomSubscription),this.odomSubscription=null)}initSubscriber(){this.odomSubscription=t=>{if(null===t||void 0===t||!t.pose)return;const e=t.pose.position,r=this.getOrientationFromQuaternion(t.pose.orientation),n=t.twist.linear.x,i=t.twist.angular.z;this.setState({x:e.x,y:e.y,orientation:r,linear_velocity:n,angular_velocity:i})},hu.subscribe(this.odomTopic,this.odomSubscription)}getOrientationFromQuaternion(t){const e=new vg(t.x,t.y,t.z,t.w);return(new Yg).setFromQuaternion(e).z*(180/Math.PI)}render(){const{x:t,y:e,orientation:r,linear_velocity:n,angular_velocity:i,width:s}=this.state,a=s>1180||window.innerHeight>window.innerWidth;return(0,Me.jsxs)("div",{className:"robot-state-wrapper",children:[(0,Me.jsxs)("div",{className:"main-border pos-state-block",children:[(0,Me.jsx)("span",{children:"Realtime Position"}),(0,Me.jsxs)("div",{className:"realtime-pos-state-msg",children:[(0,Me.jsxs)("span",{children:["x: ",t.toFixed(2)]}),(0,Me.jsxs)("span",{children:["y: ",e.toFixed(2)]}),(0,Me.jsxs)("span",{children:["Orientation: ",r.toFixed(2),"\xb0"]})]})]}),(0,Me.jsxs)("div",{className:"main-border vel-state-block",children:[(0,Me.jsx)("span",{children:"Velocities"}),(0,Me.jsxs)("div",{children:[(0,Me.jsx)(Gm,{value:n,min:-1,max:1,label:"Linear",unit:"m/s"}),(0,Me.jsx)(Gm,{value:i,min:-1,max:1,label:"Angular",unit:"rad/s",linearValue:n})]})]}),a&&(0,Me.jsx)("div",{className:"imu-state-block",children:(0,Me.jsx)(Hm,{})})]})}}const qm=Km,Ym=e=>{let{onMove:r,onStop:n}=e;const i=(0,t.useRef)(null),[s,a]=(0,t.useState)(0),[o,l]=(0,t.useState)({x:0,y:0}),[c,u]=(0,t.useState)(!1),h=s/2,d=.25*s,f=(0,t.useCallback)(t=>{if(!i.current||0===s)return;const e=i.current.getBoundingClientRect(),r=t.clientX-(e.left+h),n=t.clientY-(e.top+h),a=Math.min(Math.sqrt(r*r+n*n),h-d),o=Math.atan2(n,r),c=Math.cos(o)*a,u=Math.sin(o)*a;l({x:c,y:u})},[s,h,d]),p=(0,t.useCallback)(()=>{u(!1),l({x:0,y:0}),n&&n()},[n]);return(0,t.useEffect)(()=>{let t;const e=()=>{if(c&&r){const t=o.x/(h-d),e=-o.y/(h-d);r({x:t,y:-e})}t=requestAnimationFrame(e)};return e(),()=>cancelAnimationFrame(t)},[c,o,r,h,d]),(0,t.useEffect)(()=>{const t=i.current;if(!t)return;const e=t=>{c&&f(t)};return t.addEventListener("pointermove",e),t.addEventListener("pointerup",p),t.addEventListener("pointerleave",p),()=>{t.removeEventListener("pointermove",e),t.removeEventListener("pointerup",p),t.removeEventListener("pointerleave",p)}},[c,f,p]),(0,t.useEffect)(()=>{if(!i.current)return;const t=()=>{const t=i.current.getBoundingClientRect();a(t.width)};return t(),window.addEventListener("resize",t),()=>window.removeEventListener("resize",t)},[]),(0,Me.jsx)("div",{ref:i,onPointerDown:t=>{u(!0),i.current.setPointerCapture(t.pointerId),f(t)},className:"joystick-base",children:(0,Me.jsx)("div",{style:{width:2*d,height:2*d,borderRadius:"50%",position:"absolute",left:h-d+o.x,top:h-d+o.y,transition:c?"none":"0.2s ease-out",background:"radial-gradient(circle at 30% 30%, #00ffb0, #009f70 90%)",boxShadow:"0 4px 11px rgba(0,255,159,0.8), inset 0 2px 6px rgba(255,255,255,0.4)"}})})};class Qm extends t.Component{constructor(){super(),this.handleKeyDown=t=>{this.keysPressed[t.key]=!0},this.handleKeyUp=t=>{delete this.keysPressed[t.key],"ArrowUp"!==t.key&&"ArrowDown"!==t.key||(this.linFactor=.2),"ArrowLeft"!==t.key&&"ArrowRight"!==t.key||(this.angFactor=.2)},this.publishKeyboardTwist=()=>{if(!hu.client||!hu.client.connected)return;let t=0,e=0;this.keysPressed.ArrowUp||this.keysPressed.ArrowDown?this.linFactor=Math.min(this.linFactor+.05,1):this.linFactor=.2,this.keysPressed.ArrowLeft||this.keysPressed.ArrowRight?this.angFactor=Math.min(this.angFactor+.05,1):this.angFactor=.2,this.keysPressed.ArrowUp&&(t+=.7*this.linFactor),this.keysPressed.ArrowDown&&(t-=.7*this.linFactor),this.keysPressed.ArrowLeft&&(e+=.6*this.angFactor),this.keysPressed.ArrowRight&&(e-=.6*this.angFactor);const r={linear:{x:t,y:0,z:0},angular:{x:0,y:0,z:e}};hu.publish(cu.CMD_VEL_TOPIC,r)},this.state={connected:!1},this.handleMove=this.handleMove.bind(this),this.handleStop=this.handleStop.bind(this),this.linFactor=.2,this.angFactor=.2,this.keysPressed={}}componentDidMount(){this.interval=setInterval(()=>{const t=hu.client&&hu.client.connected;t!==this.state.connected&&this.setState({connected:t})},500),window.addEventListener("keydown",this.handleKeyDown),window.addEventListener("keyup",this.handleKeyUp),this.keyLoop=setInterval(this.publishKeyboardTwist,100)}componentWillUnmount(){clearInterval(this.interval),clearInterval(this.keyLoop),window.removeEventListener("keydown",this.handleKeyDown),window.removeEventListener("keyup",this.handleKeyUp)}handleMove(t){if(!hu.client||!hu.client.connected)return;const e={linear:{x:.7*-t.y,y:0,z:0},angular:{x:0,y:0,z:.6*-t.x}};hu.publish(cu.CMD_VEL_TOPIC,e)}handleStop(){if(!hu.client||!hu.client.connected)return;this.linFactor=.2,this.angFactor=.2;hu.publish(cu.CMD_VEL_TOPIC,{linear:{x:0,y:0,z:0},angular:{x:0,y:0,z:0}})}render(){return(0,Me.jsx)("div",{className:"tele-box",children:(0,Me.jsx)(Ym,{onMove:this.handleMove,onStop:this.handleStop})})}}const Xm=Qm;class $m extends t.Component{constructor(t){super(t),this.state={connected:!1,percentage:50,blink:!1,receivedReal:!1},this.simulate=!0===t.simulate,this.simulateIntervalMs=3e3,this.blinkIntervalMs=800,this.blinkThreshold=10,this.barBorderColor="#999",this.batteryColors={high:"#00ff66",mid:"#ffaa00",low:"#ff3333"}}componentDidMount(){this._firstTickSkipped=!1,this.interval=setInterval(()=>{const t=hu.connected;if(t!==this.state.connected&&this.setState({connected:t},()=>{t&&!this.simulate&&this.initSubscriber()}),this.simulate&&t){if(!this._firstTickSkipped)return void(this._firstTickSkipped=!0);this.setState(t=>({percentage:Math.max(t.percentage-1,0)}))}},this.simulateIntervalMs),this.blinkTimer=setInterval(()=>{this.state.percentage<=this.blinkThreshold?this.setState(t=>({blink:!t.blink})):this.setState({blink:!1})},this.blinkIntervalMs)}componentWillUnmount(){clearInterval(this.interval),clearInterval(this.blinkTimer),this.topic&&(this.topic.unsubscribe(),this.topic=null)}initSubscriber(){this.topic||(this.topic=hu.subscribe("robot1/battery_state",t=>{this.simulate||this.setState({percentage:100*t.percentage,receivedReal:!0})}))}getBatteryColor(t){return t<=20?this.batteryColors.low:t<=40?this.batteryColors.mid:this.batteryColors.high}renderBatteryBars(t){const{blink:e}=this.state,r=this.getBatteryColor(t),n=t<=this.blinkThreshold&&e;return(0,Me.jsxs)("div",{className:"battery-container-horizontal",children:[(0,Me.jsx)("div",{className:"battery-fill",style:{width:"".concat(Math.max(t,0),"%"),backgroundColor:n?"transparent":r,borderColor:this.barBorderColor}}),(0,Me.jsx)("div",{className:"battery-cap-horizontal"})]})}render(){const{connected:t,percentage:e,receivedReal:r}=this.state;let n;return n=this.simulate?t?e:0:t&&r?e:0,(0,Me.jsxs)("div",{className:"power-status-wrapper horizontal",children:[(0,Me.jsxs)("div",{className:"power-status-text",children:[n.toFixed(0),"%"]}),(0,Me.jsx)("div",{className:"power-status-block horizontal",children:this.renderBatteryBars(n)})]})}}const Zm=$m;class Jm extends t.Component{constructor(t){super(t),this.triggerStop=()=>{hu.publish(this.safetyStopTopic,{data:!0});hu.publish(this.cmdVelTopic,{linear:{x:0,y:0,z:0},angular:{x:0,y:0,z:0}}),this.setState({stopped:!0})},this.triggerResume=()=>{hu.publish(this.safetyStopTopic,{data:!1}),this.setState({stopped:!1})},this.handlePress=()=>{hu.client&&hu.client.connected&&(this.setState({pressed:!0}),this.state.stopped?this.triggerResume():this.triggerStop(),setTimeout(()=>this.setState({pressed:!1}),150))},this.state={pressed:!1,stopped:!1},this.safetyStopTopic=cu.SAFETY_STOP_TOPIC,this.cmdVelTopic=cu.CMD_VEL_TOPIC}render(){const{pressed:t,stopped:e}=this.state,r=e?"radial-gradient(circle, #4CAF50 0%, #1B5E20 90%)":"radial-gradient(circle, #FFD54F 0%, #F57F17 90%)",n=e?"RESUME":"PAUSE";return(0,Me.jsx)("div",{className:"safetyStop-btn ".concat(t?"pressed":""),style:{background:r},onClick:this.handlePress,children:(0,Me.jsxs)("span",{className:"safetyStop-text",children:[(0,Me.jsx)("span",{className:"safetyStop-icon ".concat(e?"icon-play":"icon-pause")}),n]})})}}const ty=Jm;class ey extends t.Component{constructor(t){super(t),this.handlePress=()=>{if(!hu.client||!hu.client.connected)return;this.setState({pressed:!0}),hu.publish(this.cancelNavTopic,{data:!0});hu.publish(this.cmdVelTopic,{linear:{x:0,y:0,z:0},angular:{x:0,y:0,z:0}}),setTimeout(()=>this.setState({pressed:!1}),150)},this.state={pressed:!1},this.cancelNavTopic=cu.EMERGENCY_CANCEL_NAV_TOPIC,this.cmdVelTopic=cu.CMD_VEL_TOPIC}render(){const{pressed:t}=this.state;return(0,Me.jsx)("div",{className:"emergency-btn ".concat(t?"pressed":""),onClick:this.handlePress,children:(0,Me.jsx)("span",{className:"emergency-text",children:"EMERGENCY"})})}}const ry=ey,ny=Number.isFinite||function(t){return"number"===typeof t&&isFinite(t)},iy=Number.isSafeInteger||function(t){return"number"===typeof t&&Math.abs(t)<=sy},sy=Number.MAX_SAFE_INTEGER||9007199254740991;let ay=function(t){return t.NETWORK_ERROR="networkError",t.MEDIA_ERROR="mediaError",t.KEY_SYSTEM_ERROR="keySystemError",t.MUX_ERROR="muxError",t.OTHER_ERROR="otherError",t}({}),oy=function(t){return t.KEY_SYSTEM_NO_KEYS="keySystemNoKeys",t.KEY_SYSTEM_NO_ACCESS="keySystemNoAccess",t.KEY_SYSTEM_NO_SESSION="keySystemNoSession",t.KEY_SYSTEM_NO_CONFIGURED_LICENSE="keySystemNoConfiguredLicense",t.KEY_SYSTEM_LICENSE_REQUEST_FAILED="keySystemLicenseRequestFailed",t.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED="keySystemServerCertificateRequestFailed",t.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED="keySystemServerCertificateUpdateFailed",t.KEY_SYSTEM_SESSION_UPDATE_FAILED="keySystemSessionUpdateFailed",t.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED="keySystemStatusOutputRestricted",t.KEY_SYSTEM_STATUS_INTERNAL_ERROR="keySystemStatusInternalError",t.KEY_SYSTEM_DESTROY_MEDIA_KEYS_ERROR="keySystemDestroyMediaKeysError",t.KEY_SYSTEM_DESTROY_CLOSE_SESSION_ERROR="keySystemDestroyCloseSessionError",t.KEY_SYSTEM_DESTROY_REMOVE_SESSION_ERROR="keySystemDestroyRemoveSessionError",t.MANIFEST_LOAD_ERROR="manifestLoadError",t.MANIFEST_LOAD_TIMEOUT="manifestLoadTimeOut",t.MANIFEST_PARSING_ERROR="manifestParsingError",t.MANIFEST_INCOMPATIBLE_CODECS_ERROR="manifestIncompatibleCodecsError",t.LEVEL_EMPTY_ERROR="levelEmptyError",t.LEVEL_LOAD_ERROR="levelLoadError",t.LEVEL_LOAD_TIMEOUT="levelLoadTimeOut",t.LEVEL_PARSING_ERROR="levelParsingError",t.LEVEL_SWITCH_ERROR="levelSwitchError",t.AUDIO_TRACK_LOAD_ERROR="audioTrackLoadError",t.AUDIO_TRACK_LOAD_TIMEOUT="audioTrackLoadTimeOut",t.SUBTITLE_LOAD_ERROR="subtitleTrackLoadError",t.SUBTITLE_TRACK_LOAD_TIMEOUT="subtitleTrackLoadTimeOut",t.FRAG_LOAD_ERROR="fragLoadError",t.FRAG_LOAD_TIMEOUT="fragLoadTimeOut",t.FRAG_DECRYPT_ERROR="fragDecryptError",t.FRAG_PARSING_ERROR="fragParsingError",t.FRAG_GAP="fragGap",t.REMUX_ALLOC_ERROR="remuxAllocError",t.KEY_LOAD_ERROR="keyLoadError",t.KEY_LOAD_TIMEOUT="keyLoadTimeOut",t.BUFFER_ADD_CODEC_ERROR="bufferAddCodecError",t.BUFFER_INCOMPATIBLE_CODECS_ERROR="bufferIncompatibleCodecsError",t.BUFFER_APPEND_ERROR="bufferAppendError",t.BUFFER_APPENDING_ERROR="bufferAppendingError",t.BUFFER_STALLED_ERROR="bufferStalledError",t.BUFFER_FULL_ERROR="bufferFullError",t.BUFFER_SEEK_OVER_HOLE="bufferSeekOverHole",t.BUFFER_NUDGE_ON_STALL="bufferNudgeOnStall",t.ASSET_LIST_LOAD_ERROR="assetListLoadError",t.ASSET_LIST_LOAD_TIMEOUT="assetListLoadTimeout",t.ASSET_LIST_PARSING_ERROR="assetListParsingError",t.INTERSTITIAL_ASSET_ITEM_ERROR="interstitialAssetItemError",t.INTERNAL_EXCEPTION="internalException",t.INTERNAL_ABORTED="aborted",t.ATTACH_MEDIA_ERROR="attachMediaError",t.UNKNOWN="unknown",t}({}),ly=function(t){return t.MEDIA_ATTACHING="hlsMediaAttaching",t.MEDIA_ATTACHED="hlsMediaAttached",t.MEDIA_DETACHING="hlsMediaDetaching",t.MEDIA_DETACHED="hlsMediaDetached",t.MEDIA_ENDED="hlsMediaEnded",t.STALL_RESOLVED="hlsStallResolved",t.BUFFER_RESET="hlsBufferReset",t.BUFFER_CODECS="hlsBufferCodecs",t.BUFFER_CREATED="hlsBufferCreated",t.BUFFER_APPENDING="hlsBufferAppending",t.BUFFER_APPENDED="hlsBufferAppended",t.BUFFER_EOS="hlsBufferEos",t.BUFFERED_TO_END="hlsBufferedToEnd",t.BUFFER_FLUSHING="hlsBufferFlushing",t.BUFFER_FLUSHED="hlsBufferFlushed",t.MANIFEST_LOADING="hlsManifestLoading",t.MANIFEST_LOADED="hlsManifestLoaded",t.MANIFEST_PARSED="hlsManifestParsed",t.LEVEL_SWITCHING="hlsLevelSwitching",t.LEVEL_SWITCHED="hlsLevelSwitched",t.LEVEL_LOADING="hlsLevelLoading",t.LEVEL_LOADED="hlsLevelLoaded",t.LEVEL_UPDATED="hlsLevelUpdated",t.LEVEL_PTS_UPDATED="hlsLevelPtsUpdated",t.LEVELS_UPDATED="hlsLevelsUpdated",t.AUDIO_TRACKS_UPDATED="hlsAudioTracksUpdated",t.AUDIO_TRACK_SWITCHING="hlsAudioTrackSwitching",t.AUDIO_TRACK_SWITCHED="hlsAudioTrackSwitched",t.AUDIO_TRACK_LOADING="hlsAudioTrackLoading",t.AUDIO_TRACK_LOADED="hlsAudioTrackLoaded",t.AUDIO_TRACK_UPDATED="hlsAudioTrackUpdated",t.SUBTITLE_TRACKS_UPDATED="hlsSubtitleTracksUpdated",t.SUBTITLE_TRACKS_CLEARED="hlsSubtitleTracksCleared",t.SUBTITLE_TRACK_SWITCH="hlsSubtitleTrackSwitch",t.SUBTITLE_TRACK_LOADING="hlsSubtitleTrackLoading",t.SUBTITLE_TRACK_LOADED="hlsSubtitleTrackLoaded",t.SUBTITLE_TRACK_UPDATED="hlsSubtitleTrackUpdated",t.SUBTITLE_FRAG_PROCESSED="hlsSubtitleFragProcessed",t.CUES_PARSED="hlsCuesParsed",t.NON_NATIVE_TEXT_TRACKS_FOUND="hlsNonNativeTextTracksFound",t.INIT_PTS_FOUND="hlsInitPtsFound",t.FRAG_LOADING="hlsFragLoading",t.FRAG_LOAD_EMERGENCY_ABORTED="hlsFragLoadEmergencyAborted",t.FRAG_LOADED="hlsFragLoaded",t.FRAG_DECRYPTED="hlsFragDecrypted",t.FRAG_PARSING_INIT_SEGMENT="hlsFragParsingInitSegment",t.FRAG_PARSING_USERDATA="hlsFragParsingUserdata",t.FRAG_PARSING_METADATA="hlsFragParsingMetadata",t.FRAG_PARSED="hlsFragParsed",t.FRAG_BUFFERED="hlsFragBuffered",t.FRAG_CHANGED="hlsFragChanged",t.FPS_DROP="hlsFpsDrop",t.FPS_DROP_LEVEL_CAPPING="hlsFpsDropLevelCapping",t.MAX_AUTO_LEVEL_UPDATED="hlsMaxAutoLevelUpdated",t.ERROR="hlsError",t.DESTROYING="hlsDestroying",t.KEY_LOADING="hlsKeyLoading",t.KEY_LOADED="hlsKeyLoaded",t.LIVE_BACK_BUFFER_REACHED="hlsLiveBackBufferReached",t.BACK_BUFFER_REACHED="hlsBackBufferReached",t.STEERING_MANIFEST_LOADED="hlsSteeringManifestLoaded",t.ASSET_LIST_LOADING="hlsAssetListLoading",t.ASSET_LIST_LOADED="hlsAssetListLoaded",t.INTERSTITIALS_UPDATED="hlsInterstitialsUpdated",t.INTERSTITIALS_BUFFERED_TO_BOUNDARY="hlsInterstitialsBufferedToBoundary",t.INTERSTITIAL_ASSET_PLAYER_CREATED="hlsInterstitialAssetPlayerCreated",t.INTERSTITIAL_STARTED="hlsInterstitialStarted",t.INTERSTITIAL_ASSET_STARTED="hlsInterstitialAssetStarted",t.INTERSTITIAL_ASSET_ENDED="hlsInterstitialAssetEnded",t.INTERSTITIAL_ASSET_ERROR="hlsInterstitialAssetError",t.INTERSTITIAL_ENDED="hlsInterstitialEnded",t.INTERSTITIALS_PRIMARY_RESUMED="hlsInterstitialsPrimaryResumed",t.PLAYOUT_LIMIT_REACHED="hlsPlayoutLimitReached",t.EVENT_CUE_ENTER="hlsEventCueEnter",t}({});var cy="manifest",uy="level",hy="audioTrack",dy="subtitleTrack",fy="main",py="audio",gy="subtitle";class my{constructor(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.halfLife=void 0,this.alpha_=void 0,this.estimate_=void 0,this.totalWeight_=void 0,this.halfLife=t,this.alpha_=t?Math.exp(Math.log(.5)/t):0,this.estimate_=e,this.totalWeight_=r}sample(t,e){const r=Math.pow(this.alpha_,t);this.estimate_=e*(1-r)+r*this.estimate_,this.totalWeight_+=t}getTotalWeight(){return this.totalWeight_}getEstimate(){if(this.alpha_){const t=1-Math.pow(this.alpha_,this.totalWeight_);if(t)return this.estimate_/t}return this.estimate_}}class yy{constructor(t,e,r){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:100;this.defaultEstimate_=void 0,this.minWeight_=void 0,this.minDelayMs_=void 0,this.slow_=void 0,this.fast_=void 0,this.defaultTTFB_=void 0,this.ttfb_=void 0,this.defaultEstimate_=r,this.minWeight_=.001,this.minDelayMs_=50,this.slow_=new my(t),this.fast_=new my(e),this.defaultTTFB_=n,this.ttfb_=new my(t)}update(t,e){const{slow_:r,fast_:n,ttfb_:i}=this;r.halfLife!==t&&(this.slow_=new my(t,r.getEstimate(),r.getTotalWeight())),n.halfLife!==e&&(this.fast_=new my(e,n.getEstimate(),n.getTotalWeight())),i.halfLife!==t&&(this.ttfb_=new my(t,i.getEstimate(),i.getTotalWeight()))}sample(t,e){const r=(t=Math.max(t,this.minDelayMs_))/1e3,n=8*e/r;this.fast_.sample(r,n),this.slow_.sample(r,n)}sampleTTFB(t){const e=t/1e3,r=Math.sqrt(2)*Math.exp(-Math.pow(e,2)/2);this.ttfb_.sample(r,Math.max(t,5))}canEstimate(){return this.fast_.getTotalWeight()>=this.minWeight_}getEstimate(){return this.canEstimate()?Math.min(this.fast_.getEstimate(),this.slow_.getEstimate()):this.defaultEstimate_}getEstimateTTFB(){return this.ttfb_.getTotalWeight()>=this.minWeight_?this.ttfb_.getEstimate():this.defaultTTFB_}get defaultEstimate(){return this.defaultEstimate_}destroy(){}}function vy(t,e,r){return(e=function(t){var e=function(t,e){if("object"!=typeof t||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,e);if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:e+""}(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function by(){return by=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var n in r)({}).hasOwnProperty.call(r,n)&&(t[n]=r[n])}return t},by.apply(null,arguments)}function _y(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),r.push.apply(r,n)}return r}function wy(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?_y(Object(r),!0).forEach(function(e){vy(t,e,r[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):_y(Object(r)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))})}return t}class Ey{constructor(t,e){this.trace=void 0,this.debug=void 0,this.log=void 0,this.warn=void 0,this.info=void 0,this.error=void 0;const r="[".concat(t,"]:");this.trace=Sy,this.debug=e.debug.bind(null,r),this.log=e.log.bind(null,r),this.warn=e.warn.bind(null,r),this.info=e.info.bind(null,r),this.error=e.error.bind(null,r)}}const Sy=function(){},Ty={trace:Sy,debug:Sy,log:Sy,warn:Sy,info:Sy,error:Sy};function ky(){return by({},Ty)}function Ay(t,e,r){return e[t]?e[t].bind(e):function(t,e){const r=self.console[t];return r?r.bind(self.console,"".concat(e?"["+e+"] ":"","[").concat(t,"] >")):Sy}(t,r)}const xy=ky();const Iy=xy;function Ry(){if("undefined"===typeof self)return;return(!(arguments.length>0&&void 0!==arguments[0])||arguments[0]||!self.MediaSource)&&self.ManagedMediaSource||self.MediaSource||self.WebKitMediaSource}function Ly(t,e){const r=Object.keys(t),n=Object.keys(e),i=r.length,s=n.length;return!i||!s||i===s&&!r.some(t=>-1===n.indexOf(t))}function Py(t){let e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if("undefined"!==typeof TextDecoder){const r=new TextDecoder("utf-8").decode(t);if(e){const t=r.indexOf("\0");return-1!==t?r.substring(0,t):r}return r.replace(/\0/g,"")}const r=t.length;let n,i,s,a="",o=0;for(;o<r;){if(n=t[o++],0===n&&e)return a;if(0!==n&&3!==n)switch(n>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:a+=String.fromCharCode(n);break;case 12:case 13:i=t[o++],a+=String.fromCharCode((31&n)<<6|63&i);break;case 14:i=t[o++],s=t[o++],a+=String.fromCharCode((15&n)<<12|(63&i)<<6|63&s)}}return a}function Cy(t){let e="";for(let r=0;r<t.length;r++){let n=t[r].toString(16);n.length<2&&(n="0"+n),e+=n}return e}function My(t){return Uint8Array.from(t.replace(/^0x/,"").replace(/([\da-fA-F]{2}) ?/g,"0x$1 ").replace(/ +$/,"").split(" ")).buffer}function Oy(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var Dy,Ny={exports:{}};var Fy=function(){return Dy||(Dy=1,t=Ny,function(){var e=/^(?=((?:[a-zA-Z0-9+\-.]+:)?))\1(?=((?:\/\/[^\/?#]*)?))\2(?=((?:(?:[^?#\/]*\/)*[^;?#\/]*)?))\3((?:;[^?#]*)?)(\?[^#]*)?(#[^]*)?$/,r=/^(?=([^\/?#]*))\1([^]*)$/,n=/(?:\/|^)\.(?=\/)/g,i=/(?:\/|^)\.\.\/(?!\.\.\/)[^\/]*(?=\/)/g,s={buildAbsoluteURL:function(t,e,n){if(n=n||{},t=t.trim(),!(e=e.trim())){if(!n.alwaysNormalize)return t;var i=s.parseURL(t);if(!i)throw new Error("Error trying to parse base URL.");return i.path=s.normalizePath(i.path),s.buildURLFromParts(i)}var a=s.parseURL(e);if(!a)throw new Error("Error trying to parse relative URL.");if(a.scheme)return n.alwaysNormalize?(a.path=s.normalizePath(a.path),s.buildURLFromParts(a)):e;var o=s.parseURL(t);if(!o)throw new Error("Error trying to parse base URL.");if(!o.netLoc&&o.path&&"/"!==o.path[0]){var l=r.exec(o.path);o.netLoc=l[1],o.path=l[2]}o.netLoc&&!o.path&&(o.path="/");var c={scheme:o.scheme,netLoc:a.netLoc,path:null,params:a.params,query:a.query,fragment:a.fragment};if(!a.netLoc&&(c.netLoc=o.netLoc,"/"!==a.path[0]))if(a.path){var u=o.path,h=u.substring(0,u.lastIndexOf("/")+1)+a.path;c.path=s.normalizePath(h)}else c.path=o.path,a.params||(c.params=o.params,a.query||(c.query=o.query));return null===c.path&&(c.path=n.alwaysNormalize?s.normalizePath(a.path):a.path),s.buildURLFromParts(c)},parseURL:function(t){var r=e.exec(t);return r?{scheme:r[1]||"",netLoc:r[2]||"",path:r[3]||"",params:r[4]||"",query:r[5]||"",fragment:r[6]||""}:null},normalizePath:function(t){for(t=t.split("").reverse().join("").replace(n,"");t.length!==(t=t.replace(i,"")).length;);return t.split("").reverse().join("")},buildURLFromParts:function(t){return t.scheme+t.netLoc+t.path+t.params+t.query+t.fragment}};t.exports=s}()),Ny.exports;var t}();class Uy{constructor(){this.aborted=!1,this.loaded=0,this.retry=0,this.total=0,this.chunkCount=0,this.bwEstimate=0,this.loading={start:0,first:0,end:0},this.parsing={start:0,end:0},this.buffering={start:0,first:0,end:0}}}var By="audio",jy="video",zy="audiovideo";class Wy{constructor(t){this._byteRange=null,this._url=null,this._stats=null,this._streams=null,this.base=void 0,this.relurl=void 0,"string"===typeof t&&(t={url:t}),this.base=t,function(t,e){const r=Ky(t,e);r&&(r.enumerable=!0,Object.defineProperty(t,e,r))}(this,"stats")}setByteRange(t,e){const r=t.split("@",2);let n;n=1===r.length?(null==e?void 0:e.byteRangeEndOffset)||0:parseInt(r[1]),this._byteRange=[n,parseInt(r[0])+n]}get baseurl(){return this.base.url}get byteRange(){return null===this._byteRange?[]:this._byteRange}get byteRangeStartOffset(){return this.byteRange[0]}get byteRangeEndOffset(){return this.byteRange[1]}get elementaryStreams(){return null===this._streams&&(this._streams={[By]:null,[jy]:null,[zy]:null}),this._streams}set elementaryStreams(t){this._streams=t}get hasStats(){return null!==this._stats}get hasStreams(){return null!==this._streams}get stats(){return null===this._stats&&(this._stats=new Uy),this._stats}set stats(t){this._stats=t}get url(){return!this._url&&this.baseurl&&this.relurl&&(this._url=Fy.buildAbsoluteURL(this.baseurl,this.relurl,{alwaysNormalize:!0})),this._url||""}set url(t){this._url=t}clearElementaryStreamInfo(){const{elementaryStreams:t}=this;t[By]=null,t[jy]=null,t[zy]=null}}function Gy(t){return"initSegment"!==t.sn}class Vy extends Wy{constructor(t,e){super(e),this._decryptdata=null,this._programDateTime=null,this._ref=null,this._bitrate=void 0,this.rawProgramDateTime=null,this.tagList=[],this.duration=0,this.sn=0,this.levelkeys=void 0,this.type=void 0,this.loader=null,this.keyLoader=null,this.level=-1,this.cc=0,this.startPTS=void 0,this.endPTS=void 0,this.startDTS=void 0,this.endDTS=void 0,this.start=0,this.playlistOffset=0,this.deltaPTS=void 0,this.maxStartPTS=void 0,this.minEndPTS=void 0,this.data=void 0,this.bitrateTest=!1,this.title=null,this.initSegment=null,this.endList=void 0,this.gap=void 0,this.urlId=0,this.type=t}get byteLength(){if(this.hasStats){const t=this.stats.total;if(t)return t}if(this.byteRange.length){const t=this.byteRange[0],e=this.byteRange[1];if(ny(t)&&ny(e))return e-t}return null}get bitrate(){return this.byteLength?8*this.byteLength/this.duration:this._bitrate?this._bitrate:null}set bitrate(t){this._bitrate=t}get decryptdata(){var t;const{levelkeys:e}=this;if(!e||e.NONE)return null;if(e.identity)this._decryptdata||(this._decryptdata=e.identity.getDecryptData(this.sn));else if(null==(t=this._decryptdata)||!t.keyId){const t=Object.keys(e);if(1===t.length){const r=this._decryptdata=e[t[0]]||null;r&&(this._decryptdata=r.getDecryptData(this.sn,e))}}return this._decryptdata}get end(){return this.start+this.duration}get endProgramDateTime(){if(null===this.programDateTime)return null;const t=ny(this.duration)?this.duration:0;return this.programDateTime+1e3*t}get encrypted(){var t;if(null!=(t=this._decryptdata)&&t.encrypted)return!0;if(this.levelkeys){var e;const t=Object.keys(this.levelkeys),r=t.length;if(r>1||1===r&&null!=(e=this.levelkeys[t[0]])&&e.encrypted)return!0}return!1}get programDateTime(){return null===this._programDateTime&&this.rawProgramDateTime&&(this.programDateTime=Date.parse(this.rawProgramDateTime)),this._programDateTime}set programDateTime(t){ny(t)?this._programDateTime=t:this._programDateTime=this.rawProgramDateTime=null}get ref(){return Gy(this)?(this._ref||(this._ref={base:this.base,start:this.start,duration:this.duration,sn:this.sn,programDateTime:this.programDateTime}),this._ref):null}addStart(t){this.setStart(this.start+t)}setStart(t){this.start=t,this._ref&&(this._ref.start=t)}setDuration(t){this.duration=t,this._ref&&(this._ref.duration=t)}setKeyFormat(t){const e=this.levelkeys;if(e){var r;const n=e[t];!n||null!=(r=this._decryptdata)&&r.keyId||(this._decryptdata=n.getDecryptData(this.sn,e))}}abortRequests(){var t,e;null==(t=this.loader)||t.abort(),null==(e=this.keyLoader)||e.abort()}setElementaryStreamInfo(t,e,r,n,i){let s=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const{elementaryStreams:a}=this,o=a[t];o?(o.startPTS=Math.min(o.startPTS,e),o.endPTS=Math.max(o.endPTS,r),o.startDTS=Math.min(o.startDTS,n),o.endDTS=Math.max(o.endDTS,i)):a[t]={startPTS:e,endPTS:r,startDTS:n,endDTS:i,partial:s}}}class Hy extends Wy{constructor(t,e,r,n,i){super(r),this.fragOffset=0,this.duration=0,this.gap=!1,this.independent=!1,this.relurl=void 0,this.fragment=void 0,this.index=void 0,this.duration=t.decimalFloatingPoint("DURATION"),this.gap=t.bool("GAP"),this.independent=t.bool("INDEPENDENT"),this.relurl=t.enumeratedString("URI"),this.fragment=e,this.index=n;const s=t.enumeratedString("BYTERANGE");s&&this.setByteRange(s,i),i&&(this.fragOffset=i.fragOffset+i.duration)}get start(){return this.fragment.start+this.fragOffset}get end(){return this.start+this.duration}get loaded(){const{elementaryStreams:t}=this;return!!(t.audio||t.video||t.audiovideo)}}function Ky(t,e){const r=Object.getPrototypeOf(t);if(r){const t=Object.getOwnPropertyDescriptor(r,e);return t||Ky(r,e)}}const qy=Math.pow(2,32)-1,Yy=[].push,Qy={video:1,audio:2,id3:3,text:4};function Xy(t){return String.fromCharCode.apply(null,t)}function $y(t,e){const r=t[e]<<8|t[e+1];return r<0?65536+r:r}function Zy(t,e){const r=tv(t,e);return r<0?4294967296+r:r}function Jy(t,e){let r=Zy(t,e);return r*=Math.pow(2,32),r+=Zy(t,e+4),r}function tv(t,e){return t[e]<<24|t[e+1]<<16|t[e+2]<<8|t[e+3]}function ev(t,e){const r=[];if(!e.length)return r;const n=t.byteLength;for(let i=0;i<n;){const s=Zy(t,i),a=s>1?i+s:n;if(Xy(t.subarray(i+4,i+8))===e[0])if(1===e.length)r.push(t.subarray(i+8,a));else{const n=ev(t.subarray(i+8,a),e.slice(1));n.length&&Yy.apply(r,n)}i=a}return r}function rv(t){const e=[],r=t[0];let n=8;const i=Zy(t,n);n+=4;let s=0,a=0;0===r?(s=Zy(t,n),a=Zy(t,n+4),n+=8):(s=Jy(t,n),a=Jy(t,n+8),n+=16),n+=2;let o=t.length+a;const l=$y(t,n);n+=2;for(let c=0;c<l;c++){let r=n;const s=Zy(t,r);r+=4;const a=2147483647&s;if(1===(2147483648&s)>>>31)return Iy.warn("SIDX has hierarchical references (not supported)"),null;const l=Zy(t,r);r+=4,e.push({referenceSize:a,subsegmentDuration:l,info:{duration:l/i,start:o,end:o+a-1}}),o+=a,r+=4,n=r}return{earliestPresentationTime:s,timescale:i,version:r,referencesCount:l,references:e}}function nv(t){const e=[],r=ev(t,["moov","trak"]);for(let n=0;n<r.length;n++){const t=r[n],i=ev(t,["tkhd"])[0];if(i){let r=i[0];const n=Zy(i,0===r?12:20),s=ev(t,["mdia","mdhd"])[0];if(s){r=s[0];const i=Zy(s,0===r?12:20),a=ev(t,["mdia","hdlr"])[0];if(a){const r=Xy(a.subarray(8,12)),s={soun:By,vide:jy}[r],o=iv(ev(t,["mdia","minf","stbl","stsd"])[0]);s?(e[n]={timescale:i,type:s,stsd:o},e[s]=wy({timescale:i,id:n},o)):e[n]={timescale:i,type:r,stsd:o}}}}}return ev(t,["moov","mvex","trex"]).forEach(t=>{const r=Zy(t,4),n=e[r];n&&(n.default={duration:Zy(t,12),flags:Zy(t,20)})}),e}function iv(t){const e=t.subarray(8),r=e.subarray(86),n=Xy(e.subarray(4,8));let i,s=n;const a="enca"===n||"encv"===n;if(a){const t=ev(e,[n])[0];ev(t.subarray("enca"===n?28:78),["sinf"]).forEach(t=>{const e=ev(t,["schm"])[0];if(e){const r=Xy(e.subarray(4,8));if("cbcs"===r||"cenc"===r){const e=ev(t,["frma"])[0];e&&(s=Xy(e))}}})}const o=s;switch(s){case"avc1":case"avc2":case"avc3":case"avc4":{const t=ev(r,["avcC"])[0];t&&t.length>3&&(s+="."+ov(t[1])+ov(t[2])+ov(t[3]),i=sv("avc1"===o?"dva1":"dvav",r));break}case"mp4a":{const t=ev(e,[n])[0],r=ev(t.subarray(28),["esds"])[0];if(r&&r.length>7){let t=4;if(3!==r[t++])break;t=av(r,t),t+=2;const e=r[t++];if(128&e&&(t+=2),64&e&&(t+=r[t++]),4!==r[t++])break;t=av(r,t);const n=r[t++];if(64!==n)break;if(s+="."+ov(n),t+=12,5!==r[t++])break;t=av(r,t);const i=r[t++];let a=(248&i)>>3;31===a&&(a+=1+((7&i)<<3)+((224&r[t])>>5)),s+="."+a}break}case"hvc1":case"hev1":{const t=ev(r,["hvcC"])[0];if(t&&t.length>12){const e=t[1],r=["","A","B","C"][e>>6],n=31&e,i=Zy(t,2),a=(32&e)>>5?"H":"L",o=t[12],l=t.subarray(6,12);s+="."+r+n,s+="."+function(t){let e=0;for(let r=0;r<32;r++)e|=(t>>r&1)<<31-r;return e>>>0}(i).toString(16).toUpperCase(),s+="."+a+o;let c="";for(let t=l.length;t--;){const e=l[t];if(e||c){c="."+e.toString(16).toUpperCase()+c}}s+=c}i=sv("hev1"==o?"dvhe":"dvh1",r);break}case"dvh1":case"dvhe":case"dvav":case"dva1":case"dav1":s=sv(s,r)||s;break;case"vp09":{const t=ev(r,["vpcC"])[0];if(t&&t.length>6){const e=t[4],r=t[5],n=t[6]>>4&15;s+="."+lv(e)+"."+lv(r)+"."+lv(n)}break}case"av01":{const t=ev(r,["av1C"])[0];if(t&&t.length>2){const e=t[1]>>>5,n=31&t[1],a=t[2]>>>7?"H":"M",o=(64&t[2])>>6,l=(32&t[2])>>5,c=2===e&&o?l?12:10:o?10:8,u=(16&t[2])>>4,h=(8&t[2])>>3,d=(4&t[2])>>2,f=3&t[2],p=1,g=1,m=1,y=0;s+="."+e+"."+lv(n)+a+"."+lv(c)+"."+u+"."+h+d+f+"."+lv(p)+"."+lv(g)+"."+lv(m)+"."+y,i=sv("dav1",r)}break}}return{codec:s,encrypted:a,supplemental:i}}function sv(t,e){const r=ev(e,["dvvC"]),n=r.length?r[0]:ev(e,["dvcC"])[0];if(n){const e=n[2]>>1&127,r=n[2]<<5&32|n[3]>>3&31;return t+"."+lv(e)+"."+lv(r)}}function av(t,e){const r=e+5;for(;128&t[e++]&&e<r;);return e}function ov(t){return("0"+t.toString(16).toUpperCase()).slice(-2)}function lv(t){return(t<10?"0":"")+t}function cv(t,e){ev(t,["moov","trak"]).forEach(t=>{const r=ev(t,["mdia","minf","stbl","stsd"])[0];if(!r)return;const n=r.subarray(8);let i=ev(n,["enca"]);const s=i.length>0;s||(i=ev(n,["encv"])),i.forEach(t=>{ev(s?t.subarray(28):t.subarray(78),["sinf"]).forEach(t=>{const r=uv(t);r&&e(r,s)})})})}function uv(t){const e=ev(t,["schm"])[0];if(e){const r=Xy(e.subarray(4,8));if("cbcs"===r||"cenc"===r){const e=ev(t,["schi","tenc"])[0];if(e)return e}}}function hv(t,e){const r=new Uint8Array(t.length+e.length);return r.set(t),r.set(e,t.length),r}function dv(t,e){const r=[],n=e.samples,i=e.timescale,s=e.id;let a=!1;return ev(n,["moof"]).map(o=>{const l=o.byteOffset-8;ev(o,["traf"]).map(o=>{const c=ev(o,["tfdt"]).map(t=>{const e=t[0];let r=Zy(t,4);return 1===e&&(r*=Math.pow(2,32),r+=Zy(t,8)),r/i})[0];return void 0!==c&&(t=c),ev(o,["tfhd"]).map(c=>{const u=Zy(c,4),h=16777215&Zy(c,0);let d=0;const f=0!==(16&h);let p=0;const g=0!==(32&h);let m=8;u===s&&(0!==(1&h)&&(m+=8),0!==(2&h)&&(m+=4),0!==(8&h)&&(d=Zy(c,m),m+=4),f&&(p=Zy(c,m),m+=4),g&&(m+=4),"video"===e.type&&(a=fv(e.codec)),ev(o,["trun"]).map(s=>{const o=s[0],c=16777215&Zy(s,0),u=0!==(1&c);let h=0;const f=0!==(4&c),g=0!==(256&c);let m=0;const y=0!==(512&c);let v=0;const b=0!==(1024&c),_=0!==(2048&c);let w=0;const E=Zy(s,4);let S=8;u&&(h=Zy(s,S),S+=4),f&&(S+=4);let T=h+l;for(let l=0;l<E;l++){if(g?(m=Zy(s,S),S+=4):m=d,y?(v=Zy(s,S),S+=4):v=p,b&&(S+=4),_&&(w=0===o?Zy(s,S):tv(s,S),S+=4),e.type===jy){let e=0;for(;e<v;){const s=Zy(n,T);if(T+=4,pv(a,n[T])){gv(n.subarray(T,T+s),a?2:1,t+w/i,r)}T+=s,e+=s+4}}t+=m/i}}))})})}),r}function fv(t){if(!t)return!1;const e=t.substring(0,4);return"hvc1"===e||"hev1"===e||"dvh1"===e||"dvhe"===e}function pv(t,e){if(t){const t=e>>1&63;return 39===t||40===t}return 6===(31&e)}function gv(t,e,r,n){const i=mv(t);let s=0;s+=e;let a=0,o=0,l=0;for(;s<i.length;){a=0;do{if(s>=i.length)break;l=i[s++],a+=l}while(255===l);o=0;do{if(s>=i.length)break;l=i[s++],o+=l}while(255===l);const t=i.length-s;let e=s;if(o<t)s+=o;else if(o>t){Iy.error("Malformed SEI payload. ".concat(o," is too small, only ").concat(t," bytes left to parse."));break}if(4===a){if(181===i[e++]){const t=$y(i,e);if(e+=2,49===t){const t=Zy(i,e);if(e+=4,1195456820===t){const t=i[e++];if(3===t){const s=i[e++],o=64&s,l=o?2+3*(31&s):0,c=new Uint8Array(l);if(o){c[0]=s;for(let t=1;t<l;t++)c[t]=i[e++]}n.push({type:t,payloadType:a,pts:r,bytes:c})}}}}}else if(5===a&&o>16){const t=[];for(let r=0;r<16;r++){const n=i[e++].toString(16);t.push(1==n.length?"0"+n:n),3!==r&&5!==r&&7!==r&&9!==r||t.push("-")}const s=o-16,l=new Uint8Array(s);for(let r=0;r<s;r++)l[r]=i[e++];n.push({payloadType:a,pts:r,uuid:t.join(""),userData:Py(l),userDataBytes:l})}}}function mv(t){const e=t.byteLength,r=[];let n=1;for(;n<e-2;)0===t[n]&&0===t[n+1]&&3===t[n+2]?(r.push(n+2),n+=2):n++;if(0===r.length)return t;const i=e-r.length,s=new Uint8Array(i);let a=0;for(n=0;n<i;a++,n++)a===r[0]&&(a++,r.shift()),s[n]=t[a];return s}function yv(t,e,r){if(16!==t.byteLength)throw new RangeError("Invalid system id");let n,i,s;n=0,i=new Uint8Array,s=new Uint8Array;const a=new Uint8Array(4);return r.byteLength>0&&new DataView(a.buffer).setUint32(0,r.byteLength,!1),function(t){for(var e=arguments.length,r=new Array(e>1?e-1:0),n=1;n<e;n++)r[n-1]=arguments[n];const i=r.length;let s=8,a=i;for(;a--;)s+=r[a].byteLength;const o=new Uint8Array(s);for(o[0]=s>>24&255,o[1]=s>>16&255,o[2]=s>>8&255,o[3]=255&s,o.set(t,4),a=0,s=8;a<i;a++)o.set(r[a],s),s+=r[a].byteLength;return o}([112,115,115,104],new Uint8Array([0,0,0,0]),t,s,i,a,r)}function vv(t){const e=t.getUint32(0),r=t.byteOffset,n=t.byteLength;if(n<e)return{offset:r,size:n};if(1886614376!==t.getUint32(4))return{offset:r,size:e};const i=t.getUint32(8)>>>24;if(0!==i&&1!==i)return{offset:r,size:e};const s=t.buffer,a=Cy(new Uint8Array(s,r+12,16));let o=null,l=null,c=0;if(0===i)c=28;else{const i=t.getUint32(28);if(!i||n<32+16*i)return{offset:r,size:e};o=[];for(let t=0;t<i;t++)o.push(new Uint8Array(s,r+32+16*t,16));c=32+16*i}if(!c)return{offset:r,size:e};const u=t.getUint32(c);return e-32<u?{offset:r,size:e}:(l=new Uint8Array(s,r+c+4,u),{version:i,systemId:a,kids:o,data:l,offset:r,size:e})}const bv=()=>/\(Windows.+Firefox\//i.test(navigator.userAgent),_v={audio:{a3ds:1,"ac-3":.95,"ac-4":1,alac:.9,alaw:1,dra1:1,"dts+":1,"dts-":1,dtsc:1,dtse:1,dtsh:1,"ec-3":.9,enca:1,fLaC:.9,flac:.9,FLAC:.9,g719:1,g726:1,m4ae:1,mha1:1,mha2:1,mhm1:1,mhm2:1,mlpa:1,mp4a:1,"raw ":1,Opus:1,opus:1,samr:1,sawb:1,sawp:1,sevc:1,sqcp:1,ssmv:1,twos:1,ulaw:1},video:{avc1:1,avc2:1,avc3:1,avc4:1,avcp:1,av01:.8,dav1:.8,drac:1,dva1:1,dvav:1,dvh1:.7,dvhe:.7,encv:1,hev1:.75,hvc1:.75,mjp2:1,mp4v:1,mvc1:1,mvc2:1,mvc3:1,mvc4:1,resv:1,rv60:1,s263:1,svc1:1,svc2:1,"vc-1":1,vp08:1,vp09:.9},text:{stpp:1,wvtt:1}};function wv(t,e){const r=_v[e];return!!r&&!!r[t.slice(0,4)]}function Ev(t,e){let r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return!t.split(",").some(t=>!Sv(t,e,r))}function Sv(t,e){var r;const n=Ry(!(arguments.length>2&&void 0!==arguments[2])||arguments[2]);return null!=(r=null==n?void 0:n.isTypeSupported(Tv(t,e)))&&r}function Tv(t,e){return"".concat(e,"/mp4;codecs=").concat(t)}function kv(t){if(t){const e=t.substring(0,4);return _v.video[e]}return 2}function Av(t){const e=bv();return t.split(",").reduce((t,r)=>{const n=e&&fv(r)?9:_v.video[r];return n?(2*n+t)/(t?3:2):(_v.audio[r]+t)/(t?2:1)},0)}const xv={};const Iv=/flac|opus|mp4a\.40\.34/i;function Rv(t){let e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return t.replace(Iv,t=>function(t){let e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(xv[t])return xv[t];const r={flac:["flac","fLaC","FLAC"],opus:["opus","Opus"],"mp4a.40.34":["mp3"]}[t];for(let i=0;i<r.length;i++){var n;if(Sv(r[i],"audio",e))return xv[t]=r[i],r[i];if("mp3"===r[i]&&null!=(n=Ry(e))&&n.isTypeSupported("audio/mpeg"))return""}return t}(t.toLowerCase(),e))}function Lv(t,e){if(t&&(t.length>4||-1!==["ac-3","ec-3","alac","fLaC","Opus"].indexOf(t))&&(Pv(t,"audio")||Pv(t,"video")))return t;if(e){const r=e.split(",");if(r.length>1){if(t)for(let e=r.length;e--;)if(r[e].substring(0,4)===t.substring(0,4))return r[e];return r[0]}}return e||t}function Pv(t,e){return wv(t,e)&&Sv(t,e)}function Cv(t){if(t.startsWith("av01.")){const e=t.split("."),r=["0","111","01","01","01","0"];for(let t=e.length;t>4&&t<10;t++)e[t]=r[t-4];return e.join(".")}return t}function Mv(t){const e=Ry(t)||{isTypeSupported:()=>!1};return{mpeg:e.isTypeSupported("audio/mpeg"),mp3:e.isTypeSupported('audio/mp4; codecs="mp3"'),ac3:e.isTypeSupported('audio/mp4; codecs="ac-3"')}}function Ov(t){return t.replace(/^.+codecs=["']?([^"']+).*$/,"$1")}const Dv={supported:!1,smooth:!1,powerEfficient:!1},Nv={supported:!0,configurations:[],decodingInfoResults:[{supported:!0,powerEfficient:!0,smooth:!0}]};function Fv(t,e){return{supported:!1,configurations:e,decodingInfoResults:[Dv],error:t}}function Uv(t,e,r,n,i,s){const a=t.videoCodec,o=t.audioCodec?t.audioGroups:null,l=null==s?void 0:s.audioCodec,c=null==s?void 0:s.channels,u=c?parseInt(c):l?1/0:2;let h=null;if(null!=o&&o.length)try{h=1===o.length&&o[0]?e.groups[o[0]].channels:o.reduce((t,r)=>{if(r){const n=e.groups[r];if(!n)throw new Error("Audio track group ".concat(r," not found"));Object.keys(n.channels).forEach(e=>{t[e]=(t[e]||0)+n.channels[e]})}return t},{2:0})}catch(cg){return!0}return void 0!==a&&(a.split(",").some(t=>fv(t))||t.width>1920&&t.height>1088||t.height>1920&&t.width>1088||t.frameRate>Math.max(n,30)||"SDR"!==t.videoRange&&t.videoRange!==r||t.bitrate>Math.max(i,8e6))||!!h&&ny(u)&&Object.keys(h).some(t=>parseInt(t)>u)}function Bv(t,e,r){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};const i=t.videoCodec;if(!i&&!t.audioCodec||!r)return Promise.resolve(Nv);const s=[],a=function(t){var e;const r=null==(e=t.videoCodec)?void 0:e.split(","),n=zv(t),i=t.width||640,s=t.height||480,a=t.frameRate||30,o=t.videoRange.toLowerCase();return r?r.map(t=>{const e={contentType:Tv(Cv(t),"video"),width:i,height:s,bitrate:n,framerate:a};return"sdr"!==o&&(e.transferFunction=o),e}):[]}(t),o=a.length,l=function(t,e,r){var n;const i=null==(n=t.audioCodec)?void 0:n.split(","),s=zv(t);if(i&&t.audioGroups)return t.audioGroups.reduce((t,n)=>{var a;const o=n?null==(a=e.groups[n])?void 0:a.tracks:null;return o?o.reduce((t,e)=>{if(e.groupId===n){const n=parseFloat(e.channels||"");i.forEach(e=>{const i={contentType:Tv(e,"audio"),bitrate:r?jv(e,s):s};n&&(i.channels=""+n),t.push(i)})}return t},t):t},[]);return[]}(t,e,o>0),c=l.length;for(let u=o||1*c||1;u--;){const t={type:"media-source"};if(o&&(t.video=a[u%o]),c){t.audio=l[u%c];const e=t.audio.bitrate;t.video&&e&&(t.video.bitrate-=e)}s.push(t)}if(i){const t=navigator.userAgent;if(i.split(",").some(t=>fv(t))&&bv())return Promise.resolve(Fv(new Error("Overriding Windows Firefox HEVC MediaCapabilities result based on user-agent string: (".concat(t,")")),s))}return Promise.all(s.map(t=>{const e=function(t){let e="";const{audio:r,video:n}=t;if(n){const t=Ov(n.contentType);e+="".concat(t,"_r").concat(n.height,"x").concat(n.width,"f").concat(Math.ceil(n.framerate)).concat(n.transferFunction||"sd","_").concat(Math.ceil(n.bitrate/1e5))}if(r){const t=Ov(r.contentType);e+="".concat(n?"_":"").concat(t,"_c").concat(r.channels)}return e}(t);return n[e]||(n[e]=r.decodingInfo(t))})).then(t=>({supported:!t.some(t=>!t.supported),configurations:s,decodingInfoResults:t})).catch(t=>({supported:!1,configurations:s,decodingInfoResults:[],error:t}))}function jv(t,e){if(e<=1)return 1;let r=128e3;return"ec-3"===t?r=768e3:"ac-3"===t&&(r=64e4),Math.min(e/2,r)}function zv(t){return 1e3*Math.ceil(Math.max(.9*t.bitrate,t.averageBitrate)/1e3)||1}const Wv=["NONE","TYPE-0","TYPE-1",null];const Gv=["SDR","PQ","HLG"];var Vv="",Hv="YES",Kv="v2";function qv(t){const{canSkipUntil:e,canSkipDateRanges:r,age:n}=t;return e&&n<e/2?r?Kv:Hv:Vv}class Yv{constructor(t,e,r){this.msn=void 0,this.part=void 0,this.skip=void 0,this.msn=t,this.part=e,this.skip=r}addDirectives(t){const e=new self.URL(t);return void 0!==this.msn&&e.searchParams.set("_HLS_msn",this.msn.toString()),void 0!==this.part&&e.searchParams.set("_HLS_part",this.part.toString()),this.skip&&e.searchParams.set("_HLS_skip",this.skip),e.href}}class Qv{constructor(t){if(this._attrs=void 0,this.audioCodec=void 0,this.bitrate=void 0,this.codecSet=void 0,this.url=void 0,this.frameRate=void 0,this.height=void 0,this.id=void 0,this.name=void 0,this.supplemental=void 0,this.videoCodec=void 0,this.width=void 0,this.details=void 0,this.fragmentError=0,this.loadError=0,this.loaded=void 0,this.realBitrate=0,this.supportedPromise=void 0,this.supportedResult=void 0,this._avgBitrate=0,this._audioGroups=void 0,this._subtitleGroups=void 0,this._urlId=0,this.url=[t.url],this._attrs=[t.attrs],this.bitrate=t.bitrate,t.details&&(this.details=t.details),this.id=t.id||0,this.name=t.name,this.width=t.width||0,this.height=t.height||0,this.frameRate=t.attrs.optionalFloat("FRAME-RATE",0),this._avgBitrate=t.attrs.decimalInteger("AVERAGE-BANDWIDTH"),this.audioCodec=t.audioCodec,this.videoCodec=t.videoCodec,this.codecSet=[t.videoCodec,t.audioCodec].filter(t=>!!t).map(t=>t.substring(0,4)).join(","),"supplemental"in t){var e;this.supplemental=t.supplemental;const r=null==(e=t.supplemental)?void 0:e.videoCodec;r&&r!==t.videoCodec&&(this.codecSet+=",".concat(r.substring(0,4)))}this.addGroupId("audio",t.attrs.AUDIO),this.addGroupId("text",t.attrs.SUBTITLES)}get maxBitrate(){return Math.max(this.realBitrate,this.bitrate)}get averageBitrate(){return this._avgBitrate||this.realBitrate||this.bitrate}get attrs(){return this._attrs[0]}get codecs(){return this.attrs.CODECS||""}get pathwayId(){return this.attrs["PATHWAY-ID"]||"."}get videoRange(){return this.attrs["VIDEO-RANGE"]||"SDR"}get score(){return this.attrs.optionalFloat("SCORE",0)}get uri(){return this.url[0]||""}hasAudioGroup(t){return Xv(this._audioGroups,t)}hasSubtitleGroup(t){return Xv(this._subtitleGroups,t)}get audioGroups(){return this._audioGroups}get subtitleGroups(){return this._subtitleGroups}addGroupId(t,e){if(e)if("audio"===t){let t=this._audioGroups;t||(t=this._audioGroups=[]),-1===t.indexOf(e)&&t.push(e)}else if("text"===t){let t=this._subtitleGroups;t||(t=this._subtitleGroups=[]),-1===t.indexOf(e)&&t.push(e)}}get urlId(){return 0}set urlId(t){}get audioGroupIds(){return this.audioGroups?[this.audioGroupId]:void 0}get textGroupIds(){return this.subtitleGroups?[this.textGroupId]:void 0}get audioGroupId(){var t;return null==(t=this.audioGroups)?void 0:t[0]}get textGroupId(){var t;return null==(t=this.subtitleGroups)?void 0:t[0]}addFallback(){}}function Xv(t,e){return!(!e||!t)&&-1!==t.indexOf(e)}function $v(t,e){let r=!1,n=[];if(t&&(r="SDR"!==t,n=[t]),e){n=e.allowedVideoRanges||Gv.slice(0);const t="SDR"!==n.join("")&&!e.videoCodec;r=void 0!==e.preferHDR?e.preferHDR:t&&function(){if("function"===typeof matchMedia){const t=matchMedia("(dynamic-range: high)"),e=matchMedia("bad query");if(t.media!==e.media)return!0===t.matches}return!1}(),r||(n=["SDR"])}return{preferHDR:r,allowedVideoRanges:n}}const Zv=(t,e)=>JSON.stringify(t,(t=>{const e=new WeakSet;return(r,n)=>{if(t&&(n=t(r,n)),"object"===typeof n&&null!==n){if(e.has(n))return;e.add(n)}return n}})(e));function Jv(t,e){Iy.log('[abr] start candidates with "'.concat(t,'" ignored because ').concat(e))}function tb(t){return t.reduce((t,e)=>{let r=t.groups[e.groupId];r||(r=t.groups[e.groupId]={tracks:[],channels:{2:0},hasDefault:!1,hasAutoSelect:!1}),r.tracks.push(e);const n=e.channels||"2";return r.channels[n]=(r.channels[n]||0)+1,r.hasDefault=r.hasDefault||e.default,r.hasAutoSelect=r.hasAutoSelect||e.autoselect,r.hasDefault&&(t.hasDefaultAudio=!0),r.hasAutoSelect&&(t.hasAutoSelectAudio=!0),t},{hasDefaultAudio:!1,hasAutoSelectAudio:!1,groups:{}})}function eb(t){if(!t)return t;const{lang:e,assocLang:r,characteristics:n,channels:i,audioCodec:s}=t;return{lang:e,assocLang:r,characteristics:n,channels:i,audioCodec:s}}function rb(t,e,r){if("attrs"in t){const r=e.indexOf(t);if(-1!==r)return r}for(let n=0;n<e.length;n++){if(nb(t,e[n],r))return n}return-1}function nb(t,e,r){const{groupId:n,name:i,lang:s,assocLang:a,default:o}=t,l=t.forced;return(void 0===n||e.groupId===n)&&(void 0===i||e.name===i)&&(void 0===s||function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"--";if(t.length===e.length)return t===e;return t.startsWith(e)||e.startsWith(t)}(s,e.lang))&&(void 0===s||e.assocLang===a)&&(void 0===o||e.default===o)&&(void 0===l||e.forced===l)&&(!("characteristics"in t)||function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";const r=t.split(","),n=e.split(",");return r.length===n.length&&!r.some(t=>-1===n.indexOf(t))}(t.characteristics||"",e.characteristics))&&(void 0===r||r(t,e))}function ib(t,e){const{audioCodec:r,channels:n}=t;return(void 0===r||(e.audioCodec||"").substring(0,4)===r.substring(0,4))&&(void 0===n||n===(e.channels||"2"))}function sb(t,e,r){for(let n=e;n>-1;n--)if(r(t[n]))return n;for(let n=e+1;n<t.length;n++)if(r(t[n]))return n;return-1}function ab(t,e){var r;return!!t&&t!==(null==(r=e.loadLevelObj)?void 0:r.uri)}const ob=function(t,e){let r=0,n=t.length-1,i=null,s=null;for(;r<=n;){i=(r+n)/2|0,s=t[i];const a=e(s);if(a>0)r=i+1;else{if(!(a<0))return s;n=i-1}}return null};function lb(t,e){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:.005,s=null;if(t){s=e[1+t.sn-e[0].sn]||null;const n=t.endDTS-r;n>0&&n<15e-7&&(r+=15e-7),s&&t.level!==s.level&&s.end<=t.end&&(s=e[2+t.sn-e[0].sn]||null)}else 0===r&&0===e[0].start&&(s=e[0]);if(s&&((!t||t.level===s.level)&&0===cb(r,n,s)||function(t,e,r){if(e&&0===e.start&&e.level<t.level&&(e.endPTS||0)>0){const n=e.tagList.reduce((t,e)=>("INF"===e[0]&&(t+=parseFloat(e[1])),t),r);return t.start<=n}return!1}(s,t,Math.min(i,n))))return s;const a=ob(e,cb.bind(null,r,n));return!a||a===t&&s?s:a}function cb(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2?arguments[2]:void 0;if(r.start<=t&&r.start+r.duration>t)return 0;const n=Math.min(e,r.duration+(r.deltaPTS?r.deltaPTS:0));return r.start+r.duration-n<=t?1:r.start-n>t&&r.start?-1:0}function ub(t,e,r){const n=1e3*Math.min(e,r.duration+(r.deltaPTS?r.deltaPTS:0));return(r.endProgramDateTime||0)-n>t}function hb(t,e,r){if(t&&t.startCC<=e&&t.endCC>=e){let n=t.fragments;const{fragmentHint:i}=t;let s;return i&&(n=n.concat(i)),ob(n,t=>t.cc<e?1:t.cc>e?-1:(s=t,t.end<=r?1:t.start>r?-1:0)),s||null}return null}function db(t){switch(t.details){case oy.FRAG_LOAD_TIMEOUT:case oy.KEY_LOAD_TIMEOUT:case oy.LEVEL_LOAD_TIMEOUT:case oy.MANIFEST_LOAD_TIMEOUT:return!0}return!1}function fb(t){return t.details.startsWith("key")}function pb(t){return fb(t)&&!!t.frag&&!t.frag.decryptdata}function gb(t,e){const r=db(e);return t.default["".concat(r?"timeout":"error","Retry")]}function mb(t,e){const r="linear"===t.backoff?1:Math.pow(2,e);return Math.min(r*t.retryDelayMs,t.maxRetryDelayMs)}function yb(t){return wy(wy({},t),{errorRetry:null,timeoutRetry:null})}function vb(t,e,r,n){if(!t)return!1;const i=null==n?void 0:n.code,s=e<t.maxNumRetry&&(function(t){return bb(t)||!!t&&(t<400||t>499)}(i)||!!r);return t.shouldRetry?t.shouldRetry(t,e,r,n,s):s}function bb(t){return 0===t&&!1===navigator.onLine}var _b=0,wb=2,Eb=3,Sb=5,Tb=0,kb=1,Ab=2,xb=4;function Ib(t){const e={action:_b,flags:Tb};return t&&(e.resolved=!0),e}var Rb="NOT_LOADED",Lb="APPENDING",Pb="PARTIAL",Cb="OK";class Mb{constructor(t){this.activePartLists=Object.create(null),this.endListFragments=Object.create(null),this.fragments=Object.create(null),this.timeRanges=Object.create(null),this.bufferPadding=.2,this.hls=void 0,this.hasGaps=!1,this.hls=t,this._registerListeners()}_registerListeners(){const{hls:t}=this;t&&(t.on(ly.MANIFEST_LOADING,this.onManifestLoading,this),t.on(ly.BUFFER_APPENDED,this.onBufferAppended,this),t.on(ly.FRAG_BUFFERED,this.onFragBuffered,this),t.on(ly.FRAG_LOADED,this.onFragLoaded,this))}_unregisterListeners(){const{hls:t}=this;t&&(t.off(ly.MANIFEST_LOADING,this.onManifestLoading,this),t.off(ly.BUFFER_APPENDED,this.onBufferAppended,this),t.off(ly.FRAG_BUFFERED,this.onFragBuffered,this),t.off(ly.FRAG_LOADED,this.onFragLoaded,this))}destroy(){this._unregisterListeners(),this.hls=this.fragments=this.activePartLists=this.endListFragments=this.timeRanges=null}getAppendedFrag(t,e){const r=this.activePartLists[e];if(r)for(let n=r.length;n--;){const e=r[n];if(!e)break;if(e.start<=t&&t<=e.end&&e.loaded)return e}return this.getBufferedFrag(t,e)}getBufferedFrag(t,e){return this.getFragAtPos(t,e,!0)}getFragAtPos(t,e,r){const{fragments:n}=this,i=Object.keys(n);for(let s=i.length;s--;){const a=n[i[s]];if((null==a?void 0:a.body.type)===e&&(!r||a.buffered)){const e=a.body;if(e.start<=t&&t<=e.end)return e}}return null}detectEvictedFragments(t,e,r,n,i){this.timeRanges&&(this.timeRanges[t]=e);const s=(null==n?void 0:n.fragment.sn)||-1;Object.keys(this.fragments).forEach(n=>{const a=this.fragments[n];if(!a)return;if(s>=a.body.sn)return;if(!a.buffered&&(!a.loaded||i))return void(a.body.type===r&&this.removeFragment(a.body));const o=a.range[t];o&&(0!==o.time.length?o.time.some(t=>{const r=!this.isTimeBuffered(t.startPTS,t.endPTS,e);return r&&this.removeFragment(a.body),r}):this.removeFragment(a.body))})}detectPartialFragments(t){const e=this.timeRanges;if(!e||"initSegment"===t.frag.sn)return;const r=t.frag,n=Db(r),i=this.fragments[n];if(!i||i.buffered&&r.gap)return;const s=!r.relurl;Object.keys(e).forEach(n=>{const a=r.elementaryStreams[n];if(!a)return;const o=e[n],l=s||!0===a.partial;i.range[n]=this.getBufferedTimes(r,t.part,l,o)}),i.loaded=null,Object.keys(i.range).length?(this.bufferedEnd(i,r),Ob(i)||this.removeParts(r.sn-1,r.type)):this.removeFragment(i.body)}bufferedEnd(t,e){t.buffered=!0;(t.body.endList=e.endList||t.body.endList)&&(this.endListFragments[t.body.type]=t)}removeParts(t,e){const r=this.activePartLists[e];r&&(this.activePartLists[e]=Nb(r,e=>e.fragment.sn>=t))}fragBuffered(t,e){const r=Db(t);let n=this.fragments[r];!n&&e&&(n=this.fragments[r]={body:t,appendedPTS:null,loaded:null,buffered:!1,range:Object.create(null)},t.gap&&(this.hasGaps=!0)),n&&(n.loaded=null,this.bufferedEnd(n,t))}getBufferedTimes(t,e,r,n){const i={time:[],partial:r},s=t.start,a=t.end,o=t.minEndPTS||a,l=t.maxStartPTS||s;for(let c=0;c<n.length;c++){const t=n.start(c)-this.bufferPadding,e=n.end(c)+this.bufferPadding;if(l>=t&&o<=e){i.time.push({startPTS:Math.max(s,n.start(c)),endPTS:Math.min(a,n.end(c))});break}if(s<e&&a>t){const t=Math.max(s,n.start(c)),e=Math.min(a,n.end(c));e>t&&(i.partial=!0,i.time.push({startPTS:t,endPTS:e}))}else if(a<=t)break}return i}getPartialFragment(t){let e,r,n,i=null,s=0;const{bufferPadding:a,fragments:o}=this;return Object.keys(o).forEach(l=>{const c=o[l];c&&Ob(c)&&(r=c.body.start-a,n=c.body.end+a,t>=r&&t<=n&&(e=Math.min(t-r,n-t),s<=e&&(i=c.body,s=e)))}),i}isEndListAppended(t){const e=this.endListFragments[t];return void 0!==e&&(e.buffered||Ob(e))}getState(t){const e=Db(t),r=this.fragments[e];return r?r.buffered?Ob(r)?Pb:Cb:Lb:Rb}isTimeBuffered(t,e,r){let n,i;for(let s=0;s<r.length;s++){if(n=r.start(s)-this.bufferPadding,i=r.end(s)+this.bufferPadding,t>=n&&e<=i)return!0;if(e<=n)return!1}return!1}onManifestLoading(){this.removeAllFragments()}onFragLoaded(t,e){if("initSegment"===e.frag.sn||e.frag.bitrateTest)return;const r=e.frag,n=e.part?null:e,i=Db(r);this.fragments[i]={body:r,appendedPTS:null,loaded:n,buffered:!1,range:Object.create(null)}}onBufferAppended(t,e){const{frag:r,part:n,timeRanges:i,type:s}=e;if("initSegment"===r.sn)return;const a=r.type;if(n){let t=this.activePartLists[a];t||(this.activePartLists[a]=t=[]),t.push(n)}this.timeRanges=i;const o=i[s];this.detectEvictedFragments(s,o,a,n)}onFragBuffered(t,e){this.detectPartialFragments(e)}hasFragment(t){const e=Db(t);return!!this.fragments[e]}hasFragments(t){const{fragments:e}=this,r=Object.keys(e);if(!t)return r.length>0;for(let n=r.length;n--;){const i=e[r[n]];if((null==i?void 0:i.body.type)===t)return!0}return!1}hasParts(t){var e;return!(null==(e=this.activePartLists[t])||!e.length)}removeFragmentsInRange(t,e,r,n,i){n&&!this.hasGaps||Object.keys(this.fragments).forEach(s=>{const a=this.fragments[s];if(!a)return;const o=a.body;o.type!==r||n&&!o.gap||o.start<e&&o.end>t&&(a.buffered||i)&&this.removeFragment(o)})}removeFragment(t){const e=Db(t);t.clearElementaryStreamInfo();const r=this.activePartLists[t.type];if(r){const e=t.sn;this.activePartLists[t.type]=Nb(r,t=>t.fragment.sn!==e)}delete this.fragments[e],t.endList&&delete this.endListFragments[t.type]}removeAllFragments(){var t;this.fragments=Object.create(null),this.endListFragments=Object.create(null),this.activePartLists=Object.create(null),this.hasGaps=!1;const e=null==(t=this.hls)||null==(t=t.latestLevelDetails)?void 0:t.partList;e&&e.forEach(t=>t.clearElementaryStreamInfo())}}function Ob(t){var e,r,n;return t.buffered&&!!(t.body.gap||null!=(e=t.range.video)&&e.partial||null!=(r=t.range.audio)&&r.partial||null!=(n=t.range.audiovideo)&&n.partial)}function Db(t){return"".concat(t.type,"_").concat(t.level,"_").concat(t.sn)}function Nb(t,e){return t.filter(t=>{const r=e(t);return r||t.clearElementaryStreamInfo(),r})}var Fb=0,Ub=1;class Bb{constructor(t,e,r){this.subtle=void 0,this.aesIV=void 0,this.aesMode=void 0,this.subtle=t,this.aesIV=e,this.aesMode=r}decrypt(t,e){switch(this.aesMode){case Fb:return this.subtle.decrypt({name:"AES-CBC",iv:this.aesIV},e,t);case Ub:return this.subtle.decrypt({name:"AES-CTR",counter:this.aesIV,length:64},e,t);default:throw new Error("[AESCrypto] invalid aes mode ".concat(this.aesMode))}}}class jb{constructor(){this.rcon=[0,1,2,4,8,16,32,64,128,27,54],this.subMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.invSubMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.sBox=new Uint32Array(256),this.invSBox=new Uint32Array(256),this.key=new Uint32Array(0),this.ksRows=0,this.keySize=0,this.keySchedule=void 0,this.invKeySchedule=void 0,this.initTable()}uint8ArrayToUint32Array_(t){const e=new DataView(t),r=new Uint32Array(4);for(let n=0;n<4;n++)r[n]=e.getUint32(4*n);return r}initTable(){const t=this.sBox,e=this.invSBox,r=this.subMix,n=r[0],i=r[1],s=r[2],a=r[3],o=this.invSubMix,l=o[0],c=o[1],u=o[2],h=o[3],d=new Uint32Array(256);let f=0,p=0,g=0;for(g=0;g<256;g++)d[g]=g<128?g<<1:g<<1^283;for(g=0;g<256;g++){let r=p^p<<1^p<<2^p<<3^p<<4;r=r>>>8^255&r^99,t[f]=r,e[r]=f;const o=d[f],g=d[o],m=d[g];let y=257*d[r]^16843008*r;n[f]=y<<24|y>>>8,i[f]=y<<16|y>>>16,s[f]=y<<8|y>>>24,a[f]=y,y=16843009*m^65537*g^257*o^16843008*f,l[r]=y<<24|y>>>8,c[r]=y<<16|y>>>16,u[r]=y<<8|y>>>24,h[r]=y,f?(f=o^d[d[d[m^o]]],p^=d[d[p]]):f=p=1}}expandKey(t){const e=this.uint8ArrayToUint32Array_(t);let r=!0,n=0;for(;n<e.length&&r;)r=e[n]===this.key[n],n++;if(r)return;this.key=e;const i=this.keySize=e.length;if(4!==i&&6!==i&&8!==i)throw new Error("Invalid aes key size="+i);const s=this.ksRows=4*(i+6+1);let a,o;const l=this.keySchedule=new Uint32Array(s),c=this.invKeySchedule=new Uint32Array(s),u=this.sBox,h=this.rcon,d=this.invSubMix,f=d[0],p=d[1],g=d[2],m=d[3];let y,v;for(a=0;a<s;a++)a<i?y=l[a]=e[a]:(v=y,a%i===0?(v=v<<8|v>>>24,v=u[v>>>24]<<24|u[v>>>16&255]<<16|u[v>>>8&255]<<8|u[255&v],v^=h[a/i|0]<<24):i>6&&a%i===4&&(v=u[v>>>24]<<24|u[v>>>16&255]<<16|u[v>>>8&255]<<8|u[255&v]),l[a]=y=(l[a-i]^v)>>>0);for(o=0;o<s;o++)a=s-o,v=3&o?l[a]:l[a-4],c[o]=o<4||a<=4?v:f[u[v>>>24]]^p[u[v>>>16&255]]^g[u[v>>>8&255]]^m[u[255&v]],c[o]=c[o]>>>0}networkToHostOrderSwap(t){return t<<24|(65280&t)<<8|(16711680&t)>>8|t>>>24}decrypt(t,e,r){const n=this.keySize+6,i=this.invKeySchedule,s=this.invSBox,a=this.invSubMix,o=a[0],l=a[1],c=a[2],u=a[3],h=this.uint8ArrayToUint32Array_(r);let d=h[0],f=h[1],p=h[2],g=h[3];const m=new Int32Array(t),y=new Int32Array(m.length);let v,b,_,w,E,S,T,k,A,x,I,R,L,P;const C=this.networkToHostOrderSwap;for(;e<m.length;){for(A=C(m[e]),x=C(m[e+1]),I=C(m[e+2]),R=C(m[e+3]),E=A^i[0],S=R^i[1],T=I^i[2],k=x^i[3],L=4,P=1;P<n;P++)v=o[E>>>24]^l[S>>16&255]^c[T>>8&255]^u[255&k]^i[L],b=o[S>>>24]^l[T>>16&255]^c[k>>8&255]^u[255&E]^i[L+1],_=o[T>>>24]^l[k>>16&255]^c[E>>8&255]^u[255&S]^i[L+2],w=o[k>>>24]^l[E>>16&255]^c[S>>8&255]^u[255&T]^i[L+3],E=v,S=b,T=_,k=w,L+=4;v=s[E>>>24]<<24^s[S>>16&255]<<16^s[T>>8&255]<<8^s[255&k]^i[L],b=s[S>>>24]<<24^s[T>>16&255]<<16^s[k>>8&255]<<8^s[255&E]^i[L+1],_=s[T>>>24]<<24^s[k>>16&255]<<16^s[E>>8&255]<<8^s[255&S]^i[L+2],w=s[k>>>24]<<24^s[E>>16&255]<<16^s[S>>8&255]<<8^s[255&T]^i[L+3],y[e]=C(v^d),y[e+1]=C(w^f),y[e+2]=C(_^p),y[e+3]=C(b^g),d=A,f=x,p=I,g=R,e+=4}return y.buffer}}class zb{constructor(t,e,r){this.subtle=void 0,this.key=void 0,this.aesMode=void 0,this.subtle=t,this.key=e,this.aesMode=r}expandKey(){const t=function(t){switch(t){case Fb:return"AES-CBC";case Ub:return"AES-CTR";default:throw new Error("[FastAESKey] invalid aes mode ".concat(t))}}(this.aesMode);return this.subtle.importKey("raw",this.key,{name:t},!1,["encrypt","decrypt"])}}class Wb{constructor(t){let{removePKCS7Padding:e=!0}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(this.logEnabled=!0,this.removePKCS7Padding=void 0,this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null,this.useSoftware=void 0,this.enableSoftwareAES=void 0,this.enableSoftwareAES=t.enableSoftwareAES,this.removePKCS7Padding=e,e)try{const t=self.crypto;t&&(this.subtle=t.subtle||t.webkitSubtle)}catch(vA){}this.useSoftware=!this.subtle}destroy(){this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null}isSync(){return this.useSoftware}flush(){const{currentResult:t,remainderData:e}=this;if(!t||e)return this.reset(),null;const r=new Uint8Array(t);return this.reset(),this.removePKCS7Padding?function(t){const e=t.byteLength,r=e&&new DataView(t.buffer).getUint8(e-1);return r?t.slice(0,e-r):t}(r):r}reset(){this.currentResult=null,this.currentIV=null,this.remainderData=null,this.softwareDecrypter&&(this.softwareDecrypter=null)}decrypt(t,e,r,n){return this.useSoftware?new Promise((i,s)=>{const a=ArrayBuffer.isView(t)?t:new Uint8Array(t);this.softwareDecrypt(a,e,r,n);const o=this.flush();o?i(o.buffer):s(new Error("[softwareDecrypt] Failed to decrypt data"))}):this.webCryptoDecrypt(new Uint8Array(t),e,r,n)}softwareDecrypt(t,e,r,n){const{currentIV:i,currentResult:s,remainderData:a}=this;if(n!==Fb||16!==e.byteLength)return Iy.warn("SoftwareDecrypt: can only handle AES-128-CBC"),null;this.logOnce("JS AES decrypt"),a&&(t=hv(a,t),this.remainderData=null);const o=this.getValidChunk(t);if(!o.length)return null;i&&(r=i);let l=this.softwareDecrypter;l||(l=this.softwareDecrypter=new jb),l.expandKey(e);const c=s;return this.currentResult=l.decrypt(o.buffer,0,r),this.currentIV=o.slice(-16).buffer,c||null}webCryptoDecrypt(t,e,r,n){if(this.key!==e||!this.fastAesKey){if(!this.subtle)return Promise.resolve(this.onWebCryptoError(t,e,r,n));this.key=e,this.fastAesKey=new zb(this.subtle,e,n)}return this.fastAesKey.expandKey().then(e=>{if(!this.subtle)return Promise.reject(new Error("web crypto not initialized"));this.logOnce("WebCrypto AES decrypt");return new Bb(this.subtle,new Uint8Array(r),n).decrypt(t.buffer,e)}).catch(i=>(Iy.warn("[decrypter]: WebCrypto Error, disable WebCrypto API, ".concat(i.name,": ").concat(i.message)),this.onWebCryptoError(t,e,r,n)))}onWebCryptoError(t,e,r,n){const i=this.enableSoftwareAES;if(i){this.useSoftware=!0,this.logEnabled=!0,this.softwareDecrypt(t,e,r,n);const i=this.flush();if(i)return i.buffer}throw new Error("WebCrypto"+(i?" and softwareDecrypt":"")+": failed to decrypt data")}getValidChunk(t){let e=t;const r=t.length-t.length%16;return r!==t.length&&(e=t.slice(0,r),this.remainderData=t.slice(r)),e}logOnce(t){this.logEnabled&&(Iy.log("[decrypter]: ".concat(t)),this.logEnabled=!1)}}const Gb=Math.pow(2,17);class Vb{constructor(t){this.config=void 0,this.loader=null,this.partLoadTimeout=-1,this.config=t}destroy(){this.loader&&(this.loader.destroy(),this.loader=null)}abort(){this.loader&&this.loader.abort()}load(t,e){const r=t.url;if(!r)return Promise.reject(new qb({type:ay.NETWORK_ERROR,details:oy.FRAG_LOAD_ERROR,fatal:!1,frag:t,error:new Error("Fragment does not have a ".concat(r?"part list":"url")),networkDetails:null}));this.abort();const n=this.config,i=n.fLoader,s=n.loader;return new Promise((a,o)=>{if(this.loader&&this.loader.destroy(),t.gap){if(t.tagList.some(t=>"GAP"===t[0]))return void o(Kb(t));t.gap=!1}const l=this.loader=i?new i(n):new s(n),c=Hb(t);t.loader=l;const u=yb(n.fragLoadPolicy.default),h={loadPolicy:u,timeout:u.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0,highWaterMark:"initSegment"===t.sn?1/0:Gb};t.stats=l.stats;const d={onSuccess:(e,r,n,i)=>{this.resetLoader(t,l);let s=e.data;n.resetIV&&t.decryptdata&&(t.decryptdata.iv=new Uint8Array(s.slice(0,16)),s=s.slice(16)),a({frag:t,part:null,payload:s,networkDetails:i})},onError:(e,n,i,s)=>{this.resetLoader(t,l),o(new qb({type:ay.NETWORK_ERROR,details:oy.FRAG_LOAD_ERROR,fatal:!1,frag:t,response:wy({url:r,data:void 0},e),error:new Error("HTTP Error ".concat(e.code," ").concat(e.text)),networkDetails:i,stats:s}))},onAbort:(e,r,n)=>{this.resetLoader(t,l),o(new qb({type:ay.NETWORK_ERROR,details:oy.INTERNAL_ABORTED,fatal:!1,frag:t,error:new Error("Aborted"),networkDetails:n,stats:e}))},onTimeout:(e,r,n)=>{this.resetLoader(t,l),o(new qb({type:ay.NETWORK_ERROR,details:oy.FRAG_LOAD_TIMEOUT,fatal:!1,frag:t,error:new Error("Timeout after ".concat(h.timeout,"ms")),networkDetails:n,stats:e}))}};e&&(d.onProgress=(r,n,i,s)=>e({frag:t,part:null,payload:i,networkDetails:s})),l.load(c,h,d)})}loadPart(t,e,r){this.abort();const n=this.config,i=n.fLoader,s=n.loader;return new Promise((a,o)=>{if(this.loader&&this.loader.destroy(),t.gap||e.gap)return void o(Kb(t,e));const l=this.loader=i?new i(n):new s(n),c=Hb(t,e);t.loader=l;const u=yb(n.fragLoadPolicy.default),h={loadPolicy:u,timeout:u.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0,highWaterMark:Gb};e.stats=l.stats,l.load(c,h,{onSuccess:(n,i,s,o)=>{this.resetLoader(t,l),this.updateStatsFromPart(t,e);const c={frag:t,part:e,payload:n.data,networkDetails:o};r(c),a(c)},onError:(r,n,i,s)=>{this.resetLoader(t,l),o(new qb({type:ay.NETWORK_ERROR,details:oy.FRAG_LOAD_ERROR,fatal:!1,frag:t,part:e,response:wy({url:c.url,data:void 0},r),error:new Error("HTTP Error ".concat(r.code," ").concat(r.text)),networkDetails:i,stats:s}))},onAbort:(r,n,i)=>{t.stats.aborted=e.stats.aborted,this.resetLoader(t,l),o(new qb({type:ay.NETWORK_ERROR,details:oy.INTERNAL_ABORTED,fatal:!1,frag:t,part:e,error:new Error("Aborted"),networkDetails:i,stats:r}))},onTimeout:(r,n,i)=>{this.resetLoader(t,l),o(new qb({type:ay.NETWORK_ERROR,details:oy.FRAG_LOAD_TIMEOUT,fatal:!1,frag:t,part:e,error:new Error("Timeout after ".concat(h.timeout,"ms")),networkDetails:i,stats:r}))}})})}updateStatsFromPart(t,e){const r=t.stats,n=e.stats,i=n.total;if(r.loaded+=n.loaded,i){const n=Math.round(t.duration/e.duration),s=Math.min(Math.round(r.loaded/i),n),a=(n-s)*Math.round(r.loaded/s);r.total=r.loaded+a}else r.total=Math.max(r.loaded,r.total);const s=r.loading,a=n.loading;s.start?s.first+=a.first-a.start:(s.start=a.start,s.first=a.first),s.end=a.end}resetLoader(t,e){t.loader=null,this.loader===e&&(self.clearTimeout(this.partLoadTimeout),this.loader=null),e.destroy()}}function Hb(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const r=e||t,n={frag:t,part:e,responseType:"arraybuffer",url:r.url,headers:{},rangeStart:0,rangeEnd:0},i=r.byteRangeStartOffset,s=r.byteRangeEndOffset;if(ny(i)&&ny(s)){var a;let e=i,r=s;if("initSegment"===t.sn&&("AES-128"===(o=null==(a=t.decryptdata)?void 0:a.method)||"AES-256"===o)){const t=s-i;t%16&&(r=s+(16-t%16)),0!==i&&(n.resetIV=!0,e=i-16)}n.rangeStart=e,n.rangeEnd=r}var o;return n}function Kb(t,e){const r=new Error("GAP ".concat(t.gap?"tag":"attribute"," found")),n={type:ay.MEDIA_ERROR,details:oy.FRAG_GAP,fatal:!1,frag:t,error:r,networkDetails:null};return e&&(n.part=e),(e||t).stats.aborted=!0,new qb(n)}class qb extends Error{constructor(t){super(t.error.message),this.data=void 0,this.data=t}}class Yb extends Ey{constructor(t,e){super(t,e),this._boundTick=void 0,this._tickTimer=null,this._tickInterval=null,this._tickCallCount=0,this._boundTick=this.tick.bind(this)}destroy(){this.onHandlerDestroying(),this.onHandlerDestroyed()}onHandlerDestroying(){this.clearNextTick(),this.clearInterval()}onHandlerDestroyed(){}hasInterval(){return!!this._tickInterval}hasNextTick(){return!!this._tickTimer}setInterval(t){return!this._tickInterval&&(this._tickCallCount=0,this._tickInterval=self.setInterval(this._boundTick,t),!0)}clearInterval(){return!!this._tickInterval&&(self.clearInterval(this._tickInterval),this._tickInterval=null,!0)}clearNextTick(){return!!this._tickTimer&&(self.clearTimeout(this._tickTimer),this._tickTimer=null,!0)}tick(){this._tickCallCount++,1===this._tickCallCount&&(this.doTick(),this._tickCallCount>1&&this.tickImmediate(),this._tickCallCount=0)}tickImmediate(){this.clearNextTick(),this._tickTimer=self.setTimeout(this._boundTick,0)}doTick(){}}class Qb{constructor(t,e,r){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:-1,s=arguments.length>5&&void 0!==arguments[5]&&arguments[5];this.level=void 0,this.sn=void 0,this.part=void 0,this.id=void 0,this.size=void 0,this.partial=void 0,this.transmuxing={start:0,executeStart:0,executeEnd:0,end:0},this.buffering={audio:{start:0,executeStart:0,executeEnd:0,end:0},video:{start:0,executeStart:0,executeEnd:0,end:0},audiovideo:{start:0,executeStart:0,executeEnd:0,end:0}},this.level=t,this.sn=e,this.id=r,this.size=n,this.part=i,this.partial=s}}const Xb={length:0,start:()=>0,end:()=>0};class $b{static isBuffered(t,e){if(t){const r=$b.getBuffered(t);for(let t=r.length;t--;)if(e>=r.start(t)&&e<=r.end(t))return!0}return!1}static bufferedRanges(t){if(t){const e=$b.getBuffered(t);return $b.timeRangesToArray(e)}return[]}static timeRangesToArray(t){const e=[];for(let r=0;r<t.length;r++)e.push({start:t.start(r),end:t.end(r)});return e}static bufferInfo(t,e,r){if(t){const n=$b.bufferedRanges(t);if(n.length)return $b.bufferedInfo(n,e,r)}return{len:0,start:e,end:e,bufferedIndex:-1}}static bufferedInfo(t,e,r){e=Math.max(0,e),t.length>1&&t.sort((t,e)=>t.start-e.start||e.end-t.end);let n=-1,i=[];if(r)for(let c=0;c<t.length;c++){e>=t[c].start&&e<=t[c].end&&(n=c);const s=i.length;if(s){const e=i[s-1].end;t[c].start-e<r?t[c].end>e&&(i[s-1].end=t[c].end):i.push(t[c])}else i.push(t[c])}else i=t;let s,a=0,o=e,l=e;for(let c=0;c<i.length;c++){const t=i[c].start,u=i[c].end;if(-1===n&&e>=t&&e<=u&&(n=c),e+r>=t&&e<u)o=t,l=u,a=l-e;else if(e+r<t){s=t;break}}return{len:a,start:o||0,end:l||0,nextStart:s,buffered:t,bufferedIndex:n}}static getBuffered(t){try{return t.buffered||Xb}catch(vA){return Iy.log("failed to get media.buffered",vA),Xb}}}const Zb=/\{\$([a-zA-Z0-9-_]+)\}/g;function Jb(t){return Zb.test(t)}function t_(t,e){if(null!==t.variableList||t.hasVariableRefs){const r=t.variableList;return e.replace(Zb,e=>{const n=e.substring(2,e.length-1),i=null==r?void 0:r[n];return void 0===i?(t.playlistParsingError||(t.playlistParsingError=new Error('Missing preceding EXT-X-DEFINE tag for Variable Reference: "'.concat(n,'"'))),e):i})}return e}function e_(t,e,r){let n,i,s=t.variableList;if(s||(t.variableList=s={}),"QUERYPARAM"in e){n=e.QUERYPARAM;try{const t=new self.URL(r).searchParams;if(!t.has(n))throw new Error('"'.concat(n,'" does not match any query parameter in URI: "').concat(r,'"'));i=t.get(n)}catch(cg){t.playlistParsingError||(t.playlistParsingError=new Error("EXT-X-DEFINE QUERYPARAM: ".concat(cg.message)))}}else n=e.NAME,i=e.VALUE;n in s?t.playlistParsingError||(t.playlistParsingError=new Error('EXT-X-DEFINE duplicate Variable Name declarations: "'.concat(n,'"'))):s[n]=i||""}function r_(t,e,r){const n=e.IMPORT;if(r&&n in r){let e=t.variableList;e||(t.variableList=e={}),e[n]=r[n]}else t.playlistParsingError||(t.playlistParsingError=new Error('EXT-X-DEFINE IMPORT attribute not found in Multivariant Playlist: "'.concat(n,'"')))}const n_=/^(\d+)x(\d+)$/,i_=/(.+?)=(".*?"|.*?)(?:,|$)/g;class s_{constructor(t,e){"string"===typeof t&&(t=s_.parseAttrList(t,e)),by(this,t)}get clientAttrs(){return Object.keys(this).filter(t=>"X-"===t.substring(0,2))}decimalInteger(t){const e=parseInt(this[t],10);return e>Number.MAX_SAFE_INTEGER?1/0:e}hexadecimalInteger(t){if(this[t]){let e=(this[t]||"0x").slice(2);e=(1&e.length?"0":"")+e;const r=new Uint8Array(e.length/2);for(let t=0;t<e.length/2;t++)r[t]=parseInt(e.slice(2*t,2*t+2),16);return r}return null}hexadecimalIntegerAsNumber(t){const e=parseInt(this[t],16);return e>Number.MAX_SAFE_INTEGER?1/0:e}decimalFloatingPoint(t){return parseFloat(this[t])}optionalFloat(t,e){const r=this[t];return r?parseFloat(r):e}enumeratedString(t){return this[t]}enumeratedStringList(t,e){const r=this[t];return(r?r.split(/[ ,]+/):[]).reduce((t,e)=>(t[e.toLowerCase()]=!0,t),e)}bool(t){return"YES"===this[t]}decimalResolution(t){const e=n_.exec(this[t]);if(null!==e)return{width:parseInt(e[1],10),height:parseInt(e[2],10)}}static parseAttrList(t,e){let r;const n={};for(i_.lastIndex=0;null!==(r=i_.exec(t));){const i=r[1].trim();let s=r[2];const a=0===s.indexOf('"')&&s.lastIndexOf('"')===s.length-1;let o=!1;if(a)s=s.slice(1,-1);else switch(i){case"IV":case"SCTE35-CMD":case"SCTE35-IN":case"SCTE35-OUT":o=!0}if(e&&(a||o))s=t_(e,s);else if(!o&&!a)switch(i){case"CLOSED-CAPTIONS":if("NONE"===s)break;case"ALLOWED-CPC":case"CLASS":case"ASSOC-LANGUAGE":case"AUDIO":case"BYTERANGE":case"CHANNELS":case"CHARACTERISTICS":case"CODECS":case"DATA-ID":case"END-DATE":case"GROUP-ID":case"ID":case"IMPORT":case"INSTREAM-ID":case"KEYFORMAT":case"KEYFORMATVERSIONS":case"LANGUAGE":case"NAME":case"PATHWAY-ID":case"QUERYPARAM":case"RECENTLY-REMOVED-DATERANGES":case"SERVER-URI":case"STABLE-RENDITION-ID":case"STABLE-VARIANT-ID":case"START-DATE":case"SUBTITLES":case"SUPPLEMENTAL-CODECS":case"URI":case"VALUE":case"VIDEO":case"X-ASSET-LIST":case"X-ASSET-URI":Iy.warn("".concat(t,": attribute ").concat(i," is missing quotes"))}n[i]=s}return n}}function a_(t){return"ID"!==t&&"CLASS"!==t&&"CUE"!==t&&"START-DATE"!==t&&"DURATION"!==t&&"END-DATE"!==t&&"END-ON-NEXT"!==t}function o_(t){return"SCTE35-OUT"===t||"SCTE35-IN"===t||"SCTE35-CMD"===t}class l_{constructor(t,e){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;var n;if(this.attr=void 0,this.tagAnchor=void 0,this.tagOrder=void 0,this._startDate=void 0,this._endDate=void 0,this._dateAtEnd=void 0,this._cue=void 0,this._badValueForSameId=void 0,this.tagAnchor=(null==e?void 0:e.tagAnchor)||null,this.tagOrder=null!=(n=null==e?void 0:e.tagOrder)?n:r,e){const r=e.attr;for(const e in r)if(Object.prototype.hasOwnProperty.call(t,e)&&t[e]!==r[e]){Iy.warn('DATERANGE tag attribute: "'.concat(e,'" does not match for tags with ID: "').concat(t.ID,'"')),this._badValueForSameId=e;break}t=by(new s_({}),r,t)}if(this.attr=t,e?(this._startDate=e._startDate,this._cue=e._cue,this._endDate=e._endDate,this._dateAtEnd=e._dateAtEnd):this._startDate=new Date(t["START-DATE"]),"END-DATE"in this.attr){const t=(null==e?void 0:e.endDate)||new Date(this.attr["END-DATE"]);ny(t.getTime())&&(this._endDate=t)}}get id(){return this.attr.ID}get class(){return this.attr.CLASS}get cue(){const t=this._cue;return void 0===t?this._cue=this.attr.enumeratedStringList(this.attr.CUE?"CUE":"X-CUE",{pre:!1,post:!1,once:!1}):t}get startTime(){const{tagAnchor:t}=this;return null===t||null===t.programDateTime?(Iy.warn('Expected tagAnchor Fragment with PDT set for DateRange "'.concat(this.id,'": ').concat(t)),NaN):t.start+(this.startDate.getTime()-t.programDateTime)/1e3}get startDate(){return this._startDate}get endDate(){const t=this._endDate||this._dateAtEnd;if(t)return t;const e=this.duration;return null!==e?this._dateAtEnd=new Date(this._startDate.getTime()+1e3*e):null}get duration(){if("DURATION"in this.attr){const t=this.attr.decimalFloatingPoint("DURATION");if(ny(t))return t}else if(this._endDate)return(this._endDate.getTime()-this._startDate.getTime())/1e3;return null}get plannedDuration(){return"PLANNED-DURATION"in this.attr?this.attr.decimalFloatingPoint("PLANNED-DURATION"):null}get endOnNext(){return this.attr.bool("END-ON-NEXT")}get isInterstitial(){return"com.apple.hls.interstitial"===this.class}get isValid(){return!!this.id&&!this._badValueForSameId&&ny(this.startDate.getTime())&&(null===this.duration||this.duration>=0)&&(!this.endOnNext||!!this.class)&&(!this.attr.CUE||!this.cue.pre&&!this.cue.post||this.cue.pre!==this.cue.post)&&(!this.isInterstitial||"X-ASSET-URI"in this.attr||"X-ASSET-LIST"in this.attr)}}class c_{constructor(t){this.PTSKnown=!1,this.alignedSliding=!1,this.averagetargetduration=void 0,this.endCC=0,this.endSN=0,this.fragments=void 0,this.fragmentHint=void 0,this.partList=null,this.dateRanges=void 0,this.dateRangeTagCount=0,this.live=!0,this.requestScheduled=-1,this.ageHeader=0,this.advancedDateTime=void 0,this.updated=!0,this.advanced=!0,this.misses=0,this.startCC=0,this.startSN=0,this.startTimeOffset=null,this.targetduration=0,this.totalduration=0,this.type=null,this.url=void 0,this.m3u8="",this.version=null,this.canBlockReload=!1,this.canSkipUntil=0,this.canSkipDateRanges=!1,this.skippedSegments=0,this.recentlyRemovedDateranges=void 0,this.partHoldBack=0,this.holdBack=0,this.partTarget=0,this.preloadHint=void 0,this.renditionReports=void 0,this.tuneInGoal=0,this.deltaUpdateFailed=void 0,this.driftStartTime=0,this.driftEndTime=0,this.driftStart=0,this.driftEnd=0,this.encryptedFragments=void 0,this.playlistParsingError=null,this.variableList=null,this.hasVariableRefs=!1,this.appliedTimelineOffset=void 0,this.fragments=[],this.encryptedFragments=[],this.dateRanges={},this.url=t}reloaded(t){if(!t)return this.advanced=!0,void(this.updated=!0);const e=this.lastPartSn-t.lastPartSn,r=this.lastPartIndex-t.lastPartIndex;this.updated=this.endSN!==t.endSN||!!r||!!e||!this.live,this.advanced=this.endSN>t.endSN||e>0||0===e&&r>0,this.updated||this.advanced?this.misses=Math.floor(.6*t.misses):this.misses=t.misses+1}hasKey(t){return this.encryptedFragments.some(e=>{let r=e.decryptdata;return r||(e.setKeyFormat(t.keyFormat),r=e.decryptdata),!!r&&t.matches(r)})}get hasProgramDateTime(){return!!this.fragments.length&&ny(this.fragments[this.fragments.length-1].programDateTime)}get levelTargetDuration(){return this.averagetargetduration||this.targetduration||10}get drift(){const t=this.driftEndTime-this.driftStartTime;if(t>0){return 1e3*(this.driftEnd-this.driftStart)/t}return 1}get edge(){return this.partEnd||this.fragmentEnd}get partEnd(){var t;return null!=(t=this.partList)&&t.length?this.partList[this.partList.length-1].end:this.fragmentEnd}get fragmentEnd(){return this.fragments.length?this.fragments[this.fragments.length-1].end:0}get fragmentStart(){return this.fragments.length?this.fragments[0].start:0}get age(){return this.advancedDateTime?Math.max(Date.now()-this.advancedDateTime,0)/1e3:0}get lastPartIndex(){var t;return null!=(t=this.partList)&&t.length?this.partList[this.partList.length-1].index:-1}get maxPartIndex(){const t=this.partList;if(t){const e=this.lastPartIndex;if(-1!==e){for(let r=t.length;r--;)if(t[r].index>e)return t[r].index;return e}}return 0}get lastPartSn(){var t;return null!=(t=this.partList)&&t.length?this.partList[this.partList.length-1].fragment.sn:this.endSN}get expired(){if(this.live&&this.age&&this.misses<3){const t=this.partEnd-this.fragmentStart;return this.age>Math.max(t,this.totalduration)+this.levelTargetDuration}return!1}}function u_(t,e){return t.length===e.length&&!t.some((t,r)=>t!==e[r])}function h_(t,e){return!t&&!e||!(!t||!e)&&u_(t,e)}function d_(t){return"AES-128"===t||"AES-256"===t||"AES-256-CTR"===t}function f_(t){switch(t){case"AES-128":case"AES-256":return Fb;case"AES-256-CTR":return Ub;default:throw new Error("invalid full segment method ".concat(t))}}function p_(t){return Uint8Array.from(atob(t),t=>t.charCodeAt(0))}function g_(t){return Uint8Array.from(unescape(encodeURIComponent(t)),t=>t.charCodeAt(0))}function m_(t){const e=function(t,e,r){const n=t[e];t[e]=t[r],t[r]=n};e(t,0,3),e(t,1,2),e(t,4,5),e(t,6,7)}function y_(t){const e=t.split(":");let r=null;if("data"===e[0]&&2===e.length){const t=e[1].split(";"),n=t[t.length-1].split(",");if(2===n.length){const e="base64"===n[0],i=n[1];e?(t.splice(-1,1),r=p_(i)):r=function(t){const e=g_(t).subarray(0,16),r=new Uint8Array(16);return r.set(e,16-e.length),r}(i)}}return r}const v_="undefined"!==typeof self?self:void 0;var b_={CLEARKEY:"org.w3.clearkey",FAIRPLAY:"com.apple.fps",PLAYREADY:"com.microsoft.playready",WIDEVINE:"com.widevine.alpha"},__="org.w3.clearkey",w_="com.apple.streamingkeydelivery",E_="com.microsoft.playready",S_="urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed";function T_(t){switch(t){case w_:return b_.FAIRPLAY;case E_:return b_.PLAYREADY;case S_:return b_.WIDEVINE;case __:return b_.CLEARKEY}}function k_(t){switch(t){case b_.FAIRPLAY:return w_;case b_.PLAYREADY:return E_;case b_.WIDEVINE:return S_;case b_.CLEARKEY:return __}}function A_(t){const{drmSystems:e,widevineLicenseUrl:r}=t,n=e?[b_.FAIRPLAY,b_.WIDEVINE,b_.PLAYREADY,b_.CLEARKEY].filter(t=>!!e[t]):[];return!n[b_.WIDEVINE]&&r&&n.push(b_.WIDEVINE),n}const x_=null!=v_&&null!=(I_=v_.navigator)&&I_.requestMediaKeySystemAccess?self.navigator.requestMediaKeySystemAccess.bind(self.navigator):null;var I_;function R_(t){const e=new Uint16Array(t.buffer,t.byteOffset,t.byteLength/2),r=String.fromCharCode.apply(null,Array.from(e)),n=r.substring(r.indexOf("<"),r.length),i=(new DOMParser).parseFromString(n,"text/xml").getElementsByTagName("KID")[0];if(i){const t=i.childNodes[0]?i.childNodes[0].nodeValue:i.getAttribute("VALUE");if(t){const e=p_(t).subarray(0,16);return m_(e),e}}return null}let L_={};class P_{static clearKeyUriToKeyIdMap(){L_={}}static setKeyIdForUri(t,e){L_[t]=e}static addKeyIdForUri(t){const e=Object.keys(L_).length%Number.MAX_SAFE_INTEGER,r=new Uint8Array(16);return new DataView(r.buffer,12,4).setUint32(0,e),L_[t]=r,r}constructor(t,e,r){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[1],i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,s=arguments.length>5?arguments[5]:void 0;this.uri=void 0,this.method=void 0,this.keyFormat=void 0,this.keyFormatVersions=void 0,this.encrypted=void 0,this.isCommonEncryption=void 0,this.iv=null,this.key=null,this.keyId=null,this.pssh=null,this.method=t,this.uri=e,this.keyFormat=r,this.keyFormatVersions=n,this.iv=i,this.encrypted=!!t&&"NONE"!==t,this.isCommonEncryption=this.encrypted&&!d_(t),null!=s&&s.startsWith("0x")&&(this.keyId=new Uint8Array(My(s)))}matches(t){return t.uri===this.uri&&t.method===this.method&&t.encrypted===this.encrypted&&t.keyFormat===this.keyFormat&&u_(t.keyFormatVersions,this.keyFormatVersions)&&h_(t.iv,this.iv)&&h_(t.keyId,this.keyId)}isSupported(){if(this.method){if(d_(this.method)||"NONE"===this.method)return!0;if("identity"===this.keyFormat)return"SAMPLE-AES"===this.method;switch(this.keyFormat){case w_:case S_:case E_:case __:return-1!==["SAMPLE-AES","SAMPLE-AES-CENC","SAMPLE-AES-CTR"].indexOf(this.method)}}return!1}getDecryptData(t,e){if(!this.encrypted||!this.uri)return null;if(d_(this.method)){let e=this.iv;e||("number"!==typeof t&&(Iy.warn('missing IV for initialization segment with method="'.concat(this.method,'" - compliance issue')),t=0),e=function(t){const e=new Uint8Array(16);for(let r=12;r<16;r++)e[r]=t>>8*(15-r)&255;return e}(t));return new P_(this.method,this.uri,"identity",this.keyFormatVersions,e)}if(this.keyId){const t=L_[this.uri];if(t&&!u_(this.keyId,t)&&P_.setKeyIdForUri(this.uri,this.keyId),this.pssh)return this}const r=y_(this.uri);if(r)switch(this.keyFormat){case S_:if(this.pssh=r,!this.keyId){const t=function(t){const e=[];if(t instanceof ArrayBuffer){const r=t.byteLength;let n=0;for(;n+32<r;){const r=vv(new DataView(t,n));e.push(r),n+=r.size}}return e}(r.buffer);if(t.length){var n;const e=t[0];this.keyId=null!=(n=e.kids)&&n.length?e.kids[0]:null}}this.keyId||(this.keyId=C_(e));break;case E_:{const t=new Uint8Array([154,4,240,121,152,64,66,134,171,146,230,91,224,136,95,149]);this.pssh=yv(t,0,r),this.keyId=R_(r);break}default:{let t=r.subarray(0,16);if(16!==t.length){const e=new Uint8Array(16);e.set(t,16-t.length),t=e}this.keyId=t;break}}if(!this.keyId||16!==this.keyId.byteLength){let t;t=function(t){const e=null==t?void 0:t[S_];if(e)return e.keyId;return null}(e),t||(t=C_(e),t||(t=L_[this.uri])),t&&(this.keyId=t,P_.setKeyIdForUri(this.uri,t))}return this}}function C_(t){const e=null==t?void 0:t[E_];if(e){const t=y_(e.uri);if(t)return R_(t)}return null}const M_=/#EXT-X-STREAM-INF:([^\r\n]*)(?:[\r\n](?:#[^\r\n]*)?)*([^\r\n]+)|#EXT-X-(SESSION-DATA|SESSION-KEY|DEFINE|CONTENT-STEERING|START):([^\r\n]*)[\r\n]+/g,O_=/#EXT-X-MEDIA:(.*)/g,D_=/^#EXT(?:INF|-X-TARGETDURATION):/m,N_=new RegExp([/#EXTINF:\s*(\d*(?:\.\d+)?)(?:,(.*)\s+)?/.source,/(?!#) *(\S[^\r\n]*)/.source,/#.*/.source].join("|"),"g"),F_=new RegExp([/#EXT-X-(PROGRAM-DATE-TIME|BYTERANGE|DATERANGE|DEFINE|KEY|MAP|PART|PART-INF|PLAYLIST-TYPE|PRELOAD-HINT|RENDITION-REPORT|SERVER-CONTROL|SKIP|START):(.+)/.source,/#EXT-X-(BITRATE|DISCONTINUITY-SEQUENCE|MEDIA-SEQUENCE|TARGETDURATION|VERSION): *(\d+)/.source,/#EXT-X-(DISCONTINUITY|ENDLIST|GAP|INDEPENDENT-SEGMENTS)/.source,/(#)([^:]*):(.*)/.source,/(#)(.*)(?:.*)\r?\n?/.source].join("|"));class U_{static findGroup(t,e){for(let r=0;r<t.length;r++){const n=t[r];if(n.id===e)return n}}static resolve(t,e){return Fy.buildAbsoluteURL(e,t,{alwaysNormalize:!0})}static isMediaPlaylist(t){return D_.test(t)}static parseMasterPlaylist(t,e){const r={contentSteering:null,levels:[],playlistParsingError:null,sessionData:null,sessionKeys:null,startTimeOffset:null,variableList:null,hasVariableRefs:Jb(t)},n=[];if(M_.lastIndex=0,!t.startsWith("#EXTM3U"))return r.playlistParsingError=new Error("no EXTM3U delimiter"),r;let i;for(;null!=(i=M_.exec(t));)if(i[1]){var s;const t=new s_(i[1],r),a=t_(r,i[2]),o={attrs:t,bitrate:t.decimalInteger("BANDWIDTH")||t.decimalInteger("AVERAGE-BANDWIDTH"),name:t.NAME,url:U_.resolve(a,e)},l=t.decimalResolution("RESOLUTION");l&&(o.width=l.width,o.height=l.height),G_(t.CODECS,o);const c=t["SUPPLEMENTAL-CODECS"];c&&(o.supplemental={},G_(c,o.supplemental)),null!=(s=o.unknownCodecs)&&s.length||n.push(o),r.levels.push(o)}else if(i[3]){const t=i[3],n=i[4];switch(t){case"SESSION-DATA":{const t=new s_(n,r),e=t["DATA-ID"];e&&(null===r.sessionData&&(r.sessionData={}),r.sessionData[e]=t);break}case"SESSION-KEY":{const t=z_(n,e,r);t.encrypted&&t.isSupported()?(null===r.sessionKeys&&(r.sessionKeys=[]),r.sessionKeys.push(t)):Iy.warn('[Keys] Ignoring invalid EXT-X-SESSION-KEY tag: "'.concat(n,'"'));break}case"DEFINE":e_(r,new s_(n,r),e);break;case"CONTENT-STEERING":{const t=new s_(n,r);r.contentSteering={uri:U_.resolve(t["SERVER-URI"],e),pathwayId:t["PATHWAY-ID"]||"."};break}case"START":r.startTimeOffset=W_(n)}}const a=n.length>0&&n.length<r.levels.length;return r.levels=a?n:r.levels,0===r.levels.length&&(r.playlistParsingError=new Error("no levels found in manifest")),r}static parseMasterPlaylistMedia(t,e,r){let n;const i={},s=r.levels,a={AUDIO:s.map(t=>({id:t.attrs.AUDIO,audioCodec:t.audioCodec})),SUBTITLES:s.map(t=>({id:t.attrs.SUBTITLES,textCodec:t.textCodec})),"CLOSED-CAPTIONS":[]};let o=0;for(O_.lastIndex=0;null!==(n=O_.exec(t));){const t=new s_(n[1],r),s=t.TYPE;if(s){const r=a[s],n=i[s]||[];i[s]=n;const l=t.LANGUAGE,c=t["ASSOC-LANGUAGE"],u=t.CHANNELS,h=t.CHARACTERISTICS,d=t["INSTREAM-ID"],f={attrs:t,bitrate:0,id:o++,groupId:t["GROUP-ID"]||"",name:t.NAME||l||"",type:s,default:t.bool("DEFAULT"),autoselect:t.bool("AUTOSELECT"),forced:t.bool("FORCED"),lang:l,url:t.URI?U_.resolve(t.URI,e):""};if(c&&(f.assocLang=c),u&&(f.channels=u),h&&(f.characteristics=h),d&&(f.instreamId=d),null!=r&&r.length){const t=U_.findGroup(r,f.groupId)||r[0];V_(f,t,"audioCodec"),V_(f,t,"textCodec")}n.push(f)}}return i}static parseLevelPlaylist(t,e,r,n,i,s){var a;const o={url:e},l=new c_(e),c=l.fragments,u=[];let h,d,f,p,g=null,m=0,y=0,v=0,b=0,_=0,w=null,E=new Vy(n,o),S=-1,T=!1,k=null;if(N_.lastIndex=0,l.m3u8=t,l.hasVariableRefs=Jb(t),"#EXTM3U"!==(null==(a=N_.exec(t))?void 0:a[0]))return l.playlistParsingError=new Error("Missing format identifier #EXTM3U"),l;for(;null!==(h=N_.exec(t));){T&&(T=!1,E=new Vy(n,o),E.playlistOffset=v,E.setStart(v),E.sn=m,E.cc=b,_&&(E.bitrate=_),E.level=r,g&&(E.initSegment=g,g.rawProgramDateTime&&(E.rawProgramDateTime=g.rawProgramDateTime,g.rawProgramDateTime=null),k&&(E.setByteRange(k),k=null)));const t=h[1];if(t){E.duration=parseFloat(t);const e=(" "+h[2]).slice(1);E.title=e||null,E.tagList.push(e?["INF",t,e]:["INF",t])}else if(h[3]){if(ny(E.duration)){E.playlistOffset=v,E.setStart(v),f&&q_(E,f,l),E.sn=m,E.level=r,E.cc=b,c.push(E);const t=(" "+h[3]).slice(1);E.relurl=t_(l,t),H_(E,w,u),w=E,v+=E.duration,m++,y=0,T=!0}}else{if(h=h[0].match(F_),!h){Iy.warn("No matches on slow regex match for level playlist!");continue}for(d=1;d<h.length&&void 0===h[d];d++);const t=(" "+h[d]).slice(1),i=(" "+h[d+1]).slice(1),a=h[d+2]?(" "+h[d+2]).slice(1):null;switch(t){case"BYTERANGE":w?E.setByteRange(i,w):E.setByteRange(i);break;case"PROGRAM-DATE-TIME":E.rawProgramDateTime=i,E.tagList.push(["PROGRAM-DATE-TIME",i]),-1===S&&(S=c.length);break;case"PLAYLIST-TYPE":l.type&&Y_(l,t,h),l.type=i.toUpperCase();break;case"MEDIA-SEQUENCE":0!==l.startSN?Y_(l,t,h):c.length>0&&Q_(l,t,h),m=l.startSN=parseInt(i);break;case"SKIP":{l.skippedSegments&&Y_(l,t,h);const e=new s_(i,l),r=e.decimalInteger("SKIPPED-SEGMENTS");if(ny(r)){l.skippedSegments+=r;for(let t=r;t--;)c.push(null);m+=r}const n=e.enumeratedString("RECENTLY-REMOVED-DATERANGES");n&&(l.recentlyRemovedDateranges=(l.recentlyRemovedDateranges||[]).concat(n.split("\t")));break}case"TARGETDURATION":0!==l.targetduration&&Y_(l,t,h),l.targetduration=Math.max(parseInt(i),1);break;case"VERSION":null!==l.version&&Y_(l,t,h),l.version=parseInt(i);break;case"INDEPENDENT-SEGMENTS":break;case"ENDLIST":l.live||Y_(l,t,h),l.live=!1;break;case"#":(i||a)&&E.tagList.push(a?[i,a]:[i]);break;case"DISCONTINUITY":b++,E.tagList.push(["DIS"]);break;case"GAP":E.gap=!0,E.tagList.push([t]);break;case"BITRATE":E.tagList.push([t,i]),_=1e3*parseInt(i),ny(_)?E.bitrate=_:_=0;break;case"DATERANGE":{const t=new s_(i,l),e=new l_(t,l.dateRanges[t.ID],l.dateRangeTagCount);l.dateRangeTagCount++,e.isValid||l.skippedSegments?l.dateRanges[e.id]=e:Iy.warn('Ignoring invalid DATERANGE tag: "'.concat(i,'"')),E.tagList.push(["EXT-X-DATERANGE",i]);break}case"DEFINE":{const t=new s_(i,l);"IMPORT"in t?r_(l,t,s):e_(l,t,e)}break;case"DISCONTINUITY-SEQUENCE":0!==l.startCC?Y_(l,t,h):c.length>0&&Q_(l,t,h),l.startCC=b=parseInt(i);break;case"KEY":{const t=z_(i,e,l);if(t.isSupported()){if("NONE"===t.method){f=void 0;break}f||(f={});const e=f[t.keyFormat];null!=e&&e.matches(t)||(e&&(f=by({},f)),f[t.keyFormat]=t)}else Iy.warn('[Keys] Ignoring unsupported EXT-X-KEY tag: "'.concat(i,'"'));break}case"START":l.startTimeOffset=W_(i);break;case"MAP":{const t=new s_(i,l);if(E.duration){const e=new Vy(n,o);K_(e,t,r,f),g=e,E.initSegment=g,g.rawProgramDateTime&&!E.rawProgramDateTime&&(E.rawProgramDateTime=g.rawProgramDateTime)}else{const e=E.byteRangeEndOffset;if(e){const t=E.byteRangeStartOffset;k="".concat(e-t,"@").concat(t)}else k=null;K_(E,t,r,f),g=E,T=!0}g.cc=b;break}case"SERVER-CONTROL":p&&Y_(l,t,h),p=new s_(i),l.canBlockReload=p.bool("CAN-BLOCK-RELOAD"),l.canSkipUntil=p.optionalFloat("CAN-SKIP-UNTIL",0),l.canSkipDateRanges=l.canSkipUntil>0&&p.bool("CAN-SKIP-DATERANGES"),l.partHoldBack=p.optionalFloat("PART-HOLD-BACK",0),l.holdBack=p.optionalFloat("HOLD-BACK",0);break;case"PART-INF":{l.partTarget&&Y_(l,t,h);const e=new s_(i);l.partTarget=e.decimalFloatingPoint("PART-TARGET");break}case"PART":{let t=l.partList;t||(t=l.partList=[]);const e=y>0?t[t.length-1]:void 0,r=y++,n=new s_(i,l),s=new Hy(n,E,o,r,e);t.push(s),E.duration+=s.duration;break}case"PRELOAD-HINT":{const t=new s_(i,l);l.preloadHint=t;break}case"RENDITION-REPORT":{const t=new s_(i,l);l.renditionReports=l.renditionReports||[],l.renditionReports.push(t);break}default:Iy.warn("line parsed but not handled: ".concat(h))}}}w&&!w.relurl?(c.pop(),v-=w.duration,l.partList&&(l.fragmentHint=w)):l.partList&&(H_(E,w,u),E.cc=b,l.fragmentHint=E,f&&q_(E,f,l)),l.targetduration||(l.playlistParsingError=new Error("Missing Target Duration"));const A=c.length,x=c[0],I=c[A-1];if(v+=l.skippedSegments*l.targetduration,v>0&&A&&I){l.averagetargetduration=v/A;const t=I.sn;l.endSN="initSegment"!==t?t:0,l.live||(I.endList=!0),S>0&&(!function(t,e){let r=t[e];for(let n=e;n--;){const e=t[n];if(!e)return;e.programDateTime=r.programDateTime-1e3*e.duration,r=e}}(c,S),x&&u.unshift(x))}return l.fragmentHint&&(v+=l.fragmentHint.duration),l.totalduration=v,u.length&&l.dateRangeTagCount&&x&&B_(u,l),l.endCC=b,l}}function B_(t,e){let r=t.length;if(!r){if(!e.hasProgramDateTime)return;{const n=e.fragments[e.fragments.length-1];t.push(n),r++}}const n=t[r-1],i=e.live?1/0:e.totalduration,s=Object.keys(e.dateRanges);for(let o=s.length;o--;){const l=e.dateRanges[s[o]],c=l.startDate.getTime();l.tagAnchor=n.ref;for(let n=r;n--;){var a;if((null==(a=t[n])?void 0:a.sn)<e.startSN)break;const r=j_(e,c,t,n,i);if(-1!==r){l.tagAnchor=e.fragments[r].ref;break}}}}function j_(t,e,r,n,i){const s=r[n];if(s){const o=s.programDateTime;if(e>=o||0===n){var a;if(e<=o+1e3*(((null==(a=r[n+1])?void 0:a.start)||i)-s.start)){const i=r[n].sn-t.startSN;if(i<0)return-1;const s=t.fragments;if(s.length>r.length){for(let a=(r[n+1]||s[s.length-1]).sn-t.startSN;a>i;a--){const t=s[a].programDateTime;if(e>=t&&e<t+1e3*s[a].duration)return a}}return i}}}return-1}function z_(t,e,r){var n,i;const s=new s_(t,r),a=null!=(n=s.METHOD)?n:"",o=s.URI,l=s.hexadecimalInteger("IV"),c=s.KEYFORMATVERSIONS,u=null!=(i=s.KEYFORMAT)?i:"identity";o&&s.IV&&!l&&Iy.error("Invalid IV: ".concat(s.IV));const h=o?U_.resolve(o,e):"",d=(c||"1").split("/").map(Number).filter(Number.isFinite);return new P_(a,h,u,d,l,s.KEYID)}function W_(t){const e=new s_(t).decimalFloatingPoint("TIME-OFFSET");return ny(e)?e:null}function G_(t,e){let r=(t||"").split(/[ ,]+/).filter(t=>t);["video","audio","text"].forEach(t=>{const n=r.filter(e=>wv(e,t));n.length&&(e["".concat(t,"Codec")]=n.map(t=>t.split("/")[0]).join(","),r=r.filter(t=>-1===n.indexOf(t)))}),e.unknownCodecs=r}function V_(t,e,r){const n=e[r];n&&(t[r]=n)}function H_(t,e,r){t.rawProgramDateTime?r.push(t):null!=e&&e.programDateTime&&(t.programDateTime=e.endProgramDateTime)}function K_(t,e,r,n){t.relurl=e.URI,e.BYTERANGE&&t.setByteRange(e.BYTERANGE),t.level=r,t.sn="initSegment",n&&(t.levelkeys=n),t.initSegment=null}function q_(t,e,r){t.levelkeys=e;const{encryptedFragments:n}=r;n.length&&n[n.length-1].levelkeys===e||!Object.keys(e).some(t=>e[t].isCommonEncryption)||n.push(t)}function Y_(t,e,r){t.playlistParsingError=new Error("#EXT-X-".concat(e," must not appear more than once (").concat(r[0],")"))}function Q_(t,e,r){t.playlistParsingError=new Error("#EXT-X-".concat(e," must appear before the first Media Segment (").concat(r[0],")"))}function X_(t,e){const r=e.startPTS;if(ny(r)){let n,i=0;e.sn>t.sn?(i=r-t.start,n=t):(i=t.start-r,n=e),n.duration!==i&&n.setDuration(i)}else if(e.sn>t.sn){t.cc===e.cc&&t.minEndPTS?e.setStart(t.start+(t.minEndPTS-t.start)):e.setStart(t.start+t.duration)}else e.setStart(Math.max(t.start-e.duration,0))}function $_(t,e,r,n,i,s,a){n-r<=0&&(a.warn("Fragment should have a positive duration",e),n=r+e.duration,s=i+e.duration);let o=r,l=n;const c=e.startPTS,u=e.endPTS;if(ny(c)){const h=Math.abs(c-r);t&&h>t.totalduration?a.warn("media timestamps and playlist times differ by ".concat(h,"s for level ").concat(e.level," ").concat(t.url)):ny(e.deltaPTS)?e.deltaPTS=Math.max(h,e.deltaPTS):e.deltaPTS=h,o=Math.max(r,c),r=Math.min(r,c),i=void 0!==e.startDTS?Math.min(i,e.startDTS):i,l=Math.min(n,u),n=Math.max(n,u),s=void 0!==e.endDTS?Math.max(s,e.endDTS):s}const h=r-e.start;0!==e.start&&e.setStart(r),e.setDuration(n-e.start),e.startPTS=r,e.maxStartPTS=o,e.startDTS=i,e.endPTS=n,e.minEndPTS=l,e.endDTS=s;const d=e.sn;if(!t||d<t.startSN||d>t.endSN)return 0;let f;const p=d-t.startSN,g=t.fragments;for(g[p]=e,f=p;f>0;f--)X_(g[f],g[f-1]);for(f=p;f<g.length-1;f++)X_(g[f],g[f+1]);return t.fragmentHint&&X_(g[g.length-1],t.fragmentHint),t.PTSKnown=t.alignedSliding=!0,h}function Z_(t,e,r){if(t===e)return;let n=null;const i=t.fragments;for(let u=i.length-1;u>=0;u--){const t=i[u].initSegment;if(t){n=t;break}}let s;t.fragmentHint&&delete t.fragmentHint.endPTS,function(t,e,r){const n=e.skippedSegments,i=Math.max(t.startSN,e.startSN)-e.startSN,s=(t.fragmentHint?1:0)+(n?e.endSN:Math.min(t.endSN,e.endSN))-e.startSN,a=e.startSN-t.startSN,o=e.fragmentHint?e.fragments.concat(e.fragmentHint):e.fragments,l=t.fragmentHint?t.fragments.concat(t.fragmentHint):t.fragments;for(let c=i;c<=s;c++){const i=l[a+c];let s=o[c];if(n&&!s&&i&&(s=e.fragments[c]=i),i&&s){r(i,s,c,o);const n=i.relurl,a=s.relurl;if(n&&ow(n,a))return void(e.playlistParsingError=J_("media sequence mismatch ".concat(s.sn,":"),t,e,i,s));if(i.cc!==s.cc)return void(e.playlistParsingError=J_("discontinuity sequence mismatch (".concat(i.cc,"!=").concat(s.cc,")"),t,e,i,s))}}}(t,e,(t,r,i,a)=>{if((!e.startCC||e.skippedSegments)&&r.cc!==t.cc){const n=t.cc-r.cc;for(let t=i;t<a.length;t++)a[t].cc+=n;e.endCC=a[a.length-1].cc}ny(t.startPTS)&&ny(t.endPTS)&&(r.setStart(r.startPTS=t.startPTS),r.startDTS=t.startDTS,r.maxStartPTS=t.maxStartPTS,r.endPTS=t.endPTS,r.endDTS=t.endDTS,r.minEndPTS=t.minEndPTS,r.setDuration(t.endPTS-t.startPTS),r.duration&&(s=r),e.PTSKnown=e.alignedSliding=!0),t.hasStreams&&(r.elementaryStreams=t.elementaryStreams),r.loader=t.loader,t.hasStats&&(r.stats=t.stats),t.initSegment&&(r.initSegment=t.initSegment,n=t.initSegment)});const a=e.fragments,o=e.fragmentHint?a.concat(e.fragmentHint):a;if(n&&o.forEach(t=>{var e;!t||t.initSegment&&t.initSegment.relurl!==(null==(e=n)?void 0:e.relurl)||(t.initSegment=n)}),e.skippedSegments){if(e.deltaUpdateFailed=a.some(t=>!t),e.deltaUpdateFailed){r.warn("[level-helper] Previous playlist missing segments skipped in delta playlist");for(let t=e.skippedSegments;t--;)a.shift();e.startSN=a[0].sn}else{e.canSkipDateRanges&&(e.dateRanges=function(t,e,r){const{dateRanges:n,recentlyRemovedDateranges:i}=e,s=by({},t);i&&i.forEach(t=>{delete s[t]});const a=Object.keys(s).length;if(!a)return n;return Object.keys(n).forEach(t=>{const e=s[t],i=new l_(n[t].attr,e);i.isValid?(s[t]=i,e||(i.tagOrder+=a)):r.warn('Ignoring invalid Playlist Delta Update DATERANGE tag: "'.concat(Zv(n[t].attr),'"'))}),s}(t.dateRanges,e,r));const n=t.fragments.filter(t=>t.rawProgramDateTime);if(t.hasProgramDateTime&&!e.hasProgramDateTime)for(let t=1;t<o.length;t++)null===o[t].programDateTime&&H_(o[t],o[t-1],n);B_(n,e)}e.endCC=a[a.length-1].cc}if(!e.startCC){var l;const r=nw(t,e.startSN-1);e.startCC=null!=(l=null==r?void 0:r.cc)?l:a[0].cc}!function(t,e,r){if(t&&e){let n=0;for(let i=0,s=t.length;i<=s;i++){const s=t[i],a=e[i+n];s&&a&&s.index===a.index&&s.fragment.sn===a.fragment.sn?r(s,a):n--}}}(t.partList,e.partList,(t,e)=>{e.elementaryStreams=t.elementaryStreams,e.stats=t.stats}),s?$_(e,s,s.startPTS,s.endPTS,s.startDTS,s.endDTS,r):tw(t,e),a.length&&(e.totalduration=e.edge-a[0].start),e.driftStartTime=t.driftStartTime,e.driftStart=t.driftStart;const c=e.advancedDateTime;if(e.advanced&&c){const t=e.edge;e.driftStart||(e.driftStartTime=c,e.driftStart=t),e.driftEndTime=c,e.driftEnd=t}else e.driftEndTime=t.driftEndTime,e.driftEnd=t.driftEnd,e.advancedDateTime=t.advancedDateTime;-1===e.requestScheduled&&(e.requestScheduled=t.requestScheduled)}function J_(t,e,r,n,i){return new Error("".concat(t," ").concat(i.url,"\nPlaylist starting @").concat(e.startSN,"\n").concat(e.m3u8,"\n\nPlaylist starting @").concat(r.startSN,"\n").concat(r.m3u8))}function tw(t,e){let r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const n=e.startSN+e.skippedSegments-t.startSN,i=t.fragments,s=n>=0;let a=0;if(s&&n<i.length)a=i[n].start;else if(s&&e.startSN===t.endSN+1)a=t.fragmentEnd;else if(s&&r)a=t.fragmentStart+n*e.levelTargetDuration;else{if(e.skippedSegments||0!==e.fragmentStart)return;a=t.fragmentStart}ew(e,a)}function ew(t,e){if(e){const r=t.fragments;for(let n=t.skippedSegments;n<r.length;n++)r[n].addStart(e);t.fragmentHint&&t.fragmentHint.addStart(e)}}function rw(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1/0,r=1e3*t.targetduration;if(t.updated){const n=t.fragments,i=4;if(n.length&&r*i>e){const t=1e3*n[n.length-1].duration;t<r&&(r=t)}}else r/=2;return Math.round(r)}function nw(t,e,r){if(!t)return null;let n=t.fragments[e-t.startSN];return n||(n=t.fragmentHint,n&&n.sn===e?n:e<t.startSN&&r&&r.sn===e?r:null)}function iw(t,e,r){return t?sw(t.partList,e,r):null}function sw(t,e,r){if(t)for(let n=t.length;n--;){const i=t[n];if(i.index===r&&i.fragment.sn===e)return i}return null}function aw(t){t.forEach((t,e)=>{var r;null==(r=t.details)||r.fragments.forEach(t=>{t.level=e,t.initSegment&&(t.initSegment.level=e)})})}function ow(t,e){return!(t===e||!e)&&lw(t)!==lw(e)}function lw(t){return t.replace(/\?[^?]*$/,"")}function cw(t,e){for(let n=0,i=t.length;n<i;n++){var r;if((null==(r=t[n])?void 0:r.cc)===e)return t[n]}return null}function uw(t,e){const r=t.start+e;t.startPTS=r,t.setStart(r),t.endPTS=r+t.duration}function hw(t,e){const r=e.fragments;for(let n=0,i=r.length;n<i;n++)uw(r[n],t);e.fragmentHint&&uw(e.fragmentHint,t),e.alignedSliding=!0}function dw(t,e){if(!function(t,e){return!!(t&&e.startCC<t.endCC&&e.endCC>t.startCC)}(e,t))return;const r=Math.min(e.endCC,t.endCC),n=cw(e.fragments,r),i=cw(t.fragments,r);if(!n||!i)return;Iy.log("Aligning playlist at start of dicontinuity sequence ".concat(r));hw(n.start-i.start,t)}function fw(t,e){if(!t.hasProgramDateTime||!e.hasProgramDateTime)return;const r=t.fragments,n=e.fragments;if(!r.length||!n.length)return;let i,s;const a=Math.min(e.endCC,t.endCC);e.startCC<a&&t.startCC<a&&(i=cw(n,a),s=cw(r,a)),i&&s||(i=n[Math.floor(n.length/2)],s=cw(r,i.cc)||r[Math.floor(r.length/2)]);const o=i.programDateTime,l=s.programDateTime;if(!o||!l)return;hw((l-o)/1e3-(s.start-i.start),t)}function pw(t,e,r){gw(t,e,r),t.addEventListener(e,r)}function gw(t,e,r){t.removeEventListener(e,r)}const mw=function(t){let e="";const r=t.length;for(let n=0;n<r;n++)e+="[".concat(t.start(n).toFixed(3),"-").concat(t.end(n).toFixed(3),"]");return e},yw="STOPPED",vw="IDLE",bw="KEY_LOADING",_w="FRAG_LOADING",ww="FRAG_LOADING_WAITING_RETRY",Ew="WAITING_TRACK",Sw="PARSING",Tw="PARSED",kw="ENDED",Aw="ERROR",xw="WAITING_INIT_PTS",Iw="WAITING_LEVEL";class Rw extends Yb{constructor(t,e,r,n,i){super(n,t.logger),this.hls=void 0,this.fragPrevious=null,this.fragCurrent=null,this.fragmentTracker=void 0,this.transmuxer=null,this._state=yw,this.playlistType=void 0,this.media=null,this.mediaBuffer=null,this.config=void 0,this.bitrateTest=!1,this.lastCurrentTime=0,this.nextLoadPosition=0,this.startPosition=0,this.startTimeOffset=null,this.retryDate=0,this.levels=null,this.fragmentLoader=void 0,this.keyLoader=void 0,this.levelLastLoaded=null,this.startFragRequested=!1,this.decrypter=void 0,this.initPTS=[],this.buffering=!0,this.loadingParts=!1,this.loopSn=void 0,this.onMediaSeeking=()=>{const{config:t,fragCurrent:e,media:r,mediaBuffer:n,state:i}=this,s=r?r.currentTime:0,a=$b.bufferInfo(n||r,s,t.maxBufferHole),o=!a.len;if(this.log("Media seeking to ".concat(ny(s)?s.toFixed(3):s,", state: ").concat(i,", ").concat(o?"out of":"in"," buffer")),this.state===kw)this.resetLoadingState();else if(e){const r=t.maxFragLookUpTolerance,n=e.start-r,i=e.start+e.duration+r;if(o||i<a.start||n>a.end){const t=s>i;(s<n||t)&&(t&&e.loader&&(this.log("Cancelling fragment load for seek (sn: ".concat(e.sn,")")),e.abortRequests(),this.resetLoadingState()),this.fragPrevious=null)}}if(r){this.fragmentTracker.removeFragmentsInRange(s,1/0,this.playlistType,!0);if(s>this.lastCurrentTime&&(this.lastCurrentTime=s),!this.loadingParts){const t=Math.max(a.end,s),e=this.shouldLoadParts(this.getLevelDetails(),t);e&&(this.log("LL-Part loading ON after seeking to ".concat(s.toFixed(2)," with buffer @").concat(t.toFixed(2))),this.loadingParts=e)}}this.hls.hasEnoughToStart||(this.log("Setting ".concat(o?"startPosition":"nextLoadPosition"," to ").concat(s," for seek without enough to start")),this.nextLoadPosition=s,o&&(this.startPosition=s)),o&&this.state===vw&&this.tickImmediate()},this.onMediaEnded=()=>{this.log("setting startPosition to 0 because media ended"),this.startPosition=this.lastCurrentTime=0},this.playlistType=i,this.hls=t,this.fragmentLoader=new Vb(t.config),this.keyLoader=r,this.fragmentTracker=e,this.config=t.config,this.decrypter=new Wb(t.config)}registerListeners(){const{hls:t}=this;t.on(ly.MEDIA_ATTACHED,this.onMediaAttached,this),t.on(ly.MEDIA_DETACHING,this.onMediaDetaching,this),t.on(ly.MANIFEST_LOADING,this.onManifestLoading,this),t.on(ly.MANIFEST_LOADED,this.onManifestLoaded,this),t.on(ly.ERROR,this.onError,this)}unregisterListeners(){const{hls:t}=this;t.off(ly.MEDIA_ATTACHED,this.onMediaAttached,this),t.off(ly.MEDIA_DETACHING,this.onMediaDetaching,this),t.off(ly.MANIFEST_LOADING,this.onManifestLoading,this),t.off(ly.MANIFEST_LOADED,this.onManifestLoaded,this),t.off(ly.ERROR,this.onError,this)}doTick(){this.onTickEnd()}onTickEnd(){}startLoad(t){}stopLoad(){if(this.state===yw)return;this.fragmentLoader.abort(),this.keyLoader.abort(this.playlistType);const t=this.fragCurrent;null!=t&&t.loader&&(t.abortRequests(),this.fragmentTracker.removeFragment(t)),this.resetTransmuxer(),this.fragCurrent=null,this.fragPrevious=null,this.clearInterval(),this.clearNextTick(),this.state=yw}get startPositionValue(){const{nextLoadPosition:t,startPosition:e}=this;return-1===e&&t?t:e}get bufferingEnabled(){return this.buffering}pauseBuffering(){this.buffering=!1}resumeBuffering(){this.buffering=!0}get inFlightFrag(){return{frag:this.fragCurrent,state:this.state}}_streamEnded(t,e){if(e.live||!this.media)return!1;const r=t.end||0,n=this.config.timelineOffset||0;if(r<=n)return!1;const i=t.buffered;this.config.maxBufferHole&&i&&i.length>1&&(t=$b.bufferedInfo(i,t.start,0));const s=t.nextStart;if(s&&s>n&&s<e.edge)return!1;if(this.media.currentTime<t.start)return!1;const a=e.partList;if(null!=a&&a.length){const t=a[a.length-1];return $b.isBuffered(this.media,t.start+t.duration/2)}const o=e.fragments[e.fragments.length-1].type;return this.fragmentTracker.isEndListAppended(o)}getLevelDetails(){if(this.levels&&null!==this.levelLastLoaded)return this.levelLastLoaded.details}get timelineOffset(){const t=this.config.timelineOffset;var e;return t?(null==(e=this.getLevelDetails())?void 0:e.appliedTimelineOffset)||t:0}onMediaAttached(t,e){const r=this.media=this.mediaBuffer=e.media;pw(r,"seeking",this.onMediaSeeking),pw(r,"ended",this.onMediaEnded);const n=this.config;this.levels&&n.autoStartLoad&&this.state===yw&&this.startLoad(n.startPosition)}onMediaDetaching(t,e){const r=!!e.transferMedia,n=this.media;if(null!==n){if(n.ended&&(this.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0),gw(n,"seeking",this.onMediaSeeking),gw(n,"ended",this.onMediaEnded),this.keyLoader&&!r&&this.keyLoader.detach(),this.media=this.mediaBuffer=null,this.loopSn=void 0,r)return this.resetLoadingState(),void this.resetTransmuxer();this.loadingParts=!1,this.fragmentTracker.removeAllFragments(),this.stopLoad()}}onManifestLoading(){this.initPTS=[],this.levels=this.levelLastLoaded=this.fragCurrent=null,this.lastCurrentTime=this.startPosition=0,this.startFragRequested=!1}onError(t,e){}onManifestLoaded(t,e){this.startTimeOffset=e.startTimeOffset}onHandlerDestroying(){this.stopLoad(),this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null),super.onHandlerDestroying(),this.hls=this.onMediaSeeking=this.onMediaEnded=null}onHandlerDestroyed(){this.state=yw,this.fragmentLoader&&this.fragmentLoader.destroy(),this.keyLoader&&this.keyLoader.destroy(),this.decrypter&&this.decrypter.destroy(),this.hls=this.log=this.warn=this.decrypter=this.keyLoader=this.fragmentLoader=this.fragmentTracker=null,super.onHandlerDestroyed()}loadFragment(t,e,r){this.startFragRequested=!0,this._loadFragForPlayback(t,e,r)}_loadFragForPlayback(t,e,r){this._doFragLoad(t,e,r,t=>{const e=t.frag;if(this.fragContextChanged(e))return this.warn("".concat(e.type," sn: ").concat(e.sn).concat(t.part?" part: "+t.part.index:""," of ").concat(this.fragInfo(e,!1,t.part),") was dropped during download.")),void this.fragmentTracker.removeFragment(e);e.stats.chunkCount++,this._handleFragmentLoadProgress(t)}).then(t=>{if(!t)return;const e=this.state,r=t.frag;this.fragContextChanged(r)?(e===_w||!this.fragCurrent&&e===Sw)&&(this.fragmentTracker.removeFragment(r),this.state=vw):("payload"in t&&(this.log("Loaded ".concat(r.type," sn: ").concat(r.sn," of ").concat(this.playlistLabel()," ").concat(r.level)),this.hls.trigger(ly.FRAG_LOADED,t)),this._handleFragmentLoadComplete(t))}).catch(e=>{this.state!==yw&&this.state!==Aw&&(this.warn("Frag error: ".concat((null==e?void 0:e.message)||e)),this.resetFragmentLoading(t))})}clearTrackerIfNeeded(t){var e;const{fragmentTracker:r}=this;if(r.getState(t)===Lb){const e=t.type,n=this.getFwdBufferInfo(this.mediaBuffer,e),i=Math.max(t.duration,n?n.len:this.config.maxBufferLength),s=this.backtrackFragment;(1===(s?t.sn-s.sn:0)||this.reduceMaxBufferLength(i,t.duration))&&r.removeFragment(t)}else 0===(null==(e=this.mediaBuffer)?void 0:e.buffered.length)?r.removeAllFragments():r.hasParts(t.type)&&(r.detectPartialFragments({frag:t,part:null,stats:t.stats,id:t.type}),r.getState(t)===Pb&&r.removeFragment(t))}checkLiveUpdate(t){if(t.updated&&!t.live){const e=t.fragments[t.fragments.length-1];this.fragmentTracker.detectPartialFragments({frag:e,part:null,stats:e.stats,id:e.type})}t.fragments[0]||(t.deltaUpdateFailed=!0)}waitForLive(t){const e=t.details;return(null==e?void 0:e.live)&&"EVENT"!==e.type&&(this.levelLastLoaded!==t||e.expired)}flushMainBuffer(t,e){if(!(t-e))return;const r={startOffset:t,endOffset:e,type:arguments.length>2&&void 0!==arguments[2]?arguments[2]:null};this.hls.trigger(ly.BUFFER_FLUSHING,r)}_loadInitSegment(t,e){this._doFragLoad(t,e).then(t=>{const e=null==t?void 0:t.frag;if(!e||this.fragContextChanged(e)||!this.levels)throw new Error("init load aborted");return t}).then(t=>{const{hls:e}=this,{frag:r,payload:n}=t,i=r.decryptdata;if(n&&n.byteLength>0&&null!=i&&i.key&&i.iv&&d_(i.method)){const s=self.performance.now();return this.decrypter.decrypt(new Uint8Array(n),i.key.buffer,i.iv.buffer,f_(i.method)).catch(t=>{throw e.trigger(ly.ERROR,{type:ay.MEDIA_ERROR,details:oy.FRAG_DECRYPT_ERROR,fatal:!1,error:t,reason:t.message,frag:r}),t}).then(n=>{const i=self.performance.now();return e.trigger(ly.FRAG_DECRYPTED,{frag:r,payload:n,stats:{tstart:s,tdecrypt:i}}),t.payload=n,this.completeInitSegmentLoad(t)})}return this.completeInitSegmentLoad(t)}).catch(e=>{this.state!==yw&&this.state!==Aw&&(this.warn(e),this.resetFragmentLoading(t))})}completeInitSegmentLoad(t){const{levels:e}=this;if(!e)throw new Error("init load aborted, missing levels");const r=t.frag.stats;this.state!==yw&&(this.state=vw),t.frag.data=new Uint8Array(t.payload),r.parsing.start=r.buffering.start=self.performance.now(),r.parsing.end=r.buffering.end=self.performance.now(),this.tick()}unhandledEncryptionError(t,e){var r,n;const i=t.tracks;if(i&&!e.encrypted&&(null!=(r=i.audio)&&r.encrypted||null!=(n=i.video)&&n.encrypted)&&(!this.config.emeEnabled||!this.keyLoader.emeController)){const t=this.media,r=new Error("Encrypted track with no key in ".concat(this.fragInfo(e)," (media ").concat(t?"attached mediaKeys: "+t.mediaKeys:"detached",")"));return this.warn(r.message),!t||t.mediaKeys?!1:(this.hls.trigger(ly.ERROR,{type:ay.KEY_SYSTEM_ERROR,details:oy.KEY_SYSTEM_NO_KEYS,fatal:!1,error:r,frag:e}),this.resetTransmuxer(),!0)}return!1}fragContextChanged(t){const{fragCurrent:e}=this;return!t||!e||t.sn!==e.sn||t.level!==e.level}fragBufferedComplete(t,e){const r=this.mediaBuffer?this.mediaBuffer:this.media;if(this.log("Buffered ".concat(t.type," sn: ").concat(t.sn).concat(e?" part: "+e.index:""," of ").concat(this.fragInfo(t,!1,e)," > buffer:").concat(r?mw($b.getBuffered(r)):"(detached)",")")),Gy(t)){var n;if(t.type!==gy){const e=t.elementaryStreams;if(!Object.keys(e).some(t=>!!e[t]))return void(this.state=vw)}const e=null==(n=this.levels)?void 0:n[t.level];null!=e&&e.fragmentError&&(this.log("Resetting level fragment error count of ".concat(e.fragmentError," on frag buffered")),e.fragmentError=0)}this.state=vw}_handleFragmentLoadComplete(t){const{transmuxer:e}=this;if(!e)return;const{frag:r,part:n,partsLoaded:i}=t,s=!i||0===i.length||i.some(t=>!t),a=new Qb(r.level,r.sn,r.stats.chunkCount+1,0,n?n.index:-1,!s);e.flush(a)}_handleFragmentLoadProgress(t){}_doFragLoad(t,e){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,n=arguments.length>3?arguments[3]:void 0;var i;this.fragCurrent=t;const s=e.details;if(!this.levels||!s)throw new Error("frag load aborted, missing level".concat(s?"":" detail","s"));let a=null;if(!t.encrypted||null!=(i=t.decryptdata)&&i.key)t.encrypted||(a=this.keyLoader.loadClear(t,s.encryptedFragments,this.startFragRequested),a&&this.log("[eme] blocking frag load until media-keys acquired"));else if(this.log("Loading key for ".concat(t.sn," of [").concat(s.startSN,"-").concat(s.endSN,"], ").concat(this.playlistLabel()," ").concat(t.level)),this.state=bw,this.fragCurrent=t,a=this.keyLoader.load(t).then(t=>{if(!this.fragContextChanged(t.frag))return this.hls.trigger(ly.KEY_LOADED,t),this.state===bw&&(this.state=vw),t}),this.hls.trigger(ly.KEY_LOADING,{frag:t}),null===this.fragCurrent)return this.log("context changed in KEY_LOADING"),Promise.resolve(null);const o=this.fragPrevious;if(Gy(t)&&(!o||t.sn!==o.sn)){const r=this.shouldLoadParts(e.details,t.end);r!==this.loadingParts&&(this.log("LL-Part loading ".concat(r?"ON":"OFF"," loading sn ").concat(null==o?void 0:o.sn,"->").concat(t.sn)),this.loadingParts=r)}if(r=Math.max(t.start,r||0),this.loadingParts&&Gy(t)){const i=s.partList;if(i&&n){r>s.fragmentEnd&&s.fragmentHint&&(t=s.fragmentHint);const o=this.getNextPart(i,t,r);if(o>-1){const l=i[o];let c;return t=this.fragCurrent=l.fragment,this.log("Loading ".concat(t.type," sn: ").concat(t.sn," part: ").concat(l.index," (").concat(o,"/").concat(i.length-1,") of ").concat(this.fragInfo(t,!1,l),") cc: ").concat(t.cc," [").concat(s.startSN,"-").concat(s.endSN,"], target: ").concat(parseFloat(r.toFixed(3)))),this.nextLoadPosition=l.start+l.duration,this.state=_w,c=a?a.then(r=>!r||this.fragContextChanged(r.frag)?null:this.doFragPartsLoad(t,l,e,n)).catch(t=>this.handleFragLoadError(t)):this.doFragPartsLoad(t,l,e,n).catch(t=>this.handleFragLoadError(t)),this.hls.trigger(ly.FRAG_LOADING,{frag:t,part:l,targetBufferTime:r}),null===this.fragCurrent?Promise.reject(new Error("frag load aborted, context changed in FRAG_LOADING parts")):c}if(!t.url||this.loadedEndOfParts(i,r))return Promise.resolve(null)}}var l;if(Gy(t)&&this.loadingParts)this.log("LL-Part loading OFF after next part miss @".concat(r.toFixed(2)," Check buffer at sn: ").concat(t.sn," loaded parts: ").concat(null==(l=s.partList)?void 0:l.filter(t=>t.loaded).map(t=>"[".concat(t.start,"-").concat(t.end,"]")))),this.loadingParts=!1;else if(!t.url)return Promise.resolve(null);this.log("Loading ".concat(t.type," sn: ").concat(t.sn," of ").concat(this.fragInfo(t,!1),") cc: ").concat(t.cc," ").concat("["+s.startSN+"-"+s.endSN+"]",", target: ").concat(parseFloat(r.toFixed(3)))),ny(t.sn)&&!this.bitrateTest&&(this.nextLoadPosition=t.start+t.duration),this.state=_w;const c=this.config.progressive&&t.type!==gy;let u;return u=c&&a?a.then(e=>!e||this.fragContextChanged(e.frag)?null:this.fragmentLoader.load(t,n)).catch(t=>this.handleFragLoadError(t)):Promise.all([this.fragmentLoader.load(t,c?n:void 0),a]).then(t=>{let[e]=t;return!c&&n&&n(e),e}).catch(t=>this.handleFragLoadError(t)),this.hls.trigger(ly.FRAG_LOADING,{frag:t,targetBufferTime:r}),null===this.fragCurrent?Promise.reject(new Error("frag load aborted, context changed in FRAG_LOADING")):u}doFragPartsLoad(t,e,r,n){return new Promise((i,s)=>{var a;const o=[],l=null==(a=r.details)?void 0:a.partList,c=e=>{this.fragmentLoader.loadPart(t,e,n).then(n=>{o[e.index]=n;const s=n.part;this.hls.trigger(ly.FRAG_LOADED,n);const a=iw(r.details,t.sn,e.index+1)||sw(l,t.sn,e.index+1);if(!a)return i({frag:t,part:s,partsLoaded:o});c(a)}).catch(s)};c(e)})}handleFragLoadError(t){if("data"in t){const e=t.data;e.frag&&e.details===oy.INTERNAL_ABORTED?this.handleFragLoadAborted(e.frag,e.part):e.frag&&e.type===ay.KEY_SYSTEM_ERROR?(e.frag.abortRequests(),this.resetStartWhenNotLoaded(),this.resetFragmentLoading(e.frag)):this.hls.trigger(ly.ERROR,e)}else this.hls.trigger(ly.ERROR,{type:ay.OTHER_ERROR,details:oy.INTERNAL_EXCEPTION,err:t,error:t,fatal:!0});return null}_handleTransmuxerFlush(t){const e=this.getCurrentContext(t);if(!e||this.state!==Sw)return void(this.fragCurrent||this.state===yw||this.state===Aw||(this.state=vw));const{frag:r,part:n,level:i}=e,s=self.performance.now();r.stats.parsing.end=s,n&&(n.stats.parsing.end=s);const a=this.getLevelDetails(),o=a&&r.sn>a.endSN||this.shouldLoadParts(a,r.end);o!==this.loadingParts&&(this.log("LL-Part loading ".concat(o?"ON":"OFF"," after parsing segment ending @").concat(r.end.toFixed(2))),this.loadingParts=o),this.updateLevelTiming(r,n,i,t.partial)}shouldLoadParts(t,e){if(this.config.lowLatencyMode){if(!t)return this.loadingParts;if(t.partList){var r;const i=t.partList[0];if(i.fragment.type===gy)return!1;if(e>=i.end+((null==(r=t.fragmentHint)?void 0:r.duration)||0)){var n;if((this.hls.hasEnoughToStart?(null==(n=this.media)?void 0:n.currentTime)||this.lastCurrentTime:this.getLoadPosition())>i.start-i.fragment.duration)return!0}}}return!1}getCurrentContext(t){const{levels:e,fragCurrent:r}=this,{level:n,sn:i,part:s}=t;if(null==e||!e[n])return this.warn("Levels object was unset while buffering fragment ".concat(i," of ").concat(this.playlistLabel()," ").concat(n,". The current chunk will not be buffered.")),null;const a=e[n],o=a.details,l=s>-1?iw(o,i,s):null,c=l?l.fragment:nw(o,i,r);return c?(r&&r!==c&&(c.stats=r.stats),{frag:c,part:l,level:a}):null}bufferFragmentData(t,e,r,n,i){if(this.state!==Sw)return;const{data1:s,data2:a}=t;let o=s;if(a&&(o=hv(s,a)),!o.length)return;const l=this.initPTS[e.cc],c=l?-l.baseTime/l.timescale:void 0,u={type:t.type,frag:e,part:r,chunkMeta:n,offset:c,parent:e.type,data:o};if(this.hls.trigger(ly.BUFFER_APPENDING,u),t.dropped&&t.independent&&!r){if(i)return;this.flushBufferGap(e)}}flushBufferGap(t){const e=this.media;if(!e)return;if(!$b.isBuffered(e,e.currentTime))return void this.flushMainBuffer(0,t.start);const r=e.currentTime,n=$b.bufferInfo(e,r,0),i=t.duration,s=Math.min(2*this.config.maxFragLookUpTolerance,.25*i),a=Math.max(Math.min(t.start-s,n.end-s),r+s);t.start-a>s&&this.flushMainBuffer(a,t.start)}getFwdBufferInfo(t,e){var r;const n=this.getLoadPosition();if(!ny(n))return null;const i=this.lastCurrentTime>n||null!=(r=this.media)&&r.paused?0:this.config.maxBufferHole;return this.getFwdBufferInfoAtPos(t,n,e,i)}getFwdBufferInfoAtPos(t,e,r,n){const i=$b.bufferInfo(t,e,n);if(0===i.len&&void 0!==i.nextStart){const s=this.fragmentTracker.getBufferedFrag(e,r);if(s&&(i.nextStart<=s.end||s.gap)){const r=Math.max(Math.min(i.nextStart,s.end)-e,n);return $b.bufferInfo(t,e,r)}}return i}getMaxBufferLength(t){const{config:e}=this;let r;return r=t?Math.max(8*e.maxBufferSize/t,e.maxBufferLength):e.maxBufferLength,Math.min(r,e.maxMaxBufferLength)}reduceMaxBufferLength(t,e){const r=this.config,n=Math.max(Math.min(t-e,r.maxBufferLength),e),i=Math.max(t-3*e,r.maxMaxBufferLength/2,n);return i>=n&&(r.maxMaxBufferLength=i,this.warn("Reduce max buffer length to ".concat(i,"s")),!0)}getAppendedFrag(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:fy;const r=this.fragmentTracker?this.fragmentTracker.getAppendedFrag(t,e):null;return r&&"fragment"in r?r.fragment:r}getNextFragment(t,e){const r=e.fragments,n=r.length;if(!n)return null;const{config:i}=this,s=r[0].start,a=i.lowLatencyMode&&!!e.partList;let o=null;if(e.live){const r=i.initialLiveManifestSize;if(n<r)return this.warn("Not enough fragments to start playback (have: ".concat(n,", need: ").concat(r,")")),null;if(!e.PTSKnown&&!this.startFragRequested&&-1===this.startPosition||t<s){var l;a&&!this.loadingParts&&(this.log("LL-Part loading ON for initial live fragment"),this.loadingParts=!0),o=this.getInitialLiveFragment(e);const r=this.hls.startPosition,n=this.hls.liveSyncPosition,i=o?(-1!==r&&r>=s?r:n)||o.start:t;this.log("Setting startPosition to ".concat(i," to match start frag at live edge. mainStart: ").concat(r," liveSyncPosition: ").concat(n," frag.start: ").concat(null==(l=o)?void 0:l.start)),this.startPosition=this.nextLoadPosition=i}}else t<=s&&(o=r[0]);if(!o){const r=this.loadingParts?e.partEnd:e.fragmentEnd;o=this.getFragmentAtPosition(t,r,e)}let c=this.filterReplacedPrimary(o,e);if(!c&&o){const t=o.sn-e.startSN;c=this.filterReplacedPrimary(r[t+1]||null,e)}return this.mapToInitFragWhenRequired(c)}isLoopLoading(t,e){const r=this.fragmentTracker.getState(t);return(r===Cb||r===Pb&&!!t.gap)&&this.nextLoadPosition>e}getNextFragmentLoopLoading(t,e,r,n,i){let s=null;if(t.gap&&(s=this.getNextFragment(this.nextLoadPosition,e),s&&!s.gap&&r.nextStart)){const t=this.getFwdBufferInfoAtPos(this.mediaBuffer?this.mediaBuffer:this.media,r.nextStart,n,0);if(null!==t&&r.len+t.len>=i){const t=s.sn;return this.loopSn!==t&&(this.log('buffer full after gaps in "'.concat(n,'" playlist starting at sn: ').concat(t)),this.loopSn=t),null}}return this.loopSn=void 0,s}get primaryPrefetch(){if(Lw(this.config)){var t;if(null==(t=this.hls.interstitialsManager)||null==(t=t.playingItem)?void 0:t.event)return!0}return!1}filterReplacedPrimary(t,e){if(!t)return t;if(Lw(this.config)&&t.type!==gy){const r=this.hls.interstitialsManager,n=null==r?void 0:r.bufferingItem;if(n){const r=n.event;if(r){if(r.appendInPlace||Math.abs(t.start-n.start)>1||0===n.start)return null}else{if(t.end<=n.start&&!1===(null==e?void 0:e.live))return null;if(t.start>n.end&&n.nextEvent&&(n.nextEvent.appendInPlace||t.start-n.end>1))return null}}const i=null==r?void 0:r.playerQueue;if(i)for(let e=i.length;e--;){const r=i[e].interstitial;if(r.appendInPlace&&t.start>=r.startTime&&t.end<=r.resumeTime)return null}}return t}mapToInitFragWhenRequired(t){return null==t||!t.initSegment||t.initSegment.data||this.bitrateTest?t:t.initSegment}getNextPart(t,e,r){let n=-1,i=!1,s=!0;for(let a=0,o=t.length;a<o;a++){const o=t[a];if(s=s&&!o.independent,n>-1&&r<o.start)break;const l=o.loaded;l?n=-1:(i||(o.independent||s)&&o.fragment===e)&&(o.fragment!==e&&this.warn("Need buffer at ".concat(r," but next unloaded part starts at ").concat(o.start)),n=a),i=l}return n}loadedEndOfParts(t,e){let r;for(let n=t.length;n--;){if(r=t[n],!r.loaded)return!1;if(e>r.start)return!0}return!1}getInitialLiveFragment(t){const e=t.fragments,r=this.fragPrevious;let n=null;if(r){if(t.hasProgramDateTime&&(this.log("Live playlist, switching playlist, load frag with same PDT: ".concat(r.programDateTime)),n=function(t,e,r){if(null===e||!Array.isArray(t)||!t.length||!ny(e))return null;if(e<(t[0].programDateTime||0))return null;if(e>=(t[t.length-1].endProgramDateTime||0))return null;for(let n=0;n<t.length;++n){const i=t[n];if(ub(e,r,i))return i}return null}(e,r.endProgramDateTime,this.config.maxFragLookUpTolerance)),!n){const i=r.sn+1;if(i>=t.startSN&&i<=t.endSN){const s=e[i-t.startSN];r.cc===s.cc&&(n=s,this.log("Live playlist, switching playlist, load frag with next SN: ".concat(n.sn)))}n||(n=hb(t,r.cc,r.end),n&&this.log("Live playlist, switching playlist, load frag with same CC: ".concat(n.sn)))}}else{const e=this.hls.liveSyncPosition;null!==e&&(n=this.getFragmentAtPosition(e,this.bitrateTest?t.fragmentEnd:t.edge,t))}return n}getFragmentAtPosition(t,e,r){const{config:n}=this;let{fragPrevious:i}=this,{fragments:s,endSN:a}=r;const{fragmentHint:o}=r,{maxFragLookUpTolerance:l}=n,c=r.partList,u=!!(this.loadingParts&&null!=c&&c.length&&o);let h;if(u&&!this.bitrateTest&&c[c.length-1].fragment.sn===o.sn&&(s=s.concat(o),a=o.sn),t<e){var d;h=lb(i,s,t,t<this.lastCurrentTime||t>e-l||null!=(d=this.media)&&d.paused||!this.startFragRequested?0:l)}else h=s[s.length-1];if(h){const t=h.sn-r.startSN,e=this.fragmentTracker.getState(h);if((e===Cb||e===Pb&&h.gap)&&(i=h),i&&h.sn===i.sn&&(!u||c[0].fragment.sn>h.sn||!r.live)){if(h.level===i.level){const e=s[t+1];h=h.sn<a&&this.fragmentTracker.getState(e)!==Cb?e:null}}}return h}alignPlaylists(t,e,r){const n=t.fragments.length;if(!n)return this.warn("No fragments in live playlist"),0;const i=t.fragmentStart,s=!e,a=t.alignedSliding&&ny(i);if(s||!a&&!i){!function(t,e){t&&(dw(e,t),e.alignedSliding||fw(e,t),e.alignedSliding||e.skippedSegments||tw(t,e,!1))}(r,t);const i=t.fragmentStart;return this.log("Live playlist sliding: ".concat(i.toFixed(2)," start-sn: ").concat(e?e.startSN:"na","->").concat(t.startSN," fragments: ").concat(n)),i}return i}waitForCdnTuneIn(t){return t.live&&t.canBlockReload&&t.partTarget&&t.tuneInGoal>Math.max(t.partHoldBack,3*t.partTarget)}setStartPosition(t,e){let r=this.startPosition;r<e&&(r=-1);const n=this.timelineOffset;if(-1===r){const i=null!==this.startTimeOffset,s=i?this.startTimeOffset:t.startTimeOffset;null!==s&&ny(s)?(r=e+s,s<0&&(r+=t.edge),r=Math.min(Math.max(e,r),e+t.totalduration),this.log("Setting startPosition to ".concat(r," for start time offset ").concat(s," found in ").concat(i?"multivariant":"media"," playlist")),this.startPosition=r):t.live?(r=this.hls.liveSyncPosition||e,this.log("Setting startPosition to -1 to start at live edge ".concat(r)),this.startPosition=-1):(this.log("setting startPosition to 0 by default"),this.startPosition=r=0),this.lastCurrentTime=r+n}this.nextLoadPosition=r+n}getLoadPosition(){var t;const{media:e}=this;let r=0;return null!=(t=this.hls)&&t.hasEnoughToStart&&e?r=e.currentTime:this.nextLoadPosition>=0&&(r=this.nextLoadPosition),r}handleFragLoadAborted(t,e){this.transmuxer&&t.type===this.playlistType&&Gy(t)&&t.stats.aborted&&(this.log("Fragment ".concat(t.sn).concat(e?" part "+e.index:""," of ").concat(this.playlistLabel()," ").concat(t.level," was aborted")),this.resetFragmentLoading(t))}resetFragmentLoading(t){this.fragCurrent&&(this.fragContextChanged(t)||this.state===ww)||(this.state=vw)}onFragmentOrKeyLoadError(t,e){var r;if(e.chunkMeta&&!e.frag){const t=this.getCurrentContext(e.chunkMeta);t&&(e.frag=t.frag)}const n=e.frag;if(!n||n.type!==t||!this.levels)return;var i;if(this.fragContextChanged(n))return void this.warn("Frag load error must match current frag to retry ".concat(n.url," > ").concat(null==(i=this.fragCurrent)?void 0:i.url));const s=e.details===oy.FRAG_GAP;s&&this.fragmentTracker.fragBuffered(n,!0);const a=e.errorAction;if(!a)return void(this.state=Aw);const{action:o,flags:l,retryCount:c=0,retryConfig:u}=a,h=!!u,d=h&&o===Sb,f=h&&!a.resolved&&l===kb,p=null==(r=this.hls.latestLevelDetails)?void 0:r.live;if(!d&&f&&Gy(n)&&!n.endList&&p&&!pb(e))this.resetFragmentErrors(t),this.treatAsGap(n),a.resolved=!0;else if((d||f)&&c<u.maxNumRetry){var g;const r=bb(null==(g=e.response)?void 0:g.code),i=mb(u,c);if(this.resetStartWhenNotLoaded(),this.retryDate=self.performance.now()+i,this.state=ww,a.resolved=!0,r)return this.log("Waiting for connection (offline)"),this.retryDate=1/0,void(e.reason="offline");this.warn("Fragment ".concat(n.sn," of ").concat(t," ").concat(n.level," errored with ").concat(e.details,", retrying loading ").concat(c+1,"/").concat(u.maxNumRetry," in ").concat(i,"ms"))}else if(u){if(this.resetFragmentErrors(t),!(c<u.maxNumRetry))return void this.warn("".concat(e.details," reached or exceeded max retry (").concat(c,")"));s||o===Eb||(a.resolved=!0)}else this.state=o===wb?Iw:Aw;this.tickImmediate()}checkRetryDate(){const t=self.performance.now(),e=this.retryDate,r=e===1/0;(!e||t>=e||r&&!bb(0))&&(r&&this.log("Connection restored (online)"),this.resetStartWhenNotLoaded(),this.state=vw)}reduceLengthAndFlushBuffer(t){if(this.state===Sw||this.state===Tw){const e=t.frag,r=t.parent,n=this.getFwdBufferInfo(this.mediaBuffer,r),i=n&&n.len>.5;i&&this.reduceMaxBufferLength(n.len,(null==e?void 0:e.duration)||10);const s=!i;return s&&this.warn("Buffer full error while media.currentTime (".concat(this.getLoadPosition(),") is not buffered, flush ").concat(r," buffer")),e&&(this.fragmentTracker.removeFragment(e),this.nextLoadPosition=e.start),this.resetLoadingState(),s}return!1}resetFragmentErrors(t){t===py&&(this.fragCurrent=null),this.hls.hasEnoughToStart||(this.startFragRequested=!1),this.state!==yw&&(this.state=vw)}afterBufferFlushed(t,e,r){if(!t)return;const n=$b.getBuffered(t);this.fragmentTracker.detectEvictedFragments(e,n,r),this.state===kw&&this.resetLoadingState()}resetLoadingState(){this.log("Reset loading state"),this.fragCurrent=null,this.fragPrevious=null,this.state!==yw&&(this.state=vw)}resetStartWhenNotLoaded(){if(!this.hls.hasEnoughToStart){this.startFragRequested=!1;const t=this.levelLastLoaded,e=t?t.details:null;null!=e&&e.live?(this.log("resetting startPosition for live start"),this.startPosition=-1,this.setStartPosition(e,e.fragmentStart),this.resetLoadingState()):this.nextLoadPosition=this.startPosition}}resetWhenMissingContext(t){this.log("Loading context changed while buffering sn ".concat(t.sn," of ").concat(this.playlistLabel()," ").concat(-1===t.level?"<removed>":t.level,". This chunk will not be buffered.")),this.removeUnbufferedFrags(),this.resetStartWhenNotLoaded(),this.resetLoadingState()}removeUnbufferedFrags(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;this.fragmentTracker.removeFragmentsInRange(t,1/0,this.playlistType,!1,!0)}updateLevelTiming(t,e,r,n){const i=r.details;if(!i)return void this.warn("level.details undefined");if(!Object.keys(t.elementaryStreams).reduce((e,s)=>{const a=t.elementaryStreams[s];if(a){const o=a.endPTS-a.startPTS;if(o<=0)return this.warn("Could not parse fragment ".concat(t.sn," ").concat(s," duration reliably (").concat(o,")")),e||!1;const l=n?0:$_(i,t,a.startPTS,a.endPTS,a.startDTS,a.endDTS,this);return this.hls.trigger(ly.LEVEL_PTS_UPDATED,{details:i,level:r,drift:l,type:s,frag:t,start:a.startPTS,end:a.endPTS}),!0}return e},!1)){var s;const e=null===(null==(s=this.transmuxer)?void 0:s.error);if((0===r.fragmentError||e&&(r.fragmentError<2||t.endList))&&this.treatAsGap(t,r),e){const e=new Error("Found no media in fragment ".concat(t.sn," of ").concat(this.playlistLabel()," ").concat(t.level," resetting transmuxer to fallback to playlist timing"));if(this.warn(e.message),this.hls.trigger(ly.ERROR,{type:ay.MEDIA_ERROR,details:oy.FRAG_PARSING_ERROR,fatal:!1,error:e,frag:t,reason:"Found no media in msn ".concat(t.sn," of ").concat(this.playlistLabel(),' "').concat(r.url,'"')}),!this.hls)return;this.resetTransmuxer()}}this.state=Tw,this.log("Parsed ".concat(t.type," sn: ").concat(t.sn).concat(e?" part: "+e.index:""," of ").concat(this.fragInfo(t,!1,e),")")),this.hls.trigger(ly.FRAG_PARSED,{frag:t,part:e})}playlistLabel(){return this.playlistType===fy?"level":"track"}fragInfo(t){let e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=arguments.length>2?arguments[2]:void 0;var n,i;return"".concat(this.playlistLabel()," ").concat(t.level," (").concat(r?"part":"frag",":[").concat((null!=(n=e&&!r?t.startPTS:(r||t).start)?n:NaN).toFixed(3),"-").concat((null!=(i=e&&!r?t.endPTS:(r||t).end)?i:NaN).toFixed(3),"]").concat(r&&"main"===t.type?"INDEPENDENT="+(r.independent?"YES":"NO"):"")}treatAsGap(t,e){e&&e.fragmentError++,t.gap=!0,this.fragmentTracker.removeFragment(t),this.fragmentTracker.fragBuffered(t,!0)}resetTransmuxer(){var t;null==(t=this.transmuxer)||t.reset()}recoverWorkerError(t){"demuxerWorker"===t.event&&(this.fragmentTracker.removeAllFragments(),this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null),this.resetStartWhenNotLoaded(),this.resetLoadingState())}set state(t){const e=this._state;e!==t&&(this._state=t,this.log("".concat(e,"->").concat(t)))}get state(){return this._state}}function Lw(t){return!!t.interstitialsController&&!1!==t.enableInterstitialPlayback}class Pw{constructor(){this.chunks=[],this.dataLength=0}push(t){this.chunks.push(t),this.dataLength+=t.length}flush(){const{chunks:t,dataLength:e}=this;let r;return t.length?(r=1===t.length?t[0]:function(t,e){const r=new Uint8Array(e);let n=0;for(let i=0;i<t.length;i++){const e=t[i];r.set(e,n),n+=e.length}return r}(t,e),this.reset(),r):new Uint8Array(0)}reset(){this.chunks.length=0,this.dataLength=0}}var Cw,Mw={exports:{}};var Ow=(Cw||(Cw=1,function(t){var e=Object.prototype.hasOwnProperty,r="~";function n(){}function i(t,e,r){this.fn=t,this.context=e,this.once=r||!1}function s(t,e,n,s,a){if("function"!==typeof n)throw new TypeError("The listener must be a function");var o=new i(n,s||t,a),l=r?r+e:e;return t._events[l]?t._events[l].fn?t._events[l]=[t._events[l],o]:t._events[l].push(o):(t._events[l]=o,t._eventsCount++),t}function a(t,e){0===--t._eventsCount?t._events=new n:delete t._events[e]}function o(){this._events=new n,this._eventsCount=0}Object.create&&(n.prototype=Object.create(null),(new n).__proto__||(r=!1)),o.prototype.eventNames=function(){var t,n,i=[];if(0===this._eventsCount)return i;for(n in t=this._events)e.call(t,n)&&i.push(r?n.slice(1):n);return Object.getOwnPropertySymbols?i.concat(Object.getOwnPropertySymbols(t)):i},o.prototype.listeners=function(t){var e=r?r+t:t,n=this._events[e];if(!n)return[];if(n.fn)return[n.fn];for(var i=0,s=n.length,a=new Array(s);i<s;i++)a[i]=n[i].fn;return a},o.prototype.listenerCount=function(t){var e=r?r+t:t,n=this._events[e];return n?n.fn?1:n.length:0},o.prototype.emit=function(t,e,n,i,s,a){var o=r?r+t:t;if(!this._events[o])return!1;var l,c,u=this._events[o],h=arguments.length;if(u.fn){switch(u.once&&this.removeListener(t,u.fn,void 0,!0),h){case 1:return u.fn.call(u.context),!0;case 2:return u.fn.call(u.context,e),!0;case 3:return u.fn.call(u.context,e,n),!0;case 4:return u.fn.call(u.context,e,n,i),!0;case 5:return u.fn.call(u.context,e,n,i,s),!0;case 6:return u.fn.call(u.context,e,n,i,s,a),!0}for(c=1,l=new Array(h-1);c<h;c++)l[c-1]=arguments[c];u.fn.apply(u.context,l)}else{var d,f=u.length;for(c=0;c<f;c++)switch(u[c].once&&this.removeListener(t,u[c].fn,void 0,!0),h){case 1:u[c].fn.call(u[c].context);break;case 2:u[c].fn.call(u[c].context,e);break;case 3:u[c].fn.call(u[c].context,e,n);break;case 4:u[c].fn.call(u[c].context,e,n,i);break;default:if(!l)for(d=1,l=new Array(h-1);d<h;d++)l[d-1]=arguments[d];u[c].fn.apply(u[c].context,l)}}return!0},o.prototype.on=function(t,e,r){return s(this,t,e,r,!1)},o.prototype.once=function(t,e,r){return s(this,t,e,r,!0)},o.prototype.removeListener=function(t,e,n,i){var s=r?r+t:t;if(!this._events[s])return this;if(!e)return a(this,s),this;var o=this._events[s];if(o.fn)o.fn!==e||i&&!o.once||n&&o.context!==n||a(this,s);else{for(var l=0,c=[],u=o.length;l<u;l++)(o[l].fn!==e||i&&!o[l].once||n&&o[l].context!==n)&&c.push(o[l]);c.length?this._events[s]=1===c.length?c[0]:c:a(this,s)}return this},o.prototype.removeAllListeners=function(t){var e;return t?(e=r?r+t:t,this._events[e]&&a(this,e)):(this._events=new n,this._eventsCount=0),this},o.prototype.off=o.prototype.removeListener,o.prototype.addListener=o.prototype.on,o.prefixed=r,o.EventEmitter=o,t.exports=o}(Mw)),Mw.exports),Dw=Oy(Ow);const Nw="1.6.15",Fw={};function Uw(t,e){return e+10<=t.length&&51===t[e]&&68===t[e+1]&&73===t[e+2]&&t[e+3]<255&&t[e+4]<255&&t[e+6]<128&&t[e+7]<128&&t[e+8]<128&&t[e+9]<128}function Bw(t,e){return e+10<=t.length&&73===t[e]&&68===t[e+1]&&51===t[e+2]&&t[e+3]<255&&t[e+4]<255&&t[e+6]<128&&t[e+7]<128&&t[e+8]<128&&t[e+9]<128}function jw(t,e){let r=0;return r=(127&t[e])<<21,r|=(127&t[e+1])<<14,r|=(127&t[e+2])<<7,r|=127&t[e+3],r}function zw(t,e){const r=e;let n=0;for(;Bw(t,e);){n+=10;n+=jw(t,e+6),Uw(t,e+10)&&(n+=10),e+=n}if(n>0)return t.subarray(r,r+n)}function Ww(t,e){return 255===t[e]&&240===(246&t[e+1])}function Gw(t,e){return 1&t[e+1]?7:9}function Vw(t,e){return(3&t[e+3])<<11|t[e+4]<<3|(224&t[e+5])>>>5}function Hw(t,e){return e+1<t.length&&Ww(t,e)}function Kw(t,e){if(Hw(t,e)){const r=Gw(t,e);if(e+r>=t.length)return!1;const n=Vw(t,e);if(n<=r)return!1;const i=e+n;return i===t.length||Hw(t,i)}return!1}function qw(t,e,r,n,i){if(!t.samplerate){const s=function(t,e,r,n){const i=e[r+2],s=i>>2&15;if(s>12){const e=new Error("invalid ADTS sampling index:".concat(s));return void t.emit(ly.ERROR,ly.ERROR,{type:ay.MEDIA_ERROR,details:oy.FRAG_PARSING_ERROR,fatal:!0,error:e,reason:e.message})}const a=1+(i>>6&3),o=e[r+3]>>6&3|(1&i)<<2,l="mp4a.40."+a,c=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350][s];let u=s;5!==a&&29!==a||(u-=3);const h=[a<<3|(14&u)>>1,(1&u)<<7|o<<3];return Iy.log("manifest codec:".concat(n,", parsed codec:").concat(l,", channels:").concat(o,", rate:").concat(c," (ADTS object type:").concat(a," sampling index:").concat(s,")")),{config:h,samplerate:c,channelCount:o,codec:l,parsedCodec:l,manifestCodec:n}}(e,r,n,i);if(!s)return;by(t,s)}}function Yw(t){return 9216e4/t}function Qw(t,e,r,n,i){const s=n+i*Yw(t.samplerate),a=function(t,e){const r=Gw(t,e);if(e+r<=t.length){const n=Vw(t,e)-r;if(n>0)return{headerLength:r,frameLength:n}}}(e,r);let o;if(a){const{frameLength:n,headerLength:i}=a,l=i+n,c=Math.max(0,r+l-e.length);c?(o=new Uint8Array(l-i),o.set(e.subarray(r+i,e.length),0)):o=e.subarray(r+i,r+l);const u={unit:o,pts:s};return c||t.samples.push(u),{sample:u,length:l,missing:c}}const l=e.length-r;o=new Uint8Array(l),o.set(e.subarray(r,e.length),0);return{sample:{unit:o,pts:s},length:l,missing:-1}}function Xw(t,e){return Bw(t,e)&&jw(t,e+6)+10<=t.length-e}function $w(t){return function(t,e,r,n){const i=function(t){return t instanceof ArrayBuffer?t:t.buffer}(t);let s=1;"BYTES_PER_ELEMENT"in n&&(s=n.BYTES_PER_ELEMENT);const a=(h=t,h&&h.buffer instanceof ArrayBuffer&&void 0!==h.byteLength&&void 0!==h.byteOffset?t.byteOffset:0),o=(a+t.byteLength)/s,l=(a+e)/s,c=Math.floor(Math.max(0,Math.min(l,o))),u=Math.floor(Math.min(c+Math.max(r,0),o));var h;return new n(i,c,u-c)}(t,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1/0,Uint8Array)}function Zw(t){const e={key:t.type,description:"",data:"",mimeType:null,pictureType:null};if(t.size<2)return;if(3!==t.data[0])return void console.log("Ignore frame with unrecognized character encoding");const r=t.data.subarray(1).indexOf(0);if(-1===r)return;const n=Py($w(t.data,1,r)),i=t.data[2+r],s=t.data.subarray(3+r).indexOf(0);if(-1===s)return;const a=Py($w(t.data,3+r,s));let o;return o="--\x3e"===n?Py($w(t.data,4+r+s)):function(t){return t instanceof ArrayBuffer?t:0==t.byteOffset&&t.byteLength==t.buffer.byteLength?t.buffer:new Uint8Array(t).buffer}(t.data.subarray(4+r+s)),e.mimeType=n,e.pictureType=i,e.description=a,e.data=o,e}function Jw(t){return"PRIV"===t.type?function(t){if(t.size<2)return;const e=Py(t.data,!0),r=new Uint8Array(t.data.subarray(e.length+1));return{key:t.type,info:e,data:r.buffer}}(t):"W"===t.type[0]?function(t){if("WXXX"===t.type){if(t.size<2)return;let e=1;const r=Py(t.data.subarray(e),!0);e+=r.length+1;const n=Py(t.data.subarray(e));return{key:t.type,info:r,data:n}}const e=Py(t.data);return{key:t.type,info:"",data:e}}(t):"APIC"===t.type?Zw(t):function(t){if(t.size<2)return;if("TXXX"===t.type){let e=1;const r=Py(t.data.subarray(e),!0);e+=r.length+1;const n=Py(t.data.subarray(e));return{key:t.type,info:r,data:n}}const e=Py(t.data.subarray(1));return{key:t.type,info:"",data:e}}(t)}function tE(t){const e=String.fromCharCode(t[0],t[1],t[2],t[3]),r=jw(t,4);return{type:e,size:r,data:t.subarray(10,10+r)}}function eE(t){let e=0;const r=[];for(;Bw(t,e);){const n=jw(t,e+6);t[e+5]>>6&1&&(e+=10),e+=10;const i=e+n;for(;e+10<i;){const n=tE(t.subarray(e)),i=Jw(n);i&&r.push(i),e+=n.size+10}Uw(t,e)&&(e+=10)}return r}function rE(t){return t&&"PRIV"===t.key&&"com.apple.streaming.transportStreamTimestamp"===t.info}function nE(t){if(8===t.data.byteLength){const e=new Uint8Array(t.data),r=1&e[3];let n=(e[4]<<23)+(e[5]<<15)+(e[6]<<7)+e[7];return n/=45,r&&(n+=47721858.84),Math.round(n)}}function iE(t){const e=eE(t);for(let r=0;r<e.length;r++){const t=e[r];if(rE(t))return nE(t)}}let sE=function(t){return t.audioId3="org.id3",t.dateRange="com.apple.quicktime.HLS",t.emsg="https://aomedia.org/emsg/ID3",t.misbklv="urn:misb:KLV:bin:1910.1",t}({});function aE(){return{type:arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",id:-1,pid:-1,inputTimeScale:arguments.length>1&&void 0!==arguments[1]?arguments[1]:9e4,sequenceNumber:-1,samples:[],dropped:0}}class oE{constructor(){this._audioTrack=void 0,this._id3Track=void 0,this.frameIndex=0,this.cachedData=null,this.basePTS=null,this.initPTS=null,this.lastPTS=null}resetInitSegment(t,e,r,n){this._id3Track={type:"id3",id:3,pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0}}resetTimeStamp(t){this.initPTS=t,this.resetContiguity()}resetContiguity(){this.basePTS=null,this.lastPTS=null,this.frameIndex=0}canParse(t,e){return!1}appendFrame(t,e,r){}demux(t,e){this.cachedData&&(t=hv(this.cachedData,t),this.cachedData=null);let r,n=zw(t,0),i=n?n.length:0;const s=this._audioTrack,a=this._id3Track,o=n?iE(n):void 0,l=t.length;for((null===this.basePTS||0===this.frameIndex&&ny(o))&&(this.basePTS=lE(o,e,this.initPTS),this.lastPTS=this.basePTS),null===this.lastPTS&&(this.lastPTS=this.basePTS),n&&n.length>0&&a.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:n,type:sE.audioId3,duration:Number.POSITIVE_INFINITY});i<l;){if(this.canParse(t,i)){const e=this.appendFrame(s,t,i);e?(this.frameIndex++,this.lastPTS=e.sample.pts,i+=e.length,r=i):i=l}else Xw(t,i)?(n=zw(t,i),a.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:n,type:sE.audioId3,duration:Number.POSITIVE_INFINITY}),i+=n.length,r=i):i++;if(i===l&&r!==l){const e=t.slice(r);this.cachedData?this.cachedData=hv(this.cachedData,e):this.cachedData=e}}return{audioTrack:s,videoTrack:aE(),id3Track:a,textTrack:aE()}}demuxSampleAes(t,e,r){return Promise.reject(new Error("[".concat(this,"] This demuxer does not support Sample-AES decryption")))}flush(t){const e=this.cachedData;return e&&(this.cachedData=null,this.demux(e,0)),{audioTrack:this._audioTrack,videoTrack:aE(),id3Track:this._id3Track,textTrack:aE()}}destroy(){this.cachedData=null,this._audioTrack=this._id3Track=void 0}}const lE=(t,e,r)=>{if(ny(t))return 90*t;return 9e4*e+(r?9e4*r.baseTime/r.timescale:0)};let cE=null;const uE=[32,64,96,128,160,192,224,256,288,320,352,384,416,448,32,48,56,64,80,96,112,128,160,192,224,256,320,384,32,40,48,56,64,80,96,112,128,160,192,224,256,320,32,48,56,64,80,96,112,128,144,160,176,192,224,256,8,16,24,32,40,48,56,64,80,96,112,128,144,160],hE=[44100,48e3,32e3,22050,24e3,16e3,11025,12e3,8e3],dE=[[0,72,144,12],[0,0,0,0],[0,72,144,12],[0,144,144,12]],fE=[0,1,1,4];function pE(t,e,r,n,i){if(r+24>e.length)return;const s=gE(e,r);if(s&&r+s.frameLength<=e.length){const a=n+i*(9e4*s.samplesPerFrame/s.sampleRate),o={unit:e.subarray(r,r+s.frameLength),pts:a,dts:a};return t.config=[],t.channelCount=s.channelCount,t.samplerate=s.sampleRate,t.samples.push(o),{sample:o,length:s.frameLength,missing:0}}}function gE(t,e){const r=t[e+1]>>3&3,n=t[e+1]>>1&3,i=t[e+2]>>4&15,s=t[e+2]>>2&3;if(1!==r&&0!==i&&15!==i&&3!==s){const a=t[e+2]>>1&1,o=t[e+3]>>6,l=1e3*uE[14*(3===r?3-n:3===n?3:4)+i-1],c=hE[3*(3===r?0:2===r?1:2)+s],u=3===o?1:2,h=dE[r][n],d=fE[n],f=8*h*d,p=Math.floor(h*l/c+a)*d;if(null===cE){const t=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);cE=t?parseInt(t[1]):0}return!!cE&&cE<=87&&2===n&&l>=224e3&&0===o&&(t[e+3]=128|t[e+3]),{sampleRate:c,channelCount:u,frameLength:p,samplesPerFrame:f}}}function mE(t,e){return 255===t[e]&&224===(224&t[e+1])&&0!==(6&t[e+1])}function yE(t,e){return e+1<t.length&&mE(t,e)}function vE(t,e){if(e+1<t.length&&mE(t,e)){const r=4,n=gE(t,e);let i=r;null!=n&&n.frameLength&&(i=n.frameLength);const s=e+i;return s===t.length||yE(t,s)}return!1}const bE=(t,e)=>{let r=0,n=5;e+=n;const i=new Uint32Array(1),s=new Uint32Array(1),a=new Uint8Array(1);for(;n>0;){a[0]=t[e];const o=Math.min(n,8),l=8-o;s[0]=4278190080>>>24+l<<l,i[0]=(a[0]&s[0])>>l,r=r?r<<o|i[0]:i[0],e+=1,n-=o}return r};class _E extends oE{constructor(t){super(),this.observer=void 0,this.observer=t}resetInitSegment(t,e,r,n){super.resetInitSegment(t,e,r,n),this._audioTrack={container:"audio/ac-3",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"ac3",samples:[],manifestCodec:e,duration:n,inputTimeScale:9e4,dropped:0}}canParse(t,e){return e+64<t.length}appendFrame(t,e,r){const n=wE(t,e,r,this.basePTS,this.frameIndex);if(-1!==n){return{sample:t.samples[t.samples.length-1],length:n,missing:0}}}static probe(t){if(!t)return!1;const e=zw(t,0);if(!e)return!1;const r=e.length;return 11===t[r]&&119===t[r+1]&&void 0!==iE(e)&&bE(t,r)<16}}function wE(t,e,r,n,i){if(r+8>e.length)return-1;if(11!==e[r]||119!==e[r+1])return-1;const s=e[r+4]>>6;if(s>=3)return-1;const a=[48e3,44100,32e3][s],o=63&e[r+4],l=2*[64,69,96,64,70,96,80,87,120,80,88,120,96,104,144,96,105,144,112,121,168,112,122,168,128,139,192,128,140,192,160,174,240,160,175,240,192,208,288,192,209,288,224,243,336,224,244,336,256,278,384,256,279,384,320,348,480,320,349,480,384,417,576,384,418,576,448,487,672,448,488,672,512,557,768,512,558,768,640,696,960,640,697,960,768,835,1152,768,836,1152,896,975,1344,896,976,1344,1024,1114,1536,1024,1115,1536,1152,1253,1728,1152,1254,1728,1280,1393,1920,1280,1394,1920][3*o+s];if(r+l>e.length)return-1;const c=e[r+6]>>5;let u=0;2===c?u+=2:(1&c&&1!==c&&(u+=2),4&c&&(u+=2));const h=(e[r+6]<<8|e[r+7])>>12-u&1,d=[2,1,2,3,3,4,4,5][c]+h,f=e[r+5]>>3,p=7&e[r+5],g=new Uint8Array([s<<6|f<<1|p>>2,(3&p)<<6|c<<3|h<<2|o>>4,o<<4&224]),m=n+i*(1536/a*9e4),y=e.subarray(r,r+l);return t.config=g,t.channelCount=d,t.samplerate=a,t.samples.push({unit:y,pts:m}),l}const EE=/\/emsg[-/]ID3/i;function SE(t,e){return ny(t.presentationTime)?t.presentationTime/t.timeScale:e+t.presentationTimeDelta/t.timeScale}class TE{constructor(t,e,r){this.keyData=void 0,this.decrypter=void 0,this.keyData=r,this.decrypter=new Wb(e,{removePKCS7Padding:!1})}decryptBuffer(t){return this.decrypter.decrypt(t,this.keyData.key.buffer,this.keyData.iv.buffer,Fb)}decryptAacSample(t,e,r){const n=t[e].unit;if(n.length<=16)return;const i=n.subarray(16,n.length-n.length%16),s=i.buffer.slice(i.byteOffset,i.byteOffset+i.length);this.decryptBuffer(s).then(i=>{const s=new Uint8Array(i);n.set(s,16),this.decrypter.isSync()||this.decryptAacSamples(t,e+1,r)}).catch(r)}decryptAacSamples(t,e,r){for(;;e++){if(e>=t.length)return void r();if(!(t[e].unit.length<32)&&(this.decryptAacSample(t,e,r),!this.decrypter.isSync()))return}}getAvcEncryptedData(t){const e=16*Math.floor((t.length-48)/160)+16,r=new Int8Array(e);let n=0;for(let i=32;i<t.length-16;i+=160,n+=16)r.set(t.subarray(i,i+16),n);return r}getAvcDecryptedUnit(t,e){const r=new Uint8Array(e);let n=0;for(let i=32;i<t.length-16;i+=160,n+=16)t.set(r.subarray(n,n+16),i);return t}decryptAvcSample(t,e,r,n,i){const s=mv(i.data),a=this.getAvcEncryptedData(s);this.decryptBuffer(a.buffer).then(a=>{i.data=this.getAvcDecryptedUnit(s,a),this.decrypter.isSync()||this.decryptAvcSamples(t,e,r+1,n)}).catch(n)}decryptAvcSamples(t,e,r,n){if(t instanceof Uint8Array)throw new Error("Cannot decrypt samples of type Uint8Array");for(;;e++,r=0){if(e>=t.length)return void n();const i=t[e].units;for(;!(r>=i.length);r++){const s=i[r];if(!(s.data.length<=48||1!==s.type&&5!==s.type)&&(this.decryptAvcSample(t,e,r,n,s),!this.decrypter.isSync()))return}}}}class kE{constructor(){this.VideoSample=null}createVideoSample(t,e,r){return{key:t,frame:!1,pts:e,dts:r,units:[],length:0}}getLastNalUnit(t){var e;let r,n=this.VideoSample;if(n&&0!==n.units.length||(n=t[t.length-1]),null!=(e=n)&&e.units){const t=n.units;r=t[t.length-1]}return r}pushAccessUnit(t,e){if(t.units.length&&t.frame){if(void 0===t.pts){const r=e.samples,n=r.length;if(!n)return void e.dropped++;{const e=r[n-1];t.pts=e.pts,t.dts=e.dts}}e.samples.push(t)}}parseNALu(t,e,r){const n=e.byteLength;let i=t.naluState||0;const s=i,a=[];let o,l,c,u=0,h=-1,d=0;for(-1===i&&(h=0,d=this.getNALuType(e,0),i=0,u=1);u<n;)if(o=e[u++],i)if(1!==i)if(o)if(1===o){if(l=u-i-1,h>=0){const t={data:e.subarray(h,l),type:d};a.push(t)}else{const r=this.getLastNalUnit(t.samples);r&&(s&&u<=4-s&&r.state&&(r.data=r.data.subarray(0,r.data.byteLength-s)),l>0&&(r.data=hv(r.data,e.subarray(0,l)),r.state=0))}u<n?(c=this.getNALuType(e,u),h=u,d=c,i=0):i=-1}else i=0;else i=3;else i=o?0:2;else i=o?0:1;if(h>=0&&i>=0){const t={data:e.subarray(h,n),type:d,state:i};a.push(t)}if(0===a.length){const r=this.getLastNalUnit(t.samples);r&&(r.data=hv(r.data,e))}return t.naluState=i,a}}class AE{constructor(t){this.data=void 0,this.bytesAvailable=void 0,this.word=void 0,this.bitsAvailable=void 0,this.data=t,this.bytesAvailable=t.byteLength,this.word=0,this.bitsAvailable=0}loadWord(){const t=this.data,e=this.bytesAvailable,r=t.byteLength-e,n=new Uint8Array(4),i=Math.min(4,e);if(0===i)throw new Error("no bytes available");n.set(t.subarray(r,r+i)),this.word=new DataView(n.buffer).getUint32(0),this.bitsAvailable=8*i,this.bytesAvailable-=i}skipBits(t){let e;t=Math.min(t,8*this.bytesAvailable+this.bitsAvailable),this.bitsAvailable>t?(this.word<<=t,this.bitsAvailable-=t):(e=(t-=this.bitsAvailable)>>3,t-=e<<3,this.bytesAvailable-=e,this.loadWord(),this.word<<=t,this.bitsAvailable-=t)}readBits(t){let e=Math.min(this.bitsAvailable,t);const r=this.word>>>32-e;if(t>32&&Iy.error("Cannot read more than 32 bits at a time"),this.bitsAvailable-=e,this.bitsAvailable>0)this.word<<=e;else{if(!(this.bytesAvailable>0))throw new Error("no bits available");this.loadWord()}return e=t-e,e>0&&this.bitsAvailable?r<<e|this.readBits(e):r}skipLZ(){let t;for(t=0;t<this.bitsAvailable;++t)if(0!==(this.word&2147483648>>>t))return this.word<<=t,this.bitsAvailable-=t,t;return this.loadWord(),t+this.skipLZ()}skipUEG(){this.skipBits(1+this.skipLZ())}skipEG(){this.skipBits(1+this.skipLZ())}readUEG(){const t=this.skipLZ();return this.readBits(t+1)-1}readEG(){const t=this.readUEG();return 1&t?1+t>>>1:-1*(t>>>1)}readBoolean(){return 1===this.readBits(1)}readUByte(){return this.readBits(8)}readUShort(){return this.readBits(16)}readUInt(){return this.readBits(32)}}class xE extends kE{parsePES(t,e,r,n){const i=this.parseNALu(t,r.data,n);let s,a=this.VideoSample,o=!1;r.data=null,a&&i.length&&!t.audFound&&(this.pushAccessUnit(a,t),a=this.VideoSample=this.createVideoSample(!1,r.pts,r.dts)),i.forEach(n=>{var i,l;switch(n.type){case 1:{let e=!1;s=!0;const i=n.data;if(o&&i.length>4){const t=this.readSliceType(i);2!==t&&4!==t&&7!==t&&9!==t||(e=!0)}var c;if(e)null!=(c=a)&&c.frame&&!a.key&&(this.pushAccessUnit(a,t),a=this.VideoSample=null);a||(a=this.VideoSample=this.createVideoSample(!0,r.pts,r.dts)),a.frame=!0,a.key=e;break}case 5:s=!0,null!=(i=a)&&i.frame&&!a.key&&(this.pushAccessUnit(a,t),a=this.VideoSample=null),a||(a=this.VideoSample=this.createVideoSample(!0,r.pts,r.dts)),a.key=!0,a.frame=!0;break;case 6:s=!0,gv(n.data,1,r.pts,e.samples);break;case 7:{var u,h;s=!0,o=!0;const e=n.data,r=this.readSPS(e);if(!t.sps||t.width!==r.width||t.height!==r.height||(null==(u=t.pixelRatio)?void 0:u[0])!==r.pixelRatio[0]||(null==(h=t.pixelRatio)?void 0:h[1])!==r.pixelRatio[1]){t.width=r.width,t.height=r.height,t.pixelRatio=r.pixelRatio,t.sps=[e];const n=e.subarray(1,4);let i="avc1.";for(let t=0;t<3;t++){let e=n[t].toString(16);e.length<2&&(e="0"+e),i+=e}t.codec=i}break}case 8:s=!0,t.pps=[n.data];break;case 9:s=!0,t.audFound=!0,null!=(l=a)&&l.frame&&(this.pushAccessUnit(a,t),a=null),a||(a=this.VideoSample=this.createVideoSample(!1,r.pts,r.dts));break;case 12:s=!0;break;default:s=!1}if(a&&s){a.units.push(n)}}),n&&a&&(this.pushAccessUnit(a,t),this.VideoSample=null)}getNALuType(t,e){return 31&t[e]}readSliceType(t){const e=new AE(t);return e.readUByte(),e.readUEG(),e.readUEG()}skipScalingList(t,e){let r,n=8,i=8;for(let s=0;s<t;s++)0!==i&&(r=e.readEG(),i=(n+r+256)%256),n=0===i?n:i}readSPS(t){const e=new AE(t);let r,n,i,s=0,a=0,o=0,l=0;const c=e.readUByte.bind(e),u=e.readBits.bind(e),h=e.readUEG.bind(e),d=e.readBoolean.bind(e),f=e.skipBits.bind(e),p=e.skipEG.bind(e),g=e.skipUEG.bind(e),m=this.skipScalingList.bind(this);c();const y=c();if(u(5),f(3),c(),g(),100===y||110===y||122===y||244===y||44===y||83===y||86===y||118===y||128===y){const t=h();if(3===t&&f(1),g(),g(),f(1),d())for(n=3!==t?8:12,i=0;i<n;i++)d()&&m(i<6?16:64,e)}g();const v=h();if(0===v)h();else if(1===v)for(f(1),p(),p(),r=h(),i=0;i<r;i++)p();g(),f(1);const b=h(),_=h(),w=u(1);0===w&&f(1),f(1),d()&&(s=h(),a=h(),o=h(),l=h());let E=[1,1];if(d()&&d()){switch(c()){case 1:E=[1,1];break;case 2:E=[12,11];break;case 3:E=[10,11];break;case 4:E=[16,11];break;case 5:E=[40,33];break;case 6:E=[24,11];break;case 7:E=[20,11];break;case 8:E=[32,11];break;case 9:E=[80,33];break;case 10:E=[18,11];break;case 11:E=[15,11];break;case 12:E=[64,33];break;case 13:E=[160,99];break;case 14:E=[4,3];break;case 15:E=[3,2];break;case 16:E=[2,1];break;case 255:E=[c()<<8|c(),c()<<8|c()]}}return{width:Math.ceil(16*(b+1)-2*s-2*a),height:(2-w)*(_+1)*16-(w?2:4)*(o+l),pixelRatio:E}}}class IE extends kE{constructor(){super(...arguments),this.initVPS=null}parsePES(t,e,r,n){const i=this.parseNALu(t,r.data,n);let s,a=this.VideoSample,o=!1;r.data=null,a&&i.length&&!t.audFound&&(this.pushAccessUnit(a,t),a=this.VideoSample=this.createVideoSample(!1,r.pts,r.dts)),i.forEach(n=>{var i,l;switch(n.type){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:case 9:a||(a=this.VideoSample=this.createVideoSample(!1,r.pts,r.dts)),a.frame=!0,s=!0;break;case 16:case 17:case 18:case 21:var c;if(s=!0,o)null!=(c=a)&&c.frame&&!a.key&&(this.pushAccessUnit(a,t),a=this.VideoSample=null);a||(a=this.VideoSample=this.createVideoSample(!0,r.pts,r.dts)),a.key=!0,a.frame=!0;break;case 19:case 20:s=!0,null!=(i=a)&&i.frame&&!a.key&&(this.pushAccessUnit(a,t),a=this.VideoSample=null),a||(a=this.VideoSample=this.createVideoSample(!0,r.pts,r.dts)),a.key=!0,a.frame=!0;break;case 39:s=!0,gv(n.data,2,r.pts,e.samples);break;case 32:s=!0,t.vps||("object"!==typeof t.params&&(t.params={}),t.params=by(t.params,this.readVPS(n.data)),this.initVPS=n.data),t.vps=[n.data];break;case 33:if(s=!0,o=!0,void 0===t.vps||t.vps[0]===this.initVPS||void 0===t.sps||this.matchSPS(t.sps[0],n.data)||(this.initVPS=t.vps[0],t.sps=t.pps=void 0),!t.sps){const e=this.readSPS(n.data);t.width=e.width,t.height=e.height,t.pixelRatio=e.pixelRatio,t.codec=e.codecString,t.sps=[],"object"!==typeof t.params&&(t.params={});for(const r in e.params)t.params[r]=e.params[r]}this.pushParameterSet(t.sps,n.data,t.vps),a||(a=this.VideoSample=this.createVideoSample(!0,r.pts,r.dts)),a.key=!0;break;case 34:if(s=!0,"object"===typeof t.params){if(!t.pps){t.pps=[];const e=this.readPPS(n.data);for(const r in e)t.params[r]=e[r]}this.pushParameterSet(t.pps,n.data,t.vps)}break;case 35:s=!0,t.audFound=!0,null!=(l=a)&&l.frame&&(this.pushAccessUnit(a,t),a=null),a||(a=this.VideoSample=this.createVideoSample(!1,r.pts,r.dts));break;default:s=!1}if(a&&s){a.units.push(n)}}),n&&a&&(this.pushAccessUnit(a,t),this.VideoSample=null)}pushParameterSet(t,e,r){(r&&r[0]===this.initVPS||!r&&!t.length)&&t.push(e)}getNALuType(t,e){return(126&t[e])>>>1}ebsp2rbsp(t){const e=new Uint8Array(t.byteLength);let r=0;for(let n=0;n<t.byteLength;n++)n>=2&&3===t[n]&&0===t[n-1]&&0===t[n-2]||(e[r]=t[n],r++);return new Uint8Array(e.buffer,0,r)}pushAccessUnit(t,e){super.pushAccessUnit(t,e),this.initVPS&&(this.initVPS=null)}readVPS(t){const e=new AE(t);e.readUByte(),e.readUByte(),e.readBits(4),e.skipBits(2),e.readBits(6);return{numTemporalLayers:e.readBits(3)+1,temporalIdNested:e.readBoolean()}}readSPS(t){const e=new AE(this.ebsp2rbsp(t));e.readUByte(),e.readUByte(),e.readBits(4);const r=e.readBits(3);e.readBoolean();const n=e.readBits(2),i=e.readBoolean(),s=e.readBits(5),a=e.readUByte(),o=e.readUByte(),l=e.readUByte(),c=e.readUByte(),u=e.readUByte(),h=e.readUByte(),d=e.readUByte(),f=e.readUByte(),p=e.readUByte(),g=e.readUByte(),m=e.readUByte(),y=[],v=[];for(let K=0;K<r;K++)y.push(e.readBoolean()),v.push(e.readBoolean());if(r>0)for(let K=r;K<8;K++)e.readBits(2);for(let K=0;K<r;K++)y[K]&&(e.readUByte(),e.readUByte(),e.readUByte(),e.readUByte(),e.readUByte(),e.readUByte(),e.readUByte(),e.readUByte(),e.readUByte(),e.readUByte(),e.readUByte()),v[K]&&e.readUByte();e.readUEG();const b=e.readUEG();3==b&&e.skipBits(1);const _=e.readUEG(),w=e.readUEG(),E=e.readBoolean();let S=0,T=0,k=0,A=0;E&&(S+=e.readUEG(),T+=e.readUEG(),k+=e.readUEG(),A+=e.readUEG());const x=e.readUEG(),I=e.readUEG(),R=e.readUEG();for(let K=e.readBoolean()?0:r;K<=r;K++)e.skipUEG(),e.skipUEG(),e.skipUEG();e.skipUEG(),e.skipUEG(),e.skipUEG(),e.skipUEG(),e.skipUEG(),e.skipUEG();if(e.readBoolean()){if(e.readBoolean())for(let t=0;t<4;t++)for(let r=0;r<(3===t?2:6);r++){if(e.readBoolean()){const r=Math.min(64,1<<4+(t<<1));t>1&&e.readEG();for(let t=0;t<r;t++)e.readEG()}else e.readUEG()}}e.readBoolean(),e.readBoolean();e.readBoolean()&&(e.readUByte(),e.skipUEG(),e.skipUEG(),e.readBoolean());const L=e.readUEG();let P=0;for(let K=0;K<L;K++){let t=!1;if(0!==K&&(t=e.readBoolean()),t){K===L&&e.readUEG(),e.readBoolean(),e.readUEG();let t=0;for(let r=0;r<=P;r++){const r=e.readBoolean();let n=!1;r||(n=e.readBoolean()),(r||n)&&t++}P=t}else{const t=e.readUEG(),r=e.readUEG();P=t+r;for(let n=0;n<t;n++)e.readUEG(),e.readBoolean();for(let n=0;n<r;n++)e.readUEG(),e.readBoolean()}}if(e.readBoolean()){const t=e.readUEG();for(let r=0;r<t;r++){for(let t=0;t<R+4;t++)e.readBits(1);e.readBits(1)}}let C=0,M=1,O=1,D=!0,N=1,F=0;e.readBoolean(),e.readBoolean();let U=!1;if(e.readBoolean()){if(e.readBoolean()){const t=e.readUByte();t>0&&t<16?(M=[1,12,10,16,40,24,20,32,80,18,15,64,160,4,3,2][t-1],O=[1,11,11,11,33,11,11,11,33,11,11,33,99,3,2,1][t-1]):255===t&&(M=e.readBits(16),O=e.readBits(16))}e.readBoolean()&&e.readBoolean();if(e.readBoolean()){e.readBits(3),e.readBoolean();e.readBoolean()&&(e.readUByte(),e.readUByte(),e.readUByte())}e.readBoolean()&&(e.readUEG(),e.readUEG()),e.readBoolean(),e.readBoolean(),e.readBoolean(),U=e.readBoolean(),U&&(e.skipUEG(),e.skipUEG(),e.skipUEG(),e.skipUEG());if(e.readBoolean()){N=e.readBits(32),F=e.readBits(32);e.readBoolean()&&e.readUEG();if(e.readBoolean()){const t=e.readBoolean(),n=e.readBoolean();let i=!1;(t||n)&&(i=e.readBoolean(),i&&(e.readUByte(),e.readBits(5),e.readBoolean(),e.readBits(5)),e.readBits(4),e.readBits(4),i&&e.readBits(4),e.readBits(5),e.readBits(5),e.readBits(5));for(let s=0;s<=r;s++){D=e.readBoolean();let r=!1;D||e.readBoolean()?e.readEG():r=e.readBoolean();const s=r?1:e.readUEG()+1;if(t)for(let t=0;t<s;t++)e.readUEG(),e.readUEG(),i&&(e.readUEG(),e.readUEG()),e.skipBits(1);if(n)for(let t=0;t<s;t++)e.readUEG(),e.readUEG(),i&&(e.readUEG(),e.readUEG()),e.skipBits(1)}}}e.readBoolean()&&(e.readBoolean(),e.readBoolean(),e.readBoolean(),C=e.readUEG())}let B=_,j=w;if(E){let t=1,e=1;1===b?t=e=2:2==b&&(t=2),B=_-t*T-t*S,j=w-e*A-e*k}const z=n?["A","B","C"][n]:"",W=a<<24|o<<16|l<<8|c;let G=0;for(let K=0;K<32;K++)G=(G|(W>>K&1)<<31-K)>>>0;let V=G.toString(16);1===s&&"2"===V&&(V="6");const H=i?"H":"L";return{codecString:"hvc1.".concat(z).concat(s,".").concat(V,".").concat(H).concat(m,".B0"),params:{general_tier_flag:i,general_profile_idc:s,general_profile_space:n,general_profile_compatibility_flags:[a,o,l,c],general_constraint_indicator_flags:[u,h,d,f,p,g],general_level_idc:m,bit_depth:x+8,bit_depth_luma_minus8:x,bit_depth_chroma_minus8:I,min_spatial_segmentation_idc:C,chroma_format_idc:b,frame_rate:{fixed:D,fps:F/N}},width:B,height:j,pixelRatio:[M,O]}}readPPS(t){const e=new AE(this.ebsp2rbsp(t));e.readUByte(),e.readUByte(),e.skipUEG(),e.skipUEG(),e.skipBits(2),e.skipBits(3),e.skipBits(2),e.skipUEG(),e.skipUEG(),e.skipEG(),e.skipBits(2);e.readBoolean()&&e.skipUEG(),e.skipEG(),e.skipEG(),e.skipBits(4);const r=e.readBoolean(),n=e.readBoolean();let i=1;return n&&r?i=0:n?i=3:r&&(i=2),{parallelismType:i}}matchSPS(t,e){return String.fromCharCode.apply(null,t).substr(3)===String.fromCharCode.apply(null,e).substr(3)}}const RE=188;class LE{constructor(t,e,r,n){this.logger=void 0,this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.sampleAes=null,this.pmtParsed=!1,this.audioCodec=void 0,this.videoCodec=void 0,this._pmtId=-1,this._videoTrack=void 0,this._audioTrack=void 0,this._id3Track=void 0,this._txtTrack=void 0,this.aacOverFlow=null,this.remainderData=null,this.videoParser=void 0,this.observer=t,this.config=e,this.typeSupported=r,this.logger=n,this.videoParser=null}static probe(t,e){const r=LE.syncOffset(t);return r>0&&e.warn("MPEG2-TS detected but first sync word found @ offset ".concat(r)),-1!==r}static syncOffset(t){const e=t.length;let r=Math.min(940,e-RE)+1,n=0;for(;n<r;){let i=!1,s=-1,a=0;for(let o=n;o<e;o+=RE){if(71!==t[o]||e-o!==RE&&71!==t[o+RE]){if(a)return-1;break}if(a++,-1===s&&(s=o,0!==s&&(r=Math.min(s+18612,t.length-RE)+1)),i||(i=0===PE(t,o)),i&&a>1&&(0===s&&a>2||o+RE>r))return s}n++}return-1}static createTrack(t,e){return{container:"video"===t||"audio"===t?"video/mp2t":void 0,type:t,id:Qy[t],pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0,duration:"audio"===t?e:void 0}}resetInitSegment(t,e,r,n){this.pmtParsed=!1,this._pmtId=-1,this._videoTrack=LE.createTrack("video"),this._videoTrack.duration=n,this._audioTrack=LE.createTrack("audio",n),this._id3Track=LE.createTrack("id3"),this._txtTrack=LE.createTrack("text"),this._audioTrack.segmentCodec="aac",this.videoParser=null,this.aacOverFlow=null,this.remainderData=null,this.audioCodec=e,this.videoCodec=r}resetTimeStamp(){}resetContiguity(){const{_audioTrack:t,_videoTrack:e,_id3Track:r}=this;t&&(t.pesData=null),e&&(e.pesData=null),r&&(r.pesData=null),this.aacOverFlow=null,this.remainderData=null}demux(t,e){let r,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=arguments.length>3&&void 0!==arguments[3]&&arguments[3];n||(this.sampleAes=null);const s=this._videoTrack,a=this._audioTrack,o=this._id3Track,l=this._txtTrack;let c=s.pid,u=s.pesData,h=a.pid,d=o.pid,f=a.pesData,p=o.pesData,g=null,m=this.pmtParsed,y=this._pmtId,v=t.length;if(this.remainderData&&(v=(t=hv(this.remainderData,t)).length,this.remainderData=null),v<RE&&!i)return this.remainderData=t,{audioTrack:a,videoTrack:s,id3Track:o,textTrack:l};const b=Math.max(0,LE.syncOffset(t));v-=(v-b)%RE,v<t.byteLength&&!i&&(this.remainderData=new Uint8Array(t.buffer,v,t.buffer.byteLength-v));let _=0;for(let E=b;E<v;E+=RE)if(71===t[E]){const e=!!(64&t[E+1]),i=PE(t,E);let v;if((48&t[E+3])>>4>1){if(v=E+5+t[E+4],v===E+RE)continue}else v=E+4;switch(i){case c:e&&(u&&(r=NE(u,this.logger))&&(this.readyVideoParser(s.segmentCodec),null!==this.videoParser&&this.videoParser.parsePES(s,l,r,!1)),u={data:[],size:0}),u&&(u.data.push(t.subarray(v,E+RE)),u.size+=E+RE-v);break;case h:if(e){if(f&&(r=NE(f,this.logger)))switch(a.segmentCodec){case"aac":this.parseAACPES(a,r);break;case"mp3":this.parseMPEGPES(a,r);break;case"ac3":this.parseAC3PES(a,r)}f={data:[],size:0}}f&&(f.data.push(t.subarray(v,E+RE)),f.size+=E+RE-v);break;case d:e&&(p&&(r=NE(p,this.logger))&&this.parseID3PES(o,r),p={data:[],size:0}),p&&(p.data.push(t.subarray(v,E+RE)),p.size+=E+RE-v);break;case 0:e&&(v+=t[v]+1),y=this._pmtId=CE(t,v);break;case y:{e&&(v+=t[v]+1);const r=ME(t,v,this.typeSupported,n,this.observer,this.logger);c=r.videoPid,c>0&&(s.pid=c,s.segmentCodec=r.segmentVideoCodec),h=r.audioPid,h>0&&(a.pid=h,a.segmentCodec=r.segmentAudioCodec),d=r.id3Pid,d>0&&(o.pid=d),null===g||m||(this.logger.warn("MPEG-TS PMT found at ".concat(E," after unknown PID '").concat(g,"'. Backtracking to sync byte @").concat(b," to parse all TS packets.")),g=null,E=b-188),m=this.pmtParsed=!0;break}case 17:case 8191:break;default:g=i}}else _++;_>0&&OE(this.observer,new Error("Found ".concat(_," TS packet/s that do not start with 0x47")),void 0,this.logger),s.pesData=u,a.pesData=f,o.pesData=p;const w={audioTrack:a,videoTrack:s,id3Track:o,textTrack:l};return i&&this.extractRemainingSamples(w),w}flush(){const{remainderData:t}=this;let e;return this.remainderData=null,e=t?this.demux(t,-1,!1,!0):{videoTrack:this._videoTrack,audioTrack:this._audioTrack,id3Track:this._id3Track,textTrack:this._txtTrack},this.extractRemainingSamples(e),this.sampleAes?this.decrypt(e,this.sampleAes):e}extractRemainingSamples(t){const{audioTrack:e,videoTrack:r,id3Track:n,textTrack:i}=t,s=r.pesData,a=e.pesData,o=n.pesData;let l;if(s&&(l=NE(s,this.logger))?(this.readyVideoParser(r.segmentCodec),null!==this.videoParser&&(this.videoParser.parsePES(r,i,l,!0),r.pesData=null)):r.pesData=s,a&&(l=NE(a,this.logger))){switch(e.segmentCodec){case"aac":this.parseAACPES(e,l);break;case"mp3":this.parseMPEGPES(e,l);break;case"ac3":this.parseAC3PES(e,l)}e.pesData=null}else null!=a&&a.size&&this.logger.log("last AAC PES packet truncated,might overlap between fragments"),e.pesData=a;o&&(l=NE(o,this.logger))?(this.parseID3PES(n,l),n.pesData=null):n.pesData=o}demuxSampleAes(t,e,r){const n=this.demux(t,r,!0,!this.config.progressive),i=this.sampleAes=new TE(this.observer,this.config,e);return this.decrypt(n,i)}readyVideoParser(t){null===this.videoParser&&("avc"===t?this.videoParser=new xE:"hevc"===t&&(this.videoParser=new IE))}decrypt(t,e){return new Promise(r=>{const{audioTrack:n,videoTrack:i}=t;n.samples&&"aac"===n.segmentCodec?e.decryptAacSamples(n.samples,0,()=>{i.samples?e.decryptAvcSamples(i.samples,0,0,()=>{r(t)}):r(t)}):i.samples&&e.decryptAvcSamples(i.samples,0,0,()=>{r(t)})})}destroy(){this.observer&&this.observer.removeAllListeners(),this.config=this.logger=this.observer=null,this.aacOverFlow=this.videoParser=this.remainderData=this.sampleAes=null,this._videoTrack=this._audioTrack=this._id3Track=this._txtTrack=void 0}parseAACPES(t,e){let r=0;const n=this.aacOverFlow;let i,s,a,o=e.data;if(n){this.aacOverFlow=null;const e=n.missing,i=n.sample.unit.byteLength;if(-1===e)o=hv(n.sample.unit,o);else{const s=i-e;n.sample.unit.set(o.subarray(0,e),s),t.samples.push(n.sample),r=n.missing}}for(i=r,s=o.length;i<s-1&&!Hw(o,i);i++);if(i!==r){let t;const e=i<s-1;if(t=e?"AAC PES did not start with ADTS header,offset:".concat(i):"No ADTS header found in AAC PES",OE(this.observer,new Error(t),e,this.logger),!e)return}if(qw(t,this.observer,o,i,this.audioCodec),void 0!==e.pts)a=e.pts;else{if(!n)return void this.logger.warn("[tsdemuxer]: AAC PES unknown PTS");{const e=Yw(t.samplerate);a=n.sample.pts+e}}let l,c=0;for(;i<s;){if(l=Qw(t,o,i,a,c),i+=l.length,l.missing){this.aacOverFlow=l;break}for(c++;i<s-1&&!Hw(o,i);i++);}}parseMPEGPES(t,e){const r=e.data,n=r.length;let i=0,s=0;const a=e.pts;if(void 0!==a)for(;s<n;)if(yE(r,s)){const e=pE(t,r,s,a,i);if(!e)break;s+=e.length,i++}else s++;else this.logger.warn("[tsdemuxer]: MPEG PES unknown PTS")}parseAC3PES(t,e){{const r=e.data,n=e.pts;if(void 0===n)return void this.logger.warn("[tsdemuxer]: AC3 PES unknown PTS");const i=r.length;let s,a=0,o=0;for(;o<i&&(s=wE(t,r,o,n,a++))>0;)o+=s}}parseID3PES(t,e){if(void 0===e.pts)return void this.logger.warn("[tsdemuxer]: ID3 PES unknown PTS");const r=by({},e,{type:this._videoTrack?sE.emsg:sE.audioId3,duration:Number.POSITIVE_INFINITY});t.samples.push(r)}}function PE(t,e){return((31&t[e+1])<<8)+t[e+2]}function CE(t,e){return(31&t[e+10])<<8|t[e+11]}function ME(t,e,r,n,i,s){const a={audioPid:-1,videoPid:-1,id3Pid:-1,segmentVideoCodec:"avc",segmentAudioCodec:"aac"},o=e+3+((15&t[e+1])<<8|t[e+2])-4;for(e+=12+((15&t[e+10])<<8|t[e+11]);e<o;){const o=PE(t,e),l=(15&t[e+3])<<8|t[e+4];switch(t[e]){case 207:if(!n){DE("ADTS AAC",s);break}case 15:-1===a.audioPid&&(a.audioPid=o);break;case 21:-1===a.id3Pid&&(a.id3Pid=o);break;case 219:if(!n){DE("H.264",s);break}case 27:-1===a.videoPid&&(a.videoPid=o);break;case 3:case 4:r.mpeg||r.mp3?-1===a.audioPid&&(a.audioPid=o,a.segmentAudioCodec="mp3"):s.log("MPEG audio found, not supported in this browser");break;case 193:if(!n){DE("AC-3",s);break}case 129:r.ac3?-1===a.audioPid&&(a.audioPid=o,a.segmentAudioCodec="ac3"):s.log("AC-3 audio found, not supported in this browser");break;case 6:if(-1===a.audioPid&&l>0){let n=e+5,i=l;for(;i>2;){if(106===t[n])!0!==r.ac3?s.log("AC-3 audio found, not supported in this browser for now"):(a.audioPid=o,a.segmentAudioCodec="ac3");const e=t[n+1]+2;n+=e,i-=e}}break;case 194:case 135:return OE(i,new Error("Unsupported EC-3 in M2TS found"),void 0,s),a;case 36:-1===a.videoPid&&(a.videoPid=o,a.segmentVideoCodec="hevc",s.log("HEVC in M2TS found"))}e+=l+5}return a}function OE(t,e,r,n){n.warn("parsing error: ".concat(e.message)),t.emit(ly.ERROR,ly.ERROR,{type:ay.MEDIA_ERROR,details:oy.FRAG_PARSING_ERROR,fatal:!1,levelRetry:r,error:e,reason:e.message})}function DE(t,e){e.log("".concat(t," with AES-128-CBC encryption found in unencrypted stream"))}function NE(t,e){let r,n,i,s,a,o=0;const l=t.data;if(!t||0===t.size)return null;for(;l[0].length<19&&l.length>1;)l[0]=hv(l[0],l[1]),l.splice(1,1);r=l[0];if(1===(r[0]<<16)+(r[1]<<8)+r[2]){if(n=(r[4]<<8)+r[5],n&&n>t.size-6)return null;const c=r[7];192&c&&(s=536870912*(14&r[9])+4194304*(255&r[10])+16384*(254&r[11])+128*(255&r[12])+(254&r[13])/2,64&c?(a=536870912*(14&r[14])+4194304*(255&r[15])+16384*(254&r[16])+128*(255&r[17])+(254&r[18])/2,s-a>54e5&&(e.warn("".concat(Math.round((s-a)/9e4),"s delta between PTS and DTS, align them")),s=a)):a=s),i=r[8];let u=i+9;if(t.size<=u)return null;t.size-=u;const h=new Uint8Array(t.size);for(let t=0,e=l.length;t<e;t++){r=l[t];let e=r.byteLength;if(u){if(u>e){u-=e;continue}r=r.subarray(u),e-=u,u=0}h.set(r,o),o+=e}return n&&(n-=i+3),{data:h,pts:s,dts:a,len:n}}return null}class FE{static getSilentFrame(t,e){if("mp4a.40.2"===t){if(1===e)return new Uint8Array([0,200,0,128,35,128]);if(2===e)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(3===e)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(4===e)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(5===e)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(6===e)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224])}else{if(1===e)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(2===e)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(3===e)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94])}}}const UE=Math.pow(2,32)-1;class BE{static init(){let t;for(t in BE.types={avc1:[],avcC:[],hvc1:[],hvcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],".mp3":[],dac3:[],"ac-3":[],mvex:[],mvhd:[],pasp:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]},BE.types)BE.types.hasOwnProperty(t)&&(BE.types[t]=[t.charCodeAt(0),t.charCodeAt(1),t.charCodeAt(2),t.charCodeAt(3)]);const e=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),r=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);BE.HDLR_TYPES={video:e,audio:r};const n=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),i=new Uint8Array([0,0,0,0,0,0,0,0]);BE.STTS=BE.STSC=BE.STCO=i,BE.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),BE.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),BE.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),BE.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);const s=new Uint8Array([105,115,111,109]),a=new Uint8Array([97,118,99,49]),o=new Uint8Array([0,0,0,1]);BE.FTYP=BE.box(BE.types.ftyp,s,o,s,a),BE.DINF=BE.box(BE.types.dinf,BE.box(BE.types.dref,n))}static box(t){let e=8;for(var r=arguments.length,n=new Array(r>1?r-1:0),i=1;i<r;i++)n[i-1]=arguments[i];let s=n.length;const a=s;for(;s--;)e+=n[s].byteLength;const o=new Uint8Array(e);for(o[0]=e>>24&255,o[1]=e>>16&255,o[2]=e>>8&255,o[3]=255&e,o.set(t,4),s=0,e=8;s<a;s++)o.set(n[s],e),e+=n[s].byteLength;return o}static hdlr(t){return BE.box(BE.types.hdlr,BE.HDLR_TYPES[t])}static mdat(t){return BE.box(BE.types.mdat,t)}static mdhd(t,e){e*=t;const r=Math.floor(e/(UE+1)),n=Math.floor(e%(UE+1));return BE.box(BE.types.mdhd,new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,t>>24&255,t>>16&255,t>>8&255,255&t,r>>24,r>>16&255,r>>8&255,255&r,n>>24,n>>16&255,n>>8&255,255&n,85,196,0,0]))}static mdia(t){return BE.box(BE.types.mdia,BE.mdhd(t.timescale||0,t.duration||0),BE.hdlr(t.type),BE.minf(t))}static mfhd(t){return BE.box(BE.types.mfhd,new Uint8Array([0,0,0,0,t>>24,t>>16&255,t>>8&255,255&t]))}static minf(t){return"audio"===t.type?BE.box(BE.types.minf,BE.box(BE.types.smhd,BE.SMHD),BE.DINF,BE.stbl(t)):BE.box(BE.types.minf,BE.box(BE.types.vmhd,BE.VMHD),BE.DINF,BE.stbl(t))}static moof(t,e,r){return BE.box(BE.types.moof,BE.mfhd(t),BE.traf(r,e))}static moov(t){let e=t.length;const r=[];for(;e--;)r[e]=BE.trak(t[e]);return BE.box.apply(null,[BE.types.moov,BE.mvhd(t[0].timescale||0,t[0].duration||0)].concat(r).concat(BE.mvex(t)))}static mvex(t){let e=t.length;const r=[];for(;e--;)r[e]=BE.trex(t[e]);return BE.box.apply(null,[BE.types.mvex,...r])}static mvhd(t,e){e*=t;const r=Math.floor(e/(UE+1)),n=Math.floor(e%(UE+1)),i=new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,t>>24&255,t>>16&255,t>>8&255,255&t,r>>24,r>>16&255,r>>8&255,255&r,n>>24,n>>16&255,n>>8&255,255&n,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return BE.box(BE.types.mvhd,i)}static sdtp(t){const e=t.samples||[],r=new Uint8Array(4+e.length);let n,i;for(n=0;n<e.length;n++)i=e[n].flags,r[n+4]=i.dependsOn<<4|i.isDependedOn<<2|i.hasRedundancy;return BE.box(BE.types.sdtp,r)}static stbl(t){return BE.box(BE.types.stbl,BE.stsd(t),BE.box(BE.types.stts,BE.STTS),BE.box(BE.types.stsc,BE.STSC),BE.box(BE.types.stsz,BE.STSZ),BE.box(BE.types.stco,BE.STCO))}static avc1(t){let e,r,n,i=[],s=[];for(e=0;e<t.sps.length;e++)r=t.sps[e],n=r.byteLength,i.push(n>>>8&255),i.push(255&n),i=i.concat(Array.prototype.slice.call(r));for(e=0;e<t.pps.length;e++)r=t.pps[e],n=r.byteLength,s.push(n>>>8&255),s.push(255&n),s=s.concat(Array.prototype.slice.call(r));const a=BE.box(BE.types.avcC,new Uint8Array([1,i[3],i[4],i[5],255,224|t.sps.length].concat(i).concat([t.pps.length]).concat(s))),o=t.width,l=t.height,c=t.pixelRatio[0],u=t.pixelRatio[1];return BE.box(BE.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,o>>8&255,255&o,l>>8&255,255&l,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),a,BE.box(BE.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),BE.box(BE.types.pasp,new Uint8Array([c>>24,c>>16&255,c>>8&255,255&c,u>>24,u>>16&255,u>>8&255,255&u])))}static esds(t){const e=t.config;return new Uint8Array([0,0,0,0,3,25,0,1,0,4,17,64,21,0,0,0,0,0,0,0,0,0,0,0,5,2,...e,6,1,2])}static audioStsd(t){const e=t.samplerate||0;return new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,t.channelCount||0,0,16,0,0,0,0,e>>8&255,255&e,0,0])}static mp4a(t){return BE.box(BE.types.mp4a,BE.audioStsd(t),BE.box(BE.types.esds,BE.esds(t)))}static mp3(t){return BE.box(BE.types[".mp3"],BE.audioStsd(t))}static ac3(t){return BE.box(BE.types["ac-3"],BE.audioStsd(t),BE.box(BE.types.dac3,t.config))}static stsd(t){const{segmentCodec:e}=t;if("audio"===t.type){if("aac"===e)return BE.box(BE.types.stsd,BE.STSD,BE.mp4a(t));if("ac3"===e&&t.config)return BE.box(BE.types.stsd,BE.STSD,BE.ac3(t));if("mp3"===e&&"mp3"===t.codec)return BE.box(BE.types.stsd,BE.STSD,BE.mp3(t))}else{if(!t.pps||!t.sps)throw new Error("video track missing pps or sps");if("avc"===e)return BE.box(BE.types.stsd,BE.STSD,BE.avc1(t));if("hevc"===e&&t.vps)return BE.box(BE.types.stsd,BE.STSD,BE.hvc1(t))}throw new Error("unsupported ".concat(t.type," segment codec (").concat(e,"/").concat(t.codec,")"))}static tkhd(t){const e=t.id,r=(t.duration||0)*(t.timescale||0),n=t.width||0,i=t.height||0,s=Math.floor(r/(UE+1)),a=Math.floor(r%(UE+1));return BE.box(BE.types.tkhd,new Uint8Array([1,0,0,7,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,e>>24&255,e>>16&255,e>>8&255,255&e,0,0,0,0,s>>24,s>>16&255,s>>8&255,255&s,a>>24,a>>16&255,a>>8&255,255&a,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,n>>8&255,255&n,0,0,i>>8&255,255&i,0,0]))}static traf(t,e){const r=BE.sdtp(t),n=t.id,i=Math.floor(e/(UE+1)),s=Math.floor(e%(UE+1));return BE.box(BE.types.traf,BE.box(BE.types.tfhd,new Uint8Array([0,0,0,0,n>>24,n>>16&255,n>>8&255,255&n])),BE.box(BE.types.tfdt,new Uint8Array([1,0,0,0,i>>24,i>>16&255,i>>8&255,255&i,s>>24,s>>16&255,s>>8&255,255&s])),BE.trun(t,r.length+16+20+8+16+8+8),r)}static trak(t){return t.duration=t.duration||4294967295,BE.box(BE.types.trak,BE.tkhd(t),BE.mdia(t))}static trex(t){const e=t.id;return BE.box(BE.types.trex,new Uint8Array([0,0,0,0,e>>24,e>>16&255,e>>8&255,255&e,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))}static trun(t,e){const r=t.samples||[],n=r.length,i=12+16*n,s=new Uint8Array(i);let a,o,l,c,u,h;for(e+=8+i,s.set(["video"===t.type?1:0,0,15,1,n>>>24&255,n>>>16&255,n>>>8&255,255&n,e>>>24&255,e>>>16&255,e>>>8&255,255&e],0),a=0;a<n;a++)o=r[a],l=o.duration,c=o.size,u=o.flags,h=o.cts,s.set([l>>>24&255,l>>>16&255,l>>>8&255,255&l,c>>>24&255,c>>>16&255,c>>>8&255,255&c,u.isLeading<<2|u.dependsOn,u.isDependedOn<<6|u.hasRedundancy<<4|u.paddingValue<<1|u.isNonSync,61440&u.degradPrio,15&u.degradPrio,h>>>24&255,h>>>16&255,h>>>8&255,255&h],12+16*a);return BE.box(BE.types.trun,s)}static initSegment(t){BE.types||BE.init();const e=BE.moov(t);return hv(BE.FTYP,e)}static hvc1(t){const e=t.params,r=[t.vps,t.sps,t.pps],n=new Uint8Array([1,e.general_profile_space<<6|(e.general_tier_flag?32:0)|e.general_profile_idc,e.general_profile_compatibility_flags[0],e.general_profile_compatibility_flags[1],e.general_profile_compatibility_flags[2],e.general_profile_compatibility_flags[3],e.general_constraint_indicator_flags[0],e.general_constraint_indicator_flags[1],e.general_constraint_indicator_flags[2],e.general_constraint_indicator_flags[3],e.general_constraint_indicator_flags[4],e.general_constraint_indicator_flags[5],e.general_level_idc,240|e.min_spatial_segmentation_idc>>8,255&e.min_spatial_segmentation_idc,252|e.parallelismType,252|e.chroma_format_idc,248|e.bit_depth_luma_minus8,248|e.bit_depth_chroma_minus8,0,parseInt(e.frame_rate.fps),3|e.temporal_id_nested<<2|e.num_temporal_layers<<3|(e.frame_rate.fixed?64:0),r.length]);let i=n.length;for(let d=0;d<r.length;d+=1){i+=3;for(let t=0;t<r[d].length;t+=1)i+=2+r[d][t].length}const s=new Uint8Array(i);s.set(n,0),i=n.length;const a=r.length-1;for(let d=0;d<r.length;d+=1){s.set(new Uint8Array([32+d|(d===a?128:0),0,r[d].length]),i),i+=3;for(let t=0;t<r[d].length;t+=1)s.set(new Uint8Array([r[d][t].length>>8,255&r[d][t].length]),i),i+=2,s.set(r[d][t],i),i+=r[d][t].length}const o=BE.box(BE.types.hvcC,s),l=t.width,c=t.height,u=t.pixelRatio[0],h=t.pixelRatio[1];return BE.box(BE.types.hvc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,l>>8&255,255&l,c>>8&255,255&c,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),o,BE.box(BE.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),BE.box(BE.types.pasp,new Uint8Array([u>>24,u>>16&255,u>>8&255,255&u,h>>24,h>>16&255,h>>8&255,255&h])))}}BE.types=void 0,BE.HDLR_TYPES=void 0,BE.STTS=void 0,BE.STSC=void 0,BE.STCO=void 0,BE.STSZ=void 0,BE.VMHD=void 0,BE.SMHD=void 0,BE.STSD=void 0,BE.FTYP=void 0,BE.DINF=void 0;function jE(t,e){const r=t*e*(arguments.length>2&&void 0!==arguments[2]?arguments[2]:1);return arguments.length>3&&void 0!==arguments[3]&&arguments[3]?Math.round(r):r}function zE(t){return jE(t,1e3,1/9e4,arguments.length>1&&void 0!==arguments[1]&&arguments[1])}function WE(t){const{baseTime:e,timescale:r,trackId:n}=t;return"".concat(e/r," (").concat(e,"/").concat(r,") trackId: ").concat(n)}let GE,VE=null,HE=null;function KE(t,e,r,n){return{duration:e,size:r,cts:n,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:t?2:1,isNonSync:t?0:1}}}class qE extends Ey{constructor(t,e,r,n){if(super("mp4-remuxer",n),this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.ISGenerated=!1,this._initPTS=null,this._initDTS=null,this.nextVideoTs=null,this.nextAudioTs=null,this.videoSampleDuration=null,this.isAudioContiguous=!1,this.isVideoContiguous=!1,this.videoTrackConfig=void 0,this.observer=t,this.config=e,this.typeSupported=r,this.ISGenerated=!1,null===VE){const t=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);VE=t?parseInt(t[1]):0}if(null===HE){const t=navigator.userAgent.match(/Safari\/(\d+)/i);HE=t?parseInt(t[1]):0}}destroy(){this.config=this.videoTrackConfig=this._initPTS=this._initDTS=null}resetTimeStamp(t){const e=this._initPTS;e&&t&&t.trackId===e.trackId&&t.baseTime===e.baseTime&&t.timescale===e.timescale||this.log("Reset initPTS: ".concat(e?WE(e):e," > ").concat(t?WE(t):t)),this._initPTS=this._initDTS=t}resetNextTimestamp(){this.log("reset next timestamp"),this.isVideoContiguous=!1,this.isAudioContiguous=!1}resetInitSegment(){this.log("ISGenerated flag reset"),this.ISGenerated=!1,this.videoTrackConfig=void 0}getVideoStartPts(t){let e=!1;const r=t[0].pts,n=t.reduce((t,n)=>{let i=n.pts,s=i-t;return s<-4294967296&&(e=!0,i=YE(i,r),s=i-t),s>0?t:i},r);return e&&this.debug("PTS rollover detected"),n}remux(t,e,r,n,i,s,a,o){let l,c,u,h,d,f,p=i,g=i;const m=t.pid>-1,y=e.pid>-1,v=e.samples.length,b=t.samples.length>0,_=a&&v>0||v>1;if((!m||b)&&(!y||_)||this.ISGenerated||a){if(this.ISGenerated){var w,E,S,T;const t=this.videoTrackConfig;(t&&(e.width!==t.width||e.height!==t.height||(null==(w=e.pixelRatio)?void 0:w[0])!==(null==(E=t.pixelRatio)?void 0:E[0])||(null==(S=e.pixelRatio)?void 0:S[1])!==(null==(T=t.pixelRatio)?void 0:T[1]))||!t&&_||null===this.nextAudioTs&&b)&&this.resetInitSegment()}this.ISGenerated||(u=this.generateIS(t,e,i,s));const r=this.isVideoContiguous;let n,a=-1;if(_&&(a=function(t){for(let e=0;e<t.length;e++)if(t[e].key)return e;return-1}(e.samples),!r&&this.config.forceKeyFrameOnDiscontinuity))if(f=!0,a>0){this.warn("Dropped ".concat(a," out of ").concat(v," video samples due to a missing keyframe"));const t=this.getVideoStartPts(e.samples);e.samples=e.samples.slice(a),e.dropped+=a,g+=(e.samples[0].pts-t)/e.inputTimeScale,n=g}else-1===a&&(this.warn("No keyframe found out of ".concat(v," video samples")),f=!1);if(this.ISGenerated){if(b&&_){const r=this.getVideoStartPts(e.samples),n=(YE(t.samples[0].pts,r)-r)/e.inputTimeScale;p+=Math.max(0,n),g+=Math.max(0,-n)}if(b){if(t.samplerate||(this.warn("regenerate InitSegment as audio detected"),u=this.generateIS(t,e,i,s)),c=this.remuxAudio(t,p,this.isAudioContiguous,s,y||_||o===py?g:void 0),_){const n=c?c.endPTS-c.startPTS:0;e.inputTimeScale||(this.warn("regenerate InitSegment as video detected"),u=this.generateIS(t,e,i,s)),l=this.remuxVideo(e,g,r,n)}}else _&&(l=this.remuxVideo(e,g,r,0));l&&(l.firstKeyFrame=a,l.independent=-1!==a,l.firstKeyFramePTS=n)}}return this.ISGenerated&&this._initPTS&&this._initDTS&&(r.samples.length&&(d=QE(r,i,this._initPTS,this._initDTS)),n.samples.length&&(h=XE(n,i,this._initPTS))),{audio:c,video:l,initSegment:u,independent:f,text:h,id3:d}}computeInitPts(t,e,r,n){const i=Math.round(r*e);let s=YE(t,i);if(s<i+e)for(this.log("Adjusting PTS for rollover in timeline near ".concat((i-s)/e," ").concat(n));s<i+e;)s+=8589934592;return s-i}generateIS(t,e,r,n){const i=t.samples,s=e.samples,a=this.typeSupported,o={},l=this._initPTS;let c,u,h,d=!l||n,f="audio/mp4",p=-1;if(d&&(c=u=1/0),t.config&&i.length){switch(t.timescale=t.samplerate,t.segmentCodec){case"mp3":a.mpeg?(f="audio/mpeg",t.codec=""):a.mp3&&(t.codec="mp3");break;case"ac3":t.codec="ac-3"}o.audio={id:"audio",container:f,codec:t.codec,initSegment:"mp3"===t.segmentCodec&&a.mpeg?new Uint8Array(0):BE.initSegment([t]),metadata:{channelCount:t.channelCount}},d&&(p=t.id,h=t.inputTimeScale,l&&h===l.timescale?d=!1:c=u=this.computeInitPts(i[0].pts,h,r,"audio"))}if(e.sps&&e.pps&&s.length){if(e.timescale=e.inputTimeScale,o.video={id:"main",container:"video/mp4",codec:e.codec,initSegment:BE.initSegment([e]),metadata:{width:e.width,height:e.height}},d)if(p=e.id,h=e.inputTimeScale,l&&h===l.timescale)d=!1;else{const t=this.getVideoStartPts(s),e=YE(s[0].dts,t),n=this.computeInitPts(e,h,r,"video"),i=this.computeInitPts(t,h,r,"video");u=Math.min(u,n),c=Math.min(c,i)}this.videoTrackConfig={width:e.width,height:e.height,pixelRatio:e.pixelRatio}}if(Object.keys(o).length)return this.ISGenerated=!0,d?(l&&this.warn("Timestamps at playlist time: ".concat(n?"":"~").concat(r," ").concat(c/h," != initPTS: ").concat(l.baseTime/l.timescale," (").concat(l.baseTime,"/").concat(l.timescale,") trackId: ").concat(l.trackId)),this.log("Found initPTS at playlist time: ".concat(r," offset: ").concat(c/h," (").concat(c,"/").concat(h,") trackId: ").concat(p)),this._initPTS={baseTime:c,timescale:h,trackId:p},this._initDTS={baseTime:u,timescale:h,trackId:p}):c=h=void 0,{tracks:o,initPTS:c,timescale:h,trackId:p}}remuxVideo(t,e,r,n){const i=t.inputTimeScale,s=t.samples,a=[],o=s.length,l=this._initPTS,c=l.baseTime*i/l.timescale;let u,h,d=this.nextVideoTs,f=8,p=this.videoSampleDuration,g=Number.POSITIVE_INFINITY,m=Number.NEGATIVE_INFINITY,y=!1;if(!r||null===d){const t=c+e*i,n=s[0].pts-YE(s[0].dts,s[0].pts);VE&&null!==d&&Math.abs(t-n-(d+c))<15e3?r=!0:d=t-n-c}const v=d+c;for(let O=0;O<o;O++){const t=s[O];t.pts=YE(t.pts,v),t.dts=YE(t.dts,v),t.dts<s[O>0?O-1:O].dts&&(y=!0)}y&&s.sort(function(t,e){const r=t.dts-e.dts,n=t.pts-e.pts;return r||n}),u=s[0].dts,h=s[s.length-1].dts;const b=h-u,_=b?Math.round(b/(o-1)):p||t.inputTimeScale/30;if(r){const r=u-v,n=r>_,i=r<-1;if((n||i)&&(n?this.warn("".concat((t.segmentCodec||"").toUpperCase(),": ").concat(zE(r,!0)," ms (").concat(r,"dts) hole between fragments detected at ").concat(e.toFixed(3))):this.warn("".concat((t.segmentCodec||"").toUpperCase(),": ").concat(zE(-r,!0)," ms (").concat(r,"dts) overlapping between fragments detected at ").concat(e.toFixed(3))),!i||v>=s[0].pts||VE)){u=v;const t=s[0].pts-r;if(n)s[0].dts=u,s[0].pts=t;else{let e=!0;for(let n=0;n<s.length&&!(s[n].dts>t&&e);n++){const t=s[n].pts;if(s[n].dts-=r,s[n].pts-=r,n<s.length-1){const r=s[n+1].pts;e=r<=s[n].pts==r<=t}}}this.log("Video: Initial PTS/DTS adjusted: ".concat(zE(t,!0),"/").concat(zE(u,!0),", delta: ").concat(zE(r,!0)," ms"))}}u=Math.max(0,u);let w=0,E=0,S=u;for(let O=0;O<o;O++){const t=s[O],e=t.units,r=e.length;let n=0;for(let i=0;i<r;i++)n+=e[i].data.length;E+=n,w+=r,t.length=n,t.dts<S?(t.dts=S,S+=_/4|0||1):S=t.dts,g=Math.min(t.pts,g),m=Math.max(t.pts,m)}h=s[o-1].dts;const T=E+4*w+8;let k;try{k=new Uint8Array(T)}catch(Dd){return void this.observer.emit(ly.ERROR,ly.ERROR,{type:ay.MUX_ERROR,details:oy.REMUX_ALLOC_ERROR,fatal:!1,error:Dd,bytes:T,reason:"fail allocating video mdat ".concat(T)})}const A=new DataView(k.buffer);A.setUint32(0,T),k.set(BE.types.mdat,4);let x=!1,I=Number.POSITIVE_INFINITY,R=Number.POSITIVE_INFINITY,L=Number.NEGATIVE_INFINITY,P=Number.NEGATIVE_INFINITY;for(let O=0;O<o;O++){const t=s[O],e=t.units;let r,l=0;for(let n=0,i=e.length;n<i;n++){const t=e[n],r=t.data,i=t.data.byteLength;A.setUint32(f,i),f+=4,k.set(r,f),f+=i,l+=4+i}if(O<o-1)p=s[O+1].dts-t.dts,r=s[O+1].pts-t.pts;else{const e=this.config,a=O>0?t.dts-s[O-1].dts:_;if(r=O>0?t.pts-s[O-1].pts:_,e.stretchShortVideoTrack&&null!==this.nextAudioTs){const r=Math.floor(e.maxBufferHole*i),s=(n?g+n*i:this.nextAudioTs+c)-t.pts;s>r?(p=s-a,p<0?p=a:x=!0,this.log("It is approximately ".concat(s/90," ms to the next segment; using duration ").concat(p/90," ms for the last video frame."))):p=a}else p=a}const u=Math.round(t.pts-t.dts);I=Math.min(I,p),L=Math.max(L,p),R=Math.min(R,r),P=Math.max(P,r),a.push(KE(t.key,p,l,u))}if(a.length)if(VE){if(VE<70){const t=a[0].flags;t.dependsOn=2,t.isNonSync=0}}else if(HE&&P-R<L-I&&_/L<.025&&0===a[0].cts){this.warn("Found irregular gaps in sample duration. Using PTS instead of DTS to determine MP4 sample duration.");let t=u;for(let e=0,r=a.length;e<r;e++){const n=t+a[e].duration,i=t+a[e].cts;if(e<r-1){const t=n+a[e+1].cts;a[e].duration=t-i}else a[e].duration=e?a[e-1].duration:_;a[e].cts=0,t=n}}p=x||!p?_:p;const C=h+p;this.nextVideoTs=d=C-c,this.videoSampleDuration=p,this.isVideoContiguous=!0;const M={data1:BE.moof(t.sequenceNumber++,u,by(t,{samples:a})),data2:k,startPTS:(g-c)/i,endPTS:(m+p-c)/i,startDTS:(u-c)/i,endDTS:d/i,type:"video",hasAudio:!1,hasVideo:!0,nb:a.length,dropped:t.dropped};return t.samples=[],t.dropped=0,M}getSamplesPerFrame(t){switch(t.segmentCodec){case"mp3":return 1152;case"ac3":return 1536;default:return 1024}}remuxAudio(t,e,r,n,i){const s=t.inputTimeScale,a=s/(t.samplerate?t.samplerate:s),o=this.getSamplesPerFrame(t),l=o*a,c=this._initPTS,u="mp3"===t.segmentCodec&&this.typeSupported.mpeg,h=[],d=void 0!==i;let f=t.samples,p=u?0:8,g=this.nextAudioTs||-1;const m=c.baseTime*s/c.timescale,y=m+e*s;if(this.isAudioContiguous=r=r||f.length&&g>0&&(n&&Math.abs(y-(g+m))<9e3||Math.abs(YE(f[0].pts,y)-(g+m))<20*l),f.forEach(function(t){t.pts=YE(t.pts,y)}),!r||g<0){const t=f.length;if(f=f.filter(t=>t.pts>=0),t!==f.length&&this.warn("Removed ".concat(f.length-t," of ").concat(t," samples (initPTS ").concat(m," / ").concat(s,")")),!f.length)return;g=0===i?0:n&&!d?Math.max(0,y-m):f[0].pts-m}if("aac"===t.segmentCodec){const e=this.config.maxAudioFramesDrift;for(let r=0,n=g+m;r<f.length;r++){const i=f[r],a=i.pts,o=a-n,c=Math.abs(1e3*o/s);if(o<=-e*l&&d)0===r&&(this.warn("Audio frame @ ".concat((a/s).toFixed(3),"s overlaps marker by ").concat(Math.round(1e3*o/s)," ms.")),this.nextAudioTs=g=a-m,n=a);else if(o>=e*l&&c<1e4&&d){let e=Math.round(o/l);for(n=a-e*l;n<0&&e&&l;)e--,n+=l;0===r&&(this.nextAudioTs=g=n-m),this.warn("Injecting ".concat(e," audio frames @ ").concat(((n-m)/s).toFixed(3),"s due to ").concat(Math.round(1e3*o/s)," ms gap."));for(let s=0;s<e;s++){let e=FE.getSilentFrame(t.parsedCodec||t.manifestCodec||t.codec,t.channelCount);e||(this.log("Unable to get silent frame for given audio codec; duplicating last frame instead."),e=i.unit.subarray()),f.splice(r,0,{unit:e,pts:n}),n+=l,r++}}i.pts=n,n+=l}}let v,b=null,_=null,w=0,E=f.length;for(;E--;)w+=f[E].unit.byteLength;for(let R=0,L=f.length;R<L;R++){const e=f[R],n=e.unit;let i=e.pts;if(null!==_){h[R-1].duration=Math.round((i-_)/a)}else{if(r&&"aac"===t.segmentCodec&&(i=g+m),b=i,!(w>0))return;w+=p;try{v=new Uint8Array(w)}catch(Dd){return void this.observer.emit(ly.ERROR,ly.ERROR,{type:ay.MUX_ERROR,details:oy.REMUX_ALLOC_ERROR,fatal:!1,error:Dd,bytes:w,reason:"fail allocating audio mdat ".concat(w)})}if(!u){new DataView(v.buffer).setUint32(0,w),v.set(BE.types.mdat,4)}}v.set(n,p);const s=n.byteLength;p+=s,h.push(KE(!0,o,s,0)),_=i}const S=h.length;if(!S)return;const T=h[h.length-1];g=_-m,this.nextAudioTs=g+a*T.duration;const k=u?new Uint8Array(0):BE.moof(t.sequenceNumber++,b/a,by({},t,{samples:h}));t.samples=[];const A=(b-m)/s,x=this.nextAudioTs/s,I={data1:k,data2:v,startPTS:A,endPTS:x,startDTS:A,endDTS:x,type:"audio",hasAudio:!0,hasVideo:!1,nb:S};return this.isAudioContiguous=!0,I}}function YE(t,e){let r;if(null===e)return t;for(r=e<t?-8589934592:8589934592;Math.abs(t-e)>4294967296;)t+=r;return t}function QE(t,e,r,n){const i=t.samples.length;if(!i)return;const s=t.inputTimeScale;for(let o=0;o<i;o++){const i=t.samples[o];i.pts=YE(i.pts-r.baseTime*s/r.timescale,e*s)/s,i.dts=YE(i.dts-n.baseTime*s/n.timescale,e*s)/s}const a=t.samples;return t.samples=[],{samples:a}}function XE(t,e,r){const n=t.samples.length;if(!n)return;const i=t.inputTimeScale;for(let a=0;a<n;a++){const n=t.samples[a];n.pts=YE(n.pts-r.baseTime*i/r.timescale,e*i)/i}t.samples.sort((t,e)=>t.pts-e.pts);const s=t.samples;return t.samples=[],{samples:s}}function $E(t,e){let r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return void 0!==(null==t?void 0:t.start)?(t.start+(r?t.duration:0))/t.timescale:e}function ZE(t,e,r){const n=t.codec;if(n&&n.length>4)return n;if(e===By){if("ec-3"===n||"ac-3"===n||"alac"===n)return n;if("fLaC"===n||"Opus"===n){return Rv(n,!1)}return r.warn('Unhandled audio codec "'.concat(n,'" in mp4 MAP')),n||"mp4a"}return r.warn('Unhandled video codec "'.concat(n,'" in mp4 MAP')),n||"avc1"}try{GE=self.performance.now.bind(self.performance)}catch(Dd){GE=Date.now}const JE=[{demux:class{constructor(t,e){this.remainderData=null,this.timeOffset=0,this.config=void 0,this.videoTrack=void 0,this.audioTrack=void 0,this.id3Track=void 0,this.txtTrack=void 0,this.config=e}resetTimeStamp(){}resetInitSegment(t,e,r,n){const i=this.videoTrack=aE("video",1),s=this.audioTrack=aE("audio",1),a=this.txtTrack=aE("text",1);if(this.id3Track=aE("id3",1),this.timeOffset=0,null==t||!t.byteLength)return;const o=nv(t);if(o.video){const{id:t,timescale:e,codec:r,supplemental:n}=o.video;i.id=t,i.timescale=a.timescale=e,i.codec=r,i.supplemental=n}if(o.audio){const{id:t,timescale:e,codec:r}=o.audio;s.id=t,s.timescale=e,s.codec=r}a.id=Qy.text,i.sampleDuration=0,i.duration=s.duration=n}resetContiguity(){this.remainderData=null}static probe(t){return function(t){const e=t.byteLength;for(let r=0;r<e;){const n=Zy(t,r);if(n>8&&109===t[r+4]&&111===t[r+5]&&111===t[r+6]&&102===t[r+7])return!0;r=n>1?r+n:e}return!1}(t)}demux(t,e){this.timeOffset=e;let r=t;const n=this.videoTrack,i=this.txtTrack;if(this.config.progressive){this.remainderData&&(r=hv(this.remainderData,t));const e=function(t){const e={valid:null,remainder:null},r=ev(t,["moof"]);if(r.length<2)return e.remainder=t,e;const n=r[r.length-1];return e.valid=t.slice(0,n.byteOffset-8),e.remainder=t.slice(n.byteOffset-8),e}(r);this.remainderData=e.remainder,n.samples=e.valid||new Uint8Array}else n.samples=r;const s=this.extractID3Track(n,e);return i.samples=dv(e,n),{videoTrack:n,audioTrack:this.audioTrack,id3Track:s,textTrack:this.txtTrack}}flush(){const t=this.timeOffset,e=this.videoTrack,r=this.txtTrack;e.samples=this.remainderData||new Uint8Array,this.remainderData=null;const n=this.extractID3Track(e,this.timeOffset);return r.samples=dv(t,e),{videoTrack:e,audioTrack:aE(),id3Track:n,textTrack:aE()}}extractID3Track(t,e){const r=this.id3Track;if(t.samples.length){const n=ev(t.samples,["emsg"]);n&&n.forEach(t=>{const n=function(t){const e=t[0];let r="",n="",i=0,s=0,a=0,o=0,l=0,c=0;if(0===e){for(;"\0"!==Xy(t.subarray(c,c+1));)r+=Xy(t.subarray(c,c+1)),c+=1;for(r+=Xy(t.subarray(c,c+1)),c+=1;"\0"!==Xy(t.subarray(c,c+1));)n+=Xy(t.subarray(c,c+1)),c+=1;n+=Xy(t.subarray(c,c+1)),c+=1,i=Zy(t,12),s=Zy(t,16),o=Zy(t,20),l=Zy(t,24),c=28}else if(1===e){c+=4,i=Zy(t,c),c+=4;const e=Zy(t,c);c+=4;const s=Zy(t,c);for(c+=4,a=2**32*e+s,iy(a)||(a=Number.MAX_SAFE_INTEGER,Iy.warn("Presentation time exceeds safe integer limit and wrapped to max safe integer in parsing emsg box")),o=Zy(t,c),c+=4,l=Zy(t,c),c+=4;"\0"!==Xy(t.subarray(c,c+1));)r+=Xy(t.subarray(c,c+1)),c+=1;for(r+=Xy(t.subarray(c,c+1)),c+=1;"\0"!==Xy(t.subarray(c,c+1));)n+=Xy(t.subarray(c,c+1)),c+=1;n+=Xy(t.subarray(c,c+1)),c+=1}return{schemeIdUri:r,value:n,timeScale:i,presentationTime:a,presentationTimeDelta:s,eventDuration:o,id:l,payload:t.subarray(c,t.byteLength)}}(t);if(EE.test(n.schemeIdUri)){const t=SE(n,e);let i=4294967295===n.eventDuration?Number.POSITIVE_INFINITY:n.eventDuration/n.timeScale;i<=.001&&(i=Number.POSITIVE_INFINITY);const s=n.payload;r.samples.push({data:s,len:s.byteLength,dts:t,pts:t,type:sE.emsg,duration:i})}else if(this.config.enableEmsgKLVMetadata&&n.schemeIdUri.startsWith("urn:misb:KLV:bin:1910.1")){const t=SE(n,e);r.samples.push({data:n.payload,len:n.payload.byteLength,dts:t,pts:t,type:sE.misbklv,duration:Number.POSITIVE_INFINITY})}})}return r}demuxSampleAes(t,e,r){return Promise.reject(new Error("The MP4 demuxer does not support SAMPLE-AES decryption"))}destroy(){this.config=null,this.remainderData=null,this.videoTrack=this.audioTrack=this.id3Track=this.txtTrack=void 0}},remux:class extends Ey{constructor(t,e,r,n){super("passthrough-remuxer",n),this.emitInitSegment=!1,this.audioCodec=void 0,this.videoCodec=void 0,this.initData=void 0,this.initPTS=null,this.initTracks=void 0,this.lastEndTime=null,this.isVideoContiguous=!1}destroy(){}resetTimeStamp(t){this.lastEndTime=null;const e=this.initPTS;e&&t&&e.baseTime===t.baseTime&&e.timescale===t.timescale||(this.initPTS=t)}resetNextTimestamp(){this.isVideoContiguous=!1,this.lastEndTime=null}resetInitSegment(t,e,r,n){this.audioCodec=e,this.videoCodec=r,this.generateInitSegment(t,n),this.emitInitSegment=!0}generateInitSegment(t,e){let{audioCodec:r,videoCodec:n}=this;if(null==t||!t.byteLength)return this.initTracks=void 0,void(this.initData=void 0);const{audio:i,video:s}=this.initData=nv(t);if(e)!function(t,e){if(!t||!e)return;const r=e.keyId;r&&e.isCommonEncryption&&cv(t,(t,e)=>{const n=t.subarray(8,24);n.some(t=>0!==t)||(Iy.log("[eme] Patching keyId in 'enc".concat(e?"a":"v",">sinf>>tenc' box: ").concat(Cy(n)," -> ").concat(Cy(r))),t.set(r,8))})}(t,e);else{const t=i||s;null!=t&&t.encrypted&&this.warn('Init segment with encrypted track with has no key ("'.concat(t.codec,'")!'))}i&&(r=ZE(i,By,this)),s&&(n=ZE(s,jy,this));const a={};i&&s?a.audiovideo={container:"video/mp4",codec:r+","+n,supplemental:s.supplemental,encrypted:s.encrypted,initSegment:t,id:"main"}:i?a.audio={container:"audio/mp4",codec:r,encrypted:i.encrypted,initSegment:t,id:"audio"}:s?a.video={container:"video/mp4",codec:n,supplemental:s.supplemental,encrypted:s.encrypted,initSegment:t,id:"main"}:this.warn("initSegment does not contain moov or trak boxes."),this.initTracks=a}remux(t,e,r,n,i,s){var a,o;let{initPTS:l,lastEndTime:c}=this;const u={audio:void 0,video:void 0,text:n,id3:r,initSegment:void 0};ny(c)||(c=this.lastEndTime=i||0);const h=e.samples;if(!h.length)return u;const d={initPTS:void 0,timescale:void 0,trackId:void 0};let f=this.initData;if(null!=(a=f)&&a.length||(this.generateInitSegment(h),f=this.initData),null==(o=f)||!o.length)return this.warn("Failed to generate initSegment."),u;this.emitInitSegment&&(d.tracks=this.initTracks,this.emitInitSegment=!1);const p=function(t,e,r){const n={},i=ev(t,["moof","traf"]);for(let s=0;s<i.length;s++){const t=i[s],a=ev(t,["tfhd"])[0],o=Zy(a,4),l=e[o];if(!l)continue;n[o]||(n[o]={start:NaN,duration:0,sampleCount:0,timescale:l.timescale,type:l.type});const c=n[o],u=ev(t,["tfdt"])[0];if(u){const t=u[0];let e=Zy(u,4);1===t&&(e===qy?r.warn("[mp4-demuxer]: Ignoring assumed invalid signed 64-bit track fragment decode time"):(e*=qy+1,e+=Zy(u,8))),ny(e)&&(!ny(c.start)||e<c.start)&&(c.start=e)}const h=l.default,d=Zy(a,0)|(null==h?void 0:h.flags);let f=(null==h?void 0:h.duration)||0;8&d&&(f=Zy(a,2&d?12:8));const p=ev(t,["trun"]);let g=c.start||0,m=0,y=f;for(let e=0;e<p.length;e++){const t=p[e],r=Zy(t,4),n=c.sampleCount;c.sampleCount+=r;const i=1&t[3],s=4&t[3],a=1&t[2],o=2&t[2],l=4&t[2],u=8&t[2];let h=8,d=r;for(i&&(h+=4),s&&r&&(1&t[h+1]||void 0!==c.keyFrameIndex||(c.keyFrameIndex=n),h+=4,a?(y=Zy(t,h),h+=4):y=f,o&&(h+=4),u&&(h+=4),g+=y,m+=y,d--);d--;)a?(y=Zy(t,h),h+=4):y=f,o&&(h+=4),l&&(1&t[h+1]||void 0===c.keyFrameIndex&&(c.keyFrameIndex=c.sampleCount-(d+1),c.keyFrameStart=g),h+=4),u&&(h+=4),g+=y,m+=y;!m&&f&&(m+=f*r)}c.duration+=m}if(!Object.keys(n).some(t=>n[t].duration)){let e=1/0,r=0;const i=ev(t,["sidx"]);for(let t=0;t<i.length;t++){const n=rv(i[t]);if(null!=n&&n.references){e=Math.min(e,n.earliestPresentationTime/n.timescale);const t=n.references.reduce((t,e)=>t+e.info.duration||0,0);r=Math.max(r,t+n.earliestPresentationTime/n.timescale)}}r&&ny(r)&&Object.keys(n).forEach(t=>{n[t].duration||(n[t].duration=r*n[t].timescale-n[t].start)})}return n}(h,f,this),g=f.audio?p[f.audio.id]:null,m=f.video?p[f.video.id]:null,y=$E(m,1/0),v=$E(g,1/0),b=$E(m,0,!0),_=$E(g,0,!0);let w=i,E=0;const S=g&&(!m||!l&&v<y||l&&l.trackId===f.audio.id),T=S?g:m;if(T){const t=T.timescale,e=T.start-i*t,r=S?f.audio.id:f.video.id;w=T.start/t,E=S?_-v:b-y,!s&&l||!function(t,e,r,n){if(null===t)return!0;const i=Math.max(n,1),s=e-t.baseTime/t.timescale;return Math.abs(s-r)>i}(l,w,i,E)&&t===l.timescale||(l&&this.warn("Timestamps at playlist time: ".concat(s?"":"~").concat(i," ").concat(e/t," != initPTS: ").concat(l.baseTime/l.timescale," (").concat(l.baseTime,"/").concat(l.timescale,") trackId: ").concat(l.trackId)),this.log("Found initPTS at playlist time: ".concat(i," offset: ").concat(w-i," (").concat(e,"/").concat(t,") trackId: ").concat(r)),l=null,d.initPTS=e,d.timescale=t,d.trackId=r)}else this.warn("No audio or video samples found for initPTS at playlist time: ".concat(i));l?(d.initPTS=l.baseTime,d.timescale=l.timescale,d.trackId=l.trackId):(d.timescale&&void 0!==d.trackId&&void 0!==d.initPTS||(this.warn("Could not set initPTS"),d.initPTS=w,d.timescale=1,d.trackId=-1),this.initPTS=l={baseTime:d.initPTS,timescale:d.timescale,trackId:d.trackId});const k=w-l.baseTime/l.timescale,A=k+E;E>0?this.lastEndTime=A:(this.warn("Duration parsed from mp4 should be greater than zero"),this.resetNextTimestamp());const x=!!f.audio,I=!!f.video;let R="";x&&(R+="audio"),I&&(R+="video");const L={data1:h,startPTS:k,startDTS:k,endPTS:A,endDTS:A,type:R,hasAudio:x,hasVideo:I,nb:1,dropped:0,encrypted:!!f.audio&&f.audio.encrypted||!!f.video&&f.video.encrypted};u.audio=x&&!I?L:void 0,u.video=I?L:void 0;const P=null==m?void 0:m.sampleCount;if(P){const t=m.keyFrameIndex,e=-1!==t;L.nb=P,L.dropped=0===t||this.isVideoContiguous?0:e?t:P,L.independent=e,L.firstKeyFrame=t,e&&m.keyFrameStart&&(L.firstKeyFramePTS=(m.keyFrameStart-l.baseTime)/l.timescale),this.isVideoContiguous||(u.independent=e),this.isVideoContiguous||(this.isVideoContiguous=e),L.dropped&&this.warn("fmp4 does not start with IDR: firstIDR ".concat(t,"/").concat(P," dropped: ").concat(L.dropped," start: ").concat(L.firstKeyFramePTS||"NA"))}return u.initSegment=d,u.id3=QE(r,i,l,l),n.samples.length&&(u.text=XE(n,i,l)),u}}},{demux:LE,remux:qE},{demux:class extends oE{constructor(t,e){super(),this.observer=void 0,this.config=void 0,this.observer=t,this.config=e}resetInitSegment(t,e,r,n){super.resetInitSegment(t,e,r,n),this._audioTrack={container:"audio/adts",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"aac",samples:[],manifestCodec:e,duration:n,inputTimeScale:9e4,dropped:0}}static probe(t,e){if(!t)return!1;const r=zw(t,0);let n=(null==r?void 0:r.length)||0;if(vE(t,n))return!1;for(let i=t.length;n<i;n++)if(Kw(t,n))return e.log("ADTS sync word found !"),!0;return!1}canParse(t,e){return function(t,e){return function(t,e){return e+5<t.length}(t,e)&&Ww(t,e)&&Vw(t,e)<=t.length-e}(t,e)}appendFrame(t,e,r){qw(t,this.observer,e,r,t.manifestCodec);const n=Qw(t,e,r,this.basePTS,this.frameIndex);if(n&&0===n.missing)return n}},remux:qE},{demux:class extends oE{resetInitSegment(t,e,r,n){super.resetInitSegment(t,e,r,n),this._audioTrack={container:"audio/mpeg",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"mp3",samples:[],manifestCodec:e,duration:n,inputTimeScale:9e4,dropped:0}}static probe(t){if(!t)return!1;const e=zw(t,0);let r=(null==e?void 0:e.length)||0;if(e&&11===t[r]&&119===t[r+1]&&void 0!==iE(e)&&bE(t,r)<=16)return!1;for(let n=t.length;r<n;r++)if(vE(t,r))return Iy.log("MPEG Audio sync word found !"),!0;return!1}canParse(t,e){return function(t,e){return mE(t,e)&&4<=t.length-e}(t,e)}appendFrame(t,e,r){if(null!==this.basePTS)return pE(t,e,r,this.basePTS,this.frameIndex)}},remux:qE}];JE.splice(2,0,{demux:_E,remux:qE});class tS{constructor(t,e,r,n,i,s){this.asyncResult=!1,this.logger=void 0,this.observer=void 0,this.typeSupported=void 0,this.config=void 0,this.id=void 0,this.demuxer=void 0,this.remuxer=void 0,this.decrypter=void 0,this.probe=void 0,this.decryptionPromise=null,this.transmuxConfig=void 0,this.currentTransmuxState=void 0,this.observer=t,this.typeSupported=e,this.config=r,this.id=i,this.logger=s}configure(t){this.transmuxConfig=t,this.decrypter&&this.decrypter.reset()}push(t,e,r,n){const i=r.transmuxing;i.executeStart=GE();let s=new Uint8Array(t);const{currentTransmuxState:a,transmuxConfig:o}=this;n&&(this.currentTransmuxState=n);const{contiguous:l,discontinuity:c,trackSwitch:u,accurateTimeOffset:h,timeOffset:d,initSegmentChange:f}=n||a,{audioCodec:p,videoCodec:g,defaultInitPts:m,duration:y,initSegmentData:v}=o,b=function(t,e){let r=null;t.byteLength>0&&null!=(null==e?void 0:e.key)&&null!==e.iv&&null!=e.method&&(r=e);return r}(s,e);if(b&&d_(b.method)){const t=this.getDecrypter(),e=f_(b.method);if(!t.isSync())return this.asyncResult=!0,this.decryptionPromise=t.webCryptoDecrypt(s,b.key.buffer,b.iv.buffer,e).then(t=>{const e=this.push(t,null,r);return this.decryptionPromise=null,e}),this.decryptionPromise;{let n=t.softwareDecrypt(s,b.key.buffer,b.iv.buffer,e);if(r.part>-1){const e=t.flush();n=e?e.buffer:e}if(!n)return i.executeEnd=GE(),eS(r);s=new Uint8Array(n)}}const _=this.needsProbing(c,u);if(_){const t=this.configureTransmuxer(s);if(t)return this.logger.warn("[transmuxer] ".concat(t.message)),this.observer.emit(ly.ERROR,ly.ERROR,{type:ay.MEDIA_ERROR,details:oy.FRAG_PARSING_ERROR,fatal:!1,error:t,reason:t.message}),i.executeEnd=GE(),eS(r)}(c||u||f||_)&&this.resetInitSegment(v,p,g,y,e),(c||f||_)&&this.resetInitialTimestamp(m),l||this.resetContiguity();const w=this.transmux(s,b,d,h,r);this.asyncResult=rS(w);const E=this.currentTransmuxState;return E.contiguous=!0,E.discontinuity=!1,E.trackSwitch=!1,i.executeEnd=GE(),w}flush(t){const e=t.transmuxing;e.executeStart=GE();const{decrypter:r,currentTransmuxState:n,decryptionPromise:i}=this;if(i)return this.asyncResult=!0,i.then(()=>this.flush(t));const s=[],{timeOffset:a}=n;if(r){const e=r.flush();e&&s.push(this.push(e.buffer,null,t))}const{demuxer:o,remuxer:l}=this;if(!o||!l){e.executeEnd=GE();const r=[eS(t)];return this.asyncResult?Promise.resolve(r):r}const c=o.flush(a);return rS(c)?(this.asyncResult=!0,c.then(e=>(this.flushRemux(s,e,t),s))):(this.flushRemux(s,c,t),this.asyncResult?Promise.resolve(s):s)}flushRemux(t,e,r){const{audioTrack:n,videoTrack:i,id3Track:s,textTrack:a}=e,{accurateTimeOffset:o,timeOffset:l}=this.currentTransmuxState;this.logger.log("[transmuxer.ts]: Flushed ".concat(this.id," sn: ").concat(r.sn).concat(r.part>-1?" part: "+r.part:""," of ").concat(this.id===fy?"level":"track"," ").concat(r.level));const c=this.remuxer.remux(n,i,s,a,l,o,!0,this.id);t.push({remuxResult:c,chunkMeta:r}),r.transmuxing.executeEnd=GE()}resetInitialTimestamp(t){const{demuxer:e,remuxer:r}=this;e&&r&&(e.resetTimeStamp(t),r.resetTimeStamp(t))}resetContiguity(){const{demuxer:t,remuxer:e}=this;t&&e&&(t.resetContiguity(),e.resetNextTimestamp())}resetInitSegment(t,e,r,n,i){const{demuxer:s,remuxer:a}=this;s&&a&&(s.resetInitSegment(t,e,r,n),a.resetInitSegment(t,e,r,i))}destroy(){this.demuxer&&(this.demuxer.destroy(),this.demuxer=void 0),this.remuxer&&(this.remuxer.destroy(),this.remuxer=void 0)}transmux(t,e,r,n,i){let s;return s=e&&"SAMPLE-AES"===e.method?this.transmuxSampleAes(t,e,r,n,i):this.transmuxUnencrypted(t,r,n,i),s}transmuxUnencrypted(t,e,r,n){const{audioTrack:i,videoTrack:s,id3Track:a,textTrack:o}=this.demuxer.demux(t,e,!1,!this.config.progressive);return{remuxResult:this.remuxer.remux(i,s,a,o,e,r,!1,this.id),chunkMeta:n}}transmuxSampleAes(t,e,r,n,i){return this.demuxer.demuxSampleAes(t,e,r).then(t=>({remuxResult:this.remuxer.remux(t.audioTrack,t.videoTrack,t.id3Track,t.textTrack,r,n,!1,this.id),chunkMeta:i}))}configureTransmuxer(t){const{config:e,observer:r,typeSupported:n}=this;let i;for(let u=0,h=JE.length;u<h;u++){var s;if(null!=(s=JE[u].demux)&&s.probe(t,this.logger)){i=JE[u];break}}if(!i)return new Error("Failed to find demuxer by probing fragment data");const a=this.demuxer,o=this.remuxer,l=i.remux,c=i.demux;o&&o instanceof l||(this.remuxer=new l(r,e,n,this.logger)),a&&a instanceof c||(this.demuxer=new c(r,e,n,this.logger),this.probe=c.probe)}needsProbing(t,e){return!this.demuxer||!this.remuxer||t||e}getDecrypter(){let t=this.decrypter;return t||(t=this.decrypter=new Wb(this.config)),t}}const eS=t=>({remuxResult:{},chunkMeta:t});function rS(t){return"then"in t&&t.then instanceof Function}class nS{constructor(t,e,r,n,i){this.audioCodec=void 0,this.videoCodec=void 0,this.initSegmentData=void 0,this.duration=void 0,this.defaultInitPts=void 0,this.audioCodec=t,this.videoCodec=e,this.initSegmentData=r,this.duration=n,this.defaultInitPts=i||null}}class iS{constructor(t,e,r,n,i,s){this.discontinuity=void 0,this.contiguous=void 0,this.accurateTimeOffset=void 0,this.trackSwitch=void 0,this.timeOffset=void 0,this.initSegmentChange=void 0,this.discontinuity=t,this.contiguous=e,this.accurateTimeOffset=r,this.trackSwitch=n,this.timeOffset=i,this.initSegmentChange=s}}let sS=0;class aS{constructor(t,e,r,n){this.error=null,this.hls=void 0,this.id=void 0,this.instanceNo=sS++,this.observer=void 0,this.frag=null,this.part=null,this.useWorker=void 0,this.workerContext=null,this.transmuxer=null,this.onTransmuxComplete=void 0,this.onFlush=void 0,this.onWorkerMessage=t=>{const e=t.data,r=this.hls;if(r&&null!=e&&e.event&&e.instanceNo===this.instanceNo)switch(e.event){case"init":{var n;const t=null==(n=this.workerContext)?void 0:n.objectURL;t&&self.URL.revokeObjectURL(t);break}case"transmuxComplete":this.handleTransmuxComplete(e.data);break;case"flush":this.onFlush(e.data);break;case"workerLog":r.logger[e.data.logType]&&r.logger[e.data.logType](e.data.message);break;default:e.data=e.data||{},e.data.frag=this.frag,e.data.part=this.part,e.data.id=this.id,r.trigger(e.event,e.data)}},this.onWorkerError=t=>{if(!this.hls)return;const e=new Error("".concat(t.message,"  (").concat(t.filename,":").concat(t.lineno,")"));this.hls.config.enableWorker=!1,this.hls.logger.warn('Error in "'.concat(this.id,'" Web Worker, fallback to inline')),this.hls.trigger(ly.ERROR,{type:ay.OTHER_ERROR,details:oy.INTERNAL_EXCEPTION,fatal:!1,event:"demuxerWorker",error:e})};const i=t.config;this.hls=t,this.id=e,this.useWorker=!!i.enableWorker,this.onTransmuxComplete=r,this.onFlush=n;const s=(t,e)=>{(e=e||{}).frag=this.frag||void 0,t===ly.ERROR&&(e.parent=this.id,e.part=this.part,this.error=e.error),this.hls.trigger(t,e)};this.observer=new Dw,this.observer.on(ly.FRAG_DECRYPTED,s),this.observer.on(ly.ERROR,s);const a=Mv(i.preferManagedMediaSource);if(this.useWorker&&"undefined"!==typeof Worker){const r=this.hls.logger;if(i.workerPath||"function"===typeof __HLS_WORKER_BUNDLE__){try{i.workerPath?(r.log("loading Web Worker ".concat(i.workerPath,' for "').concat(e,'"')),this.workerContext=function(t){const e=Fw[t];if(e)return e.clientCount++,e;const r=new self.URL(t,self.location.href).href,n={worker:new self.Worker(r),scriptURL:r,clientCount:1};return Fw[t]=n,n}(i.workerPath)):(r.log('injecting Web Worker for "'.concat(e,'"')),this.workerContext=function(){const t=Fw[Nw];if(t)return t.clientCount++,t;const e=new self.Blob(["var exports={};var module={exports:exports};function define(f){f()};define.amd=true;(".concat(__HLS_WORKER_BUNDLE__.toString(),")(true);")],{type:"text/javascript"}),r=self.URL.createObjectURL(e),n={worker:new self.Worker(r),objectURL:r,clientCount:1};return Fw[Nw]=n,n}());const{worker:t}=this.workerContext;t.addEventListener("message",this.onWorkerMessage),t.addEventListener("error",this.onWorkerError),t.postMessage({instanceNo:this.instanceNo,cmd:"init",typeSupported:a,id:e,config:Zv(i)})}catch(Dd){r.warn('Error setting up "'.concat(e,'" Web Worker, fallback to inline'),Dd),this.terminateWorker(),this.error=null,this.transmuxer=new tS(this.observer,a,i,"",e,t.logger)}return}}this.transmuxer=new tS(this.observer,a,i,"",e,t.logger)}reset(){if(this.frag=null,this.part=null,this.workerContext){const t=this.instanceNo;this.instanceNo=sS++;const e=this.hls.config,r=Mv(e.preferManagedMediaSource);this.workerContext.worker.postMessage({instanceNo:this.instanceNo,cmd:"reset",resetNo:t,typeSupported:r,id:this.id,config:Zv(e)})}}terminateWorker(){if(this.workerContext){const{worker:t}=this.workerContext;this.workerContext=null,t.removeEventListener("message",this.onWorkerMessage),t.removeEventListener("error",this.onWorkerError),function(t){const e=Fw[t||Nw];if(e&&1===e.clientCount--){const{worker:r,objectURL:n}=e;delete Fw[t||Nw],n&&self.URL.revokeObjectURL(n),r.terminate()}}(this.hls.config.workerPath)}}destroy(){if(this.workerContext)this.terminateWorker(),this.onWorkerMessage=this.onWorkerError=null;else{const t=this.transmuxer;t&&(t.destroy(),this.transmuxer=null)}const t=this.observer;t&&t.removeAllListeners(),this.frag=null,this.part=null,this.observer=null,this.hls=null}push(t,e,r,n,i,s,a,o,l,c){var u,h;l.transmuxing.start=self.performance.now();const{instanceNo:d,transmuxer:f}=this,p=s?s.start:i.start,g=i.decryptdata,m=this.frag,y=!(m&&i.cc===m.cc),v=!(m&&l.level===m.level),b=m?l.sn-m.sn:-1,_=this.part?l.part-this.part.index:-1,w=0===b&&l.id>1&&l.id===(null==m?void 0:m.stats.chunkCount),E=!v&&(1===b||0===b&&(1===_||w&&_<=0)),S=self.performance.now();(v||b||0===i.stats.parsing.start)&&(i.stats.parsing.start=S),!s||!_&&E||(s.stats.parsing.start=S);const T=!(m&&(null==(u=i.initSegment)?void 0:u.url)===(null==(h=m.initSegment)?void 0:h.url)),k=new iS(y,E,o,v,p,T);if(!E||y||T){this.hls.logger.log("[transmuxer-interface]: Starting new transmux session for ".concat(i.type," sn: ").concat(l.sn).concat(l.part>-1?" part: "+l.part:""," ").concat(this.id===fy?"level":"track",": ").concat(l.level," id: ").concat(l.id,"\n        discontinuity: ").concat(y,"\n        trackSwitch: ").concat(v,"\n        contiguous: ").concat(E,"\n        accurateTimeOffset: ").concat(o,"\n        timeOffset: ").concat(p,"\n        initSegmentChange: ").concat(T));const t=new nS(r,n,e,a,c);this.configureTransmuxer(t)}if(this.frag=i,this.part=s,this.workerContext)this.workerContext.worker.postMessage({instanceNo:d,cmd:"demux",data:t,decryptdata:g,chunkMeta:l,state:k},t instanceof ArrayBuffer?[t]:[]);else if(f){const e=f.push(t,g,l,k);rS(e)?e.then(t=>{this.handleTransmuxComplete(t)}).catch(t=>{this.transmuxerError(t,l,"transmuxer-interface push error")}):this.handleTransmuxComplete(e)}}flush(t){t.transmuxing.start=self.performance.now();const{instanceNo:e,transmuxer:r}=this;if(this.workerContext)this.workerContext.worker.postMessage({instanceNo:e,cmd:"flush",chunkMeta:t});else if(r){const e=r.flush(t);rS(e)?e.then(e=>{this.handleFlushResult(e,t)}).catch(e=>{this.transmuxerError(e,t,"transmuxer-interface flush error")}):this.handleFlushResult(e,t)}}transmuxerError(t,e,r){this.hls&&(this.error=t,this.hls.trigger(ly.ERROR,{type:ay.MEDIA_ERROR,details:oy.FRAG_PARSING_ERROR,chunkMeta:e,frag:this.frag||void 0,part:this.part||void 0,fatal:!1,error:t,err:t,reason:r}))}handleFlushResult(t,e){t.forEach(t=>{this.handleTransmuxComplete(t)}),this.onFlush(e)}configureTransmuxer(t){const{instanceNo:e,transmuxer:r}=this;this.workerContext?this.workerContext.worker.postMessage({instanceNo:e,cmd:"configure",config:t}):r&&r.configure(t)}handleTransmuxComplete(t){t.chunkMeta.transmuxing.end=self.performance.now(),this.onTransmuxComplete(t)}}class oS extends Ey{constructor(t,e){super(e,t.logger),this.hls=void 0,this.canLoad=!1,this.timer=-1,this.hls=t}destroy(){this.clearTimer(),this.hls=this.log=this.warn=null}clearTimer(){-1!==this.timer&&(self.clearTimeout(this.timer),this.timer=-1)}startLoad(){this.canLoad=!0,this.loadPlaylist()}stopLoad(){this.canLoad=!1,this.clearTimer()}switchParams(t,e,r){const n=null==e?void 0:e.renditionReports;if(n){let i=-1;for(let r=0;r<n.length;r++){const s=n[r];let a;try{a=new self.URL(s.URI,e.url).href}catch(cg){this.warn("Could not construct new URL for Rendition Report: ".concat(cg)),a=s.URI||""}if(a===t){i=r;break}a===t.substring(0,a.length)&&(i=r)}if(-1!==i){const t=n[i],s=parseInt(t["LAST-MSN"])||e.lastPartSn;let a=parseInt(t["LAST-PART"])||e.lastPartIndex;if(this.hls.config.lowLatencyMode){const t=Math.min(e.age-e.partTarget,e.targetduration);a>=0&&t>e.partTarget&&(a+=1)}const o=r&&qv(r);return new Yv(s,a>=0?a:void 0,o)}}}loadPlaylist(t){this.clearTimer()}loadingPlaylist(t,e){this.clearTimer()}shouldLoadPlaylist(t){return this.canLoad&&!!t&&!!t.url&&(!t.details||t.details.live)}getUrlWithDirectives(t,e){if(e)try{return e.addDirectives(t)}catch(cg){this.warn("Could not construct new URL with HLS Delivery Directives: ".concat(cg))}return t}playlistLoaded(t,e,r){const{details:n,stats:i}=e,s=self.performance.now(),a=i.loading.first?Math.max(0,s-i.loading.first):0;n.advancedDateTime=Date.now()-a;const o=this.hls.config.timelineOffset;if(o!==n.appliedTimelineOffset){const t=Math.max(o||0,0);n.appliedTimelineOffset=t,n.fragments.forEach(e=>{e.setStart(e.playlistOffset+t)})}if(n.live||null!=r&&r.live){const o="levelInfo"in e?e.levelInfo:e.track;if(n.reloaded(r),r&&n.fragments.length>0){Z_(r,n,this);const t=n.playlistParsingError;if(t){this.warn(t);const r=this.hls;if(!r.config.ignorePlaylistParsingErrors){var l;const{networkDetails:s}=e;return void r.trigger(ly.ERROR,{type:ay.NETWORK_ERROR,details:oy.LEVEL_PARSING_ERROR,fatal:!1,url:n.url,error:t,reason:t.message,level:e.level||void 0,parent:null==(l=n.fragments[0])?void 0:l.type,networkDetails:s,stats:i})}n.playlistParsingError=null}}-1===n.requestScheduled&&(n.requestScheduled=i.loading.start);const c=this.hls.mainForwardBufferInfo,u=c?c.end-c.len:0,h=rw(n,1e3*(n.edge-u));if(n.requestScheduled+h<s?n.requestScheduled=s:n.requestScheduled+=h,this.log("live playlist ".concat(t," ").concat(n.advanced?"REFRESHED "+n.lastPartSn+"-"+n.lastPartIndex:n.updated?"UPDATED":"MISSED")),!this.canLoad||!n.live)return;let d,f,p;if(n.canBlockReload&&n.endSN&&n.advanced){const t=this.hls.config.lowLatencyMode,i=n.lastPartSn,a=n.endSN,l=n.lastPartIndex,c=i===a;-1!==l?c?(f=a+1,p=t?0:l):(f=i,p=t?l+1:n.maxPartIndex):f=a+1;const u=n.age,h=u+n.ageHeader;let g=Math.min(h-n.partTarget,1.5*n.targetduration);if(g>0){if(h>3*n.targetduration)this.log("Playlist last advanced ".concat(u.toFixed(2),"s ago. Omitting segment and part directives.")),f=void 0,p=void 0;else if(null!=r&&r.tuneInGoal&&h-n.partTarget>r.tuneInGoal)this.warn("CDN Tune-in goal increased from: ".concat(r.tuneInGoal," to: ").concat(g," with playlist age: ").concat(n.age)),g=0;else{const t=Math.floor(g/n.targetduration);if(f+=t,void 0!==p){p+=Math.round(g%n.targetduration/n.partTarget)}this.log("CDN Tune-in age: ".concat(n.ageHeader,"s last advanced ").concat(u.toFixed(2),"s goal: ").concat(g," skip sn ").concat(t," to part ").concat(p))}n.tuneInGoal=g}if(d=this.getDeliveryDirectives(n,e.deliveryDirectives,f,p),t||!c)return n.requestScheduled=s,void this.loadingPlaylist(o,d)}else(n.canBlockReload||n.canSkipUntil)&&(d=this.getDeliveryDirectives(n,e.deliveryDirectives,f,p));d&&void 0!==f&&n.canBlockReload&&(n.requestScheduled=i.loading.first+Math.max(h-2*a,h/2)),this.scheduleLoading(o,d,n)}else this.clearTimer()}scheduleLoading(t,e,r){const n=r||t.details;if(!n)return void this.loadingPlaylist(t,e);const i=self.performance.now(),s=n.requestScheduled;if(i>=s)return void this.loadingPlaylist(t,e);const a=s-i;this.log("reload live playlist ".concat(t.name||t.bitrate+"bps"," in ").concat(Math.round(a)," ms")),this.clearTimer(),this.timer=self.setTimeout(()=>this.loadingPlaylist(t,e),a)}getDeliveryDirectives(t,e,r,n){let i=qv(t);return null!=e&&e.skip&&t.deltaUpdateFailed&&(r=e.msn,n=e.part,i=Vv),new Yv(r,n,i)}checkRetry(t){const e=t.details,r=db(t),n=t.errorAction,{action:i,retryCount:s=0,retryConfig:a}=n||{},o=!!n&&!!a&&(i===Sb||!n.resolved&&i===wb);if(o){var l;if(s>=a.maxNumRetry)return!1;if(r&&null!=(l=t.context)&&l.deliveryDirectives)this.warn("Retrying playlist loading ".concat(s+1,"/").concat(a.maxNumRetry,' after "').concat(e,'" without delivery-directives')),this.loadPlaylist();else{const t=mb(a,s);this.clearTimer(),this.timer=self.setTimeout(()=>this.loadPlaylist(),t),this.warn("Retrying playlist loading ".concat(s+1,"/").concat(a.maxNumRetry,' after "').concat(e,'" in ').concat(t,"ms"))}t.levelRetry=!0,n.resolved=!0}return o}}function lS(t,e){if(t.length!==e.length)return!1;for(let r=0;r<t.length;r++)if(!cS(t[r].attrs,e[r].attrs))return!1;return!0}function cS(t,e,r){const n=t["STABLE-RENDITION-ID"];return n&&!r?n===e["STABLE-RENDITION-ID"]:!(r||["LANGUAGE","NAME","CHARACTERISTICS","AUTOSELECT","DEFAULT","FORCED","ASSOC-LANGUAGE"]).some(r=>t[r]!==e[r])}function uS(t,e){return e.label.toLowerCase()===t.name.toLowerCase()&&(!e.language||e.language.toLowerCase()===(t.lang||"").toLowerCase())}class hS{constructor(t){this.tracks=void 0,this.queues={video:[],audio:[],audiovideo:[]},this.tracks=t}destroy(){this.tracks=this.queues=null}append(t,e,r){if(null===this.queues||null===this.tracks)return;const n=this.queues[e];n.push(t),1!==n.length||r||this.executeNext(e)}appendBlocker(t){return new Promise(e=>{const r={label:"async-blocker",execute:e,onStart:()=>{},onComplete:()=>{},onError:()=>{}};this.append(r,t)})}prependBlocker(t){return new Promise(e=>{if(this.queues){const r={label:"async-blocker-prepend",execute:e,onStart:()=>{},onComplete:()=>{},onError:()=>{}};this.queues[t].unshift(r)}})}removeBlockers(){null!==this.queues&&[this.queues.video,this.queues.audio,this.queues.audiovideo].forEach(t=>{var e;const r=null==(e=t[0])?void 0:e.label;"async-blocker"!==r&&"async-blocker-prepend"!==r||(t[0].execute(),t.splice(0,1))})}unblockAudio(t){if(null===this.queues)return;this.queues.audio[0]===t&&this.shiftAndExecuteNext("audio")}executeNext(t){if(null===this.queues||null===this.tracks)return;const e=this.queues[t];if(e.length){const n=e[0];try{n.execute()}catch(cg){var r;if(n.onError(cg),null===this.queues||null===this.tracks)return;const i=null==(r=this.tracks[t])?void 0:r.buffer;null!=i&&i.updating||this.shiftAndExecuteNext(t)}}}shiftAndExecuteNext(t){null!==this.queues&&(this.queues[t].shift(),this.executeNext(t))}current(t){var e;return(null==(e=this.queues)?void 0:e[t][0])||null}toString(){const{queues:t,tracks:e}=this;return null===t||null===e?"<destroyed>":"\n".concat(this.list("video"),"\n").concat(this.list("audio"),"\n").concat(this.list("audiovideo"),"}")}list(t){var e,r;return null!=(e=this.queues)&&e[t]||null!=(r=this.tracks)&&r[t]?"".concat(t,": (").concat(this.listSbInfo(t),") ").concat(this.listOps(t)):""}listSbInfo(t){var e;const r=null==(e=this.tracks)?void 0:e[t],n=null==r?void 0:r.buffer;return n?"SourceBuffer".concat(n.updating?" updating":"").concat(r.ended?" ended":"").concat(r.ending?" ending":""):"none"}listOps(t){var e;return(null==(e=this.queues)?void 0:e[t].map(t=>t.label).join(", "))||""}}const dS=/(avc[1234]|hvc1|hev1|dvh[1e]|vp09|av01)(?:\.[^.,]+)+/,fS="HlsJsTrackRemovedError";class pS extends Error{constructor(t){super(t),this.name=fS}}function gS(t){const e=t.querySelectorAll("source");[].slice.call(e).forEach(e=>{t.removeChild(e)})}function mS(t){return"audio"===t?1:0}class yS{constructor(t){this.hls=void 0,this.autoLevelCapping=void 0,this.firstLevel=void 0,this.media=void 0,this.restrictedLevels=void 0,this.timer=void 0,this.clientRect=void 0,this.streamController=void 0,this.hls=t,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.firstLevel=-1,this.media=null,this.restrictedLevels=[],this.timer=void 0,this.clientRect=null,this.registerListeners()}setStreamController(t){this.streamController=t}destroy(){this.hls&&this.unregisterListener(),this.timer&&this.stopCapping(),this.media=null,this.clientRect=null,this.hls=this.streamController=null}registerListeners(){const{hls:t}=this;t.on(ly.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),t.on(ly.MEDIA_ATTACHING,this.onMediaAttaching,this),t.on(ly.MANIFEST_PARSED,this.onManifestParsed,this),t.on(ly.LEVELS_UPDATED,this.onLevelsUpdated,this),t.on(ly.BUFFER_CODECS,this.onBufferCodecs,this),t.on(ly.MEDIA_DETACHING,this.onMediaDetaching,this)}unregisterListener(){const{hls:t}=this;t.off(ly.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),t.off(ly.MEDIA_ATTACHING,this.onMediaAttaching,this),t.off(ly.MANIFEST_PARSED,this.onManifestParsed,this),t.off(ly.LEVELS_UPDATED,this.onLevelsUpdated,this),t.off(ly.BUFFER_CODECS,this.onBufferCodecs,this),t.off(ly.MEDIA_DETACHING,this.onMediaDetaching,this)}onFpsDropLevelCapping(t,e){const r=this.hls.levels[e.droppedLevel];this.isLevelAllowed(r)&&this.restrictedLevels.push({bitrate:r.bitrate,height:r.height,width:r.width})}onMediaAttaching(t,e){this.media=e.media instanceof HTMLVideoElement?e.media:null,this.clientRect=null,this.timer&&this.hls.levels.length&&this.detectPlayerSize()}onManifestParsed(t,e){const r=this.hls;this.restrictedLevels=[],this.firstLevel=e.firstLevel,r.config.capLevelToPlayerSize&&e.video&&this.startCapping()}onLevelsUpdated(t,e){this.timer&&ny(this.autoLevelCapping)&&this.detectPlayerSize()}onBufferCodecs(t,e){this.hls.config.capLevelToPlayerSize&&e.video&&this.startCapping()}onMediaDetaching(){this.stopCapping(),this.media=null}detectPlayerSize(){if(this.media){if(this.mediaHeight<=0||this.mediaWidth<=0)return void(this.clientRect=null);const t=this.hls.levels;if(t.length){const e=this.hls,r=this.getMaxLevel(t.length-1);r!==this.autoLevelCapping&&e.logger.log("Setting autoLevelCapping to ".concat(r,": ").concat(t[r].height,"p@").concat(t[r].bitrate," for media ").concat(this.mediaWidth,"x").concat(this.mediaHeight)),e.autoLevelCapping=r,e.autoLevelEnabled&&e.autoLevelCapping>this.autoLevelCapping&&this.streamController&&this.streamController.nextLevelSwitch(),this.autoLevelCapping=e.autoLevelCapping}}}getMaxLevel(t){const e=this.hls.levels;if(!e.length)return-1;const r=e.filter((e,r)=>this.isLevelAllowed(e)&&r<=t);return this.clientRect=null,yS.getMaxLevelByMediaSize(r,this.mediaWidth,this.mediaHeight)}startCapping(){this.timer||(this.autoLevelCapping=Number.POSITIVE_INFINITY,self.clearInterval(this.timer),this.timer=self.setInterval(this.detectPlayerSize.bind(this),1e3),this.detectPlayerSize())}stopCapping(){this.restrictedLevels=[],this.firstLevel=-1,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.timer&&(self.clearInterval(this.timer),this.timer=void 0)}getDimensions(){if(this.clientRect)return this.clientRect;const t=this.media,e={width:0,height:0};if(t){const r=t.getBoundingClientRect();e.width=r.width,e.height=r.height,e.width||e.height||(e.width=r.right-r.left||t.width||0,e.height=r.bottom-r.top||t.height||0)}return this.clientRect=e,e}get mediaWidth(){return this.getDimensions().width*this.contentScaleFactor}get mediaHeight(){return this.getDimensions().height*this.contentScaleFactor}get contentScaleFactor(){let t=1;if(!this.hls.config.ignoreDevicePixelRatio)try{t=self.devicePixelRatio}catch(vA){}return Math.min(t,this.hls.config.maxDevicePixelRatio)}isLevelAllowed(t){return!this.restrictedLevels.some(e=>t.bitrate===e.bitrate&&t.width===e.width&&t.height===e.height)}static getMaxLevelByMediaSize(t,e,r){if(null==t||!t.length)return-1;const n=(t,e)=>!e||(t.width!==e.width||t.height!==e.height);let i=t.length-1;const s=Math.max(e,r);for(let a=0;a<t.length;a+=1){const e=t[a];if((e.width>=s||e.height>=s)&&n(e,t[a+1])){i=a;break}}return i}}const vS={MANIFEST:"m",AUDIO:"a",VIDEO:"v",MUXED:"av",INIT:"i",CAPTION:"c",TIMED_TEXT:"tt",KEY:"k",OTHER:"o"},bS={HLS:"h"};class _S{constructor(t,e){Array.isArray(t)&&(t=t.map(t=>t instanceof _S?t:new _S(t))),this.value=t,this.params=e}}function wS(t,e,r,n){return new Error("failed to ".concat(t,' "').concat((i=e,Array.isArray(i)?JSON.stringify(i):i instanceof Map?"Map{}":i instanceof Set?"Set{}":"object"===typeof i?JSON.stringify(i):String(i)),'" as ').concat(r),{cause:n});var i}function ES(t,e,r){return wS("serialize",t,e,r)}class SS{constructor(t){this.description=t}}const TS="Bare Item";function kS(t){if(!1===ArrayBuffer.isView(t))throw ES(t,"Byte Sequence");return":".concat((e=t,btoa(String.fromCharCode(...e))),":");var e}function AS(t){if(function(t){return t<-999999999999999||999999999999999<t}(t))throw ES(t,"Integer");return t.toString()}function xS(t,e){if(t<0)return-xS(-t,e);const r=Math.pow(10,e);if(Math.abs(t*r%1-.5)<Number.EPSILON){const e=Math.floor(t*r);return(e%2===0?e:e+1)/r}return Math.round(t*r)/r}function IS(t){const e=xS(t,3);if(Math.floor(Math.abs(e)).toString().length>12)throw ES(t,"Decimal");const r=e.toString();return r.includes(".")?r:"".concat(r,".0")}const RS=/[\x00-\x1f\x7f]+/;function LS(t){const e=(r=t).description||r.toString().slice(7,-1);var r;if(!1===/^([a-zA-Z*])([!#$%&'*+\-.^_`|~\w:/]*)$/.test(e))throw ES(e,"Token");return e}function PS(t){switch(typeof t){case"number":if(!ny(t))throw ES(t,TS);return Number.isInteger(t)?AS(t):IS(t);case"string":return function(t){if(RS.test(t))throw ES(t,"String");return'"'.concat(t.replace(/\\/g,"\\\\").replace(/"/g,'\\"'),'"')}(t);case"symbol":return LS(t);case"boolean":return function(t){if("boolean"!==typeof t)throw ES(t,"Boolean");return t?"?1":"?0"}(t);case"object":if(t instanceof Date)return function(t){return"@".concat(AS(t.getTime()/1e3))}(t);if(t instanceof Uint8Array)return kS(t);if(t instanceof SS)return LS(t);default:throw ES(t,TS)}}function CS(t){if(!1===/^[a-z*][a-z0-9\-_.*]*$/.test(t))throw ES(t,"Key");return t}function MS(t){return null==t?"":Object.entries(t).map(t=>{let[e,r]=t;return!0===r?";".concat(CS(e)):";".concat(CS(e),"=").concat(PS(r))}).join("")}function OS(t){return t instanceof _S?"".concat(PS(t.value)).concat(MS(t.params)):PS(t)}function DS(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{whitespace:!0};if("object"!==typeof t||null==t)throw ES(t,"Dict");const r=t instanceof Map?t.entries():Object.entries(t),n=(null===e||void 0===e?void 0:e.whitespace)?" ":"";return Array.from(r).map(t=>{let[e,r]=t;r instanceof _S===!1&&(r=new _S(r));let n=CS(e);var i;return!0===r.value?n+=MS(r.params):(n+="=",Array.isArray(r.value)?n+="(".concat((i=r).value.map(OS).join(" "),")").concat(MS(i.params)):n+=OS(r)),n}).join(",".concat(n))}function NS(t,e){return DS(t,e)}const FS="CMCD-Object",US="CMCD-Request",BS="CMCD-Session",jS="CMCD-Status",zS={br:FS,ab:FS,d:FS,ot:FS,tb:FS,tpb:FS,lb:FS,tab:FS,lab:FS,url:FS,pb:US,bl:US,tbl:US,dl:US,ltc:US,mtp:US,nor:US,nrr:US,rc:US,sn:US,sta:US,su:US,ttfb:US,ttfbb:US,ttlb:US,cmsdd:US,cmsds:US,smrt:US,df:US,cs:US,ts:US,cid:BS,pr:BS,sf:BS,sid:BS,st:BS,v:BS,msd:BS,bs:jS,bsd:jS,cdn:jS,rtp:jS,bg:jS,pt:jS,ec:jS,e:jS},WS=US;function GS(t,e){const r={};if(!t)return r;const n=Object.keys(t),i=e?(s=e,Object.keys(s).reduce((t,e)=>{var r;return null===(r=s[e])||void 0===r||r.forEach(r=>t[r]=e),t},{})):{};var s;return n.reduce((e,r)=>{var n;const s=zS[r]||i[r]||WS;return(null!==(n=e[s])&&void 0!==n?n:e[s]={})[r]=t[r],e},r)}const VS="event";const HS=t=>Math.round(t),KS=(t,e)=>Array.isArray(t)?t.map(t=>KS(t,e)):t instanceof _S&&"string"===typeof t.value?new _S(KS(t.value,e),t.params):(e.baseUrl&&(t=function(t,e){const r=new URL(t),n=new URL(e);if(r.origin!==n.origin)return t;const i=r.pathname.split("/").slice(1),s=n.pathname.split("/").slice(1,-1);for(;i[0]===s[0];)i.shift(),s.shift();for(;s.length;)s.shift(),i.unshift("..");return i.join("/")+r.search+r.hash}(t,e.baseUrl)),1===e.version?encodeURIComponent(t):t),qS=t=>100*HS(t/100),YS={br:HS,d:HS,bl:qS,dl:qS,mtp:qS,nor:(t,e)=>{let r=t;return e.version>=2&&(t instanceof _S&&"string"===typeof t.value?r=new _S([t]):"string"===typeof t&&(r=[t])),KS(r,e)},rtp:qS,tb:HS},QS="request",XS="response",$S=["ab","bg","bl","br","bs","bsd","cdn","cid","cs","df","ec","lab","lb","ltc","msd","mtp","pb","pr","pt","sf","sid","sn","st","sta","tab","tb","tbl","tpb","ts","v"],ZS=["e"],JS=/^[a-zA-Z0-9-.]+-[a-zA-Z0-9-.]+$/;function tT(t){return JS.test(t)}const eT=["d","dl","nor","ot","rtp","su"];const rT=["cmsdd","cmsds","rc","smrt","ttfb","ttfbb","ttlb","url"];const nT=["bl","br","bs","cid","d","dl","mtp","nor","nrr","ot","pr","rtp","sf","sid","st","su","tb","v"];function iT(t){return nT.includes(t)||tT(t)}const sT={[XS]:function(t){return $S.includes(t)||eT.includes(t)||rT.includes(t)||tT(t)},[VS]:function(t){return $S.includes(t)||ZS.includes(t)||tT(t)},[QS]:function(t){return $S.includes(t)||eT.includes(t)||tT(t)}};function aT(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const r={};if(null==t||"object"!==typeof t)return r;const n=e.version||t.v||1,i=e.reportingMode||QS,s=1===n?iT:sT[i];let a=Object.keys(t).filter(s);const o=e.filter;"function"===typeof o&&(a=a.filter(o));const l=i===XS||i===VS;l&&!a.includes("ts")&&a.push("ts"),n>1&&!a.includes("v")&&a.push("v");const c=by({},YS,e.formatters),u={version:n,reportingMode:i,baseUrl:e.baseUrl};return a.sort().forEach(e=>{let i=t[e];const s=c[e];if("function"===typeof s&&(i=s(i,u)),"v"===e){if(1===n)return;i=n}"pr"==e&&1===i||(l&&"ts"===e&&!ny(i)&&(i=Date.now()),function(t){return"number"===typeof t?ny(t):null!=t&&""!==t&&!1!==t}(i)&&(function(t){return["ot","sf","st","e","sta"].includes(t)}(e)&&"string"===typeof i&&(i=new SS(i)),r[e]=i))}),r}function oT(t,e,r){return by(t,function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const r={};if(!t)return r;const n=GS(aT(t,e),null===e||void 0===e?void 0:e.customHeaderMap);return Object.entries(n).reduce((t,e)=>{let[r,n]=e;const i=NS(n,{whitespace:!1});return i&&(t[r]=i),t},r)}(e,r))}function lT(t){if(!t)return"";const e=function(t){return t?NS(aT(t,arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}),{whitespace:!1}):""}(t,arguments.length>1&&void 0!==arguments[1]?arguments[1]:{});return encodeURIComponent(e)}const cT=/CMCD=[^&#]+/;function uT(t,e,r){const n=function(t){if(!t)return"";const e=lT(t,arguments.length>1&&void 0!==arguments[1]?arguments[1]:{});return"".concat("CMCD","=").concat(e)}(e,r);if(!n)return t;if(cT.test(t))return t.replace(cT,n);const i=t.includes("?")?"&":"?";return"".concat(t).concat(i).concat(n)}function hT(t,e,r,n){t&&Object.keys(e).forEach(i=>{const s=t.filter(t=>t.groupId===i).map(t=>{const s=by({},t);return s.details=void 0,s.attrs=new s_(s.attrs),s.url=s.attrs.URI=dT(t.url,t.attrs["STABLE-RENDITION-ID"],"PER-RENDITION-URIS",r),s.groupId=s.attrs["GROUP-ID"]=e[i],s.attrs["PATHWAY-ID"]=n,s});t.push(...s)})}function dT(t,e,r,n){const{HOST:i,PARAMS:s,[r]:a}=n;let o;e&&(o=null==a?void 0:a[e],o&&(t=o));const l=new self.URL(t);return i&&!o&&(l.host=i),s&&Object.keys(s).sort().forEach(t=>{t&&l.searchParams.set(t,s[t])}),l.href}class fT extends Ey{constructor(t){super("eme",t.logger),this.hls=void 0,this.config=void 0,this.media=null,this.mediaResolved=void 0,this.keyFormatPromise=null,this.keySystemAccessPromises={},this._requestLicenseFailureCount=0,this.mediaKeySessions=[],this.keyIdToKeySessionPromise={},this.mediaKeys=null,this.setMediaKeysQueue=fT.CDMCleanupPromise?[fT.CDMCleanupPromise]:[],this.bannedKeyIds={},this.onMediaEncrypted=t=>{const{initDataType:e,initData:r}=t,n='"'.concat(t.type,'" event: init data type: "').concat(e,'"');if(this.debug(n),null!==r){if(!this.keyFormatPromise){let t=Object.keys(this.keySystemAccessPromises);t.length||(t=A_(this.config));const e=t.map(k_).filter(t=>!!t);this.keyFormatPromise=this.getKeyFormatPromise(e)}this.keyFormatPromise.then(i=>{const s=T_(i);if("sinf"!==e||s!==b_.FAIRPLAY)return void this.log('Ignoring "'.concat(t.type,'" event with init data type: "').concat(e,'" for selected key-system ').concat(s));let a;try{const t=Xy(new Uint8Array(r)),e=uv(p_(JSON.parse(t).sinf));if(!e)throw new Error("'schm' box missing or not cbcs/cenc with schi > tenc");a=new Uint8Array(e.subarray(8,24))}catch(cg){return void this.warn("".concat(n," Failed to parse sinf: ").concat(cg))}const o=Cy(a),{keyIdToKeySessionPromise:l,mediaKeySessions:c}=this;let u=l[o];for(let t=0;t<c.length;t++){const n=c[t],i=n.decryptdata;if(!i.keyId)continue;const s=Cy(i.keyId);if(u_(a,i.keyId)||-1!==i.uri.replace(/-/g,"").indexOf(o)){if(u=l[s],!u)continue;if(i.pssh)break;delete l[s],i.pssh=new Uint8Array(r),i.keyId=a,u=l[o]=u.then(()=>this.generateRequestWithPreferredKeySession(n,e,r,"encrypted-event-key-match")),u.catch(t=>this.handleError(t));break}}u||this.handleError(new Error("Key ID ".concat(o," not encountered in playlist. Key-system sessions ").concat(c.length,".")))}).catch(t=>this.handleError(t))}},this.onWaitingForKey=t=>{this.log('"'.concat(t.type,'" event'))},this.hls=t,this.config=t.config,this.registerListeners()}destroy(){this.onDestroying(),this.onMediaDetached();const t=this.config;t.requestMediaKeySystemAccessFunc=null,t.licenseXhrSetup=t.licenseResponseCallback=void 0,t.drmSystems=t.drmSystemOptions={},this.hls=this.config=this.keyIdToKeySessionPromise=null,this.onMediaEncrypted=this.onWaitingForKey=null}registerListeners(){this.hls.on(ly.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(ly.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.on(ly.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.on(ly.MANIFEST_LOADED,this.onManifestLoaded,this),this.hls.on(ly.DESTROYING,this.onDestroying,this)}unregisterListeners(){this.hls.off(ly.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.off(ly.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.off(ly.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.off(ly.MANIFEST_LOADED,this.onManifestLoaded,this),this.hls.off(ly.DESTROYING,this.onDestroying,this)}getLicenseServerUrl(t){const{drmSystems:e,widevineLicenseUrl:r}=this.config,n=null==e?void 0:e[t];return n?n.licenseUrl:t===b_.WIDEVINE&&r?r:void 0}getLicenseServerUrlOrThrow(t){const e=this.getLicenseServerUrl(t);if(void 0===e)throw new Error('no license server URL configured for key-system "'.concat(t,'"'));return e}getServerCertificateUrl(t){const{drmSystems:e}=this.config,r=null==e?void 0:e[t];if(r)return r.serverCertificateUrl;this.log('No Server Certificate in config.drmSystems["'.concat(t,'"]'))}attemptKeySystemAccess(t){const e=this.hls.levels,r=(t,e,r)=>!!t&&r.indexOf(t)===e,n=e.map(t=>t.audioCodec).filter(r),i=e.map(t=>t.videoCodec).filter(r);return n.length+i.length===0&&i.push("avc1.42e01e"),new Promise((e,r)=>{const s=t=>{const a=t.shift();this.getMediaKeysPromise(a,n,i).then(t=>e({keySystem:a,mediaKeys:t})).catch(e=>{t.length?s(t):r(e instanceof mT?e:new mT({type:ay.KEY_SYSTEM_ERROR,details:oy.KEY_SYSTEM_NO_ACCESS,error:e,fatal:!0},e.message))})};s(t)})}requestMediaKeySystemAccess(t,e){const{requestMediaKeySystemAccessFunc:r}=this.config;if("function"!==typeof r){let t="Configured requestMediaKeySystemAccess is not a function ".concat(r);return null===x_&&"http:"===self.location.protocol&&(t="navigator.requestMediaKeySystemAccess is not available over insecure protocol ".concat(location.protocol)),Promise.reject(new Error(t))}return r(t,e)}getMediaKeysPromise(t,e,r){var n;const i=function(t,e,r,n){let i;switch(t){case b_.FAIRPLAY:i=["cenc","sinf"];break;case b_.WIDEVINE:case b_.PLAYREADY:i=["cenc"];break;case b_.CLEARKEY:i=["cenc","keyids"];break;default:throw new Error("Unknown key-system: ".concat(t))}return function(t,e,r,n){return[{initDataTypes:t,persistentState:n.persistentState||"optional",distinctiveIdentifier:n.distinctiveIdentifier||"optional",sessionTypes:n.sessionTypes||[n.sessionType||"temporary"],audioCapabilities:e.map(t=>({contentType:"audio/mp4; codecs=".concat(t),robustness:n.audioRobustness||"",encryptionScheme:n.audioEncryptionScheme||null})),videoCapabilities:r.map(t=>({contentType:"video/mp4; codecs=".concat(t),robustness:n.videoRobustness||"",encryptionScheme:n.videoEncryptionScheme||null}))}]}(i,e,r,n)}(t,e,r,this.config.drmSystemOptions||{});let s=this.keySystemAccessPromises[t],a=null==(n=s)?void 0:n.keySystemAccess;if(!a){this.log('Requesting encrypted media "'.concat(t,'" key-system access with config: ').concat(Zv(i))),a=this.requestMediaKeySystemAccess(t,i);const e=s=this.keySystemAccessPromises[t]={keySystemAccess:a};return a.catch(e=>{this.log('Failed to obtain access to key-system "'.concat(t,'": ').concat(e))}),a.then(r=>{this.log('Access for key-system "'.concat(r.keySystem,'" obtained'));const n=this.fetchServerCertificate(t);this.log('Create media-keys for "'.concat(t,'"'));const i=e.mediaKeys=r.createMediaKeys().then(r=>(this.log('Media-keys created for "'.concat(t,'"')),e.hasMediaKeys=!0,n.then(e=>e?this.setMediaKeysServerCertificate(r,t,e):r)));return i.catch(e=>{this.error('Failed to create media-keys for "'.concat(t,'"}: ').concat(e))}),i})}return a.then(()=>s.mediaKeys)}createMediaKeySessionContext(t){let{decryptdata:e,keySystem:r,mediaKeys:n}=t;this.log('Creating key-system session "'.concat(r,'" keyId: ').concat(Cy(e.keyId||[])," keyUri: ").concat(e.uri));const i=n.createSession(),s={decryptdata:e,keySystem:r,mediaKeys:n,mediaKeysSession:i,keyStatus:"status-pending"};return this.mediaKeySessions.push(s),s}renewKeySession(t){const e=t.decryptdata;if(e.pssh){const r=this.createMediaKeySessionContext(t),n=pT(e),i="cenc";this.keyIdToKeySessionPromise[n]=this.generateRequestWithPreferredKeySession(r,i,e.pssh.buffer,"expired")}else this.warn("Could not renew expired session. Missing pssh initData.");this.removeSession(t)}updateKeySession(t,e){const r=t.mediaKeysSession;return this.log('Updating key-session "'.concat(r.sessionId,'" for keyId ').concat(Cy(t.decryptdata.keyId||[]),"\n      } (data length: ").concat(e.byteLength,")")),r.update(e)}getSelectedKeySystemFormats(){return Object.keys(this.keySystemAccessPromises).map(t=>({keySystem:t,hasMediaKeys:this.keySystemAccessPromises[t].hasMediaKeys})).filter(t=>{let{hasMediaKeys:e}=t;return!!e}).map(t=>{let{keySystem:e}=t;return k_(e)}).filter(t=>!!t)}getKeySystemAccess(t){return this.getKeySystemSelectionPromise(t).then(t=>{let{keySystem:e,mediaKeys:r}=t;return this.attemptSetMediaKeys(e,r)})}selectKeySystem(t){return new Promise((e,r)=>{this.getKeySystemSelectionPromise(t).then(t=>{let{keySystem:n}=t;const i=k_(n);i?e(i):r(new Error('Unable to find format for key-system "'.concat(n,'"')))}).catch(r)})}selectKeySystemFormat(t){const e=Object.keys(t.levelkeys||{});return this.keyFormatPromise||(this.log("Selecting key-system from fragment (sn: ".concat(t.sn," ").concat(t.type,": ").concat(t.level,") key formats ").concat(e.join(", "))),this.keyFormatPromise=this.getKeyFormatPromise(e)),this.keyFormatPromise}getKeyFormatPromise(t){const e=A_(this.config),r=t.map(T_).filter(t=>!!t&&-1!==e.indexOf(t));return this.selectKeySystem(r)}getKeyStatus(t){const{mediaKeySessions:e}=this;for(let r=0;r<e.length;r++){const n=gT(t,e[r]);if(n)return n}}loadKey(t){const e=t.keyInfo.decryptdata,r=pT(e),n=this.bannedKeyIds[r];if(n||"internal-error"===this.getKeyStatus(e)){const r=yT(n||"internal-error",e);return this.handleError(r,t.frag),Promise.reject(r)}const i="(keyId: ".concat(r,' format: "').concat(e.keyFormat,'" method: ').concat(e.method," uri: ").concat(e.uri,")");this.log("Starting session for key ".concat(i));const s=this.keyIdToKeySessionPromise[r];if(!s){const n=this.getKeySystemForKeyPromise(e).then(r=>{let{keySystem:n,mediaKeys:s}=r;return this.throwIfDestroyed(),this.log("Handle encrypted media sn: ".concat(t.frag.sn," ").concat(t.frag.type,": ").concat(t.frag.level," using key ").concat(i)),this.attemptSetMediaKeys(n,s).then(()=>(this.throwIfDestroyed(),this.createMediaKeySessionContext({keySystem:n,mediaKeys:s,decryptdata:e})))}).then(t=>{const r=e.pssh?e.pssh.buffer:null;return this.generateRequestWithPreferredKeySession(t,"cenc",r,"playlist-key")});return n.catch(e=>this.handleError(e,t.frag)),this.keyIdToKeySessionPromise[r]=n,n}return s.catch(r=>{if(r instanceof mT){const n=wy({},r.data);"internal-error"===this.getKeyStatus(e)&&(n.decryptdata=e);const i=new mT(n,r.message);this.handleError(i,t.frag)}}),s}throwIfDestroyed(){if(!this.hls)throw new Error("invalid state")}handleError(t,e){if(this.hls)if(t instanceof mT){e&&(t.data.frag=e);const r=t.data.decryptdata;this.error("".concat(t.message).concat(r?" (".concat(Cy(r.keyId||[]),")"):"")),this.hls.trigger(ly.ERROR,t.data)}else this.error(t.message),this.hls.trigger(ly.ERROR,{type:ay.KEY_SYSTEM_ERROR,details:oy.KEY_SYSTEM_NO_KEYS,error:t,fatal:!0})}getKeySystemForKeyPromise(t){const e=pT(t),r=this.keyIdToKeySessionPromise[e];if(!r){const e=T_(t.keyFormat),r=e?[e]:A_(this.config);return this.attemptKeySystemAccess(r)}return r}getKeySystemSelectionPromise(t){if(t.length||(t=A_(this.config)),0===t.length)throw new mT({type:ay.KEY_SYSTEM_ERROR,details:oy.KEY_SYSTEM_NO_CONFIGURED_LICENSE,fatal:!0},"Missing key-system license configuration options ".concat(Zv({drmSystems:this.config.drmSystems})));return this.attemptKeySystemAccess(t)}attemptSetMediaKeys(t,e){if(this.mediaResolved=void 0,this.mediaKeys===e)return Promise.resolve();const r=this.setMediaKeysQueue.slice();this.log('Setting media-keys for "'.concat(t,'"'));const n=Promise.all(r).then(()=>this.media?this.media.setMediaKeys(e):new Promise((t,r)=>{this.mediaResolved=()=>{if(this.mediaResolved=void 0,!this.media)return r(new Error("Attempted to set mediaKeys without media element attached"));this.mediaKeys=e,this.media.setMediaKeys(e).then(t).catch(r)}}));return this.mediaKeys=e,this.setMediaKeysQueue.push(n),n.then(()=>{this.log('Media-keys set for "'.concat(t,'"')),r.push(n),this.setMediaKeysQueue=this.setMediaKeysQueue.filter(t=>-1===r.indexOf(t))})}generateRequestWithPreferredKeySession(t,e,r,n){var i;const s=null==(i=this.config.drmSystems)||null==(i=i[t.keySystem])?void 0:i.generateRequest;if(s)try{const n=s.call(this.hls,e,r,t);if(!n)throw new Error("Invalid response from configured generateRequest filter");e=n.initDataType,r=n.initData?n.initData:null,t.decryptdata.pssh=r?new Uint8Array(r):null}catch(cg){if(this.warn(cg.message),this.hls&&this.hls.config.debug)throw cg}if(null===r)return this.log('Skipping key-session request for "'.concat(n,'" (no initData)')),Promise.resolve(t);const a=pT(t.decryptdata),o=t.decryptdata.uri;this.log('Generating key-session request for "'.concat(n,'" keyId: ').concat(a," URI: ").concat(o," (init data type: ").concat(e," length: ").concat(r.byteLength,")"));const l=new Dw,c=t._onmessage=e=>{const r=t.mediaKeysSession;if(!r)return void l.emit("error",new Error("invalid state"));const{messageType:n,message:i}=e;this.log('"'.concat(n,'" message event for session "').concat(r.sessionId,'" message size: ').concat(i.byteLength)),"license-request"===n||"license-renewal"===n?this.renewLicense(t,i).catch(t=>{l.eventNames().length?l.emit("error",t):this.handleError(t)}):"license-release"===n?t.keySystem===b_.FAIRPLAY&&this.updateKeySession(t,g_("acknowledged")).then(()=>this.removeSession(t)).catch(t=>this.handleError(t)):this.warn('unhandled media key message type "'.concat(n,'"'))},u=(t,e)=>{let r;e.keyStatus=t,t.startsWith("usable")?l.emit("resolved"):"internal-error"===t||"output-restricted"===t||"output-downscaled"===t?r=yT(t,e.decryptdata):"expired"===t?r=new Error("key expired (keyId: ".concat(a,")")):"released"===t?r=new Error("key released"):"status-pending"===t||this.warn('unhandled key status change "'.concat(t,'" (keyId: ').concat(a,")")),r&&(l.eventNames().length?l.emit("error",r):this.handleError(r))},h=t._onkeystatuseschange=e=>{if(!t.mediaKeysSession)return void l.emit("error",new Error("invalid state"));const r=this.getKeyStatuses(t);if(!Object.keys(r).some(t=>"status-pending"!==r[t]))return;if("expired"===r[a])return this.log("Expired key ".concat(Zv(r),' in key-session "').concat(t.mediaKeysSession.sessionId,'"')),void this.renewKeySession(t);let n=r[a];if(n)u(n,t);else{var i;const e=1e3;t.keyStatusTimeouts||(t.keyStatusTimeouts={}),(i=t.keyStatusTimeouts)[a]||(i[a]=self.setTimeout(()=>{if(!t.mediaKeysSession||!this.mediaKeys)return;const r=this.getKeyStatus(t.decryptdata);if(r&&"status-pending"!==r)return this.log("No status for keyId ".concat(a,' in key-session "').concat(t.mediaKeysSession.sessionId,'". Using session key-status ').concat(r," from other session.")),u(r,t);this.log("key status for ".concat(a,' in key-session "').concat(t.mediaKeysSession.sessionId,'" timed out after ').concat(e,"ms")),n="internal-error",u(n,t)},e)),this.log("No status for keyId ".concat(a," (").concat(Zv(r),")."))}};pw(t.mediaKeysSession,"message",c),pw(t.mediaKeysSession,"keystatuseschange",h);const d=new Promise((t,e)=>{l.on("error",e),l.on("resolved",t)});return t.mediaKeysSession.generateRequest(e,r).then(()=>{this.log('Request generated for key-session "'.concat(t.mediaKeysSession.sessionId,'" keyId: ').concat(a," URI: ").concat(o))}).catch(e=>{throw new mT({type:ay.KEY_SYSTEM_ERROR,details:oy.KEY_SYSTEM_NO_SESSION,error:e,decryptdata:t.decryptdata,fatal:!1},"Error generating key-session request: ".concat(e))}).then(()=>d).catch(e=>(l.removeAllListeners(),this.removeSession(t).then(()=>{throw e}))).then(()=>(l.removeAllListeners(),t))}getKeyStatuses(t){const e={};return t.mediaKeysSession.keyStatuses.forEach((r,n)=>{if("string"===typeof n&&"object"===typeof r){const t=n;n=r,r=t}const i="buffer"in n?new Uint8Array(n.buffer,n.byteOffset,n.byteLength):new Uint8Array(n);if(t.keySystem===b_.PLAYREADY&&16===i.length){const t=Cy(i);e[t]=r,m_(i)}const s=Cy(i);"internal-error"===r&&(this.bannedKeyIds[s]=r),this.log('key status change "'.concat(r,'" for keyStatuses keyId: ').concat(s,' key-session "').concat(t.mediaKeysSession.sessionId,'"')),e[s]=r}),e}fetchServerCertificate(t){const e=this.config,r=new(0,e.loader)(e),n=this.getServerCertificateUrl(t);return n?(this.log('Fetching server certificate for "'.concat(t,'"')),new Promise((i,s)=>{const a={responseType:"arraybuffer",url:n},o=e.certLoadPolicy.default,l={loadPolicy:o,timeout:o.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},c={onSuccess:(t,e,r,n)=>{i(t.data)},onError:(e,r,i,o)=>{s(new mT({type:ay.KEY_SYSTEM_ERROR,details:oy.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED,fatal:!0,networkDetails:i,response:wy({url:a.url,data:void 0},e)},'"'.concat(t,'" certificate request failed (').concat(n,"). Status: ").concat(e.code," (").concat(e.text,")")))},onTimeout:(e,r,i)=>{s(new mT({type:ay.KEY_SYSTEM_ERROR,details:oy.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED,fatal:!0,networkDetails:i,response:{url:a.url,data:void 0}},'"'.concat(t,'" certificate request timed out (').concat(n,")")))},onAbort:(t,e,r)=>{s(new Error("aborted"))}};r.load(a,l,c)})):Promise.resolve()}setMediaKeysServerCertificate(t,e,r){return new Promise((n,i)=>{t.setServerCertificate(r).then(i=>{this.log("setServerCertificate ".concat(i?"success":"not supported by CDM"," (").concat(r.byteLength,') on "').concat(e,'"')),n(t)}).catch(t=>{i(new mT({type:ay.KEY_SYSTEM_ERROR,details:oy.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED,error:t,fatal:!0},t.message))})})}renewLicense(t,e){return this.requestLicense(t,new Uint8Array(e)).then(e=>this.updateKeySession(t,new Uint8Array(e)).catch(e=>{throw new mT({type:ay.KEY_SYSTEM_ERROR,details:oy.KEY_SYSTEM_SESSION_UPDATE_FAILED,decryptdata:t.decryptdata,error:e,fatal:!1},e.message)}))}unpackPlayReadyKeyMessage(t,e){const r=String.fromCharCode.apply(null,new Uint16Array(e.buffer));if(!r.includes("PlayReadyKeyMessage"))return t.setRequestHeader("Content-Type","text/xml; charset=utf-8"),e;const n=(new DOMParser).parseFromString(r,"application/xml"),i=n.querySelectorAll("HttpHeader");if(i.length>0){let e;for(let r=0,n=i.length;r<n;r++){var s,a;e=i[r];const n=null==(s=e.querySelector("name"))?void 0:s.textContent,o=null==(a=e.querySelector("value"))?void 0:a.textContent;n&&o&&t.setRequestHeader(n,o)}}const o=n.querySelector("Challenge"),l=null==o?void 0:o.textContent;if(!l)throw new Error("Cannot find <Challenge> in key message");return g_(atob(l))}setupLicenseXHR(t,e,r,n){const i=this.config.licenseXhrSetup;return i?Promise.resolve().then(()=>{if(!r.decryptdata)throw new Error("Key removed");return i.call(this.hls,t,e,r,n)}).catch(s=>{if(!r.decryptdata)throw s;return t.open("POST",e,!0),i.call(this.hls,t,e,r,n)}).then(r=>{t.readyState||t.open("POST",e,!0);return{xhr:t,licenseChallenge:r||n}}):(t.open("POST",e,!0),Promise.resolve({xhr:t,licenseChallenge:n}))}requestLicense(t,e){const r=this.config.keyLoadPolicy.default;return new Promise((n,i)=>{const s=this.getLicenseServerUrlOrThrow(t.keySystem);this.log("Sending license request to URL: ".concat(s));const a=new XMLHttpRequest;a.responseType="arraybuffer",a.onreadystatechange=()=>{if(!this.hls||!t.mediaKeysSession)return i(new Error("invalid state"));if(4===a.readyState)if(200===a.status){this._requestLicenseFailureCount=0;let e=a.response;this.log("License received ".concat(e instanceof ArrayBuffer?e.byteLength:e));const r=this.config.licenseResponseCallback;if(r)try{e=r.call(this.hls,a,s,t)}catch(cg){this.error(cg)}n(e)}else{const o=r.errorRetry,l=o?o.maxNumRetry:0;if(this._requestLicenseFailureCount++,this._requestLicenseFailureCount>l||a.status>=400&&a.status<500)i(new mT({type:ay.KEY_SYSTEM_ERROR,details:oy.KEY_SYSTEM_LICENSE_REQUEST_FAILED,decryptdata:t.decryptdata,fatal:!0,networkDetails:a,response:{url:s,data:void 0,code:a.status,text:a.statusText}},"License Request XHR failed (".concat(s,"). Status: ").concat(a.status," (").concat(a.statusText,")")));else{const r=l-this._requestLicenseFailureCount+1;this.warn("Retrying license request, ".concat(r," attempts left")),this.requestLicense(t,e).then(n,i)}}},t.licenseXhr&&t.licenseXhr.readyState!==XMLHttpRequest.DONE&&t.licenseXhr.abort(),t.licenseXhr=a,this.setupLicenseXHR(a,s,t,e).then(e=>{let{xhr:r,licenseChallenge:n}=e;t.keySystem==b_.PLAYREADY&&(n=this.unpackPlayReadyKeyMessage(r,n)),r.send(n)}).catch(i)})}onDestroying(){this.unregisterListeners(),this._clear()}onMediaAttached(t,e){if(!this.config.emeEnabled)return;const r=e.media;this.media=r,pw(r,"encrypted",this.onMediaEncrypted),pw(r,"waitingforkey",this.onWaitingForKey);const n=this.mediaResolved;n?n():this.mediaKeys=r.mediaKeys}onMediaDetached(){const t=this.media;t&&(gw(t,"encrypted",this.onMediaEncrypted),gw(t,"waitingforkey",this.onWaitingForKey),this.media=null,this.mediaKeys=null)}_clear(){var t;this._requestLicenseFailureCount=0,this.keyIdToKeySessionPromise={},this.bannedKeyIds={};const e=this.mediaResolved;if(e&&e(),!this.mediaKeys&&!this.mediaKeySessions.length)return;const r=this.media,n=this.mediaKeySessions.slice();this.mediaKeySessions=[],this.mediaKeys=null,P_.clearKeyUriToKeyIdMap();const i=n.length;fT.CDMCleanupPromise=Promise.all(n.map(t=>this.removeSession(t)).concat((null==r||null==(t=r.setMediaKeys(null))?void 0:t.catch(t=>{this.log("Could not clear media keys: ".concat(t)),this.hls&&this.hls.trigger(ly.ERROR,{type:ay.OTHER_ERROR,details:oy.KEY_SYSTEM_DESTROY_MEDIA_KEYS_ERROR,fatal:!1,error:new Error("Could not clear media keys: ".concat(t))})}))||Promise.resolve())).catch(t=>{this.log("Could not close sessions and clear media keys: ".concat(t)),this.hls&&this.hls.trigger(ly.ERROR,{type:ay.OTHER_ERROR,details:oy.KEY_SYSTEM_DESTROY_CLOSE_SESSION_ERROR,fatal:!1,error:new Error("Could not close sessions and clear media keys: ".concat(t))})}).then(()=>{i&&this.log("finished closing key sessions and clearing media keys")})}onManifestLoading(){this._clear()}onManifestLoaded(t,e){let{sessionKeys:r}=e;if(r&&this.config.emeEnabled&&!this.keyFormatPromise){const t=r.reduce((t,e)=>(-1===t.indexOf(e.keyFormat)&&t.push(e.keyFormat),t),[]);this.log("Selecting key-system from session-keys ".concat(t.join(", "))),this.keyFormatPromise=this.getKeyFormatPromise(t)}}removeSession(t){const{mediaKeysSession:e,licenseXhr:r,decryptdata:n}=t;if(e){this.log('Remove licenses and keys and close session "'.concat(e.sessionId,'" keyId: ').concat(Cy((null==n?void 0:n.keyId)||[]))),t._onmessage&&(e.removeEventListener("message",t._onmessage),t._onmessage=void 0),t._onkeystatuseschange&&(e.removeEventListener("keystatuseschange",t._onkeystatuseschange),t._onkeystatuseschange=void 0),r&&r.readyState!==XMLHttpRequest.DONE&&r.abort(),t.mediaKeysSession=t.decryptdata=t.licenseXhr=void 0;const i=this.mediaKeySessions.indexOf(t);i>-1&&this.mediaKeySessions.splice(i,1);const{keyStatusTimeouts:s}=t;s&&Object.keys(s).forEach(t=>self.clearTimeout(s[t]));const{drmSystemOptions:a}=this.config,o=function(t){var e;return!!t&&("persistent-license"===t.sessionType||!(null==(e=t.sessionTypes)||!e.some(t=>"persistent-license"===t)))}(a)?new Promise((t,r)=>{self.setTimeout(()=>r(new Error("MediaKeySession.remove() timeout")),8e3),e.remove().then(t).catch(r)}):Promise.resolve();return o.catch(t=>{this.log("Could not remove session: ".concat(t)),this.hls&&this.hls.trigger(ly.ERROR,{type:ay.OTHER_ERROR,details:oy.KEY_SYSTEM_DESTROY_REMOVE_SESSION_ERROR,fatal:!1,error:new Error("Could not remove session: ".concat(t))})}).then(()=>e.close()).catch(t=>{this.log("Could not close session: ".concat(t)),this.hls&&this.hls.trigger(ly.ERROR,{type:ay.OTHER_ERROR,details:oy.KEY_SYSTEM_DESTROY_CLOSE_SESSION_ERROR,fatal:!1,error:new Error("Could not close session: ".concat(t))})})}return Promise.resolve()}}function pT(t){if(!t)throw new Error("Could not read keyId of undefined decryptdata");if(null===t.keyId)throw new Error("keyId is null");return Cy(t.keyId)}function gT(t,e){return t.keyId&&e.mediaKeysSession.keyStatuses.has(t.keyId)?e.mediaKeysSession.keyStatuses.get(t.keyId):t.matches(e.decryptdata)?e.keyStatus:void 0}fT.CDMCleanupPromise=void 0;class mT extends Error{constructor(t,e){super(e),this.data=void 0,t.error||(t.error=new Error(e)),this.data=t,t.err=t.error}}function yT(t,e){const r="output-restricted"===t,n=r?oy.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED:oy.KEY_SYSTEM_STATUS_INTERNAL_ERROR;return new mT({type:ay.KEY_SYSTEM_ERROR,details:n,fatal:!1,decryptdata:e},r?"HDCP level output restricted":'key status changed to "'.concat(t,'"'))}function vT(t,e){let r;try{r=new Event("addtrack")}catch(Dd){r=document.createEvent("Event"),r.initEvent("addtrack",!1,!1)}r.track=t,e.dispatchEvent(r)}function bT(t,e){const r=t.mode;if("disabled"===r&&(t.mode="hidden"),t.cues&&!t.cues.getCueById(e.id))try{if(t.addCue(e),!t.cues.getCueById(e.id))throw new Error("addCue is failed for: ".concat(e))}catch(Dd){Iy.debug("[texttrack-utils]: ".concat(Dd));try{const r=new self.TextTrackCue(e.startTime,e.endTime,e.text);r.id=e.id,t.addCue(r)}catch(n){Iy.debug("[texttrack-utils]: Legacy TextTrackCue fallback failed: ".concat(n))}}"disabled"===r&&(t.mode=r)}function _T(t,e){const r=t.mode;if("disabled"===r&&(t.mode="hidden"),t.cues)for(let n=t.cues.length;n--;)e&&t.cues[n].removeEventListener("enter",e),t.removeCue(t.cues[n]);"disabled"===r&&(t.mode=r)}function wT(t,e,r,n){const i=t.mode;if("disabled"===i&&(t.mode="hidden"),t.cues&&t.cues.length>0){const i=function(t,e,r){const n=[],i=function(t,e){if(e<=t[0].startTime)return 0;const r=t.length-1;if(e>t[r].endTime)return-1;let n,i=0,s=r;for(;i<=s;)if(n=Math.floor((s+i)/2),e<t[n].startTime)s=n-1;else{if(!(e>t[n].startTime&&i<r))return n;i=n+1}return t[i].startTime-e<e-t[s].startTime?i:s}(t,e);if(i>-1)for(let s=i,a=t.length;s<a;s++){const i=t[s];if(i.startTime>=e&&i.endTime<=r)n.push(i);else if(i.startTime>r)return n}return n}(t.cues,e,r);for(let e=0;e<i.length;e++)n&&!n(i[e])||t.removeCue(i[e])}"disabled"===i&&(t.mode=i)}function ET(t){const e=[];for(let r=0;r<t.length;r++){const n=t[r];"subtitles"!==n.kind&&"captions"!==n.kind||!n.label||e.push(t[r])}return e}function ST(t){let e=5381,r=t.length;for(;r;)e=33*e^t.charCodeAt(--r);return(e>>>0).toString()}const TT=.025;let kT=function(t){return t[t.Point=0]="Point",t[t.Range=1]="Range",t}({});function AT(t,e,r){return"".concat(t.identifier,"-").concat(r+1,"-").concat(ST(e))}class xT{constructor(t,e){this.base=void 0,this._duration=null,this._timelineStart=null,this.appendInPlaceDisabled=void 0,this.appendInPlaceStarted=void 0,this.dateRange=void 0,this.hasPlayed=!1,this.cumulativeDuration=0,this.resumeOffset=NaN,this.playoutLimit=NaN,this.restrictions={skip:!1,jump:!1},this.snapOptions={out:!1,in:!1},this.assetList=[],this.assetListLoader=void 0,this.assetListResponse=null,this.resumeAnchor=void 0,this.error=void 0,this.resetOnResume=void 0,this.base=e,this.dateRange=t,this.setDateRange(t)}setDateRange(t){this.dateRange=t,this.resumeOffset=t.attr.optionalFloat("X-RESUME-OFFSET",this.resumeOffset),this.playoutLimit=t.attr.optionalFloat("X-PLAYOUT-LIMIT",this.playoutLimit),this.restrictions=t.attr.enumeratedStringList("X-RESTRICT",this.restrictions),this.snapOptions=t.attr.enumeratedStringList("X-SNAP",this.snapOptions)}reset(){var t;this.appendInPlaceStarted=!1,null==(t=this.assetListLoader)||t.destroy(),this.assetListLoader=void 0,this.supplementsPrimary||(this.assetListResponse=null,this.assetList=[],this._duration=null)}isAssetPastPlayoutLimit(t){var e;if(t>0&&t>=this.assetList.length)return!0;const r=this.playoutLimit;if(t<=0||isNaN(r))return!1;if(0===r)return!0;return((null==(e=this.assetList[t])?void 0:e.startOffset)||0)>r}findAssetIndex(t){return this.assetList.indexOf(t)}get identifier(){return this.dateRange.id}get startDate(){return this.dateRange.startDate}get startTime(){const t=this.dateRange.startTime;if(this.snapOptions.out){const e=this.dateRange.tagAnchor;if(e)return IT(t,e)}return t}get startOffset(){return this.cue.pre?0:this.startTime}get startIsAligned(){if(0===this.startTime||this.snapOptions.out)return!0;const t=this.dateRange.tagAnchor;if(t){const e=this.dateRange.startTime;return e-IT(e,t)<.1}return!1}get resumptionOffset(){const t=this.resumeOffset,e=ny(t)?t:this.duration;return this.cumulativeDuration+e}get resumeTime(){const t=this.startOffset+this.resumptionOffset;if(this.snapOptions.in){const e=this.resumeAnchor;if(e)return IT(t,e)}return t}get appendInPlace(){return!!this.appendInPlaceStarted||!this.appendInPlaceDisabled&&!(this.cue.once||this.cue.pre||!this.startIsAligned||!(isNaN(this.playoutLimit)&&isNaN(this.resumeOffset)||this.resumeOffset&&this.duration&&Math.abs(this.resumeOffset-this.duration)<TT))}set appendInPlace(t){this.appendInPlaceStarted?this.resetOnResume=!t:this.appendInPlaceDisabled=!t}get timelineStart(){return null!==this._timelineStart?this._timelineStart:this.startTime}set timelineStart(t){this._timelineStart=t}get duration(){const t=this.playoutLimit;let e;return e=null!==this._duration?this._duration:this.dateRange.duration?this.dateRange.duration:this.dateRange.plannedDuration||0,!isNaN(t)&&t<e&&(e=t),e}set duration(t){this._duration=t}get cue(){return this.dateRange.cue}get timelineOccupancy(){return"RANGE"===this.dateRange.attr["X-TIMELINE-OCCUPIES"]?kT.Range:kT.Point}get supplementsPrimary(){return"PRIMARY"===this.dateRange.attr["X-TIMELINE-STYLE"]}get contentMayVary(){return"NO"!==this.dateRange.attr["X-CONTENT-MAY-VARY"]}get assetUrl(){return this.dateRange.attr["X-ASSET-URI"]}get assetListUrl(){return this.dateRange.attr["X-ASSET-LIST"]}get baseUrl(){return this.base.url}get assetListLoaded(){return this.assetList.length>0||null!==this.assetListResponse}toString(){return'["'.concat((t=this).identifier,'" ').concat(t.cue.pre?"<pre>":t.cue.post?"<post>":"").concat(t.timelineStart.toFixed(2),"-").concat(t.resumeTime.toFixed(2),"]");var t}}function IT(t,e){return t-e.start<e.duration/2&&!(Math.abs(t-(e.start+e.duration))<TT)?e.start:e.start+e.duration}function RT(t,e,r){const n=new self.URL(t,r);return"data:"!==n.protocol&&n.searchParams.set("_HLS_primary_id",e),n}function LT(t,e){for(;null!=(r=t.assetList[++e])&&r.error;)var r;return e}function PT(t){const e=t.timelineStart,r=t.duration||0;return'["'.concat(t.identifier,'" ').concat(e.toFixed(2),"-").concat((e+r).toFixed(2),"]")}class CT{constructor(t,e,r,n){this.hls=void 0,this.interstitial=void 0,this.assetItem=void 0,this.tracks=null,this.hasDetails=!1,this.mediaAttached=null,this._currentTime=void 0,this._bufferedEosTime=void 0,this.checkPlayout=()=>{this.reachedPlayout(this.currentTime)&&this.hls&&this.hls.trigger(ly.PLAYOUT_LIMIT_REACHED,{})};const i=this.hls=new t(e);this.interstitial=r,this.assetItem=n;const s=()=>{this.hasDetails=!0};i.once(ly.LEVEL_LOADED,s),i.once(ly.AUDIO_TRACK_LOADED,s),i.once(ly.SUBTITLE_TRACK_LOADED,s),i.on(ly.MEDIA_ATTACHING,(t,e)=>{let{media:r}=e;this.removeMediaListeners(),this.mediaAttached=r;this.interstitial.playoutLimit&&(r.addEventListener("timeupdate",this.checkPlayout),this.appendInPlace&&i.on(ly.BUFFER_APPENDED,()=>{const t=this.bufferedEnd;this.reachedPlayout(t)&&(this._bufferedEosTime=t,i.trigger(ly.BUFFERED_TO_END,void 0))}))})}get appendInPlace(){return this.interstitial.appendInPlace}loadSource(){const t=this.hls;if(t)if(t.url)t.levels.length&&!t.started&&t.startLoad(-1,!0);else{let e=this.assetItem.uri;try{e=RT(e,t.config.primarySessionId||"").href}catch(cg){}t.loadSource(e)}}bufferedInPlaceToEnd(t){var e;if(!this.appendInPlace)return!1;if(null!=(e=this.hls)&&e.bufferedToEnd)return!0;if(!t)return!1;const r=Math.min(this._bufferedEosTime||1/0,this.duration),n=this.timelineOffset,i=$b.bufferInfo(t,n,0);return this.getAssetTime(i.end)>=r-.02}reachedPlayout(t){const e=this.interstitial.playoutLimit;return this.startOffset+t>=e}get destroyed(){var t;return!(null!=(t=this.hls)&&t.userConfig)}get assetId(){return this.assetItem.identifier}get interstitialId(){return this.assetItem.parentIdentifier}get media(){var t;return(null==(t=this.hls)?void 0:t.media)||null}get bufferedEnd(){const t=this.media||this.mediaAttached;if(!t)return this._bufferedEosTime?this._bufferedEosTime:this.currentTime;const e=$b.bufferInfo(t,t.currentTime,.001);return this.getAssetTime(e.end)}get currentTime(){const t=this.media||this.mediaAttached;return t?this.getAssetTime(t.currentTime):this._currentTime||0}get duration(){const t=this.assetItem.duration;if(!t)return 0;const e=this.interstitial.playoutLimit;if(e){const r=e-this.startOffset;if(r>0&&r<t)return r}return t}get remaining(){const t=this.duration;return t?Math.max(0,t-this.currentTime):0}get startOffset(){return this.assetItem.startOffset}get timelineOffset(){var t;return(null==(t=this.hls)?void 0:t.config.timelineOffset)||0}set timelineOffset(t){const e=this.timelineOffset;if(t!==e){const r=t-e;if(Math.abs(r)>1/9e4&&this.hls){if(this.hasDetails)throw new Error("Cannot set timelineOffset after playlists are loaded");this.hls.config.timelineOffset=t}}}getAssetTime(t){const e=this.timelineOffset,r=this.duration;return Math.min(Math.max(0,t-e),r)}removeMediaListeners(){const t=this.mediaAttached;t&&(this._currentTime=t.currentTime,this.bufferSnapShot(),t.removeEventListener("timeupdate",this.checkPlayout))}bufferSnapShot(){var t;this.mediaAttached&&(null!=(t=this.hls)&&t.bufferedToEnd&&(this._bufferedEosTime=this.bufferedEnd))}destroy(){this.removeMediaListeners(),this.hls&&this.hls.destroy(),this.hls=null,this.tracks=this.mediaAttached=this.checkPlayout=null}attachMedia(t){var e;this.loadSource(),null==(e=this.hls)||e.attachMedia(t)}detachMedia(){var t;this.removeMediaListeners(),this.mediaAttached=null,null==(t=this.hls)||t.detachMedia()}resumeBuffering(){var t;null==(t=this.hls)||t.resumeBuffering()}pauseBuffering(){var t;null==(t=this.hls)||t.pauseBuffering()}transferMedia(){var t;return this.bufferSnapShot(),(null==(t=this.hls)?void 0:t.transferMedia())||null}resetDetails(){const t=this.hls;if(t&&this.hasDetails){t.stopLoad();const e=t=>delete t.details;t.levels.forEach(e),t.allAudioTracks.forEach(e),t.allSubtitleTracks.forEach(e),this.hasDetails=!1}}on(t,e,r){var n;null==(n=this.hls)||n.on(t,e)}once(t,e,r){var n;null==(n=this.hls)||n.once(t,e)}off(t,e,r){var n;null==(n=this.hls)||n.off(t,e)}toString(){var t;return"HlsAssetPlayer: ".concat(PT(this.assetItem)," ").concat(null==(t=this.hls)?void 0:t.sessionId," ").concat(this.appendInPlace?"append-in-place":"")}}class MT extends Ey{constructor(t,e){super("interstitials-sched",e),this.onScheduleUpdate=void 0,this.eventMap={},this.events=null,this.items=null,this.durations={primary:0,playout:0,integrated:0},this.onScheduleUpdate=t}destroy(){this.reset(),this.onScheduleUpdate=null}reset(){this.eventMap={},this.setDurations(0,0,0),this.events&&this.events.forEach(t=>t.reset()),this.events=this.items=null}resetErrorsInRange(t,e){return this.events?this.events.reduce((r,n)=>t<=n.startOffset&&e>n.startOffset?(delete n.error,r+1):r,0):0}get duration(){const t=this.items;return t?t[t.length-1].end:0}get length(){return this.items?this.items.length:0}getEvent(t){return t&&this.eventMap[t]||null}hasEvent(t){return t in this.eventMap}findItemIndex(t,e){if(t.event)return this.findEventIndex(t.event.identifier);let r=-1;t.nextEvent?r=this.findEventIndex(t.nextEvent.identifier)-1:t.previousEvent&&(r=this.findEventIndex(t.previousEvent.identifier)+1);const n=this.items;if(n)for(n[r]||(void 0===e&&(e=t.start),r=this.findItemIndexAtTime(e));r>=0&&null!=(i=n[r])&&i.event;){var i;r--}return r}findItemIndexAtTime(t,e){const r=this.items;if(r)for(let n=0;n<r.length;n++){let i=r[n];if(e&&"primary"!==e&&(i=i[e]),t===i.start||t>i.start&&t<i.end)return n}return-1}findJumpRestrictedIndex(t,e){const r=this.items;if(r)for(let n=t;n<=e&&r[n];n++){const t=r[n].event;if(null!=t&&t.restrictions.jump&&!t.appendInPlace)return n}return-1}findEventIndex(t){const e=this.items;if(e)for(let n=e.length;n--;){var r;if((null==(r=e[n].event)?void 0:r.identifier)===t)return n}return-1}findAssetIndex(t,e){const r=t.assetList,n=r.length;if(n>1)for(let i=0;i<n;i++){const t=r[i];if(!t.error){const r=t.timelineStart;if(e===r||e>r&&(e<r+(t.duration||0)||i===n-1))return i}}return 0}get assetIdAtEnd(){var t;const e=null==(t=this.items)||null==(t=t[this.length-1])?void 0:t.event;if(e){const t=e.assetList,r=t[t.length-1];if(r)return r.identifier}return null}parseInterstitialDateRanges(t,e){const r=t.main.details,{dateRanges:n}=r,i=this.events,s=this.parseDateRanges(n,{url:r.url},e),a=Object.keys(n),o=i?i.filter(t=>!a.includes(t.identifier)):[];s.length&&s.sort((t,e)=>{const r=t.cue.pre,n=t.cue.post,i=e.cue.pre,s=e.cue.post;if(r&&!i)return-1;if(i&&!r)return 1;if(n&&!s)return 1;if(s&&!n)return-1;if(!r&&!i&&!n&&!s){const r=t.startTime,n=e.startTime;if(r!==n)return r-n}return t.dateRange.tagOrder-e.dateRange.tagOrder}),this.events=s,o.forEach(t=>{this.removeEvent(t)}),this.updateSchedule(t,o)}updateSchedule(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const n=this.events||[];if(n.length||e.length||this.length<2){const i=this.items,s=this.parseSchedule(n,t);(r||e.length||(null==i?void 0:i.length)!==s.length||s.some((t,e)=>Math.abs(t.playout.start-i[e].playout.start)>.005||Math.abs(t.playout.end-i[e].playout.end)>.005))&&(this.items=s,this.onScheduleUpdate(e,i))}}parseDateRanges(t,e,r){const n=[],i=Object.keys(t);for(let s=0;s<i.length;s++){const a=i[s],o=t[a];if(o.isInterstitial){let t=this.eventMap[a];t?t.setDateRange(o):(t=new xT(o,e),this.eventMap[a]=t,!1===r&&(t.appendInPlace=r)),n.push(t)}}return n}parseSchedule(t,e){const r=[],n=e.main.details,i=n.live?1/0:n.edge;let s=0;if((t=t.filter(t=>!t.error&&!(t.cue.once&&t.hasPlayed))).length){this.resolveOffsets(t,e);let n=0,o=0;if(t.forEach((e,a)=>{const l=e.cue.pre,c=e.cue.post,u=t[a-1]||null,h=e.appendInPlace,d=c?i:e.startOffset,f=e.duration,p=e.timelineOccupancy===kT.Range?f:0,g=e.resumptionOffset,m=(null==u?void 0:u.startTime)===d,y=d+e.cumulativeDuration;let v=h?y+f:d+g;if(l||!c&&d<=0){const t=o;o+=p,e.timelineStart=y;const n=s;s+=f,r.push({event:e,start:y,end:v,playout:{start:n,end:s},integrated:{start:t,end:o}})}else{if(!(d<=i))return;{if(!m){const i=d-n;if(i>.033){const l=n,c=o;o+=i;const u=s;s+=i;const h={previousEvent:t[a-1]||null,nextEvent:e,start:l,end:l+i,playout:{start:u,end:s},integrated:{start:c,end:o}};r.push(h)}else i>0&&u&&(u.cumulativeDuration+=i,r[r.length-1].end=d)}c&&(v=y),e.timelineStart=y;const i=o;o+=p;const l=s;s+=f,r.push({event:e,start:y,end:v,playout:{start:l,end:s},integrated:{start:i,end:o}})}}const b=e.resumeTime;n=c||b>i?i:b}),n<i){var a;const t=n,e=o,l=i-n;o+=l;const c=s;s+=l,r.push({previousEvent:(null==(a=r[r.length-1])?void 0:a.event)||null,nextEvent:null,start:n,end:t+l,playout:{start:c,end:s},integrated:{start:e,end:o}})}this.setDurations(i,s,o)}else{const t=0;r.push({previousEvent:null,nextEvent:null,start:t,end:i,playout:{start:t,end:i},integrated:{start:t,end:i}}),this.setDurations(i,i,i)}return r}setDurations(t,e,r){this.durations={primary:t,playout:e,integrated:r}}resolveOffsets(t,e){const r=e.main.details,n=r.live?1/0:r.edge;let i=0,s=-1;t.forEach((a,o)=>{const l=a.cue.pre,c=a.cue.post,u=l?0:c?n:a.startTime;this.updateAssetDurations(a);if(s===u?a.cumulativeDuration=i:(i=0,s=u),!c&&a.snapOptions.in&&(a.resumeAnchor=lb(null,r.fragments,a.startOffset+a.resumptionOffset,0,0)||void 0),a.appendInPlace&&!a.appendInPlaceStarted){this.primaryCanResumeInPlaceAt(a,e)||(a.appendInPlace=!1)}if(!a.appendInPlace&&o+1<t.length){t[o+1].startTime-t[o].resumeTime<.033&&(t[o+1].appendInPlace=!1,t[o+1].appendInPlace&&this.warn("Could not change append strategy for abutting event ".concat(a)))}const h=ny(a.resumeOffset)?a.resumeOffset:a.duration;i+=h})}primaryCanResumeInPlaceAt(t,e){const r=t.resumeTime,n=t.startTime+t.resumptionOffset;if(Math.abs(r-n)>TT)return this.log('"'.concat(t.identifier,'" resumption ').concat(r," not aligned with estimated timeline end ").concat(n)),!1;return!Object.keys(e).some(n=>{const i=e[n].details,s=i.edge;if(r>=s)return this.log('"'.concat(t.identifier,'" resumption ').concat(r," past ").concat(n," playlist end ").concat(s)),!1;const a=lb(null,i.fragments,r);if(!a)return this.log('"'.concat(t.identifier,'" resumption ').concat(r," does not align with any fragments in ").concat(n," playlist (").concat(i.fragStart,"-").concat(i.fragmentEnd,")")),!0;const o="audio"===n?.175:0;return!(Math.abs(a.start-r)<TT+o||Math.abs(a.end-r)<TT+o)&&(this.log('"'.concat(t.identifier,'" resumption ').concat(r," not aligned with ").concat(n," fragment bounds (").concat(a.start,"-").concat(a.end," sn: ").concat(a.sn," cc: ").concat(a.cc,")")),!0)})}updateAssetDurations(t){if(!t.assetListLoaded)return;const e=t.timelineStart;let r=0,n=!1,i=!1;for(let s=0;s<t.assetList.length;s++){const a=t.assetList[s],o=e+r;a.startOffset=r,a.timelineStart=o,n||(n=null===a.duration),i||(i=!!a.error);r+=a.error?0:a.duration||0}t.duration=n&&!i?Math.max(r,t.duration):r}removeEvent(t){t.reset(),delete this.eventMap[t.identifier]}}function OT(t){return"[".concat(t.event?'"'+t.event.identifier+'"':"primary",": ").concat(t.start.toFixed(2),"-").concat(t.end.toFixed(2),"]")}class DT{constructor(t){this.hls=void 0,this.hls=t}destroy(){this.hls=null}loadAssetList(t,e){const r=t.assetListUrl;let n;try{n=RT(r,this.hls.sessionId,t.baseUrl)}catch(cg){const n=this.assignAssetListError(t,oy.ASSET_LIST_LOAD_ERROR,cg,r);return void this.hls.trigger(ly.ERROR,n)}e&&"data:"!==n.protocol&&n.searchParams.set("_HLS_start_offset",""+e);const i=this.hls.config,s=new(0,i.loader)(i),a={responseType:"json",url:n.href},o=i.interstitialAssetListLoadPolicy.default,l={loadPolicy:o,timeout:o.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},c={onSuccess:(e,r,n,i)=>{const s=e.data,a=null==s?void 0:s.ASSETS;if(!Array.isArray(a)){const e=this.assignAssetListError(t,oy.ASSET_LIST_PARSING_ERROR,new Error("Invalid interstitial asset list"),n.url,r,i);return void this.hls.trigger(ly.ERROR,e)}t.assetListResponse=s,this.hls.trigger(ly.ASSET_LIST_LOADED,{event:t,assetListResponse:s,networkDetails:i})},onError:(e,r,n,i)=>{const s=this.assignAssetListError(t,oy.ASSET_LIST_LOAD_ERROR,new Error("Error loading X-ASSET-LIST: HTTP status ".concat(e.code," ").concat(e.text," (").concat(r.url,")")),r.url,i,n);this.hls.trigger(ly.ERROR,s)},onTimeout:(e,r,n)=>{const i=this.assignAssetListError(t,oy.ASSET_LIST_LOAD_TIMEOUT,new Error("Timeout loading X-ASSET-LIST (".concat(r.url,")")),r.url,e,n);this.hls.trigger(ly.ERROR,i)}};return s.load(a,l,c),this.hls.trigger(ly.ASSET_LIST_LOADING,{event:t}),s}assignAssetListError(t,e,r,n,i,s){return t.error=r,{type:ay.NETWORK_ERROR,details:e,fatal:!1,interstitial:t,url:n,error:r,networkDetails:s,stats:i}}}function NT(t){var e;null==t||null==(e=t.play())||e.catch(()=>{})}function FT(t,e){return"[".concat(t,"] Advancing timeline position to ").concat(e)}class UT{constructor(t){this.buffered=void 0;const e=(e,r,n)=>{if((r>>>=0)>n-1)throw new DOMException("Failed to execute '".concat(e,"' on 'TimeRanges': The index provided (").concat(r,") is greater than the maximum bound (").concat(n,")"));return t[r][e]};this.buffered={get length(){return t.length},end:r=>e("end",r,t.length),start:r=>e("start",r,t.length)}}}const BT={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,128:174,129:176,130:189,131:191,132:8482,133:162,134:163,135:9834,136:224,137:32,138:232,139:226,140:234,141:238,142:244,143:251,144:193,145:201,146:211,147:218,148:220,149:252,150:8216,151:161,152:42,153:8217,154:9473,155:169,156:8480,157:8226,158:8220,159:8221,160:192,161:194,162:199,163:200,164:202,165:203,166:235,167:206,168:207,169:239,170:212,171:217,172:249,173:219,174:171,175:187,176:195,177:227,178:205,179:204,180:236,181:210,182:242,183:213,184:245,185:123,186:125,187:92,188:94,189:95,190:124,191:8764,192:196,193:228,194:214,195:246,196:223,197:165,198:164,199:9475,200:197,201:229,202:216,203:248,204:9487,205:9491,206:9495,207:9499},jT=t=>String.fromCharCode(BT[t]||t),zT=15,WT=100,GT={17:1,18:3,21:5,22:7,23:9,16:11,19:12,20:14},VT={17:2,18:4,21:6,22:8,23:10,19:13,20:15},HT={25:1,26:3,29:5,30:7,31:9,24:11,27:12,28:14},KT={25:2,26:4,29:6,30:8,31:10,27:13,28:15},qT=["white","green","blue","cyan","red","yellow","magenta","black","transparent"];class YT{constructor(){this.time=null,this.verboseLevel=0}log(t,e){if(this.verboseLevel>=t){const r="function"===typeof e?e():e;Iy.log("".concat(this.time," [").concat(t,"] ").concat(r))}}}const QT=function(t){const e=[];for(let r=0;r<t.length;r++)e.push(t[r].toString(16));return e};class XT{constructor(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1}reset(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1}setStyles(t){const e=["foreground","underline","italics","background","flash"];for(let r=0;r<e.length;r++){const n=e[r];t.hasOwnProperty(n)&&(this[n]=t[n])}}isDefault(){return"white"===this.foreground&&!this.underline&&!this.italics&&"black"===this.background&&!this.flash}equals(t){return this.foreground===t.foreground&&this.underline===t.underline&&this.italics===t.italics&&this.background===t.background&&this.flash===t.flash}copy(t){this.foreground=t.foreground,this.underline=t.underline,this.italics=t.italics,this.background=t.background,this.flash=t.flash}toString(){return"color="+this.foreground+", underline="+this.underline+", italics="+this.italics+", background="+this.background+", flash="+this.flash}}class $T{constructor(){this.uchar=" ",this.penState=new XT}reset(){this.uchar=" ",this.penState.reset()}setChar(t,e){this.uchar=t,this.penState.copy(e)}setPenState(t){this.penState.copy(t)}equals(t){return this.uchar===t.uchar&&this.penState.equals(t.penState)}copy(t){this.uchar=t.uchar,this.penState.copy(t.penState)}isEmpty(){return" "===this.uchar&&this.penState.isDefault()}}class ZT{constructor(t){this.chars=[],this.pos=0,this.currPenState=new XT,this.cueStartTime=null,this.logger=void 0;for(let e=0;e<WT;e++)this.chars.push(new $T);this.logger=t}equals(t){for(let e=0;e<WT;e++)if(!this.chars[e].equals(t.chars[e]))return!1;return!0}copy(t){for(let e=0;e<WT;e++)this.chars[e].copy(t.chars[e])}isEmpty(){let t=!0;for(let e=0;e<WT;e++)if(!this.chars[e].isEmpty()){t=!1;break}return t}setCursor(t){this.pos!==t&&(this.pos=t),this.pos<0?(this.logger.log(3,"Negative cursor position "+this.pos),this.pos=0):this.pos>WT&&(this.logger.log(3,"Too large cursor position "+this.pos),this.pos=WT)}moveCursor(t){const e=this.pos+t;if(t>1)for(let r=this.pos+1;r<e+1;r++)this.chars[r].setPenState(this.currPenState);this.setCursor(e)}backSpace(){this.moveCursor(-1),this.chars[this.pos].setChar(" ",this.currPenState)}insertChar(t){t>=144&&this.backSpace();const e=jT(t);this.pos>=WT?this.logger.log(0,()=>"Cannot insert "+t.toString(16)+" ("+e+") at position "+this.pos+". Skipping it!"):(this.chars[this.pos].setChar(e,this.currPenState),this.moveCursor(1))}clearFromPos(t){let e;for(e=t;e<WT;e++)this.chars[e].reset()}clear(){this.clearFromPos(0),this.pos=0,this.currPenState.reset()}clearToEndOfRow(){this.clearFromPos(this.pos)}getTextString(){const t=[];let e=!0;for(let r=0;r<WT;r++){const n=this.chars[r].uchar;" "!==n&&(e=!1),t.push(n)}return e?"":t.join("")}setPenStyles(t){this.currPenState.setStyles(t);this.chars[this.pos].setPenState(this.currPenState)}}class JT{constructor(t){this.rows=[],this.currRow=14,this.nrRollUpRows=null,this.lastOutputScreen=null,this.logger=void 0;for(let e=0;e<zT;e++)this.rows.push(new ZT(t));this.logger=t}reset(){for(let t=0;t<zT;t++)this.rows[t].clear();this.currRow=14}equals(t){let e=!0;for(let r=0;r<zT;r++)if(!this.rows[r].equals(t.rows[r])){e=!1;break}return e}copy(t){for(let e=0;e<zT;e++)this.rows[e].copy(t.rows[e])}isEmpty(){let t=!0;for(let e=0;e<zT;e++)if(!this.rows[e].isEmpty()){t=!1;break}return t}backSpace(){this.rows[this.currRow].backSpace()}clearToEndOfRow(){this.rows[this.currRow].clearToEndOfRow()}insertChar(t){this.rows[this.currRow].insertChar(t)}setPen(t){this.rows[this.currRow].setPenStyles(t)}moveCursor(t){this.rows[this.currRow].moveCursor(t)}setCursor(t){this.logger.log(2,"setCursor: "+t);this.rows[this.currRow].setCursor(t)}setPAC(t){this.logger.log(2,()=>"pacData = "+Zv(t));let e=t.row-1;if(this.nrRollUpRows&&e<this.nrRollUpRows-1&&(e=this.nrRollUpRows-1),this.nrRollUpRows&&this.currRow!==e){for(let e=0;e<zT;e++)this.rows[e].clear();const t=this.currRow+1-this.nrRollUpRows,r=this.lastOutputScreen;if(r){const n=r.rows[t].cueStartTime,i=this.logger.time;if(null!==n&&null!==i&&n<i)for(let s=0;s<this.nrRollUpRows;s++)this.rows[e-this.nrRollUpRows+s+1].copy(r.rows[t+s])}}this.currRow=e;const r=this.rows[this.currRow];if(null!==t.indent){const e=t.indent,n=Math.max(e-1,0);r.setCursor(t.indent),t.color=r.chars[n].penState.foreground}const n={foreground:t.color,underline:t.underline,italics:t.italics,background:"black",flash:!1};this.setPen(n)}setBkgData(t){this.logger.log(2,()=>"bkgData = "+Zv(t)),this.backSpace(),this.setPen(t),this.insertChar(32)}setRollUpRows(t){this.nrRollUpRows=t}rollUp(){if(null===this.nrRollUpRows)return void this.logger.log(3,"roll_up but nrRollUpRows not set yet");this.logger.log(1,()=>this.getDisplayText());const t=this.currRow+1-this.nrRollUpRows,e=this.rows.splice(t,1)[0];e.clear(),this.rows.splice(this.currRow,0,e),this.logger.log(2,"Rolling up")}getDisplayText(t){t=t||!1;const e=[];let r="",n=-1;for(let i=0;i<zT;i++){const r=this.rows[i].getTextString();r&&(n=i+1,t?e.push("Row "+n+": '"+r+"'"):e.push(r.trim()))}return e.length>0&&(r=t?"["+e.join(" | ")+"]":e.join("\n")),r}getTextAndFormat(){return this.rows}}class tk{constructor(t,e,r){this.chNr=void 0,this.outputFilter=void 0,this.mode=void 0,this.verbose=void 0,this.displayedMemory=void 0,this.nonDisplayedMemory=void 0,this.lastOutputScreen=void 0,this.currRollUpRow=void 0,this.writeScreen=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chNr=t,this.outputFilter=e,this.mode=null,this.verbose=0,this.displayedMemory=new JT(r),this.nonDisplayedMemory=new JT(r),this.lastOutputScreen=new JT(r),this.currRollUpRow=this.displayedMemory.rows[14],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null,this.logger=r}reset(){this.mode=null,this.displayedMemory.reset(),this.nonDisplayedMemory.reset(),this.lastOutputScreen.reset(),this.outputFilter.reset(),this.currRollUpRow=this.displayedMemory.rows[14],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null}getHandler(){return this.outputFilter}setHandler(t){this.outputFilter=t}setPAC(t){this.writeScreen.setPAC(t)}setBkgData(t){this.writeScreen.setBkgData(t)}setMode(t){t!==this.mode&&(this.mode=t,this.logger.log(2,()=>"MODE="+t),"MODE_POP-ON"===this.mode?this.writeScreen=this.nonDisplayedMemory:(this.writeScreen=this.displayedMemory,this.writeScreen.reset()),"MODE_ROLL-UP"!==this.mode&&(this.displayedMemory.nrRollUpRows=null,this.nonDisplayedMemory.nrRollUpRows=null),this.mode=t)}insertChars(t){for(let r=0;r<t.length;r++)this.writeScreen.insertChar(t[r]);const e=this.writeScreen===this.displayedMemory?"DISP":"NON_DISP";this.logger.log(2,()=>e+": "+this.writeScreen.getDisplayText(!0)),"MODE_PAINT-ON"!==this.mode&&"MODE_ROLL-UP"!==this.mode||(this.logger.log(1,()=>"DISPLAYED: "+this.displayedMemory.getDisplayText(!0)),this.outputDataUpdate())}ccRCL(){this.logger.log(2,"RCL - Resume Caption Loading"),this.setMode("MODE_POP-ON")}ccBS(){this.logger.log(2,"BS - BackSpace"),"MODE_TEXT"!==this.mode&&(this.writeScreen.backSpace(),this.writeScreen===this.displayedMemory&&this.outputDataUpdate())}ccAOF(){}ccAON(){}ccDER(){this.logger.log(2,"DER- Delete to End of Row"),this.writeScreen.clearToEndOfRow(),this.outputDataUpdate()}ccRU(t){this.logger.log(2,"RU("+t+") - Roll Up"),this.writeScreen=this.displayedMemory,this.setMode("MODE_ROLL-UP"),this.writeScreen.setRollUpRows(t)}ccFON(){this.logger.log(2,"FON - Flash On"),this.writeScreen.setPen({flash:!0})}ccRDC(){this.logger.log(2,"RDC - Resume Direct Captioning"),this.setMode("MODE_PAINT-ON")}ccTR(){this.logger.log(2,"TR"),this.setMode("MODE_TEXT")}ccRTD(){this.logger.log(2,"RTD"),this.setMode("MODE_TEXT")}ccEDM(){this.logger.log(2,"EDM - Erase Displayed Memory"),this.displayedMemory.reset(),this.outputDataUpdate(!0)}ccCR(){this.logger.log(2,"CR - Carriage Return"),this.writeScreen.rollUp(),this.outputDataUpdate(!0)}ccENM(){this.logger.log(2,"ENM - Erase Non-displayed Memory"),this.nonDisplayedMemory.reset()}ccEOC(){if(this.logger.log(2,"EOC - End Of Caption"),"MODE_POP-ON"===this.mode){const t=this.displayedMemory;this.displayedMemory=this.nonDisplayedMemory,this.nonDisplayedMemory=t,this.writeScreen=this.nonDisplayedMemory,this.logger.log(1,()=>"DISP: "+this.displayedMemory.getDisplayText())}this.outputDataUpdate(!0)}ccTO(t){this.logger.log(2,"TO("+t+") - Tab Offset"),this.writeScreen.moveCursor(t)}ccMIDROW(t){const e={flash:!1};if(e.underline=t%2===1,e.italics=t>=46,e.italics)e.foreground="white";else{const r=Math.floor(t/2)-16,n=["white","green","blue","cyan","red","yellow","magenta"];e.foreground=n[r]}this.logger.log(2,"MIDROW: "+Zv(e)),this.writeScreen.setPen(e)}outputDataUpdate(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const e=this.logger.time;null!==e&&this.outputFilter&&(null!==this.cueStartTime||this.displayedMemory.isEmpty()?this.displayedMemory.equals(this.lastOutputScreen)||(this.outputFilter.newCue(this.cueStartTime,e,this.lastOutputScreen),t&&this.outputFilter.dispatchCue&&this.outputFilter.dispatchCue(),this.cueStartTime=this.displayedMemory.isEmpty()?null:e):this.cueStartTime=e,this.lastOutputScreen.copy(this.displayedMemory))}cueSplitAtTime(t){this.outputFilter&&(this.displayedMemory.isEmpty()||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,t,this.displayedMemory),this.cueStartTime=t))}}class ek{constructor(t,e,r){this.channels=void 0,this.currentChannel=0,this.cmdHistory={a:null,b:null},this.logger=void 0;const n=this.logger=new YT;this.channels=[null,new tk(t,e,n),new tk(t+1,r,n)]}getHandler(t){return this.channels[t].getHandler()}setHandler(t,e){this.channels[t].setHandler(e)}addData(t,e){this.logger.time=t;for(let r=0;r<e.length;r+=2){const t=127&e[r],n=127&e[r+1];let i=!1,s=null;if(0===t&&0===n)continue;this.logger.log(3,()=>"["+QT([e[r],e[r+1]])+"] -> ("+QT([t,n])+")");const a=this.cmdHistory;if(t>=16&&t<=31){if(nk(t,n,a)){rk(null,null,a),this.logger.log(3,()=>"Repeated command ("+QT([t,n])+") is dropped");continue}rk(t,n,this.cmdHistory),i=this.parseCmd(t,n),i||(i=this.parseMidrow(t,n)),i||(i=this.parsePAC(t,n)),i||(i=this.parseBackgroundAttributes(t,n))}else rk(null,null,a);if(!i&&(s=this.parseChars(t,n),s)){const t=this.currentChannel;if(t&&t>0){this.channels[t].insertChars(s)}else this.logger.log(2,"No channel found yet. TEXT-MODE?")}i||s||this.logger.log(2,()=>"Couldn't parse cleaned data "+QT([t,n])+" orig: "+QT([e[r],e[r+1]]))}}parseCmd(t,e){if(!((20===t||28===t||21===t||29===t)&&e>=32&&e<=47)&&!((23===t||31===t)&&e>=33&&e<=35))return!1;const r=20===t||21===t||23===t?1:2,n=this.channels[r];return 20===t||21===t||28===t||29===t?32===e?n.ccRCL():33===e?n.ccBS():34===e?n.ccAOF():35===e?n.ccAON():36===e?n.ccDER():37===e?n.ccRU(2):38===e?n.ccRU(3):39===e?n.ccRU(4):40===e?n.ccFON():41===e?n.ccRDC():42===e?n.ccTR():43===e?n.ccRTD():44===e?n.ccEDM():45===e?n.ccCR():46===e?n.ccENM():47===e&&n.ccEOC():n.ccTO(e-32),this.currentChannel=r,!0}parseMidrow(t,e){let r=0;if((17===t||25===t)&&e>=32&&e<=47){if(r=17===t?1:2,r!==this.currentChannel)return this.logger.log(0,"Mismatch channel in midrow parsing"),!1;const n=this.channels[r];return!!n&&(n.ccMIDROW(e),this.logger.log(3,()=>"MIDROW ("+QT([t,e])+")"),!0)}return!1}parsePAC(t,e){let r;if(!((t>=17&&t<=23||t>=25&&t<=31)&&e>=64&&e<=127)&&!((16===t||24===t)&&e>=64&&e<=95))return!1;const n=t<=23?1:2;r=e>=64&&e<=95?1===n?GT[t]:HT[t]:1===n?VT[t]:KT[t];const i=this.channels[n];return!!i&&(i.setPAC(this.interpretPAC(r,e)),this.currentChannel=n,!0)}interpretPAC(t,e){let r;const n={color:null,italics:!1,indent:null,underline:!1,row:t};return r=e>95?e-96:e-64,n.underline=1===(1&r),r<=13?n.color=["white","green","blue","cyan","red","yellow","magenta","white"][Math.floor(r/2)]:r<=15?(n.italics=!0,n.color="white"):n.indent=4*Math.floor((r-16)/2),n}parseChars(t,e){let r,n=null,i=null;if(t>=25?(r=2,i=t-8):(r=1,i=t),i>=17&&i<=19){let t;t=17===i?e+80:18===i?e+112:e+144,this.logger.log(2,()=>"Special char '"+jT(t)+"' in channel "+r),n=[t]}else t>=32&&t<=127&&(n=0===e?[t]:[t,e]);return n&&this.logger.log(3,()=>"Char codes =  "+QT(n).join(",")),n}parseBackgroundAttributes(t,e){if(!((16===t||24===t)&&e>=32&&e<=47)&&!((23===t||31===t)&&e>=45&&e<=47))return!1;let r;const n={};16===t||24===t?(r=Math.floor((e-32)/2),n.background=qT[r],e%2===1&&(n.background=n.background+"_semi")):45===e?n.background="transparent":(n.foreground="black",47===e&&(n.underline=!0));const i=t<=23?1:2;return this.channels[i].setBkgData(n),!0}reset(){for(let t=0;t<Object.keys(this.channels).length;t++){const e=this.channels[t];e&&e.reset()}rk(null,null,this.cmdHistory)}cueSplitAtTime(t){for(let e=0;e<this.channels.length;e++){const r=this.channels[e];r&&r.cueSplitAtTime(t)}}}function rk(t,e,r){r.a=t,r.b=e}function nk(t,e,r){return r.a===t&&r.b===e}var ik=function(){if(null!=v_&&v_.VTTCue)return self.VTTCue;const t=["","lr","rl"],e=["start","middle","end","left","right"];function r(t,e){if("string"!==typeof e)return!1;if(!Array.isArray(t))return!1;const r=e.toLowerCase();return!!~t.indexOf(r)&&r}function n(t){return r(e,t)}function i(t){for(var e=arguments.length,r=new Array(e>1?e-1:0),n=1;n<e;n++)r[n-1]=arguments[n];let i=1;for(;i<arguments.length;i++){const e=arguments[i];for(const r in e)t[r]=e[r]}return t}function s(e,s,a){const o=this,l={enumerable:!0};o.hasBeenReset=!1;let c="",u=!1,h=e,d=s,f=a,p=null,g="",m=!0,y="auto",v="start",b=50,_="middle",w=50,E="middle";Object.defineProperty(o,"id",i({},l,{get:function(){return c},set:function(t){c=""+t}})),Object.defineProperty(o,"pauseOnExit",i({},l,{get:function(){return u},set:function(t){u=!!t}})),Object.defineProperty(o,"startTime",i({},l,{get:function(){return h},set:function(t){if("number"!==typeof t)throw new TypeError("Start time must be set to a number.");h=t,this.hasBeenReset=!0}})),Object.defineProperty(o,"endTime",i({},l,{get:function(){return d},set:function(t){if("number"!==typeof t)throw new TypeError("End time must be set to a number.");d=t,this.hasBeenReset=!0}})),Object.defineProperty(o,"text",i({},l,{get:function(){return f},set:function(t){f=""+t,this.hasBeenReset=!0}})),Object.defineProperty(o,"region",i({},l,{get:function(){return p},set:function(t){p=t,this.hasBeenReset=!0}})),Object.defineProperty(o,"vertical",i({},l,{get:function(){return g},set:function(e){const n=function(e){return r(t,e)}(e);if(!1===n)throw new SyntaxError("An invalid or illegal string was specified.");g=n,this.hasBeenReset=!0}})),Object.defineProperty(o,"snapToLines",i({},l,{get:function(){return m},set:function(t){m=!!t,this.hasBeenReset=!0}})),Object.defineProperty(o,"line",i({},l,{get:function(){return y},set:function(t){if("number"!==typeof t&&"auto"!==t)throw new SyntaxError("An invalid number or illegal string was specified.");y=t,this.hasBeenReset=!0}})),Object.defineProperty(o,"lineAlign",i({},l,{get:function(){return v},set:function(t){const e=n(t);if(!e)throw new SyntaxError("An invalid or illegal string was specified.");v=e,this.hasBeenReset=!0}})),Object.defineProperty(o,"position",i({},l,{get:function(){return b},set:function(t){if(t<0||t>100)throw new Error("Position must be between 0 and 100.");b=t,this.hasBeenReset=!0}})),Object.defineProperty(o,"positionAlign",i({},l,{get:function(){return _},set:function(t){const e=n(t);if(!e)throw new SyntaxError("An invalid or illegal string was specified.");_=e,this.hasBeenReset=!0}})),Object.defineProperty(o,"size",i({},l,{get:function(){return w},set:function(t){if(t<0||t>100)throw new Error("Size must be between 0 and 100.");w=t,this.hasBeenReset=!0}})),Object.defineProperty(o,"align",i({},l,{get:function(){return E},set:function(t){const e=n(t);if(!e)throw new SyntaxError("An invalid or illegal string was specified.");E=e,this.hasBeenReset=!0}})),o.displayState=void 0}return s.prototype.getCueAsHTML=function(){return self.WebVTT.convertCueToDOMTree(self,this.text)},s}();class sk{decode(t,e){if(!t)return"";if("string"!==typeof t)throw new Error("Error - expected string data.");return decodeURIComponent(encodeURIComponent(t))}}function ak(t){function e(t,e,r,n){return 3600*(0|t)+60*(0|e)+(0|r)+parseFloat(n||0)}const r=t.match(/^(?:(\d+):)?(\d{2}):(\d{2})(\.\d+)?/);return r?parseFloat(r[2])>59?e(r[2],r[3],0,r[4]):e(r[1],r[2],r[3],r[4]):null}class ok{constructor(){this.values=Object.create(null)}set(t,e){this.get(t)||""===e||(this.values[t]=e)}get(t,e,r){return r?this.has(t)?this.values[t]:e[r]:this.has(t)?this.values[t]:e}has(t){return t in this.values}alt(t,e,r){for(let n=0;n<r.length;++n)if(e===r[n]){this.set(t,e);break}}integer(t,e){/^-?\d+$/.test(e)&&this.set(t,parseInt(e,10))}percent(t,e){if(/^([\d]{1,3})(\.[\d]*)?%$/.test(e)){const r=parseFloat(e);if(r>=0&&r<=100)return this.set(t,r),!0}return!1}}function lk(t,e,r,n){const i=n?t.split(n):[t];for(const s in i){if("string"!==typeof i[s])continue;const t=i[s].split(r);if(2!==t.length)continue;e(t[0],t[1])}}const ck=new ik(0,0,""),uk="middle"===ck.align?"middle":"center";function hk(t,e,r){const n=t;function i(){const e=ak(t);if(null===e)throw new Error("Malformed timestamp: "+n);return t=t.replace(/^[^\sa-zA-Z-]+/,""),e}function s(){t=t.replace(/^\s+/,"")}if(s(),e.startTime=i(),s(),"--\x3e"!==t.slice(0,3))throw new Error("Malformed time stamp (time stamps must be separated by '--\x3e'): "+n);t=t.slice(3),s(),e.endTime=i(),s(),function(t,e){const n=new ok;lk(t,function(t,e){let i;switch(t){case"region":for(let i=r.length-1;i>=0;i--)if(r[i].id===e){n.set(t,r[i].region);break}break;case"vertical":n.alt(t,e,["rl","lr"]);break;case"line":i=e.split(","),n.integer(t,i[0]),n.percent(t,i[0])&&n.set("snapToLines",!1),n.alt(t,i[0],["auto"]),2===i.length&&n.alt("lineAlign",i[1],["start",uk,"end"]);break;case"position":i=e.split(","),n.percent(t,i[0]),2===i.length&&n.alt("positionAlign",i[1],["start",uk,"end","line-left","line-right","auto"]);break;case"size":n.percent(t,e);break;case"align":n.alt(t,e,["start",uk,"end","left","right"])}},/:/,/\s/),e.region=n.get("region",null),e.vertical=n.get("vertical","");let i=n.get("line","auto");"auto"===i&&-1===ck.line&&(i=-1),e.line=i,e.lineAlign=n.get("lineAlign","start"),e.snapToLines=n.get("snapToLines",!0),e.size=n.get("size",100),e.align=n.get("align",uk);let s=n.get("position","auto");"auto"===s&&50===ck.position&&(s="start"===e.align||"left"===e.align?0:"end"===e.align||"right"===e.align?100:50),e.position=s}(t,e)}function dk(t){return t.replace(/<br(?: \/)?>/gi,"\n")}class fk{constructor(){this.state="INITIAL",this.buffer="",this.decoder=new sk,this.regionList=[],this.cue=null,this.oncue=void 0,this.onparsingerror=void 0,this.onflush=void 0}parse(t){const e=this;function r(){let t=e.buffer,r=0;for(t=dk(t);r<t.length&&"\r"!==t[r]&&"\n"!==t[r];)++r;const n=t.slice(0,r);return"\r"===t[r]&&++r,"\n"===t[r]&&++r,e.buffer=t.slice(r),n}function n(t){lk(t,function(t,e){},/:/)}t&&(e.buffer+=e.decoder.decode(t,{stream:!0}));try{let t="";if("INITIAL"===e.state){if(!/\r\n|\n/.test(e.buffer))return this;t=r();const n=t.match(/^(\xef\xbb\xbf)?WEBVTT([ \t].*)?$/);if(null==n||!n[0])throw new Error("Malformed WebVTT signature.");e.state="HEADER"}let i=!1;for(;e.buffer;){if(!/\r\n|\n/.test(e.buffer))return this;switch(i?i=!1:t=r(),e.state){case"HEADER":/:/.test(t)?n(t):t||(e.state="ID");continue;case"NOTE":t||(e.state="ID");continue;case"ID":if(/^NOTE($|[ \t])/.test(t)){e.state="NOTE";break}if(!t)continue;if(e.cue=new ik(0,0,""),e.state="CUE",-1===t.indexOf("--\x3e")){e.cue.id=t;continue}case"CUE":if(!e.cue){e.state="BADCUE";continue}try{hk(t,e.cue,e.regionList)}catch(vA){e.cue=null,e.state="BADCUE";continue}e.state="CUETEXT";continue;case"CUETEXT":{const r=-1!==t.indexOf("--\x3e");if(!t||r&&(i=!0)){e.oncue&&e.cue&&e.oncue(e.cue),e.cue=null,e.state="ID";continue}if(null===e.cue)continue;e.cue.text&&(e.cue.text+="\n"),e.cue.text+=t}continue;case"BADCUE":t||(e.state="ID")}}}catch(vA){"CUETEXT"===e.state&&e.cue&&e.oncue&&e.oncue(e.cue),e.cue=null,e.state="INITIAL"===e.state?"BADWEBVTT":"BADCUE"}return this}flush(){const t=this;try{if((t.cue||"HEADER"===t.state)&&(t.buffer+="\n\n",t.parse()),"INITIAL"===t.state||"BADWEBVTT"===t.state)throw new Error("Malformed WebVTT signature.")}catch(vA){t.onparsingerror&&t.onparsingerror(vA)}return t.onflush&&t.onflush(),this}}const pk=/\r\n|\n\r|\n|\r/g,gk=function(t,e){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return t.slice(r,r+e.length)===e};function mk(t,e,r){return ST(t.toString())+ST(e.toString())+ST(r)}function yk(t,e,r,n,i,s,a){const o=new fk,l=Py(new Uint8Array(t)).trim().replace(pk,"\n").split("\n"),c=[],u=e?function(t){return jE(t,9e4,1/(arguments.length>1&&void 0!==arguments[1]?arguments[1]:1))}(e.baseTime,e.timescale):0;let h,d="00:00.000",f=0,p=0,g=!0;o.oncue=function(t){const s=r[n];let a=r.ccOffset;const o=(f-u)/9e4;if(null!=s&&s.new&&(void 0!==p?a=r.ccOffset=s.start:function(t,e,r){let n=t[e],i=t[n.prevCC];if(!i||!i.new&&n.new)return t.ccOffset=t.presentationOffset=n.start,void(n.new=!1);for(;null!=(s=i)&&s.new;){var s;t.ccOffset+=n.start-i.start,n.new=!1,n=i,i=t[n.prevCC]}t.presentationOffset=r}(r,n,o)),o){if(!e)return void(h=new Error("Missing initPTS for VTT MPEGTS"));a=o-r.presentationOffset}const l=t.endTime-t.startTime,d=YE(9e4*(t.startTime+a-p),9e4*i)/9e4;t.startTime=Math.max(d,0),t.endTime=Math.max(d+l,0);const g=t.text.trim();t.text=decodeURIComponent(encodeURIComponent(g)),t.id||(t.id=mk(t.startTime,t.endTime,g)),t.endTime>0&&c.push(t)},o.onparsingerror=function(t){h=t},o.onflush=function(){h?a(h):s(c)},l.forEach(t=>{if(g){if(gk(t,"X-TIMESTAMP-MAP=")){g=!1,t.slice(16).split(",").forEach(t=>{gk(t,"LOCAL:")?d=t.slice(6):gk(t,"MPEGTS:")&&(f=parseInt(t.slice(7)))});try{p=function(t){let e=parseInt(t.slice(-3));const r=parseInt(t.slice(-6,-4)),n=parseInt(t.slice(-9,-7)),i=t.length>9?parseInt(t.substring(0,t.indexOf(":"))):0;if(!ny(e)||!ny(r)||!ny(n)||!ny(i))throw Error("Malformed X-TIMESTAMP-MAP: Local:".concat(t));return e+=1e3*r,e+=6e4*n,e+=36e5*i,e}(d)/1e3}catch(cg){h=cg}return}""===t&&(g=!1)}o.parse(t+"\n")}),o.flush()}const vk="stpp.ttml.im1t",bk=/^(\d{2,}):(\d{2}):(\d{2}):(\d{2})\.?(\d+)?$/,_k=/^(\d*(?:\.\d*)?)(h|m|s|ms|f|t)$/,wk={left:"start",center:"center",right:"end",start:"start",end:"end"};function Ek(t,e,r,n){const i=ev(new Uint8Array(t),["mdat"]);if(0===i.length)return void n(new Error("Could not parse IMSC1 mdat"));const s=i.map(t=>Py(t)),a=function(t,e){return jE(t,e,1/(arguments.length>2&&void 0!==arguments[2]?arguments[2]:1),arguments.length>3&&void 0!==arguments[3]&&arguments[3])}(e.baseTime,1,e.timescale);try{s.forEach(t=>r(function(t,e){const r=(new DOMParser).parseFromString(t,"text/xml"),n=r.getElementsByTagName("tt")[0];if(!n)throw new Error("Invalid ttml");const i={frameRate:30,subFrameRate:1,frameRateMultiplier:0,tickRate:0},s=Object.keys(i).reduce((t,e)=>(t[e]=n.getAttribute("ttp:".concat(e))||i[e],t),{}),a="preserve"!==n.getAttribute("xml:space"),o=Tk(Sk(n,"styling","style")),l=Tk(Sk(n,"layout","region")),c=Sk(n,"body","[begin]");return[].map.call(c,t=>{const r=kk(t,a);if(!r||!t.hasAttribute("begin"))return null;const n=Ik(t.getAttribute("begin"),s),i=Ik(t.getAttribute("dur"),s);let c=Ik(t.getAttribute("end"),s);if(null===n)throw xk(t);if(null===c){if(null===i)throw xk(t);c=n+i}const u=new ik(n-e,c-e,r);u.id=mk(u.startTime,u.endTime,u.text);const h=function(t,e,r){const n="http://www.w3.org/ns/ttml#styling";let i=null;const s=["displayAlign","textAlign","color","backgroundColor","fontSize","fontFamily"],a=null!=t&&t.hasAttribute("style")?t.getAttribute("style"):null;a&&r.hasOwnProperty(a)&&(i=r[a]);return s.reduce((r,s)=>{const a=Ak(e,n,s)||Ak(t,n,s)||Ak(i,n,s);return a&&(r[s]=a),r},{})}(l[t.getAttribute("region")],o[t.getAttribute("style")],o),{textAlign:d}=h;if(d){const t=wk[d];t&&(u.lineAlign=t),u.align=d}return by(u,h),u}).filter(t=>null!==t)}(t,a)))}catch(cg){n(cg)}}function Sk(t,e,r){const n=t.getElementsByTagName(e)[0];return n?[].slice.call(n.querySelectorAll(r)):[]}function Tk(t){return t.reduce((t,e)=>{const r=e.getAttribute("xml:id");return r&&(t[r]=e),t},{})}function kk(t,e){return[].slice.call(t.childNodes).reduce((t,r,n)=>{var i;return"br"===r.nodeName&&n?t+"\n":null!=(i=r.childNodes)&&i.length?kk(r,e):e?t+r.textContent.trim().replace(/\s+/g," "):t+r.textContent},"")}function Ak(t,e,r){return t&&t.hasAttributeNS(e,r)?t.getAttributeNS(e,r):null}function xk(t){return new Error("Could not parse ttml timestamp ".concat(t))}function Ik(t,e){if(!t)return null;let r=ak(t);return null===r&&(bk.test(t)?r=function(t,e){const r=bk.exec(t),n=(0|r[4])+(0|r[5])/e.subFrameRate;return 3600*(0|r[1])+60*(0|r[2])+(0|r[3])+n/e.frameRate}(t,e):_k.test(t)&&(r=function(t,e){const r=_k.exec(t),n=Number(r[1]);switch(r[2]){case"h":return 3600*n;case"m":return 60*n;case"ms":return 1e3*n;case"f":return n/e.frameRate;case"t":return n/e.tickRate}return n}(t,e))),r}class Rk{constructor(t,e){this.timelineController=void 0,this.cueRanges=[],this.trackName=void 0,this.startTime=null,this.endTime=null,this.screen=null,this.timelineController=t,this.trackName=e}dispatchCue(){null!==this.startTime&&(this.timelineController.addCues(this.trackName,this.startTime,this.endTime,this.screen,this.cueRanges),this.startTime=null)}newCue(t,e,r){(null===this.startTime||this.startTime>t)&&(this.startTime=t),this.endTime=e,this.screen=r,this.timelineController.createCaptionsTrack(this.trackName)}reset(){this.cueRanges=[],this.startTime=null}}function Lk(t){return t.characteristics&&/transcribes-spoken-dialog/gi.test(t.characteristics)&&/describes-music-and-sound/gi.test(t.characteristics)?"captions":"subtitles"}function Pk(t,e){return!!t&&t.kind===Lk(e)&&uS(e,t)}function Ck(t,e,r,n){return Math.min(e,n)-Math.max(t,r)}const Mk=/\s/,Ok={newCue(t,e,r,n){const i=[];let s,a,o,l,c;const u=self.VTTCue||self.TextTrackCue;for(let d=0;d<n.rows.length;d++)if(s=n.rows[d],o=!0,l=0,c="",!s.isEmpty()){var h;for(let t=0;t<s.chars.length;t++)Mk.test(s.chars[t].uchar)&&o?l++:(c+=s.chars[t].uchar,o=!1);s.cueStartTime=e,e===r&&(r+=1e-4),l>=16?l--:l++;const n=dk(c.trim()),f=mk(e,r,n);null!=t&&null!=(h=t.cues)&&h.getCueById(f)||(a=new u(e,r,n),a.id=f,a.line=d+1,a.align="left",a.position=10+Math.min(80,10*Math.floor(8*l/32)),i.push(a))}return t&&i.length&&(i.sort((t,e)=>"auto"===t.line||"auto"===e.line?0:t.line>8&&e.line>8?e.line-t.line:t.line-e.line),i.forEach(e=>bT(t,e))),i}};const Dk=/(\d+)-(\d+)\/(\d+)/;class Nk{constructor(t){this.fetchSetup=void 0,this.requestTimeout=void 0,this.request=null,this.response=null,this.controller=void 0,this.context=null,this.config=null,this.callbacks=null,this.stats=void 0,this.loader=null,this.fetchSetup=t.fetchSetup||Fk,this.controller=new self.AbortController,this.stats=new Uy}destroy(){this.loader=this.callbacks=this.context=this.config=this.request=null,this.abortInternal(),this.response=null,this.fetchSetup=this.controller=this.stats=null}abortInternal(){this.controller&&!this.stats.loading.end&&(this.stats.aborted=!0,this.controller.abort())}abort(){var t;this.abortInternal(),null!=(t=this.callbacks)&&t.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.response)}load(t,e,r){const n=this.stats;if(n.loading.start)throw new Error("Loader can only be used once.");n.loading.start=self.performance.now();const i=function(t,e){const r={method:"GET",mode:"cors",credentials:"same-origin",signal:e,headers:new self.Headers(by({},t.headers))};t.rangeEnd&&r.headers.set("Range","bytes="+t.rangeStart+"-"+String(t.rangeEnd-1));return r}(t,this.controller.signal),s="arraybuffer"===t.responseType,a=s?"byteLength":"length",{maxTimeToFirstByteMs:o,maxLoadTimeMs:l}=e.loadPolicy;this.context=t,this.config=e,this.callbacks=r,this.request=this.fetchSetup(t,i),self.clearTimeout(this.requestTimeout),e.timeout=o&&ny(o)?o:l,this.requestTimeout=self.setTimeout(()=>{this.callbacks&&(this.abortInternal(),this.callbacks.onTimeout(n,t,this.response))},e.timeout);(rS(this.request)?this.request.then(self.fetch):self.fetch(this.request)).then(r=>{var i;this.response=this.loader=r;const a=Math.max(self.performance.now(),n.loading.start);if(self.clearTimeout(this.requestTimeout),e.timeout=l,this.requestTimeout=self.setTimeout(()=>{this.callbacks&&(this.abortInternal(),this.callbacks.onTimeout(n,t,this.response))},l-(a-n.loading.start)),!r.ok){const{status:t,statusText:e}=r;throw new Uk(e||"fetch, bad network response",t,r)}n.loading.first=a,n.total=function(t){const e=t.get("Content-Range");if(e){const t=function(t){const e=Dk.exec(t);if(e)return parseInt(e[2])-parseInt(e[1])+1}(e);if(ny(t))return t}const r=t.get("Content-Length");if(r)return parseInt(r)}(r.headers)||n.total;const o=null==(i=this.callbacks)?void 0:i.onProgress;return o&&ny(e.highWaterMark)?this.loadProgressively(r,n,t,e.highWaterMark,o):s?r.arrayBuffer():"json"===t.responseType?r.json():r.text()}).then(r=>{var i,s;const o=this.response;if(!o)throw new Error("loader destroyed");self.clearTimeout(this.requestTimeout),n.loading.end=Math.max(self.performance.now(),n.loading.first);const l=r[a];l&&(n.loaded=n.total=l);const c={url:o.url,data:r,code:o.status},u=null==(i=this.callbacks)?void 0:i.onProgress;u&&!ny(e.highWaterMark)&&u(n,t,r,o),null==(s=this.callbacks)||s.onSuccess(c,n,t,o)}).catch(e=>{var r;if(self.clearTimeout(this.requestTimeout),n.aborted)return;const i=e&&e.code||0,s=e?e.message:null;null==(r=this.callbacks)||r.onError({code:i,text:s},t,e?e.details:null,n)})}getCacheAge(){let t=null;if(this.response){const e=this.response.headers.get("age");t=e?parseFloat(e):null}return t}getResponseHeader(t){return this.response?this.response.headers.get(t):null}loadProgressively(t,e,r){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,i=arguments.length>4?arguments[4]:void 0;const s=new Pw,a=t.body.getReader(),o=()=>a.read().then(a=>{if(a.done)return s.dataLength&&i(e,r,s.flush().buffer,t),Promise.resolve(new ArrayBuffer(0));const l=a.value,c=l.length;return e.loaded+=c,c<n||s.dataLength?(s.push(l),s.dataLength>=n&&i(e,r,s.flush().buffer,t)):i(e,r,l.buffer,t),o()}).catch(()=>Promise.reject());return o()}}function Fk(t,e){return new self.Request(t.url,e)}class Uk extends Error{constructor(t,e,r){super(t),this.code=void 0,this.details=void 0,this.code=e,this.details=r}}const Bk=/^age:\s*[\d.]+\s*$/im;class jk{constructor(t){this.xhrSetup=void 0,this.requestTimeout=void 0,this.retryTimeout=void 0,this.retryDelay=void 0,this.config=null,this.callbacks=null,this.context=null,this.loader=null,this.stats=void 0,this.xhrSetup=t&&t.xhrSetup||null,this.stats=new Uy,this.retryDelay=0}destroy(){this.callbacks=null,this.abortInternal(),this.loader=null,this.config=null,this.context=null,this.xhrSetup=null}abortInternal(){const t=this.loader;self.clearTimeout(this.requestTimeout),self.clearTimeout(this.retryTimeout),t&&(t.onreadystatechange=null,t.onprogress=null,4!==t.readyState&&(this.stats.aborted=!0,t.abort()))}abort(){var t;this.abortInternal(),null!=(t=this.callbacks)&&t.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.loader)}load(t,e,r){if(this.stats.loading.start)throw new Error("Loader can only be used once.");this.stats.loading.start=self.performance.now(),this.context=t,this.config=e,this.callbacks=r,this.loadInternal()}loadInternal(){const{config:t,context:e}=this;if(!t||!e)return;const r=this.loader=new self.XMLHttpRequest,n=this.stats;n.loading.first=0,n.loaded=0,n.aborted=!1;const i=this.xhrSetup;i?Promise.resolve().then(()=>{if(this.loader===r&&!this.stats.aborted)return i(r,e.url)}).catch(t=>{if(this.loader===r&&!this.stats.aborted)return r.open("GET",e.url,!0),i(r,e.url)}).then(()=>{this.loader!==r||this.stats.aborted||this.openAndSendXhr(r,e,t)}).catch(t=>{var i;null==(i=this.callbacks)||i.onError({code:r.status,text:t.message},e,r,n)}):this.openAndSendXhr(r,e,t)}openAndSendXhr(t,e,r){t.readyState||t.open("GET",e.url,!0);const n=e.headers,{maxTimeToFirstByteMs:i,maxLoadTimeMs:s}=r.loadPolicy;if(n)for(const a in n)t.setRequestHeader(a,n[a]);e.rangeEnd&&t.setRequestHeader("Range","bytes="+e.rangeStart+"-"+(e.rangeEnd-1)),t.onreadystatechange=this.readystatechange.bind(this),t.onprogress=this.loadprogress.bind(this),t.responseType=e.responseType,self.clearTimeout(this.requestTimeout),r.timeout=i&&ny(i)?i:s,this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),r.timeout),t.send()}readystatechange(){const{context:t,loader:e,stats:r}=this;if(!t||!e)return;const n=e.readyState,i=this.config;if(!r.aborted&&n>=2&&(0===r.loading.first&&(r.loading.first=Math.max(self.performance.now(),r.loading.start),i.timeout!==i.loadPolicy.maxLoadTimeMs&&(self.clearTimeout(this.requestTimeout),i.timeout=i.loadPolicy.maxLoadTimeMs,this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),i.loadPolicy.maxLoadTimeMs-(r.loading.first-r.loading.start)))),4===n)){self.clearTimeout(this.requestTimeout),e.onreadystatechange=null,e.onprogress=null;const n=e.status,l="text"===e.responseType?e.responseText:null;if(n>=200&&n<300){const i=null!=l?l:e.response;if(null!=i){var s,a;r.loading.end=Math.max(self.performance.now(),r.loading.first);const o="arraybuffer"===e.responseType?i.byteLength:i.length;r.loaded=r.total=o,r.bwEstimate=8e3*r.total/(r.loading.end-r.loading.first);const l=null==(s=this.callbacks)?void 0:s.onProgress;l&&l(r,t,i,e);const c={url:e.responseURL,data:i,code:n};return void(null==(a=this.callbacks)||a.onSuccess(c,r,t,e))}}const c=i.loadPolicy.errorRetry;var o;if(vb(c,r.retry,!1,{url:t.url,data:void 0,code:n}))this.retry(c);else Iy.error("".concat(n," while loading ").concat(t.url)),null==(o=this.callbacks)||o.onError({code:n,text:e.statusText},t,e,r)}}loadtimeout(){if(!this.config)return;const t=this.config.loadPolicy.timeoutRetry;if(vb(t,this.stats.retry,!0))this.retry(t);else{var e;Iy.warn("timeout while loading ".concat(null==(e=this.context)?void 0:e.url));const t=this.callbacks;t&&(this.abortInternal(),t.onTimeout(this.stats,this.context,this.loader))}}retry(t){const{context:e,stats:r}=this;this.retryDelay=mb(t,r.retry),r.retry++,Iy.warn("".concat(status?"HTTP Status "+status:"Timeout"," while loading ").concat(null==e?void 0:e.url,", retrying ").concat(r.retry,"/").concat(t.maxNumRetry," in ").concat(this.retryDelay,"ms")),this.abortInternal(),this.loader=null,self.clearTimeout(this.retryTimeout),this.retryTimeout=self.setTimeout(this.loadInternal.bind(this),this.retryDelay)}loadprogress(t){const e=this.stats;e.loaded=t.loaded,t.lengthComputable&&(e.total=t.total)}getCacheAge(){let t=null;if(this.loader&&Bk.test(this.loader.getAllResponseHeaders())){const e=this.loader.getResponseHeader("age");t=e?parseFloat(e):null}return t}getResponseHeader(t){return this.loader&&new RegExp("^".concat(t,":\\s*[\\d.]+\\s*$"),"im").test(this.loader.getAllResponseHeaders())?this.loader.getResponseHeader(t):null}}const zk=wy(wy({autoStartLoad:!0,startPosition:-1,defaultAudioCodec:void 0,debug:!1,capLevelOnFPSDrop:!1,capLevelToPlayerSize:!1,ignoreDevicePixelRatio:!1,maxDevicePixelRatio:Number.POSITIVE_INFINITY,preferManagedMediaSource:!0,initialLiveManifestSize:1,maxBufferLength:30,backBufferLength:1/0,frontBufferFlushThreshold:1/0,startOnSegmentBoundary:!1,maxBufferSize:6e7,maxFragLookUpTolerance:.25,maxBufferHole:.1,detectStallWithCurrentTimeMs:1250,highBufferWatchdogPeriod:2,nudgeOffset:.1,nudgeMaxRetry:3,nudgeOnVideoHole:!0,liveSyncMode:"edge",liveSyncDurationCount:3,liveSyncOnStallIncrease:1,liveMaxLatencyDurationCount:1/0,liveSyncDuration:void 0,liveMaxLatencyDuration:void 0,maxLiveSyncPlaybackRate:1,liveDurationInfinity:!1,liveBackBufferLength:null,maxMaxBufferLength:600,enableWorker:!0,workerPath:null,enableSoftwareAES:!0,startLevel:void 0,startFragPrefetch:!1,fpsDroppedMonitoringPeriod:5e3,fpsDroppedMonitoringThreshold:.2,appendErrorMaxRetry:3,ignorePlaylistParsingErrors:!1,loader:jk,fLoader:void 0,pLoader:void 0,xhrSetup:void 0,licenseXhrSetup:void 0,licenseResponseCallback:void 0,abrController:class extends Ey{constructor(t){super("abr",t.logger),this.hls=void 0,this.lastLevelLoadSec=0,this.lastLoadedFragLevel=-1,this.firstSelection=-1,this._nextAutoLevel=-1,this.nextAutoLevelKey="",this.audioTracksByGroup=null,this.codecTiers=null,this.timer=-1,this.fragCurrent=null,this.partCurrent=null,this.bitrateTestDelay=0,this.rebufferNotice=-1,this.supportedCache={},this.bwEstimator=void 0,this._abandonRulesCheck=t=>{var e;const{fragCurrent:r,partCurrent:n,hls:i}=this,{autoLevelEnabled:s,media:a}=i;if(!r||!a)return;const o=performance.now(),l=n?n.stats:r.stats,c=n?n.duration:r.duration,u=o-l.loading.start,h=i.minAutoLevel,d=r.level,f=this._nextAutoLevel;if(l.aborted||l.loaded&&l.loaded===l.total||d<=h)return this.clearTimer(),void(this._nextAutoLevel=-1);if(!s)return;const p=f>-1&&f!==d,g=!!t||p;if(!g&&(a.paused||!a.playbackRate||!a.readyState))return;const m=i.mainForwardBufferInfo;if(!g&&null===m)return;const y=this.bwEstimator.getEstimateTTFB(),v=Math.abs(a.playbackRate);if(u<=Math.max(y,c/(2*v)*1e3))return;const b=m?m.len/v:0,_=l.loading.first?l.loading.first-l.loading.start:-1,w=l.loaded&&_>-1,E=this.getBwEstimate(),S=i.levels,T=S[d],k=Math.max(l.loaded,Math.round(c*(r.bitrate||T.averageBitrate)/8));let A=w?u-_:u;A<1&&w&&(A=Math.min(u,8*l.loaded/E));const x=w?1e3*l.loaded/A:0,I=y/1e3,R=x?(k-l.loaded)/x:8*k/E+I;if(R<=b)return;const L=x?8*x:E,P=!0===(null==(e=(null==t?void 0:t.details)||this.hls.latestLevelDetails)?void 0:e.live),C=this.hls.config.abrBandWidthUpFactor;let M,O=Number.POSITIVE_INFINITY;for(M=d-1;M>h;M--){const t=S[M].maxBitrate,e=!S[M].details||P;if(O=this.getTimeToLoadFrag(I,L,c*t,e),O<Math.min(b,c+I))break}if(O>=R)return;if(O>10*c)return;w?this.bwEstimator.sample(u-Math.min(y,_),l.loaded):this.bwEstimator.sampleTTFB(u);const D=S[M].maxBitrate;this.getBwEstimate()*C>D&&this.resetEstimator(D);const N=this.findBestLevel(D,h,M,0,b,1,1);N>-1&&(M=N),this.warn("Fragment ".concat(r.sn).concat(n?" part "+n.index:""," of level ").concat(d," is loading too slowly;\n      Fragment duration: ").concat(r.duration.toFixed(3),"\n      Time to underbuffer: ").concat(b.toFixed(3)," s\n      Estimated load time for current fragment: ").concat(R.toFixed(3)," s\n      Estimated load time for down switch fragment: ").concat(O.toFixed(3)," s\n      TTFB estimate: ").concat(0|_," ms\n      Current BW estimate: ").concat(ny(E)?0|E:"Unknown"," bps\n      New BW estimate: ").concat(0|this.getBwEstimate()," bps\n      Switching to level ").concat(M," @ ").concat(0|D," bps")),i.nextLoadLevel=i.nextAutoLevel=M,this.clearTimer();const F=()=>{if(this.clearTimer(),this.fragCurrent===r&&this.hls.loadLevel===M&&M>0){const t=this.getStarvationDelay();if(this.warn("Aborting inflight request ".concat(M>0?"and switching down":"","\n      Fragment duration: ").concat(r.duration.toFixed(3)," s\n      Time to underbuffer: ").concat(t.toFixed(3)," s")),r.abortRequests(),this.fragCurrent=this.partCurrent=null,M>h){let e=this.findBestLevel(this.hls.levels[h].bitrate,h,M,0,t,1,1);-1===e&&(e=h),this.hls.nextLoadLevel=this.hls.nextAutoLevel=e,this.resetEstimator(this.hls.levels[e].bitrate)}}};p||R>2*O?F():this.timer=self.setInterval(F,1e3*O),i.trigger(ly.FRAG_LOAD_EMERGENCY_ABORTED,{frag:r,part:n,stats:l})},this.hls=t,this.bwEstimator=this.initEstimator(),this.registerListeners()}resetEstimator(t){t&&(this.log("setting initial bwe to ".concat(t)),this.hls.config.abrEwmaDefaultEstimate=t),this.firstSelection=-1,this.bwEstimator=this.initEstimator()}initEstimator(){const t=this.hls.config;return new yy(t.abrEwmaSlowVoD,t.abrEwmaFastVoD,t.abrEwmaDefaultEstimate)}registerListeners(){const{hls:t}=this;t.on(ly.MANIFEST_LOADING,this.onManifestLoading,this),t.on(ly.FRAG_LOADING,this.onFragLoading,this),t.on(ly.FRAG_LOADED,this.onFragLoaded,this),t.on(ly.FRAG_BUFFERED,this.onFragBuffered,this),t.on(ly.LEVEL_SWITCHING,this.onLevelSwitching,this),t.on(ly.LEVEL_LOADED,this.onLevelLoaded,this),t.on(ly.LEVELS_UPDATED,this.onLevelsUpdated,this),t.on(ly.MAX_AUTO_LEVEL_UPDATED,this.onMaxAutoLevelUpdated,this),t.on(ly.ERROR,this.onError,this)}unregisterListeners(){const{hls:t}=this;t&&(t.off(ly.MANIFEST_LOADING,this.onManifestLoading,this),t.off(ly.FRAG_LOADING,this.onFragLoading,this),t.off(ly.FRAG_LOADED,this.onFragLoaded,this),t.off(ly.FRAG_BUFFERED,this.onFragBuffered,this),t.off(ly.LEVEL_SWITCHING,this.onLevelSwitching,this),t.off(ly.LEVEL_LOADED,this.onLevelLoaded,this),t.off(ly.LEVELS_UPDATED,this.onLevelsUpdated,this),t.off(ly.MAX_AUTO_LEVEL_UPDATED,this.onMaxAutoLevelUpdated,this),t.off(ly.ERROR,this.onError,this))}destroy(){this.unregisterListeners(),this.clearTimer(),this.hls=this._abandonRulesCheck=this.supportedCache=null,this.fragCurrent=this.partCurrent=null}onManifestLoading(t,e){this.lastLoadedFragLevel=-1,this.firstSelection=-1,this.lastLevelLoadSec=0,this.supportedCache={},this.fragCurrent=this.partCurrent=null,this.onLevelsUpdated(),this.clearTimer()}onLevelsUpdated(){this.lastLoadedFragLevel>-1&&this.fragCurrent&&(this.lastLoadedFragLevel=this.fragCurrent.level),this._nextAutoLevel=-1,this.onMaxAutoLevelUpdated(),this.codecTiers=null,this.audioTracksByGroup=null}onMaxAutoLevelUpdated(){this.firstSelection=-1,this.nextAutoLevelKey=""}onFragLoading(t,e){const r=e.frag;if(!this.ignoreFragment(r)){var n;if(!r.bitrateTest)this.fragCurrent=r,this.partCurrent=null!=(n=e.part)?n:null;this.clearTimer(),this.timer=self.setInterval(this._abandonRulesCheck,100)}}onLevelSwitching(t,e){this.clearTimer()}onError(t,e){if(!e.fatal)switch(e.details){case oy.BUFFER_ADD_CODEC_ERROR:case oy.BUFFER_APPEND_ERROR:this.lastLoadedFragLevel=-1,this.firstSelection=-1;break;case oy.FRAG_LOAD_TIMEOUT:{const t=e.frag,{fragCurrent:r,partCurrent:n}=this;if(t&&r&&t.sn===r.sn&&t.level===r.level){const e=performance.now(),r=n?n.stats:t.stats,i=e-r.loading.start,s=r.loading.first?r.loading.first-r.loading.start:-1;if(r.loaded&&s>-1){const t=this.bwEstimator.getEstimateTTFB();this.bwEstimator.sample(i-Math.min(t,s),r.loaded)}else this.bwEstimator.sampleTTFB(i)}break}}}getTimeToLoadFrag(t,e,r,n){return t+r/e+(n?t+this.lastLevelLoadSec:0)}onLevelLoaded(t,e){const r=this.hls.config,{loading:n}=e.stats,i=n.end-n.first;ny(i)&&(this.lastLevelLoadSec=i/1e3),e.details.live?this.bwEstimator.update(r.abrEwmaSlowLive,r.abrEwmaFastLive):this.bwEstimator.update(r.abrEwmaSlowVoD,r.abrEwmaFastVoD),this.timer>-1&&this._abandonRulesCheck(e.levelInfo)}onFragLoaded(t,e){let{frag:r,part:n}=e;const i=n?n.stats:r.stats;if(r.type===fy&&this.bwEstimator.sampleTTFB(i.loading.first-i.loading.start),!this.ignoreFragment(r)){if(this.clearTimer(),r.level===this._nextAutoLevel&&(this._nextAutoLevel=-1),this.firstSelection=-1,this.hls.config.abrMaxWithRealBitrate){const t=n?n.duration:r.duration,e=this.hls.levels[r.level],s=(e.loaded?e.loaded.bytes:0)+i.loaded,a=(e.loaded?e.loaded.duration:0)+t;e.loaded={bytes:s,duration:a},e.realBitrate=Math.round(8*s/a)}if(r.bitrateTest){const t={stats:i,frag:r,part:n,id:r.type};this.onFragBuffered(ly.FRAG_BUFFERED,t),r.bitrateTest=!1}else this.lastLoadedFragLevel=r.level}}onFragBuffered(t,e){const{frag:r,part:n}=e,i=null!=n&&n.stats.loaded?n.stats:r.stats;if(i.aborted)return;if(this.ignoreFragment(r))return;const s=i.parsing.end-i.loading.start-Math.min(i.loading.first-i.loading.start,this.bwEstimator.getEstimateTTFB());this.bwEstimator.sample(s,i.loaded),i.bwEstimate=this.getBwEstimate(),r.bitrateTest?this.bitrateTestDelay=s/1e3:this.bitrateTestDelay=0}ignoreFragment(t){return t.type!==fy||"initSegment"===t.sn}clearTimer(){this.timer>-1&&(self.clearInterval(this.timer),this.timer=-1)}get firstAutoLevel(){const{maxAutoLevel:t,minAutoLevel:e}=this.hls,r=this.getBwEstimate(),n=this.hls.config.maxStarvationDelay,i=this.findBestLevel(r,e,t,0,n,1,1);if(i>-1)return i;const s=this.hls.firstLevel,a=Math.min(Math.max(s,e),t);return this.warn("Could not find best starting auto level. Defaulting to first in playlist ".concat(s," clamped to ").concat(a)),a}get forcedAutoLevel(){return this.nextAutoLevelKey?-1:this._nextAutoLevel}get nextAutoLevel(){const t=this.forcedAutoLevel,e=this.bwEstimator.canEstimate(),r=this.lastLoadedFragLevel>-1;if(-1!==t&&(!e||!r||this.nextAutoLevelKey===this.getAutoLevelKey()))return t;const n=e&&r?this.getNextABRAutoLevel():this.firstAutoLevel;if(-1!==t){const e=this.hls.levels;if(e.length>Math.max(t,n)&&e[t].loadError<=e[n].loadError)return t}return this._nextAutoLevel=n,this.nextAutoLevelKey=this.getAutoLevelKey(),n}getAutoLevelKey(){return"".concat(this.getBwEstimate(),"_").concat(this.getStarvationDelay().toFixed(2))}getNextABRAutoLevel(){const{fragCurrent:t,partCurrent:e,hls:r}=this;if(r.levels.length<=1)return r.loadLevel;const{maxAutoLevel:n,config:i,minAutoLevel:s}=r,a=e?e.duration:t?t.duration:0,o=this.getBwEstimate(),l=this.getStarvationDelay();let c=i.abrBandWidthFactor,u=i.abrBandWidthUpFactor;if(l){const t=this.findBestLevel(o,s,n,l,0,c,u);if(t>=0)return this.rebufferNotice=-1,t}let h=a?Math.min(a,i.maxStarvationDelay):i.maxStarvationDelay;if(!l){const t=this.bitrateTestDelay;if(t){h=(a?Math.min(a,i.maxLoadingDelay):i.maxLoadingDelay)-t,this.info("bitrate test took ".concat(Math.round(1e3*t),"ms, set first fragment max fetchDuration to ").concat(Math.round(1e3*h)," ms")),c=u=1}}const d=this.findBestLevel(o,s,n,l,h,c,u);if(this.rebufferNotice!==d&&(this.rebufferNotice=d,this.info("".concat(l?"rebuffering expected":"buffer is empty",", optimal quality level ").concat(d))),d>-1)return d;const f=r.levels[s],p=r.loadLevelObj;return p&&(null==f?void 0:f.bitrate)<p.bitrate?s:r.loadLevel}getStarvationDelay(){const t=this.hls,e=t.media;if(!e)return 1/0;const r=e&&0!==e.playbackRate?Math.abs(e.playbackRate):1,n=t.mainForwardBufferInfo;return(n?n.len:0)/r}getBwEstimate(){return this.bwEstimator.canEstimate()?this.bwEstimator.getEstimate():this.hls.config.abrEwmaDefaultEstimate}findBestLevel(t,e,r,n,i,s,a){var o;const l=n+i,c=this.lastLoadedFragLevel,u=-1===c?this.hls.firstLevel:c,{fragCurrent:h,partCurrent:d}=this,{levels:f,allAudioTracks:p,loadLevel:g,config:m}=this.hls;if(1===f.length)return 0;const y=f[u],v=!(null==(o=this.hls.latestLevelDetails)||!o.live),b=-1===g||-1===c;let _,w="SDR",E=(null==y?void 0:y.frameRate)||0;const{audioPreference:S,videoPreference:T}=m,k=this.audioTracksByGroup||(this.audioTracksByGroup=tb(p));let A=-1;if(b){if(-1!==this.firstSelection)return this.firstSelection;const n=this.codecTiers||(this.codecTiers=function(t,e,r,n){return t.slice(r,n+1).reduce((t,r,n)=>{if(!r.codecSet)return t;const i=r.audioGroups;let s=t[r.codecSet];s||(t[r.codecSet]=s={minBitrate:1/0,minHeight:1/0,minFramerate:1/0,minIndex:n,maxScore:0,videoRanges:{SDR:0},channels:{2:0},hasDefaultAudio:!i,fragmentError:0}),s.minBitrate=Math.min(s.minBitrate,r.bitrate);const a=Math.min(r.height,r.width);return s.minHeight=Math.min(s.minHeight,a),s.minFramerate=Math.min(s.minFramerate,r.frameRate),s.minIndex=Math.min(s.minIndex,n),s.maxScore=Math.max(s.maxScore,r.score),s.fragmentError+=r.fragmentError,s.videoRanges[r.videoRange]=(s.videoRanges[r.videoRange]||0)+1,i&&i.forEach(t=>{if(!t)return;const r=e.groups[t];r&&(s.hasDefaultAudio=s.hasDefaultAudio||e.hasDefaultAudio?r.hasDefault:r.hasAutoSelect||!e.hasDefaultAudio&&!e.hasAutoSelectAudio,Object.keys(r.channels).forEach(t=>{s.channels[t]=(s.channels[t]||0)+r.channels[t]}))}),t},{})}(f,k,e,r)),i=function(t,e,r,n,i){const s=Object.keys(t),a=null==n?void 0:n.channels,o=null==n?void 0:n.audioCodec,l=null==i?void 0:i.videoCodec,c=a&&2===parseInt(a);let u=!1,h=!1,d=1/0,f=1/0,p=1/0,g=1/0,m=0,y=[];const{preferHDR:v,allowedVideoRanges:b}=$v(e,i);for(let S=s.length;S--;){const e=t[s[S]];u||(u=e.channels[2]>0),d=Math.min(d,e.minHeight),f=Math.min(f,e.minFramerate),p=Math.min(p,e.minBitrate),b.filter(t=>e.videoRanges[t]>0).length>0&&(h=!0)}d=ny(d)?d:0,f=ny(f)?f:0;const _=Math.max(1080,d),w=Math.max(30,f);p=ny(p)?p:r,r=Math.max(p,r),h||(e=void 0);const E=s.length>1;return{codecSet:s.reduce((e,n)=>{const i=t[n];if(n===e)return e;if(y=h?b.filter(t=>i.videoRanges[t]>0):[],E){if(i.minBitrate>r)return Jv(n,"min bitrate of ".concat(i.minBitrate," > current estimate of ").concat(r)),e;if(!i.hasDefaultAudio)return Jv(n,"no renditions with default or auto-select sound found"),e;if(o&&n.indexOf(o.substring(0,4))%5!==0)return Jv(n,'audio codec preference "'.concat(o,'" not found')),e;if(a&&!c){if(!i.channels[a])return Jv(n,"no renditions with ".concat(a," channel sound found (channels options: ").concat(Object.keys(i.channels),")")),e}else if((!o||c)&&u&&0===i.channels[2])return Jv(n,"no renditions with stereo sound found"),e;if(i.minHeight>_)return Jv(n,"min resolution of ".concat(i.minHeight," > maximum of ").concat(_)),e;if(i.minFramerate>w)return Jv(n,"min framerate of ".concat(i.minFramerate," > maximum of ").concat(w)),e;if(!y.some(t=>i.videoRanges[t]>0))return Jv(n,"no variants with VIDEO-RANGE of ".concat(Zv(y)," found")),e;if(l&&n.indexOf(l.substring(0,4))%5!==0)return Jv(n,'video codec preference "'.concat(l,'" not found')),e;if(i.maxScore<m)return Jv(n,"max score of ".concat(i.maxScore," < selected max of ").concat(m)),e}return e&&(Av(n)>=Av(e)||i.fragmentError>t[e].fragmentError)?e:(g=i.minIndex,m=i.maxScore,n)},void 0),videoRanges:y,preferHDR:v,minFramerate:f,minBitrate:p,minIndex:g}}(n,w,t,S,T),{codecSet:s,videoRanges:a,minFramerate:o,minBitrate:l,minIndex:c,preferHDR:u}=i;A=c,_=s,w=u?a[a.length-1]:a[0],E=o,t=Math.max(t,l),this.log("picked start tier ".concat(Zv(i)))}else _=null==y?void 0:y.codecSet,w=null==y?void 0:y.videoRange;const x=d?d.duration:h?h.duration:0,I=this.bwEstimator.getEstimateTTFB()/1e3,R=[];for(let P=r;P>=e;P--){var L;const e=f[P],o=P>u;if(!e)continue;if(m.useMediaCapabilities&&!e.supportedResult&&!e.supportedPromise){const r=navigator.mediaCapabilities;"function"===typeof(null==r?void 0:r.decodingInfo)&&Uv(e,k,w,E,t,S)?(e.supportedPromise=Bv(e,k,r,this.supportedCache),e.supportedPromise.then(t=>{if(!this.hls)return;e.supportedResult=t;const r=this.hls.levels,n=r.indexOf(e);t.error?this.warn('MediaCapabilities decodingInfo error: "'.concat(t.error,'" for level ').concat(n," ").concat(Zv(t))):t.supported?t.decodingInfoResults.some(t=>!1===t.smooth||!1===t.powerEfficient)&&this.log("MediaCapabilities decodingInfo for level ".concat(n," not smooth or powerEfficient: ").concat(Zv(t))):(this.warn("Unsupported MediaCapabilities decodingInfo result for level ".concat(n," ").concat(Zv(t))),n>-1&&r.length>1&&(this.log("Removing unsupported level ".concat(n)),this.hls.removeLevel(n),-1===this.hls.loadLevel&&(this.hls.nextLoadLevel=0)))}).catch(t=>{this.warn("Error handling MediaCapabilities decodingInfo: ".concat(t))})):e.supportedResult=Nv}if((_&&e.codecSet!==_||w&&e.videoRange!==w||o&&E>e.frameRate||!o&&E>0&&E<e.frameRate||null!=(L=e.supportedResult)&&null!=(L=L.decodingInfoResults)&&L.some(t=>!1===t.smooth))&&(!b||P!==A)){R.push(P);continue}const h=e.details,p=(d?null==h?void 0:h.partTarget:null==h?void 0:h.averagetargetduration)||x;let y;y=o?a*t:s*t;const T=x&&n>=2*x&&0===i?e.averageBitrate:e.maxBitrate,C=this.getTimeToLoadFrag(I,y,T*p,void 0===h);if(y>=T&&(P===c||0===e.loadError&&0===e.fragmentError)&&(C<=I||!ny(C)||v&&!this.bitrateTestDelay||C<l)){const t=this.forcedAutoLevel;return P===g||-1!==t&&t===g||(R.length&&this.trace("Skipped level(s) ".concat(R.join(",")," of ").concat(r,' max with CODECS and VIDEO-RANGE:"').concat(f[R[0]].codecs,'" ').concat(f[R[0]].videoRange,'; not compatible with "').concat(_,'" ').concat(w)),this.info("switch candidate:".concat(u,"->").concat(P," adjustedbw(").concat(Math.round(y),")-bitrate=").concat(Math.round(y-T)," ttfb:").concat(I.toFixed(1)," avgDuration:").concat(p.toFixed(1)," maxFetchDuration:").concat(l.toFixed(1)," fetchDuration:").concat(C.toFixed(1)," firstSelection:").concat(b," codecSet:").concat(e.codecSet," videoRange:").concat(e.videoRange," hls.loadLevel:").concat(g))),b&&(this.firstSelection=P),P}}return-1}set nextAutoLevel(t){const e=this.deriveNextAutoLevel(t);this._nextAutoLevel!==e&&(this.nextAutoLevelKey="",this._nextAutoLevel=e)}deriveNextAutoLevel(t){const{maxAutoLevel:e,minAutoLevel:r}=this.hls;return Math.min(Math.max(t,r),e)}},bufferController:class extends Ey{constructor(t,e){var r;super("buffer-controller",t.logger),this.hls=void 0,this.fragmentTracker=void 0,this.details=null,this._objectUrl=null,this.operationQueue=null,this.bufferCodecEventsTotal=0,this.media=null,this.mediaSource=null,this.lastMpegAudioChunk=null,this.blockedAudioAppend=null,this.lastVideoAppendEnd=0,this.appendSource=void 0,this.transferData=void 0,this.overrides=void 0,this.appendErrors={audio:0,video:0,audiovideo:0},this.tracks={},this.sourceBuffers=[[null,null],[null,null]],this._onEndStreaming=t=>{var e;this.hls&&"open"===(null==(e=this.mediaSource)?void 0:e.readyState)&&this.hls.pauseBuffering()},this._onStartStreaming=t=>{this.hls&&this.hls.resumeBuffering()},this._onMediaSourceOpen=t=>{const{media:e,mediaSource:r}=this;t&&this.log("Media source opened"),e&&r&&(r.removeEventListener("sourceopen",this._onMediaSourceOpen),e.removeEventListener("emptied",this._onMediaEmptied),this.updateDuration(),this.hls.trigger(ly.MEDIA_ATTACHED,{media:e,mediaSource:r}),null!==this.mediaSource&&this.checkPendingTracks())},this._onMediaSourceClose=()=>{this.log("Media source closed")},this._onMediaSourceEnded=()=>{this.log("Media source ended")},this._onMediaEmptied=()=>{const{mediaSrc:t,_objectUrl:e}=this;t!==e&&this.error("Media element src was set while attaching MediaSource (".concat(e," > ").concat(t,")"))},this.hls=t,this.fragmentTracker=e,this.appendSource=(r=Ry(t.config.preferManagedMediaSource),"undefined"!==typeof self&&r===self.ManagedMediaSource),this.initTracks(),this.registerListeners()}hasSourceTypes(){return Object.keys(this.tracks).length>0}destroy(){this.unregisterListeners(),this.details=null,this.lastMpegAudioChunk=this.blockedAudioAppend=null,this.transferData=this.overrides=void 0,this.operationQueue&&(this.operationQueue.destroy(),this.operationQueue=null),this.hls=this.fragmentTracker=null,this._onMediaSourceOpen=this._onMediaSourceClose=null,this._onMediaSourceEnded=null,this._onStartStreaming=this._onEndStreaming=null}registerListeners(){const{hls:t}=this;t.on(ly.MEDIA_ATTACHING,this.onMediaAttaching,this),t.on(ly.MEDIA_DETACHING,this.onMediaDetaching,this),t.on(ly.MANIFEST_LOADING,this.onManifestLoading,this),t.on(ly.MANIFEST_PARSED,this.onManifestParsed,this),t.on(ly.BUFFER_RESET,this.onBufferReset,this),t.on(ly.BUFFER_APPENDING,this.onBufferAppending,this),t.on(ly.BUFFER_CODECS,this.onBufferCodecs,this),t.on(ly.BUFFER_EOS,this.onBufferEos,this),t.on(ly.BUFFER_FLUSHING,this.onBufferFlushing,this),t.on(ly.LEVEL_UPDATED,this.onLevelUpdated,this),t.on(ly.FRAG_PARSED,this.onFragParsed,this),t.on(ly.FRAG_CHANGED,this.onFragChanged,this),t.on(ly.ERROR,this.onError,this)}unregisterListeners(){const{hls:t}=this;t.off(ly.MEDIA_ATTACHING,this.onMediaAttaching,this),t.off(ly.MEDIA_DETACHING,this.onMediaDetaching,this),t.off(ly.MANIFEST_LOADING,this.onManifestLoading,this),t.off(ly.MANIFEST_PARSED,this.onManifestParsed,this),t.off(ly.BUFFER_RESET,this.onBufferReset,this),t.off(ly.BUFFER_APPENDING,this.onBufferAppending,this),t.off(ly.BUFFER_CODECS,this.onBufferCodecs,this),t.off(ly.BUFFER_EOS,this.onBufferEos,this),t.off(ly.BUFFER_FLUSHING,this.onBufferFlushing,this),t.off(ly.LEVEL_UPDATED,this.onLevelUpdated,this),t.off(ly.FRAG_PARSED,this.onFragParsed,this),t.off(ly.FRAG_CHANGED,this.onFragChanged,this),t.off(ly.ERROR,this.onError,this)}transferMedia(){const{media:t,mediaSource:e}=this;if(!t)return null;const r={};if(this.operationQueue){const t=this.isUpdating();t||this.operationQueue.removeBlockers();const e=this.isQueued();(t||e)&&this.warn("Transfering MediaSource with".concat(e?" operations in queue":"").concat(t?" updating SourceBuffer(s)":""," ").concat(this.operationQueue)),this.operationQueue.destroy()}const n=this.transferData;return!this.sourceBufferCount&&n&&n.mediaSource===e?by(r,n.tracks):this.sourceBuffers.forEach(t=>{const[e]=t;e&&(r[e]=by({},this.tracks[e]),this.removeBuffer(e)),t[0]=t[1]=null}),{media:t,mediaSource:e,tracks:r}}initTracks(){this.sourceBuffers=[[null,null],[null,null]],this.tracks={},this.resetQueue(),this.resetAppendErrors(),this.lastMpegAudioChunk=this.blockedAudioAppend=null,this.lastVideoAppendEnd=0}onManifestLoading(){this.bufferCodecEventsTotal=0,this.details=null}onManifestParsed(t,e){var r;let n=2;(e.audio&&!e.video||!e.altAudio)&&(n=1),this.bufferCodecEventsTotal=n,this.log("".concat(n," bufferCodec event(s) expected.")),null!=(r=this.transferData)&&r.mediaSource&&this.sourceBufferCount&&n&&this.bufferCreated()}onMediaAttaching(t,e){const r=this.media=e.media;this.transferData=this.overrides=void 0;const n=Ry(this.appendSource);if(n){const t=!!e.mediaSource;(t||e.overrides)&&(this.transferData=e,this.overrides=e.overrides);const i=this.mediaSource=e.mediaSource||new n;if(this.assignMediaSource(i),t)this._objectUrl=r.src,this.attachTransferred();else{const t=this._objectUrl=self.URL.createObjectURL(i);if(this.appendSource)try{r.removeAttribute("src");const e=self.ManagedMediaSource;r.disableRemotePlayback=r.disableRemotePlayback||e&&i instanceof e,gS(r),function(t,e){const r=self.document.createElement("source");r.type="video/mp4",r.src=e,t.appendChild(r)}(r,t),r.load()}catch(cg){r.src=t}else r.src=t}r.addEventListener("emptied",this._onMediaEmptied)}}assignMediaSource(t){var e,r;this.log("".concat((null==(e=this.transferData)?void 0:e.mediaSource)===t?"transferred":"created"," media source: ").concat(null==(r=t.constructor)?void 0:r.name)),t.addEventListener("sourceopen",this._onMediaSourceOpen),t.addEventListener("sourceended",this._onMediaSourceEnded),t.addEventListener("sourceclose",this._onMediaSourceClose),this.appendSource&&(t.addEventListener("startstreaming",this._onStartStreaming),t.addEventListener("endstreaming",this._onEndStreaming))}attachTransferred(){const t=this.media,e=this.transferData;if(!e||!t)return;const r=this.tracks,n=e.tracks,i=n?Object.keys(n):null,s=i?i.length:0,a=()=>{Promise.resolve().then(()=>{this.media&&this.mediaSourceOpenOrEnded&&this._onMediaSourceOpen()})};if(n&&i&&s){if(!this.tracksReady)return this.hls.config.startFragPrefetch=!0,void this.log("attachTransferred: waiting for SourceBuffer track info");if(this.log("attachTransferred: (bufferCodecEventsTotal ".concat(this.bufferCodecEventsTotal,")\nrequired tracks: ").concat(Zv(r,(t,e)=>"initSegment"===t?void 0:e),";\ntransfer tracks: ").concat(Zv(n,(t,e)=>"initSegment"===t?void 0:e),"}")),!Ly(n,r)){e.mediaSource=null,e.tracks=void 0;const i=t.currentTime,s=this.details,a=Math.max(i,(null==s?void 0:s.fragments[0].start)||0);return a-i>1?void this.log("attachTransferred: waiting for playback to reach new tracks start time ".concat(i," -> ").concat(a)):(this.warn('attachTransferred: resetting MediaSource for incompatible tracks ("'.concat(Object.keys(n),'"->"').concat(Object.keys(r),'") start time: ').concat(a," currentTime: ").concat(i)),this.onMediaDetaching(ly.MEDIA_DETACHING,{}),this.onMediaAttaching(ly.MEDIA_ATTACHING,e),void(t.currentTime=a))}this.transferData=void 0,i.forEach(t=>{const e=t,r=n[e];if(r){const t=r.buffer;if(t){const n=this.fragmentTracker,i=r.id;if(n.hasFragments(i)||n.hasParts(i)){const r=$b.getBuffered(t);n.detectEvictedFragments(e,r,i,null,!0)}const s=mS(e),a=[e,t];this.sourceBuffers[s]=a,t.updating&&this.operationQueue&&this.operationQueue.prependBlocker(e),this.trackSourceBuffer(e,r)}}}),a(),this.bufferCreated()}else this.log("attachTransferred: MediaSource w/o SourceBuffers"),a()}get mediaSourceOpenOrEnded(){var t;const e=null==(t=this.mediaSource)?void 0:t.readyState;return"open"===e||"ended"===e}onMediaDetaching(t,e){const r=!!e.transferMedia;this.transferData=this.overrides=void 0;const{media:n,mediaSource:i,_objectUrl:s}=this;if(i){if(this.log("media source ".concat(r?"transferring":"detaching")),r)this.sourceBuffers.forEach(t=>{let[e]=t;e&&this.removeBuffer(e)}),this.resetQueue();else{if(this.mediaSourceOpenOrEnded){const t="open"===i.readyState;try{const e=i.sourceBuffers;for(let r=e.length;r--;)t&&e[r].abort(),i.removeSourceBuffer(e[r]);t&&i.endOfStream()}catch(Dd){this.warn("onMediaDetaching: ".concat(Dd.message," while calling endOfStream"))}}this.sourceBufferCount&&this.onBufferReset()}i.removeEventListener("sourceopen",this._onMediaSourceOpen),i.removeEventListener("sourceended",this._onMediaSourceEnded),i.removeEventListener("sourceclose",this._onMediaSourceClose),this.appendSource&&(i.removeEventListener("startstreaming",this._onStartStreaming),i.removeEventListener("endstreaming",this._onEndStreaming)),this.mediaSource=null,this._objectUrl=null}n&&(n.removeEventListener("emptied",this._onMediaEmptied),r||(s&&self.URL.revokeObjectURL(s),this.mediaSrc===s?(n.removeAttribute("src"),this.appendSource&&gS(n),n.load()):this.warn("media|source.src was changed by a third party - skip cleanup")),this.media=null),this.hls.trigger(ly.MEDIA_DETACHED,e)}onBufferReset(){this.sourceBuffers.forEach(t=>{let[e]=t;e&&this.resetBuffer(e)}),this.initTracks()}resetBuffer(t){var e;const r=null==(e=this.tracks[t])?void 0:e.buffer;if(this.removeBuffer(t),r)try{var n;null!=(n=this.mediaSource)&&n.sourceBuffers.length&&this.mediaSource.removeSourceBuffer(r)}catch(Dd){this.warn("onBufferReset ".concat(t),Dd)}delete this.tracks[t]}removeBuffer(t){this.removeBufferListeners(t),this.sourceBuffers[mS(t)]=[null,null];const e=this.tracks[t];e&&(e.buffer=void 0)}resetQueue(){this.operationQueue&&this.operationQueue.destroy(),this.operationQueue=new hS(this.tracks)}onBufferCodecs(t,e){var r;const n=this.tracks,i=Object.keys(e);this.log('BUFFER_CODECS: "'.concat(i,'" (current SB count ').concat(this.sourceBufferCount,")"));const s="audiovideo"in e&&(n.audio||n.video)||n.audiovideo&&("audio"in e||"video"in e),a=!s&&this.sourceBufferCount&&this.media&&i.some(t=>!n[t]);s||a?this.warn('Unsupported transition between "'.concat(Object.keys(n),'" and "').concat(i,'" SourceBuffers')):(i.forEach(t=>{var r,i;const s=e[t],{id:a,codec:o,levelCodec:l,container:c,metadata:u,supplemental:h}=s;let d=n[t];const f=null==(r=this.transferData)||null==(r=r.tracks)?void 0:r[t],p=null!=f&&f.buffer?f:d,g=(null==p?void 0:p.pendingCodec)||(null==p?void 0:p.codec),m=null==p?void 0:p.levelCodec;d||(d=n[t]={buffer:void 0,listeners:[],codec:o,supplemental:h,container:c,levelCodec:l,metadata:u,id:a});const y=Lv(g,m),v=null==y?void 0:y.replace(dS,"$1");let b=Lv(o,l);const _=null==(i=b)?void 0:i.replace(dS,"$1");b&&y&&v!==_&&("audio"===t.slice(0,5)&&(b=Rv(b,this.appendSource)),this.log("switching codec ".concat(g," to ").concat(b)),b!==(d.pendingCodec||d.codec)&&(d.pendingCodec=b),d.container=c,this.appendChangeType(t,c,b))}),(this.tracksReady||this.sourceBufferCount)&&(e.tracks=this.sourceBufferTracks),this.sourceBufferCount||(this.bufferCodecEventsTotal>1&&!this.tracks.video&&!e.video&&"main"===(null==(r=e.audio)?void 0:r.id)&&(this.log("Main audio-only"),this.bufferCodecEventsTotal=1),this.mediaSourceOpenOrEnded&&this.checkPendingTracks()))}get sourceBufferTracks(){return Object.keys(this.tracks).reduce((t,e)=>{const r=this.tracks[e];return t[e]={id:r.id,container:r.container,codec:r.codec,levelCodec:r.levelCodec},t},{})}appendChangeType(t,e,r){const n="".concat(e,";codecs=").concat(r),i={label:"change-type=".concat(n),execute:()=>{const i=this.tracks[t];if(i){const s=i.buffer;null!=s&&s.changeType&&(this.log("changing ".concat(t," sourceBuffer type to ").concat(n)),s.changeType(n),i.codec=r,i.container=e)}this.shiftAndExecuteNext(t)},onStart:()=>{},onComplete:()=>{},onError:e=>{this.warn("Failed to change ".concat(t," SourceBuffer type"),e)}};this.append(i,t,this.isPending(this.tracks[t]))}blockAudio(t){var e;const r=t.start,n=r+.05*t.duration;if(!0===(null==(e=this.fragmentTracker.getAppendedFrag(r,fy))?void 0:e.gap))return;const i={label:"block-audio",execute:()=>{var t;const e=this.tracks.video;(this.lastVideoAppendEnd>n||null!=e&&e.buffer&&$b.isBuffered(e.buffer,n)||!0===(null==(t=this.fragmentTracker.getAppendedFrag(n,fy))?void 0:t.gap))&&(this.blockedAudioAppend=null,this.shiftAndExecuteNext("audio"))},onStart:()=>{},onComplete:()=>{},onError:t=>{this.warn("Error executing block-audio operation",t)}};this.blockedAudioAppend={op:i,frag:t},this.append(i,"audio",!0)}unblockAudio(){const{blockedAudioAppend:t,operationQueue:e}=this;t&&e&&(this.blockedAudioAppend=null,e.unblockAudio(t.op))}onBufferAppending(t,e){const{tracks:r}=this,{data:n,type:i,parent:s,frag:a,part:o,chunkMeta:l,offset:c}=e,u=l.buffering[i],{sn:h,cc:d}=a,f=self.performance.now();u.start=f;const p=a.stats.buffering,g=o?o.stats.buffering:null;0===p.start&&(p.start=f),g&&0===g.start&&(g.start=f);const m=r.audio;let y=!1;"audio"===i&&"audio/mpeg"===(null==m?void 0:m.container)&&(y=!this.lastMpegAudioChunk||1===l.id||this.lastMpegAudioChunk.sn!==l.sn,this.lastMpegAudioChunk=l);const v=r.video,b=null==v?void 0:v.buffer;if(b&&"initSegment"!==h){const t=o||a,e=this.blockedAudioAppend;if("audio"!==i||"main"===s||this.blockedAudioAppend||v.ending||v.ended){if("video"===i){const r=t.end;if(e){const t=e.frag.start;(r>t||r<this.lastVideoAppendEnd||$b.isBuffered(b,t))&&this.unblockAudio()}this.lastVideoAppendEnd=r}}else{const e=t.start+.05*t.duration,r=b.buffered,n=this.currentOp("video");r.length||n?!n&&!$b.isBuffered(b,e)&&this.lastVideoAppendEnd<e&&this.blockAudio(t):this.blockAudio(t)}}const _=(o||a).start,w={label:"append-".concat(i),execute:()=>{var t;u.executeStart=self.performance.now();const e=null==(t=this.tracks[i])?void 0:t.buffer;e&&(y?this.updateTimestampOffset(e,_,.1,i,h,d):void 0!==c&&ny(c)&&this.updateTimestampOffset(e,c,1e-6,i,h,d)),this.appendExecutor(n,i)},onStart:()=>{},onComplete:()=>{const t=self.performance.now();u.executeEnd=u.end=t,0===p.first&&(p.first=t),g&&0===g.first&&(g.first=t);const e={};this.sourceBuffers.forEach(t=>{let[r,n]=t;r&&(e[r]=$b.getBuffered(n))}),this.appendErrors[i]=0,"audio"===i||"video"===i?this.appendErrors.audiovideo=0:(this.appendErrors.audio=0,this.appendErrors.video=0),this.hls.trigger(ly.BUFFER_APPENDED,{type:i,frag:a,part:o,chunkMeta:l,parent:a.type,timeRanges:e})},onError:t=>{var e;const r={type:ay.MEDIA_ERROR,parent:a.type,details:oy.BUFFER_APPEND_ERROR,sourceBufferName:i,frag:a,part:o,chunkMeta:l,error:t,err:t,fatal:!1},n=null==(e=this.media)?void 0:e.error;if(t.code===DOMException.QUOTA_EXCEEDED_ERR||"QuotaExceededError"==t.name||"quota"in t)r.details=oy.BUFFER_FULL_ERROR;else if(t.code===DOMException.INVALID_STATE_ERR&&this.mediaSourceOpenOrEnded&&!n)r.errorAction=Ib(!0);else if(t.name===fS&&0===this.sourceBufferCount)r.errorAction=Ib(!0);else{const t=++this.appendErrors[i];this.warn("Failed ".concat(t,"/").concat(this.hls.config.appendErrorMaxRetry,' times to append segment in "').concat(i,'" sourceBuffer (').concat(n||"no media error",")")),(t>=this.hls.config.appendErrorMaxRetry||n)&&(r.fatal=!0)}this.hls.trigger(ly.ERROR,r)}};this.log('queuing "'.concat(i,'" append sn: ').concat(h).concat(o?" p: "+o.index:""," of ").concat(a.type===fy?"level":"track"," ").concat(a.level," cc: ").concat(d)),this.append(w,i,this.isPending(this.tracks[i]))}getFlushOp(t,e,r){return this.log('queuing "'.concat(t,'" remove ').concat(e,"-").concat(r)),{label:"remove",execute:()=>{this.removeExecutor(t,e,r)},onStart:()=>{},onComplete:()=>{this.hls.trigger(ly.BUFFER_FLUSHED,{type:t})},onError:n=>{this.warn("Failed to remove ".concat(e,"-").concat(r,' from "').concat(t,'" SourceBuffer'),n)}}}onBufferFlushing(t,e){const{type:r,startOffset:n,endOffset:i}=e;r?this.append(this.getFlushOp(r,n,i),r):this.sourceBuffers.forEach(t=>{let[e]=t;e&&this.append(this.getFlushOp(e,n,i),e)})}onFragParsed(t,e){const{frag:r,part:n}=e,i=[],s=n?n.elementaryStreams:r.elementaryStreams;s[zy]?i.push("audiovideo"):(s[By]&&i.push("audio"),s[jy]&&i.push("video"));0===i.length&&this.warn("Fragments must have at least one ElementaryStreamType set. type: ".concat(r.type," level: ").concat(r.level," sn: ").concat(r.sn)),this.blockBuffers(()=>{const t=self.performance.now();r.stats.buffering.end=t,n&&(n.stats.buffering.end=t);const e=n?n.stats:r.stats;this.hls.trigger(ly.FRAG_BUFFERED,{frag:r,part:n,stats:e,id:r.type})},i).catch(t=>{this.warn("Fragment buffered callback ".concat(t)),this.stepOperationQueue(this.sourceBufferTypes)})}onFragChanged(t,e){this.trimBuffers()}get bufferedToEnd(){return this.sourceBufferCount>0&&!this.sourceBuffers.some(t=>{let[e]=t;if(e){const t=this.tracks[e];if(t)return!t.ended||t.ending}return!1})}onBufferEos(t,e){var r;this.sourceBuffers.forEach(t=>{let[r]=t;if(r){const t=this.tracks[r];e.type&&e.type!==r||(t.ending=!0,t.ended||(t.ended=!0,this.log("".concat(r," buffer reached EOS"))))}});const n=!1!==(null==(r=this.overrides)?void 0:r.endOfStream);this.sourceBufferCount>0&&!this.sourceBuffers.some(t=>{let[e]=t;var r;return e&&!(null!=(r=this.tracks[e])&&r.ended)})?n?(this.log("Queueing EOS"),this.blockUntilOpen(()=>{this.tracksEnded();const{mediaSource:t}=this;t&&"open"===t.readyState?(this.log("Calling mediaSource.endOfStream()"),t.endOfStream(),this.hls.trigger(ly.BUFFERED_TO_END,void 0)):t&&this.log("Could not call mediaSource.endOfStream(). mediaSource.readyState: ".concat(t.readyState))})):(this.tracksEnded(),this.hls.trigger(ly.BUFFERED_TO_END,void 0)):"video"===e.type&&this.unblockAudio()}tracksEnded(){this.sourceBuffers.forEach(t=>{let[e]=t;if(null!==e){const t=this.tracks[e];t&&(t.ending=!1)}})}onLevelUpdated(t,e){let{details:r}=e;r.fragments.length&&(this.details=r,this.updateDuration())}updateDuration(){this.blockUntilOpen(()=>{const t=this.getDurationAndRange();t&&this.updateMediaSource(t)})}onError(t,e){if(e.details===oy.BUFFER_APPEND_ERROR&&e.frag){var r;const t=null==(r=e.errorAction)?void 0:r.nextAutoLevel;ny(t)&&t!==e.frag.level&&this.resetAppendErrors()}}resetAppendErrors(){this.appendErrors={audio:0,video:0,audiovideo:0}}trimBuffers(){const{hls:t,details:e,media:r}=this;if(!r||null===e)return;if(!this.sourceBufferCount)return;const n=t.config,i=r.currentTime,s=e.levelTargetDuration,a=e.live&&null!==n.liveBackBufferLength?n.liveBackBufferLength:n.backBufferLength;if(ny(a)&&a>=0){const t=Math.max(a,s),e=Math.floor(i/s)*s-t;this.flushBackBuffer(i,s,e)}const o=n.frontBufferFlushThreshold;if(ny(o)&&o>0){const t=Math.max(n.maxBufferLength,o),e=Math.max(t,s),r=Math.floor(i/s)*s+e;this.flushFrontBuffer(i,s,r)}}flushBackBuffer(t,e,r){this.sourceBuffers.forEach(t=>{let[e,n]=t;if(n){const t=$b.getBuffered(n);if(t.length>0&&r>t.start(0)){var i;this.hls.trigger(ly.BACK_BUFFER_REACHED,{bufferEnd:r});const t=this.tracks[e];if(null!=(i=this.details)&&i.live)this.hls.trigger(ly.LIVE_BACK_BUFFER_REACHED,{bufferEnd:r});else if(null!=t&&t.ended)return void this.log("Cannot flush ".concat(e," back buffer while SourceBuffer is in ended state"));this.hls.trigger(ly.BUFFER_FLUSHING,{startOffset:0,endOffset:r,type:e})}}})}flushFrontBuffer(t,e,r){this.sourceBuffers.forEach(e=>{let[n,i]=e;if(i){const e=$b.getBuffered(i),s=e.length;if(s<2)return;const a=e.start(s-1),o=e.end(s-1);if(r>a||t>=a&&t<=o)return;this.hls.trigger(ly.BUFFER_FLUSHING,{startOffset:a,endOffset:1/0,type:n})}})}getDurationAndRange(){var t;const{details:e,mediaSource:r}=this;if(!e||!this.media||"open"!==(null==r?void 0:r.readyState))return null;const n=e.edge;if(e.live&&this.hls.config.liveDurationInfinity){if(e.fragments.length&&r.setLiveSeekableRange){const t=Math.max(0,e.fragmentStart);return{duration:1/0,start:t,end:Math.max(t,n)}}return{duration:1/0}}const i=null==(t=this.overrides)?void 0:t.duration;if(i)return ny(i)?{duration:i}:null;const s=this.media.duration;return n>(ny(r.duration)?r.duration:0)&&n>s||!ny(s)?{duration:n}:null}updateMediaSource(t){let{duration:e,start:r,end:n}=t;const i=this.mediaSource;this.media&&i&&"open"===i.readyState&&(i.duration!==e&&(ny(e)&&this.log("Updating MediaSource duration to ".concat(e.toFixed(3))),i.duration=e),void 0!==r&&void 0!==n&&(this.log("MediaSource duration is set to ".concat(i.duration,". Setting seekable range to ").concat(r,"-").concat(n,".")),i.setLiveSeekableRange(r,n)))}get tracksReady(){const t=this.pendingTrackCount;return t>0&&(t>=this.bufferCodecEventsTotal||this.isPending(this.tracks.audiovideo))}checkPendingTracks(){const{bufferCodecEventsTotal:t,pendingTrackCount:e,tracks:r}=this;if(this.log("checkPendingTracks (pending: ".concat(e," codec events expected: ").concat(t,") ").concat(Zv(r))),this.tracksReady){var n;const t=null==(n=this.transferData)?void 0:n.tracks;t&&Object.keys(t).length?this.attachTransferred():this.createSourceBuffers()}}bufferCreated(){if(this.sourceBufferCount){const t={};this.sourceBuffers.forEach(e=>{let[r,n]=e;if(r){const e=this.tracks[r];t[r]={buffer:n,container:e.container,codec:e.codec,supplemental:e.supplemental,levelCodec:e.levelCodec,id:e.id,metadata:e.metadata}}}),this.hls.trigger(ly.BUFFER_CREATED,{tracks:t}),this.log("SourceBuffers created. Running queue: ".concat(this.operationQueue)),this.sourceBuffers.forEach(t=>{let[e]=t;this.executeNext(e)})}else{const t=new Error("could not create source buffer for media codec(s)");this.hls.trigger(ly.ERROR,{type:ay.MEDIA_ERROR,details:oy.BUFFER_INCOMPATIBLE_CODECS_ERROR,fatal:!0,error:t,reason:t.message})}}createSourceBuffers(){const{tracks:t,sourceBuffers:e,mediaSource:r}=this;if(!r)throw new Error("createSourceBuffers called when mediaSource was null");for(const i in t){const s=i,a=t[s];if(this.isPending(a)){const t=this.getTrackCodec(a,s),i="".concat(a.container,";codecs=").concat(t);a.codec=t,this.log("creating sourceBuffer(".concat(i,")").concat(this.currentOp(s)?" Queued":""," ").concat(Zv(a)));try{const t=r.addSourceBuffer(i),n=mS(s),o=[s,t];e[n]=o,a.buffer=t}catch(cg){var n;return this.error("error while trying to add sourceBuffer: ".concat(cg.message)),this.shiftAndExecuteNext(s),null==(n=this.operationQueue)||n.removeBlockers(),delete this.tracks[s],void this.hls.trigger(ly.ERROR,{type:ay.MEDIA_ERROR,details:oy.BUFFER_ADD_CODEC_ERROR,fatal:!1,error:cg,sourceBufferName:s,mimeType:i,parent:a.id})}this.trackSourceBuffer(s,a)}}this.bufferCreated()}getTrackCodec(t,e){const r=t.supplemental;let n=t.codec;r&&("video"===e||"audiovideo"===e)&&Ev(r,"video")&&(n=function(t,e){const r=[];if(t){const e=t.split(",");for(let t=0;t<e.length;t++)wv(e[t],"video")||r.push(e[t])}return e&&r.push(e),r.join(",")}(n,r));const i=Lv(n,t.levelCodec);return i?"audio"===e.slice(0,5)?Rv(i,this.appendSource):i:""}trackSourceBuffer(t,e){const r=e.buffer;if(!r)return;const n=this.getTrackCodec(e,t);this.tracks[t]={buffer:r,codec:n,container:e.container,levelCodec:e.levelCodec,supplemental:e.supplemental,metadata:e.metadata,id:e.id,listeners:[]},this.removeBufferListeners(t),this.addBufferListener(t,"updatestart",this.onSBUpdateStart),this.addBufferListener(t,"updateend",this.onSBUpdateEnd),this.addBufferListener(t,"error",this.onSBUpdateError),this.appendSource&&this.addBufferListener(t,"bufferedchange",(t,e)=>{const r=e.removedRanges;null!=r&&r.length&&this.hls.trigger(ly.BUFFER_FLUSHED,{type:t})})}get mediaSrc(){var t,e;const r=(null==(t=this.media)||null==(e=t.querySelector)?void 0:e.call(t,"source"))||this.media;return null==r?void 0:r.src}onSBUpdateStart(t){const e=this.currentOp(t);e&&e.onStart()}onSBUpdateEnd(t){var e;if("closed"===(null==(e=this.mediaSource)?void 0:e.readyState))return void this.resetBuffer(t);const r=this.currentOp(t);r&&(r.onComplete(),this.shiftAndExecuteNext(t))}onSBUpdateError(t,e){var r;const n=new Error("".concat(t," SourceBuffer error. MediaSource readyState: ").concat(null==(r=this.mediaSource)?void 0:r.readyState));this.error("".concat(n),e),this.hls.trigger(ly.ERROR,{type:ay.MEDIA_ERROR,details:oy.BUFFER_APPENDING_ERROR,sourceBufferName:t,error:n,fatal:!1});const i=this.currentOp(t);i&&i.onError(n)}updateTimestampOffset(t,e,r,n,i,s){const a=e-t.timestampOffset;Math.abs(a)>=r&&(this.log("Updating ".concat(n," SourceBuffer timestampOffset to ").concat(e," (sn: ").concat(i," cc: ").concat(s,")")),t.timestampOffset=e)}removeExecutor(t,e,r){const{media:n,mediaSource:i}=this,s=this.tracks[t],a=null==s?void 0:s.buffer;if(!n||!i||!a)return this.warn("Attempting to remove from the ".concat(t," SourceBuffer, but it does not exist")),void this.shiftAndExecuteNext(t);const o=ny(n.duration)?n.duration:1/0,l=ny(i.duration)?i.duration:1/0,c=Math.max(0,e),u=Math.min(r,o,l);u>c&&(!s.ending||s.ended)?(s.ended=!1,this.log("Removing [".concat(c,",").concat(u,"] from the ").concat(t," SourceBuffer")),a.remove(c,u)):this.shiftAndExecuteNext(t)}appendExecutor(t,e){const r=this.tracks[e],n=null==r?void 0:r.buffer;if(!n)throw new pS("Attempting to append to the ".concat(e," SourceBuffer, but it does not exist"));r.ending=!1,r.ended=!1,n.appendBuffer(t)}blockUntilOpen(t){if(this.isUpdating()||this.isQueued())this.blockBuffers(t).catch(t=>{this.warn("SourceBuffer blocked callback ".concat(t)),this.stepOperationQueue(this.sourceBufferTypes)});else try{t()}catch(cg){this.warn("Callback run without blocking ".concat(this.operationQueue," ").concat(cg))}}isUpdating(){return this.sourceBuffers.some(t=>{let[e,r]=t;return e&&r.updating})}isQueued(){return this.sourceBuffers.some(t=>{let[e]=t;return e&&!!this.currentOp(e)})}isPending(t){return!!t&&!t.buffer}blockBuffers(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.sourceBufferTypes;if(!e.length)return this.log("Blocking operation requested, but no SourceBuffers exist"),Promise.resolve().then(t);const{operationQueue:r}=this,n=e.map(t=>this.appendBlocker(t));return e.length>1&&!!this.blockedAudioAppend&&this.unblockAudio(),Promise.all(n).then(e=>{r===this.operationQueue&&(t(),this.stepOperationQueue(this.sourceBufferTypes))})}stepOperationQueue(t){t.forEach(t=>{var e;const r=null==(e=this.tracks[t])?void 0:e.buffer;r&&!r.updating&&this.shiftAndExecuteNext(t)})}append(t,e,r){this.operationQueue&&this.operationQueue.append(t,e,r)}appendBlocker(t){if(this.operationQueue)return this.operationQueue.appendBlocker(t)}currentOp(t){return this.operationQueue?this.operationQueue.current(t):null}executeNext(t){t&&this.operationQueue&&this.operationQueue.executeNext(t)}shiftAndExecuteNext(t){this.operationQueue&&this.operationQueue.shiftAndExecuteNext(t)}get pendingTrackCount(){return Object.keys(this.tracks).reduce((t,e)=>t+(this.isPending(this.tracks[e])?1:0),0)}get sourceBufferCount(){return this.sourceBuffers.reduce((t,e)=>{let[r]=e;return t+(r?1:0)},0)}get sourceBufferTypes(){return this.sourceBuffers.map(t=>{let[e]=t;return e}).filter(t=>!!t)}addBufferListener(t,e,r){const n=this.tracks[t];if(!n)return;const i=n.buffer;if(!i)return;const s=r.bind(this,t);n.listeners.push({event:e,listener:s}),i.addEventListener(e,s)}removeBufferListeners(t){const e=this.tracks[t];if(!e)return;const r=e.buffer;r&&(e.listeners.forEach(t=>{r.removeEventListener(t.event,t.listener)}),e.listeners.length=0)}},capLevelController:yS,errorController:class extends Ey{constructor(t){super("error-controller",t.logger),this.hls=void 0,this.playlistError=0,this.hls=t,this.registerListeners()}registerListeners(){const t=this.hls;t.on(ly.ERROR,this.onError,this),t.on(ly.MANIFEST_LOADING,this.onManifestLoading,this),t.on(ly.LEVEL_UPDATED,this.onLevelUpdated,this)}unregisterListeners(){const t=this.hls;t&&(t.off(ly.ERROR,this.onError,this),t.off(ly.ERROR,this.onErrorOut,this),t.off(ly.MANIFEST_LOADING,this.onManifestLoading,this),t.off(ly.LEVEL_UPDATED,this.onLevelUpdated,this))}destroy(){this.unregisterListeners(),this.hls=null}startLoad(t){}stopLoad(){this.playlistError=0}getVariantLevelIndex(t){return(null==t?void 0:t.type)===fy?t.level:this.getVariantIndex()}getVariantIndex(){var t;const e=this.hls,r=e.currentLevel;return null!=(t=e.loadLevelObj)&&t.details||-1===r?e.loadLevel:r}variantHasKey(t,e){if(t){var r;if(null!=(r=t.details)&&r.hasKey(e))return!0;const n=t.audioGroups;if(n){return this.hls.allAudioTracks.filter(t=>n.indexOf(t.groupId)>=0).some(t=>{var r;return null==(r=t.details)?void 0:r.hasKey(e)})}}return!1}onManifestLoading(){this.playlistError=0}onLevelUpdated(){this.playlistError=0}onError(t,e){var r;if(e.fatal)return;const n=this.hls,i=e.context;switch(e.details){case oy.FRAG_LOAD_ERROR:case oy.FRAG_LOAD_TIMEOUT:case oy.KEY_LOAD_ERROR:case oy.KEY_LOAD_TIMEOUT:return void(e.errorAction=this.getFragRetryOrSwitchAction(e));case oy.FRAG_PARSING_ERROR:if(null!=(r=e.frag)&&r.gap)return void(e.errorAction=Ib());case oy.FRAG_GAP:case oy.FRAG_DECRYPT_ERROR:return e.errorAction=this.getFragRetryOrSwitchAction(e),void(e.errorAction.action=wb);case oy.LEVEL_EMPTY_ERROR:case oy.LEVEL_PARSING_ERROR:{var s;const t=e.parent===fy?e.level:n.loadLevel;e.details===oy.LEVEL_EMPTY_ERROR&&null!=(s=e.context)&&null!=(s=s.levelDetails)&&s.live?e.errorAction=this.getPlaylistRetryOrSwitchAction(e,t):(e.levelRetry=!1,e.errorAction=this.getLevelSwitchAction(e,t))}return;case oy.LEVEL_LOAD_ERROR:case oy.LEVEL_LOAD_TIMEOUT:return void("number"===typeof(null==i?void 0:i.level)&&(e.errorAction=this.getPlaylistRetryOrSwitchAction(e,i.level)));case oy.AUDIO_TRACK_LOAD_ERROR:case oy.AUDIO_TRACK_LOAD_TIMEOUT:case oy.SUBTITLE_LOAD_ERROR:case oy.SUBTITLE_TRACK_LOAD_TIMEOUT:if(i){const t=n.loadLevelObj;if(t&&(i.type===hy&&t.hasAudioGroup(i.groupId)||i.type===dy&&t.hasSubtitleGroup(i.groupId)))return e.errorAction=this.getPlaylistRetryOrSwitchAction(e,n.loadLevel),e.errorAction.action=wb,void(e.errorAction.flags=kb)}return;case oy.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED:return void(e.errorAction={action:wb,flags:Ab});case oy.KEY_SYSTEM_SESSION_UPDATE_FAILED:case oy.KEY_SYSTEM_STATUS_INTERNAL_ERROR:case oy.KEY_SYSTEM_NO_SESSION:return void(e.errorAction={action:wb,flags:xb});case oy.BUFFER_ADD_CODEC_ERROR:case oy.REMUX_ALLOC_ERROR:case oy.BUFFER_APPEND_ERROR:var a;if(!e.errorAction)e.errorAction=this.getLevelSwitchAction(e,null!=(a=e.level)?a:n.loadLevel);return;case oy.INTERNAL_EXCEPTION:case oy.BUFFER_APPENDING_ERROR:case oy.BUFFER_FULL_ERROR:case oy.LEVEL_SWITCH_ERROR:case oy.BUFFER_STALLED_ERROR:case oy.BUFFER_SEEK_OVER_HOLE:case oy.BUFFER_NUDGE_ON_STALL:return void(e.errorAction=Ib())}e.type===ay.KEY_SYSTEM_ERROR&&(e.levelRetry=!1,e.errorAction=Ib())}getPlaylistRetryOrSwitchAction(t,e){const r=gb(this.hls.config.playlistLoadPolicy,t),n=this.playlistError++;if(vb(r,n,db(t),t.response))return{action:Sb,flags:Tb,retryConfig:r,retryCount:n};const i=this.getLevelSwitchAction(t,e);return r&&(i.retryConfig=r,i.retryCount=n),i}getFragRetryOrSwitchAction(t){const e=this.hls,r=this.getVariantLevelIndex(t.frag),n=e.levels[r],{fragLoadPolicy:i,keyLoadPolicy:s}=e.config,a=gb(fb(t)?s:i,t),o=e.levels.reduce((t,e)=>t+e.fragmentError,0);if(n&&(t.details!==oy.FRAG_GAP&&n.fragmentError++,!pb(t))){if(vb(a,o,db(t),t.response))return{action:Sb,flags:Tb,retryConfig:a,retryCount:o}}const l=this.getLevelSwitchAction(t,r);return a&&(l.retryConfig=a,l.retryCount=o),l}getLevelSwitchAction(t,e){const r=this.hls;null!==e&&void 0!==e||(e=r.loadLevel);const n=this.hls.levels[e];if(n){var i,s;const e=t.details;n.loadError++,e===oy.BUFFER_APPEND_ERROR&&n.fragmentError++;let l=-1;const{levels:c,loadLevel:u,minAutoLevel:h,maxAutoLevel:d}=r;r.autoLevelEnabled||r.config.preserveManualLevelOnError||(r.loadLevel=-1);const f=null==(i=t.frag)?void 0:i.type,p=(f===py&&e===oy.FRAG_PARSING_ERROR||"audio"===t.sourceBufferName&&(e===oy.BUFFER_ADD_CODEC_ERROR||e===oy.BUFFER_APPEND_ERROR))&&c.some(t=>{let{audioCodec:e}=t;return n.audioCodec!==e}),g="video"===t.sourceBufferName&&(e===oy.BUFFER_ADD_CODEC_ERROR||e===oy.BUFFER_APPEND_ERROR)&&c.some(t=>{let{codecSet:e,audioCodec:r}=t;return n.codecSet!==e&&n.audioCodec===r}),{type:m,groupId:y}=null!=(s=t.context)?s:{};for(let r=c.length;r--;){const i=(r+u)%c.length;if(i!==u&&i>=h&&i<=d&&0===c[i].loadError){var a,o;const r=c[i];if(e===oy.FRAG_GAP&&f===fy&&t.frag){const e=c[i].details;if(e){const r=lb(t.frag,e.fragments,t.frag.start);if(null!=r&&r.gap)continue}}else{if(m===hy&&r.hasAudioGroup(y)||m===dy&&r.hasSubtitleGroup(y))continue;if(f===py&&null!=(a=n.audioGroups)&&a.some(t=>r.hasAudioGroup(t))||f===gy&&null!=(o=n.subtitleGroups)&&o.some(t=>r.hasSubtitleGroup(t))||p&&n.audioCodec===r.audioCodec||g&&n.codecSet===r.codecSet||!p&&n.codecSet!==r.codecSet)continue}l=i;break}}if(l>-1&&r.loadLevel!==l)return t.levelRetry=!0,this.playlistError=0,{action:wb,flags:Tb,nextAutoLevel:l}}return{action:wb,flags:kb}}onErrorOut(t,e){var r;switch(null==(r=e.errorAction)?void 0:r.action){case _b:break;case wb:this.sendAlternateToPenaltyBox(e),e.errorAction.resolved||e.details===oy.FRAG_GAP?/MediaSource readyState: ended/.test(e.error.message)&&(this.warn('MediaSource ended after "'.concat(e.sourceBufferName,'" sourceBuffer append error. Attempting to recover from media error.')),this.hls.recoverMediaError()):e.fatal=!0}e.fatal&&this.hls.stopLoad()}sendAlternateToPenaltyBox(t){const e=this.hls,r=t.errorAction;if(!r)return;const{flags:n}=r,i=r.nextAutoLevel;switch(n){case Tb:this.switchLevel(t,i);break;case Ab:{const n=this.getVariantLevelIndex(t.frag),i=e.levels[n],s=null==i?void 0:i.attrs["HDCP-LEVEL"];if(r.hdcpLevel=s,"NONE"===s)this.warn("HDCP policy resticted output with HDCP-LEVEL=NONE");else if(s){e.maxHdcpLevel=Wv[Wv.indexOf(s)-1],r.resolved=!0,this.warn('Restricting playback to HDCP-LEVEL of "'.concat(e.maxHdcpLevel,'" or lower'));break}}case xb:{const e=t.decryptdata;if(e){const n=this.hls.levels,i=n.length;for(let r=i;r--;){var s,a;if(this.variantHasKey(n[r],e))this.log("Banned key found in level ".concat(r," (").concat(n[r].bitrate,'bps) or audio group "').concat(null==(s=n[r].audioGroups)?void 0:s.join(","),'" (').concat(null==(a=t.frag)?void 0:a.type," fragment) ").concat(Cy(e.keyId||[]))),n[r].fragmentError++,n[r].loadError++,this.log("Removing level ".concat(r," with key error (").concat(t.error,")")),this.hls.removeLevel(r)}const o=t.frag;if(this.hls.levels.length<i)r.resolved=!0;else if(o&&o.type!==fy){const t=o.decryptdata;t&&!e.matches(t)&&(r.resolved=!0)}}break}}r.resolved||this.switchLevel(t,i)}switchLevel(t,e){if(void 0!==e&&t.errorAction&&(this.warn("switching to level ".concat(e," after ").concat(t.details)),this.hls.nextAutoLevel=e,t.errorAction.resolved=!0,this.hls.nextLoadLevel=this.hls.nextAutoLevel,t.details===oy.BUFFER_ADD_CODEC_ERROR&&t.mimeType&&"audiovideo"!==t.sourceBufferName)){const e=Ov(t.mimeType),r=this.hls.levels;for(let n=r.length;n--;)r[n]["".concat(t.sourceBufferName,"Codec")]===e&&(this.log("Removing level ".concat(n," for ").concat(t.details,' ("').concat(e,'" not supported)')),this.hls.removeLevel(n))}}},fpsController:class{constructor(t){this.hls=void 0,this.isVideoPlaybackQualityAvailable=!1,this.timer=void 0,this.media=null,this.lastTime=void 0,this.lastDroppedFrames=0,this.lastDecodedFrames=0,this.streamController=void 0,this.hls=t,this.registerListeners()}setStreamController(t){this.streamController=t}registerListeners(){this.hls.on(ly.MEDIA_ATTACHING,this.onMediaAttaching,this),this.hls.on(ly.MEDIA_DETACHING,this.onMediaDetaching,this)}unregisterListeners(){this.hls.off(ly.MEDIA_ATTACHING,this.onMediaAttaching,this),this.hls.off(ly.MEDIA_DETACHING,this.onMediaDetaching,this)}destroy(){this.timer&&clearInterval(this.timer),this.unregisterListeners(),this.isVideoPlaybackQualityAvailable=!1,this.media=null}onMediaAttaching(t,e){const r=this.hls.config;if(r.capLevelOnFPSDrop){const t=e.media instanceof self.HTMLVideoElement?e.media:null;this.media=t,t&&"function"===typeof t.getVideoPlaybackQuality&&(this.isVideoPlaybackQualityAvailable=!0),self.clearInterval(this.timer),this.timer=self.setInterval(this.checkFPSInterval.bind(this),r.fpsDroppedMonitoringPeriod)}}onMediaDetaching(){this.media=null}checkFPS(t,e,r){const n=performance.now();if(e){if(this.lastTime){const t=n-this.lastTime,i=r-this.lastDroppedFrames,s=e-this.lastDecodedFrames,a=1e3*i/t,o=this.hls;if(o.trigger(ly.FPS_DROP,{currentDropped:i,currentDecoded:s,totalDroppedFrames:r}),a>0&&i>o.config.fpsDroppedMonitoringThreshold*s){let t=o.currentLevel;o.logger.warn("drop FPS ratio greater than max allowed value for currentLevel: "+t),t>0&&(-1===o.autoLevelCapping||o.autoLevelCapping>=t)&&(t-=1,o.trigger(ly.FPS_DROP_LEVEL_CAPPING,{level:t,droppedLevel:o.currentLevel}),o.autoLevelCapping=t,this.streamController.nextLevelSwitch())}}this.lastTime=n,this.lastDroppedFrames=r,this.lastDecodedFrames=e}}checkFPSInterval(){const t=this.media;if(t)if(this.isVideoPlaybackQualityAvailable){const e=t.getVideoPlaybackQuality();this.checkFPS(t,e.totalVideoFrames,e.droppedVideoFrames)}else this.checkFPS(t,t.webkitDecodedFrameCount,t.webkitDroppedFrameCount)}},stretchShortVideoTrack:!1,maxAudioFramesDrift:1,forceKeyFrameOnDiscontinuity:!0,abrEwmaFastLive:3,abrEwmaSlowLive:9,abrEwmaFastVoD:3,abrEwmaSlowVoD:9,abrEwmaDefaultEstimate:5e5,abrEwmaDefaultEstimateMax:5e6,abrBandWidthFactor:.95,abrBandWidthUpFactor:.7,abrMaxWithRealBitrate:!1,maxStarvationDelay:4,maxLoadingDelay:4,minAutoBitrate:0,emeEnabled:!1,widevineLicenseUrl:void 0,drmSystems:{},drmSystemOptions:{},requestMediaKeySystemAccessFunc:x_,requireKeySystemAccessOnStart:!1,testBandwidth:!0,progressive:!1,lowLatencyMode:!0,cmcd:void 0,enableDateRangeMetadataCues:!0,enableEmsgMetadataCues:!0,enableEmsgKLVMetadata:!1,enableID3MetadataCues:!0,enableInterstitialPlayback:!0,interstitialAppendInPlace:!0,interstitialLiveLookAhead:10,useMediaCapabilities:!0,preserveManualLevelOnError:!1,certLoadPolicy:{default:{maxTimeToFirstByteMs:8e3,maxLoadTimeMs:2e4,timeoutRetry:null,errorRetry:null}},keyLoadPolicy:{default:{maxTimeToFirstByteMs:8e3,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:2e4,backoff:"linear"},errorRetry:{maxNumRetry:8,retryDelayMs:1e3,maxRetryDelayMs:2e4,backoff:"linear"}}},manifestLoadPolicy:{default:{maxTimeToFirstByteMs:1/0,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},playlistLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:2,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},fragLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:12e4,timeoutRetry:{maxNumRetry:4,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:6,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},steeringManifestLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},interstitialAssetListLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:3e4,timeoutRetry:{maxNumRetry:0,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:0,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},manifestLoadingTimeOut:1e4,manifestLoadingMaxRetry:1,manifestLoadingRetryDelay:1e3,manifestLoadingMaxRetryTimeout:64e3,levelLoadingTimeOut:1e4,levelLoadingMaxRetry:4,levelLoadingRetryDelay:1e3,levelLoadingMaxRetryTimeout:64e3,fragLoadingTimeOut:2e4,fragLoadingMaxRetry:6,fragLoadingRetryDelay:1e3,fragLoadingMaxRetryTimeout:64e3},{cueHandler:Ok,enableWebVTT:!0,enableIMSC1:!0,enableCEA708Captions:!0,captionsTextTrack1Label:"English",captionsTextTrack1LanguageCode:"en",captionsTextTrack2Label:"Spanish",captionsTextTrack2LanguageCode:"es",captionsTextTrack3Label:"Unknown CC",captionsTextTrack3LanguageCode:"",captionsTextTrack4Label:"Unknown CC",captionsTextTrack4LanguageCode:"",renderTextTracksNatively:!0}),{},{subtitleStreamController:class extends Rw{constructor(t,e,r){super(t,e,r,"subtitle-stream-controller",gy),this.currentTrackId=-1,this.tracksBuffered=[],this.mainDetails=null,this.registerListeners()}onHandlerDestroying(){this.unregisterListeners(),super.onHandlerDestroying(),this.mainDetails=null}registerListeners(){super.registerListeners();const{hls:t}=this;t.on(ly.LEVEL_LOADED,this.onLevelLoaded,this),t.on(ly.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),t.on(ly.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),t.on(ly.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),t.on(ly.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),t.on(ly.BUFFER_FLUSHING,this.onBufferFlushing,this)}unregisterListeners(){super.unregisterListeners();const{hls:t}=this;t.off(ly.LEVEL_LOADED,this.onLevelLoaded,this),t.off(ly.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),t.off(ly.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),t.off(ly.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),t.off(ly.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),t.off(ly.BUFFER_FLUSHING,this.onBufferFlushing,this)}startLoad(t,e){this.stopLoad(),this.state=vw,this.setInterval(500),this.nextLoadPosition=this.lastCurrentTime=t+this.timelineOffset,this.startPosition=e?-1:t,this.tick()}onManifestLoading(){super.onManifestLoading(),this.mainDetails=null}onMediaDetaching(t,e){this.tracksBuffered=[],super.onMediaDetaching(t,e)}onLevelLoaded(t,e){this.mainDetails=e.details}onSubtitleFragProcessed(t,e){const{frag:r,success:n}=e;if(this.fragContextChanged(r)||(Gy(r)&&(this.fragPrevious=r),this.state=vw),!n)return;const i=this.tracksBuffered[this.currentTrackId];if(!i)return;let s;const a=r.start;for(let l=0;l<i.length;l++)if(a>=i[l].start&&a<=i[l].end){s=i[l];break}const o=r.start+r.duration;s?s.end=o:(s={start:a,end:o},i.push(s)),this.fragmentTracker.fragBuffered(r),this.fragBufferedComplete(r,null),this.media&&this.tick()}onBufferFlushing(t,e){const{startOffset:r,endOffset:n}=e;if(0===r&&n!==Number.POSITIVE_INFINITY){const t=n-1;if(t<=0)return;e.endOffsetSubtitles=Math.max(0,t),this.tracksBuffered.forEach(e=>{for(let r=0;r<e.length;)if(e[r].end<=t)e.shift();else{if(!(e[r].start<t))break;e[r].start=t,r++}}),this.fragmentTracker.removeFragmentsInRange(r,t,gy)}}onError(t,e){const r=e.frag;(null==r?void 0:r.type)===gy&&(e.details===oy.FRAG_GAP&&this.fragmentTracker.fragBuffered(r,!0),this.fragCurrent&&this.fragCurrent.abortRequests(),this.state!==yw&&(this.state=vw))}onSubtitleTracksUpdated(t,e){let{subtitleTracks:r}=e;this.levels&&lS(this.levels,r)?this.levels=r.map(t=>new Qv(t)):(this.tracksBuffered=[],this.levels=r.map(t=>{const e=new Qv(t);return this.tracksBuffered[e.id]=[],e}),this.fragmentTracker.removeFragmentsInRange(0,Number.POSITIVE_INFINITY,gy),this.fragPrevious=null,this.mediaBuffer=null)}onSubtitleTrackSwitch(t,e){var r;if(this.currentTrackId=e.id,null==(r=this.levels)||!r.length||-1===this.currentTrackId)return void this.clearInterval();const n=this.levels[this.currentTrackId];null!=n&&n.details?this.mediaBuffer=this.mediaBufferTimeRanges:this.mediaBuffer=null,n&&this.state!==yw&&this.setInterval(500)}onSubtitleTrackLoaded(t,e){var r;const{currentTrackId:n,levels:i}=this,{details:s,id:a}=e;if(!i)return void this.warn("Subtitle tracks were reset while loading level ".concat(a));const o=i[a];if(a>=i.length||!o)return;this.log("Subtitle track ".concat(a," loaded [").concat(s.startSN,",").concat(s.endSN,"]").concat(s.lastPartSn?"[part-".concat(s.lastPartSn,"-").concat(s.lastPartIndex,"]"):"",",duration:").concat(s.totalduration)),this.mediaBuffer=this.mediaBufferTimeRanges;let l=0;if(s.live||null!=(r=o.details)&&r.live){if(s.deltaUpdateFailed)return;const t=this.mainDetails;if(!t)return void(this.startFragRequested=!1);const e=t.fragments[0];var c;if(o.details)l=this.alignPlaylists(s,o.details,null==(c=this.levelLastLoaded)?void 0:c.details),0===l&&e&&(l=e.start,ew(s,l));else s.hasProgramDateTime&&t.hasProgramDateTime?(fw(s,t),l=s.fragmentStart):e&&(l=e.start,ew(s,l));t&&!this.startFragRequested&&this.setStartPosition(t,l)}if(o.details=s,this.levelLastLoaded=o,a===n&&(this.hls.trigger(ly.SUBTITLE_TRACK_UPDATED,{details:s,id:a,groupId:e.groupId}),this.tick(),s.live&&!this.fragCurrent&&this.media&&this.state===vw)){lb(null,s.fragments,this.media.currentTime,0)||(this.warn("Subtitle playlist not aligned with playback"),o.details=void 0)}}_handleFragmentLoadComplete(t){const{frag:e,payload:r}=t,n=e.decryptdata,i=this.hls;if(!this.fragContextChanged(e)&&r&&r.byteLength>0&&null!=n&&n.key&&n.iv&&d_(n.method)){const t=performance.now();this.decrypter.decrypt(new Uint8Array(r),n.key.buffer,n.iv.buffer,f_(n.method)).catch(t=>{throw i.trigger(ly.ERROR,{type:ay.MEDIA_ERROR,details:oy.FRAG_DECRYPT_ERROR,fatal:!1,error:t,reason:t.message,frag:e}),t}).then(r=>{const n=performance.now();i.trigger(ly.FRAG_DECRYPTED,{frag:e,payload:r,stats:{tstart:t,tdecrypt:n}})}).catch(t=>{this.warn("".concat(t.name,": ").concat(t.message)),this.state=vw})}}doTick(){if(this.media){if(this.state===vw){const{currentTrackId:t,levels:e}=this,r=null==e?void 0:e[t];if(!r||!e.length||!r.details)return;if(this.waitForLive(r))return;const{config:n}=this,i=this.getLoadPosition(),s=$b.bufferedInfo(this.tracksBuffered[this.currentTrackId]||[],i,n.maxBufferHole),{end:a,len:o}=s,l=r.details;if(o>this.hls.maxBufferLength+l.levelTargetDuration)return;const c=l.fragments,u=c.length,h=l.edge;let d=null;const f=this.fragPrevious;if(a<h){const t=n.maxFragLookUpTolerance,e=a>h-t?0:t;d=lb(f,c,Math.max(c[0].start,a),e),!d&&f&&f.start<c[0].start&&(d=c[0])}else d=c[u-1];if(d=this.filterReplacedPrimary(d,r.details),!d)return;const p=c[d.sn-l.startSN-1];if(p&&p.cc===d.cc&&this.fragmentTracker.getState(p)===Rb&&(d=p),this.fragmentTracker.getState(d)===Rb){const t=this.mapToInitFragWhenRequired(d);t&&this.loadFragment(t,r,a)}}}else this.state=vw}loadFragment(t,e,r){Gy(t)?super.loadFragment(t,e,r):this._loadInitSegment(t,e)}get mediaBufferTimeRanges(){return new UT(this.tracksBuffered[this.currentTrackId]||[])}},subtitleTrackController:class extends oS{constructor(t){super(t,"subtitle-track-controller"),this.media=null,this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0,this.queuedDefaultTrack=-1,this.useTextTrackPolling=!1,this.subtitlePollingInterval=-1,this._subtitleDisplay=!0,this.asyncPollTrackChange=()=>this.pollTrackChange(0),this.onTextTracksChanged=()=>{if(this.useTextTrackPolling||self.clearInterval(this.subtitlePollingInterval),!this.media||!this.hls.config.renderTextTracksNatively)return;let t=null;const e=ET(this.media.textTracks);for(let n=0;n<e.length;n++)if("hidden"===e[n].mode)t=e[n];else if("showing"===e[n].mode){t=e[n];break}const r=this.findTrackForTextTrack(t);this.subtitleTrack!==r&&this.setSubtitleTrack(r)},this.registerListeners()}destroy(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.currentTrack=null,this.onTextTracksChanged=this.asyncPollTrackChange=null,super.destroy()}get subtitleDisplay(){return this._subtitleDisplay}set subtitleDisplay(t){this._subtitleDisplay=t,this.trackId>-1&&this.toggleTrackModes()}registerListeners(){const{hls:t}=this;t.on(ly.MEDIA_ATTACHED,this.onMediaAttached,this),t.on(ly.MEDIA_DETACHING,this.onMediaDetaching,this),t.on(ly.MANIFEST_LOADING,this.onManifestLoading,this),t.on(ly.MANIFEST_PARSED,this.onManifestParsed,this),t.on(ly.LEVEL_LOADING,this.onLevelLoading,this),t.on(ly.LEVEL_SWITCHING,this.onLevelSwitching,this),t.on(ly.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),t.on(ly.ERROR,this.onError,this)}unregisterListeners(){const{hls:t}=this;t.off(ly.MEDIA_ATTACHED,this.onMediaAttached,this),t.off(ly.MEDIA_DETACHING,this.onMediaDetaching,this),t.off(ly.MANIFEST_LOADING,this.onManifestLoading,this),t.off(ly.MANIFEST_PARSED,this.onManifestParsed,this),t.off(ly.LEVEL_LOADING,this.onLevelLoading,this),t.off(ly.LEVEL_SWITCHING,this.onLevelSwitching,this),t.off(ly.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),t.off(ly.ERROR,this.onError,this)}onMediaAttached(t,e){this.media=e.media,this.media&&(this.queuedDefaultTrack>-1&&(this.subtitleTrack=this.queuedDefaultTrack,this.queuedDefaultTrack=-1),this.useTextTrackPolling=!(this.media.textTracks&&"onchange"in this.media.textTracks),this.useTextTrackPolling?this.pollTrackChange(500):this.media.textTracks.addEventListener("change",this.asyncPollTrackChange))}pollTrackChange(t){self.clearInterval(this.subtitlePollingInterval),this.subtitlePollingInterval=self.setInterval(this.onTextTracksChanged,t)}onMediaDetaching(t,e){const r=this.media;if(!r)return;const n=!!e.transferMedia;if(self.clearInterval(this.subtitlePollingInterval),this.useTextTrackPolling||r.textTracks.removeEventListener("change",this.asyncPollTrackChange),this.trackId>-1&&(this.queuedDefaultTrack=this.trackId),this.subtitleTrack=-1,this.media=null,n)return;ET(r.textTracks).forEach(t=>{_T(t)})}onManifestLoading(){this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0}onManifestParsed(t,e){this.tracks=e.subtitleTracks}onSubtitleTrackLoaded(t,e){const{id:r,groupId:n,details:i}=e,s=this.tracksInGroup[r];if(!s||s.groupId!==n)return void this.warn("Subtitle track with id:".concat(r," and group:").concat(n," not found in active group ").concat(null==s?void 0:s.groupId));const a=s.details;s.details=e.details,this.log("Subtitle track ".concat(r,' "').concat(s.name,'" lang:').concat(s.lang," group:").concat(n," loaded [").concat(i.startSN,"-").concat(i.endSN,"]")),r===this.trackId&&this.playlistLoaded(r,e,a)}onLevelLoading(t,e){this.switchLevel(e.level)}onLevelSwitching(t,e){this.switchLevel(e.level)}switchLevel(t){const e=this.hls.levels[t];if(!e)return;const r=e.subtitleGroups||null,n=this.groupIds;let i=this.currentTrack;if(!r||(null==n?void 0:n.length)!==(null==r?void 0:r.length)||null!=r&&r.some(t=>-1===(null==n?void 0:n.indexOf(t)))){this.groupIds=r,this.trackId=-1,this.currentTrack=null;const t=this.tracks.filter(t=>!r||-1!==r.indexOf(t.groupId));if(t.length)this.selectDefaultTrack&&!t.some(t=>t.default)&&(this.selectDefaultTrack=!1),t.forEach((t,e)=>{t.id=e});else if(!i&&!this.tracksInGroup.length)return;this.tracksInGroup=t;const e=this.hls.config.subtitlePreference;if(!i&&e){this.selectDefaultTrack=!1;const r=rb(e,t);if(r>-1)i=t[r];else{const t=rb(e,this.tracks);i=this.tracks[t]}}let n=this.findTrackId(i);-1===n&&i&&(n=this.findTrackId(null));const s={subtitleTracks:t};this.log("Updating subtitle tracks, ".concat(t.length,' track(s) found in "').concat(null==r?void 0:r.join(","),'" group-id')),this.hls.trigger(ly.SUBTITLE_TRACKS_UPDATED,s),-1!==n&&-1===this.trackId&&this.setSubtitleTrack(n)}}findTrackId(t){const e=this.tracksInGroup,r=this.selectDefaultTrack;for(let n=0;n<e.length;n++){const i=e[n];if((!r||i.default)&&(r||t)&&(!t||nb(i,t)))return n}if(t){for(let r=0;r<e.length;r++){const n=e[r];if(cS(t.attrs,n.attrs,["LANGUAGE","ASSOC-LANGUAGE","CHARACTERISTICS"]))return r}for(let r=0;r<e.length;r++){const n=e[r];if(cS(t.attrs,n.attrs,["LANGUAGE"]))return r}}return-1}findTrackForTextTrack(t){if(t){const e=this.tracksInGroup;for(let r=0;r<e.length;r++){if(uS(e[r],t))return r}}return-1}onError(t,e){!e.fatal&&e.context&&(e.context.type!==dy||e.context.id!==this.trackId||this.groupIds&&-1===this.groupIds.indexOf(e.context.groupId)||this.checkRetry(e))}get allSubtitleTracks(){return this.tracks}get subtitleTracks(){return this.tracksInGroup}get subtitleTrack(){return this.trackId}set subtitleTrack(t){this.selectDefaultTrack=!1,this.setSubtitleTrack(t)}setSubtitleOption(t){if(this.hls.config.subtitlePreference=t,t){if(-1===t.id)return this.setSubtitleTrack(-1),null;const e=this.allSubtitleTracks;if(this.selectDefaultTrack=!1,e.length){const r=this.currentTrack;if(r&&nb(t,r))return r;const n=rb(t,this.tracksInGroup);if(n>-1){const t=this.tracksInGroup[n];return this.setSubtitleTrack(n),t}if(r)return null;{const r=rb(t,e);if(r>-1)return e[r]}}}return null}loadPlaylist(t){super.loadPlaylist(),this.shouldLoadPlaylist(this.currentTrack)&&this.scheduleLoading(this.currentTrack,t)}loadingPlaylist(t,e){super.loadingPlaylist(t,e);const r=t.id,n=t.groupId,i=this.getUrlWithDirectives(t.url,e),s=t.details,a=null==s?void 0:s.age;this.log("Loading subtitle ".concat(r,' "').concat(t.name,'" lang:').concat(t.lang," group:").concat(n).concat(void 0!==(null==e?void 0:e.msn)?" at sn "+e.msn+" part "+e.part:"").concat(a&&s.live?" age "+a.toFixed(1)+(s.type?" "+s.type||0:""):""," ").concat(i)),this.hls.trigger(ly.SUBTITLE_TRACK_LOADING,{url:i,id:r,groupId:n,deliveryDirectives:e||null,track:t})}toggleTrackModes(){const{media:t}=this;if(!t)return;const e=ET(t.textTracks),r=this.currentTrack;let n;if(r&&(n=e.filter(t=>uS(r,t))[0],n||this.warn('Unable to find subtitle TextTrack with name "'.concat(r.name,'" and language "').concat(r.lang,'"'))),[].slice.call(e).forEach(t=>{"disabled"!==t.mode&&t!==n&&(t.mode="disabled")}),n){const t=this.subtitleDisplay?"showing":"hidden";n.mode!==t&&(n.mode=t)}}setSubtitleTrack(t){const e=this.tracksInGroup;if(!this.media)return void(this.queuedDefaultTrack=t);if(t<-1||t>=e.length||!ny(t))return void this.warn("Invalid subtitle track id: ".concat(t));this.selectDefaultTrack=!1;const r=this.currentTrack,n=e[t]||null;if(this.trackId=t,this.currentTrack=n,this.toggleTrackModes(),!n)return void this.hls.trigger(ly.SUBTITLE_TRACK_SWITCH,{id:t});const i=!!n.details&&!n.details.live;if(t===this.trackId&&n===r&&i)return;this.log("Switching to subtitle-track ".concat(t)+(n?' "'.concat(n.name,'" lang:').concat(n.lang," group:").concat(n.groupId):""));const{id:s,groupId:a="",name:o,type:l,url:c}=n;this.hls.trigger(ly.SUBTITLE_TRACK_SWITCH,{id:s,groupId:a,name:o,type:l,url:c});const u=this.switchParams(n.url,null==r?void 0:r.details,n.details);this.loadPlaylist(u)}},timelineController:class{constructor(t){this.hls=void 0,this.media=null,this.config=void 0,this.enabled=!0,this.Cues=void 0,this.textTracks=[],this.tracks=[],this.initPTS=[],this.unparsedVttFrags=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.cea608Parser1=void 0,this.cea608Parser2=void 0,this.lastCc=-1,this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs={ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!0}},this.captionsProperties=void 0,this.hls=t,this.config=t.config,this.Cues=t.config.cueHandler,this.captionsProperties={textTrack1:{label:this.config.captionsTextTrack1Label,languageCode:this.config.captionsTextTrack1LanguageCode},textTrack2:{label:this.config.captionsTextTrack2Label,languageCode:this.config.captionsTextTrack2LanguageCode},textTrack3:{label:this.config.captionsTextTrack3Label,languageCode:this.config.captionsTextTrack3LanguageCode},textTrack4:{label:this.config.captionsTextTrack4Label,languageCode:this.config.captionsTextTrack4LanguageCode}},t.on(ly.MEDIA_ATTACHING,this.onMediaAttaching,this),t.on(ly.MEDIA_DETACHING,this.onMediaDetaching,this),t.on(ly.MANIFEST_LOADING,this.onManifestLoading,this),t.on(ly.MANIFEST_LOADED,this.onManifestLoaded,this),t.on(ly.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),t.on(ly.FRAG_LOADING,this.onFragLoading,this),t.on(ly.FRAG_LOADED,this.onFragLoaded,this),t.on(ly.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),t.on(ly.FRAG_DECRYPTED,this.onFragDecrypted,this),t.on(ly.INIT_PTS_FOUND,this.onInitPtsFound,this),t.on(ly.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),t.on(ly.BUFFER_FLUSHING,this.onBufferFlushing,this)}destroy(){const{hls:t}=this;t.off(ly.MEDIA_ATTACHING,this.onMediaAttaching,this),t.off(ly.MEDIA_DETACHING,this.onMediaDetaching,this),t.off(ly.MANIFEST_LOADING,this.onManifestLoading,this),t.off(ly.MANIFEST_LOADED,this.onManifestLoaded,this),t.off(ly.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),t.off(ly.FRAG_LOADING,this.onFragLoading,this),t.off(ly.FRAG_LOADED,this.onFragLoaded,this),t.off(ly.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),t.off(ly.FRAG_DECRYPTED,this.onFragDecrypted,this),t.off(ly.INIT_PTS_FOUND,this.onInitPtsFound,this),t.off(ly.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),t.off(ly.BUFFER_FLUSHING,this.onBufferFlushing,this),this.hls=this.config=this.media=null,this.cea608Parser1=this.cea608Parser2=void 0}initCea608Parsers(){const t=new Rk(this,"textTrack1"),e=new Rk(this,"textTrack2"),r=new Rk(this,"textTrack3"),n=new Rk(this,"textTrack4");this.cea608Parser1=new ek(1,t,e),this.cea608Parser2=new ek(3,r,n)}addCues(t,e,r,n,i){let s=!1;for(let a=i.length;a--;){const t=i[a],n=Ck(t[0],t[1],e,r);if(n>=0&&(t[0]=Math.min(t[0],e),t[1]=Math.max(t[1],r),s=!0,n/(r-e)>.5))return}if(s||i.push([e,r]),this.config.renderTextTracksNatively){const i=this.captionsTracks[t];this.Cues.newCue(i,e,r,n)}else{const i=this.Cues.newCue(null,e,r,n);this.hls.trigger(ly.CUES_PARSED,{type:"captions",cues:i,track:t})}}onInitPtsFound(t,e){let{frag:r,id:n,initPTS:i,timescale:s,trackId:a}=e;const{unparsedVttFrags:o}=this;n===fy&&(this.initPTS[r.cc]={baseTime:i,timescale:s,trackId:a}),o.length&&(this.unparsedVttFrags=[],o.forEach(t=>{this.initPTS[t.frag.cc]?this.onFragLoaded(ly.FRAG_LOADED,t):this.hls.trigger(ly.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:t.frag,error:new Error("Subtitle discontinuity domain does not match main")})}))}getExistingTrack(t,e){const{media:r}=this;if(r)for(let n=0;n<r.textTracks.length;n++){const i=r.textTracks[n];if(Pk(i,{name:t,lang:e,characteristics:"transcribes-spoken-dialog,describes-music-and-sound"}))return i}return null}createCaptionsTrack(t){this.config.renderTextTracksNatively?this.createNativeTrack(t):this.createNonNativeTrack(t)}createNativeTrack(t){if(this.captionsTracks[t])return;const{captionsProperties:e,captionsTracks:r,media:n}=this,{label:i,languageCode:s}=e[t],a=this.getExistingTrack(i,s);if(a)r[t]=a,_T(r[t]),vT(r[t],n);else{const e=this.createTextTrack("captions",i,s);e&&(e[t]=!0,r[t]=e)}}createNonNativeTrack(t){if(this.nonNativeCaptionsTracks[t])return;const e=this.captionsProperties[t];if(!e)return;const r={_id:t,label:e.label,kind:"captions",default:!!e.media&&!!e.media.default,closedCaptions:e.media};this.nonNativeCaptionsTracks[t]=r,this.hls.trigger(ly.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:[r]})}createTextTrack(t,e,r){const n=this.media;if(n)return n.addTextTrack(t,e,r)}onMediaAttaching(t,e){this.media=e.media,e.mediaSource||this._cleanTracks()}onMediaDetaching(t,e){const r=!!e.transferMedia;if(this.media=null,r)return;const{captionsTracks:n}=this;Object.keys(n).forEach(t=>{_T(n[t]),delete n[t]}),this.nonNativeCaptionsTracks={}}onManifestLoading(){this.lastCc=-1,this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs={ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!0}},this._cleanTracks(),this.tracks=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.textTracks=[],this.unparsedVttFrags=[],this.initPTS=[],this.cea608Parser1&&this.cea608Parser2&&(this.cea608Parser1.reset(),this.cea608Parser2.reset())}_cleanTracks(){const{media:t}=this;if(!t)return;const e=t.textTracks;if(e)for(let r=0;r<e.length;r++)_T(e[r])}onSubtitleTracksUpdated(t,e){const r=e.subtitleTracks||[],n=r.some(t=>t.textCodec===vk);if(this.config.enableWebVTT||n&&this.config.enableIMSC1){if(lS(this.tracks,r))return void(this.tracks=r);if(this.textTracks=[],this.tracks=r,this.config.renderTextTracksNatively){const t=this.media,e=t?ET(t.textTracks):null;if(this.tracks.forEach((t,r)=>{let n;if(e){let r=null;for(let n=0;n<e.length;n++)if(e[n]&&Pk(e[n],t)){r=e[n],e[n]=null;break}r&&(n=r)}if(n)_T(n);else{const e=Lk(t);n=this.createTextTrack(e,t.name,t.lang),n&&(n.mode="disabled")}n&&this.textTracks.push(n)}),null!=e&&e.length){const t=e.filter(t=>null!==t).map(t=>t.label);t.length&&this.hls.logger.warn("Media element contains unused subtitle tracks: ".concat(t.join(", "),". Replace media element for each source to clear TextTracks and captions menu."))}}else if(this.tracks.length){const t=this.tracks.map(t=>({label:t.name,kind:t.type.toLowerCase(),default:t.default,subtitleTrack:t}));this.hls.trigger(ly.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:t})}}}onManifestLoaded(t,e){this.config.enableCEA708Captions&&e.captions&&e.captions.forEach(t=>{const e=/(?:CC|SERVICE)([1-4])/.exec(t.instreamId);if(!e)return;const r="textTrack".concat(e[1]),n=this.captionsProperties[r];n&&(n.label=t.name,t.lang&&(n.languageCode=t.lang),n.media=t)})}closedCaptionsForLevel(t){const e=this.hls.levels[t.level];return null==e?void 0:e.attrs["CLOSED-CAPTIONS"]}onFragLoading(t,e){if(this.enabled&&e.frag.type===fy){var r,n;const{cea608Parser1:t,cea608Parser2:i,lastSn:s}=this,{cc:a,sn:o}=e.frag,l=null!=(r=null==(n=e.part)?void 0:n.index)?r:-1;t&&i&&(o!==s+1||o===s&&l!==this.lastPartIndex+1||a!==this.lastCc)&&(t.reset(),i.reset()),this.lastCc=a,this.lastSn=o,this.lastPartIndex=l}}onFragLoaded(t,e){const{frag:r,payload:n}=e;if(r.type===gy)if(n.byteLength){const t=r.decryptdata,i="stats"in e;if(null==t||!t.encrypted||i){const t=this.tracks[r.level],i=this.vttCCs;i[r.cc]||(i[r.cc]={start:r.start,prevCC:this.prevCC,new:!0},this.prevCC=r.cc),t&&t.textCodec===vk?this._parseIMSC1(r,n):this._parseVTTs(e)}}else this.hls.trigger(ly.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:r,error:new Error("Empty subtitle payload")})}_parseIMSC1(t,e){const r=this.hls;Ek(e,this.initPTS[t.cc],e=>{this._appendCues(e,t.level),r.trigger(ly.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:t})},e=>{r.logger.log("Failed to parse IMSC1: ".concat(e)),r.trigger(ly.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:t,error:e})})}_parseVTTs(t){var e;const{frag:r,payload:n}=t,{initPTS:i,unparsedVttFrags:s}=this,a=i.length-1;if(!i[r.cc]&&-1===a)return void s.push(t);const o=this.hls;yk(null!=(e=r.initSegment)&&e.data?hv(r.initSegment.data,new Uint8Array(n)).buffer:n,this.initPTS[r.cc],this.vttCCs,r.cc,r.start,t=>{this._appendCues(t,r.level),o.trigger(ly.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:r})},e=>{const i="Missing initPTS for VTT MPEGTS"===e.message;i?s.push(t):this._fallbackToIMSC1(r,n),o.logger.log("Failed to parse VTT cue: ".concat(e)),i&&a>r.cc||o.trigger(ly.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:r,error:e})})}_fallbackToIMSC1(t,e){const r=this.tracks[t.level];r.textCodec||Ek(e,this.initPTS[t.cc],()=>{r.textCodec=vk,this._parseIMSC1(t,e)},()=>{r.textCodec="wvtt"})}_appendCues(t,e){const r=this.hls;if(this.config.renderTextTracksNatively){const r=this.textTracks[e];if(!r||"disabled"===r.mode)return;t.forEach(t=>bT(r,t))}else{const n=this.tracks[e];if(!n)return;const i=n.default?"default":"subtitles"+e;r.trigger(ly.CUES_PARSED,{type:"subtitles",cues:t,track:i})}}onFragDecrypted(t,e){const{frag:r}=e;r.type===gy&&this.onFragLoaded(ly.FRAG_LOADED,e)}onSubtitleTracksCleared(){this.tracks=[],this.captionsTracks={}}onFragParsingUserdata(t,e){if(!this.enabled||!this.config.enableCEA708Captions)return;const{frag:r,samples:n}=e;if(r.type!==fy||"NONE"!==this.closedCaptionsForLevel(r))for(let i=0;i<n.length;i++){const t=n[i].bytes;if(t){this.cea608Parser1||this.initCea608Parsers();const e=this.extractCea608Data(t);this.cea608Parser1.addData(n[i].pts,e[0]),this.cea608Parser2.addData(n[i].pts,e[1])}}}onBufferFlushing(t,e){let{startOffset:r,endOffset:n,endOffsetSubtitles:i,type:s}=e;const{media:a}=this;if(a&&!(a.currentTime<n)){if(!s||"video"===s){const{captionsTracks:t}=this;Object.keys(t).forEach(e=>wT(t[e],r,n))}if(this.config.renderTextTracksNatively&&0===r&&void 0!==i){const{textTracks:t}=this;Object.keys(t).forEach(e=>wT(t[e],r,i))}}}extractCea608Data(t){const e=[[],[]],r=31&t[0];let n=2;for(let i=0;i<r;i++){const r=t[n++],i=127&t[n++],s=127&t[n++];if(0===i&&0===s)continue;if(0!==(4&r)){const t=3&r;0!==t&&1!==t||(e[t].push(i),e[t].push(s))}}return e}},audioStreamController:class extends Rw{constructor(t,e,r){super(t,e,r,"audio-stream-controller",py),this.mainAnchor=null,this.mainFragLoading=null,this.audioOnly=!1,this.bufferedTrack=null,this.switchingTrack=null,this.trackId=-1,this.waitingData=null,this.mainDetails=null,this.flushing=!1,this.bufferFlushed=!1,this.cachedTrackLoadedData=null,this.registerListeners()}onHandlerDestroying(){this.unregisterListeners(),super.onHandlerDestroying(),this.resetItem()}resetItem(){this.mainDetails=this.mainAnchor=this.mainFragLoading=this.bufferedTrack=this.switchingTrack=this.waitingData=this.cachedTrackLoadedData=null}registerListeners(){super.registerListeners();const{hls:t}=this;t.on(ly.LEVEL_LOADED,this.onLevelLoaded,this),t.on(ly.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),t.on(ly.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),t.on(ly.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),t.on(ly.BUFFER_RESET,this.onBufferReset,this),t.on(ly.BUFFER_CREATED,this.onBufferCreated,this),t.on(ly.BUFFER_FLUSHING,this.onBufferFlushing,this),t.on(ly.BUFFER_FLUSHED,this.onBufferFlushed,this),t.on(ly.INIT_PTS_FOUND,this.onInitPtsFound,this),t.on(ly.FRAG_LOADING,this.onFragLoading,this),t.on(ly.FRAG_BUFFERED,this.onFragBuffered,this)}unregisterListeners(){const{hls:t}=this;t&&(super.unregisterListeners(),t.off(ly.LEVEL_LOADED,this.onLevelLoaded,this),t.off(ly.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),t.off(ly.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),t.off(ly.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),t.off(ly.BUFFER_RESET,this.onBufferReset,this),t.off(ly.BUFFER_CREATED,this.onBufferCreated,this),t.off(ly.BUFFER_FLUSHING,this.onBufferFlushing,this),t.off(ly.BUFFER_FLUSHED,this.onBufferFlushed,this),t.off(ly.INIT_PTS_FOUND,this.onInitPtsFound,this),t.off(ly.FRAG_LOADING,this.onFragLoading,this),t.off(ly.FRAG_BUFFERED,this.onFragBuffered,this))}onInitPtsFound(t,e){let{frag:r,id:n,initPTS:i,timescale:s,trackId:a}=e;if(n===fy){const t=r.cc,e=this.fragCurrent;if(this.initPTS[t]={baseTime:i,timescale:s,trackId:a},this.log("InitPTS for cc: ".concat(t," found from main: ").concat(i/s," (").concat(i,"/").concat(s,") trackId: ").concat(a)),this.mainAnchor=r,this.state===xw){const e=this.waitingData;(!e&&!this.loadingParts||e&&e.frag.cc!==t)&&this.syncWithAnchor(r,null==e?void 0:e.frag)}else!this.hls.hasEnoughToStart&&e&&e.cc!==t?(e.abortRequests(),this.syncWithAnchor(r,e)):this.state===vw&&this.tick()}}getLoadPosition(){return!this.startFragRequested&&this.nextLoadPosition>=0?this.nextLoadPosition:super.getLoadPosition()}syncWithAnchor(t,e){var r;const n=(null==(r=this.mainFragLoading)?void 0:r.frag)||null;if(e&&(null==n?void 0:n.cc)===e.cc)return;const i=(n||t).cc,s=hb(this.getLevelDetails(),i,this.getLoadPosition());s&&(this.log("Syncing with main frag at ".concat(s.start," cc ").concat(s.cc)),this.startFragRequested=!1,this.nextLoadPosition=s.start,this.resetLoadingState(),this.state===vw&&this.doTickIdle())}startLoad(t,e){if(!this.levels)return this.startPosition=t,void(this.state=yw);const r=this.lastCurrentTime;this.stopLoad(),this.setInterval(100),r>0&&-1===t?(this.log("Override startPosition with lastCurrentTime @".concat(r.toFixed(3))),t=r,this.state=vw):this.state=Ew,this.nextLoadPosition=this.lastCurrentTime=t+this.timelineOffset,this.startPosition=e?-1:t,this.tick()}doTick(){switch(this.state){case vw:this.doTickIdle();break;case Ew:{const{levels:t,trackId:e}=this,r=null==t?void 0:t[e],n=null==r?void 0:r.details;if(n&&!this.waitForLive(r)){if(this.waitForCdnTuneIn(n))break;this.state=xw}break}case ww:this.checkRetryDate();break;case xw:{const t=this.waitingData;if(t){const{frag:e,part:r,cache:n,complete:i}=t,s=this.mainAnchor;if(void 0!==this.initPTS[e.cc]){this.waitingData=null,this.state=_w;const t={frag:e,part:r,payload:n.flush().buffer,networkDetails:null};this._handleFragmentLoadProgress(t),i&&super._handleFragmentLoadComplete(t)}else s&&s.cc!==t.frag.cc&&this.syncWithAnchor(s,t.frag)}else this.state=vw}}this.onTickEnd()}resetLoadingState(){const t=this.waitingData;t&&(this.fragmentTracker.removeFragment(t.frag),this.waitingData=null),super.resetLoadingState()}onTickEnd(){const{media:t}=this;null!=t&&t.readyState&&(this.lastCurrentTime=t.currentTime)}doTickIdle(){var t;const{hls:e,levels:r,media:n,trackId:i}=this,s=e.config;if(!this.buffering||!n&&!this.primaryPrefetch&&(this.startFragRequested||!s.startFragPrefetch)||null==r||!r[i])return;const a=r[i],o=a.details;if(!o||this.waitForLive(a)||this.waitForCdnTuneIn(o))return this.state=Ew,void(this.startFragRequested=!1);const l=this.mediaBuffer?this.mediaBuffer:this.media;this.bufferFlushed&&l&&(this.bufferFlushed=!1,this.afterBufferFlushed(l,By,py));const c=this.getFwdBufferInfo(l,py);if(null===c)return;if(!this.switchingTrack&&this._streamEnded(c,o))return e.trigger(ly.BUFFER_EOS,{type:"audio"}),void(this.state=kw);const u=c.len,h=e.maxBufferLength,d=o.fragments,f=d[0].start,p=this.getLoadPosition(),g=this.flushing?p:c.end;if(this.switchingTrack&&n){const t=p;o.PTSKnown&&t<f&&(c.end>f||c.nextStart)&&(this.log("Alt audio track ahead of main track, seek to start of alt audio track"),n.currentTime=f+.05)}if(u>=h&&!this.switchingTrack&&g<d[d.length-1].start)return;let m=this.getNextFragment(g,o);if(m&&this.isLoopLoading(m,g)&&(m=this.getNextFragmentLoopLoading(m,o,c,fy,h)),!m)return void(this.bufferFlushed=!0);let y=(null==(t=this.mainFragLoading)?void 0:t.frag)||null;if(!this.audioOnly&&this.startFragRequested&&y&&Gy(m)&&!m.endList&&(!o.live||!this.loadingParts&&g<this.hls.liveSyncPosition)&&(this.fragmentTracker.getState(y)===Cb&&(this.mainFragLoading=y=null),y&&Gy(y))){if(m.start>y.end){const t=this.fragmentTracker.getFragAtPos(g,fy);t&&t.end>y.end&&(y=t,this.mainFragLoading={frag:t,targetBufferTime:null})}if(m.start>y.end)return}this.loadFragment(m,a,g)}onMediaDetaching(t,e){this.bufferFlushed=this.flushing=!1,super.onMediaDetaching(t,e)}onAudioTracksUpdated(t,e){let{audioTracks:r}=e;this.resetTransmuxer(),this.levels=r.map(t=>new Qv(t))}onAudioTrackSwitching(t,e){const r=!!e.url;this.trackId=e.id;const{fragCurrent:n}=this;n&&(n.abortRequests(),this.removeUnbufferedFrags(n.start)),this.resetLoadingState(),r?(this.switchingTrack=e,this.flushAudioIfNeeded(e),this.state!==yw&&(this.setInterval(100),this.state=vw,this.tick())):(this.resetTransmuxer(),this.switchingTrack=null,this.bufferedTrack=e,this.clearInterval())}onManifestLoading(){super.onManifestLoading(),this.bufferFlushed=this.flushing=this.audioOnly=!1,this.resetItem(),this.trackId=-1}onLevelLoaded(t,e){this.mainDetails=e.details;const r=this.cachedTrackLoadedData;r&&(this.cachedTrackLoadedData=null,this.onAudioTrackLoaded(ly.AUDIO_TRACK_LOADED,r))}onAudioTrackLoaded(t,e){var r;const{levels:n}=this,{details:i,id:s,groupId:a,track:o}=e;if(!n)return void this.warn("Audio tracks reset while loading track ".concat(s,' "').concat(o.name,'" of "').concat(a,'"'));const l=this.mainDetails;if(!l||i.endCC>l.endCC||l.expired)return this.cachedTrackLoadedData=e,void(this.state!==yw&&(this.state=Ew));this.cachedTrackLoadedData=null,this.log("Audio track ".concat(s,' "').concat(o.name,'" of "').concat(a,'" loaded [').concat(i.startSN,",").concat(i.endSN,"]").concat(i.lastPartSn?"[part-".concat(i.lastPartSn,"-").concat(i.lastPartIndex,"]"):"",",duration:").concat(i.totalduration));const c=n[s];let u=0;if(i.live||null!=(r=c.details)&&r.live){if(this.checkLiveUpdate(i),i.deltaUpdateFailed)return;var h;if(c.details)u=this.alignPlaylists(i,c.details,null==(h=this.levelLastLoaded)?void 0:h.details);i.alignedSliding||(dw(i,l),i.alignedSliding||fw(i,l),u=i.fragmentStart)}c.details=i,this.levelLastLoaded=c,this.startFragRequested||this.setStartPosition(l,u),this.hls.trigger(ly.AUDIO_TRACK_UPDATED,{details:i,id:s,groupId:e.groupId}),this.state!==Ew||this.waitForCdnTuneIn(i)||(this.state=vw),this.tick()}_handleFragmentLoadProgress(t){var e;const r=t.frag,{part:n,payload:i}=t,{config:s,trackId:a,levels:o}=this;if(!o)return void this.warn("Audio tracks were reset while fragment load was in progress. Fragment ".concat(r.sn," of level ").concat(r.level," will not be buffered"));const l=o[a];if(!l)return void this.warn("Audio track is undefined on fragment load progress");const c=l.details;if(!c)return this.warn("Audio track details undefined on fragment load progress"),void this.removeUnbufferedFrags(r.start);const u=s.defaultAudioCodec||l.audioCodec||"mp4a.40.2";let h=this.transmuxer;h||(h=this.transmuxer=new aS(this.hls,py,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)));const d=this.initPTS[r.cc],f=null==(e=r.initSegment)?void 0:e.data;if(void 0!==d){const t=!1,e=n?n.index:-1,s=-1!==e,a=new Qb(r.level,r.sn,r.stats.chunkCount,i.byteLength,e,s);h.push(i,f,u,"",r,n,c.totalduration,t,a,d)}else{this.log("Unknown video PTS for cc ".concat(r.cc,", waiting for video PTS before demuxing audio frag ").concat(r.sn," of [").concat(c.startSN," ,").concat(c.endSN,"],track ").concat(a));const{cache:t}=this.waitingData=this.waitingData||{frag:r,part:n,cache:new Pw,complete:!1};t.push(new Uint8Array(i)),this.state!==yw&&(this.state=xw)}}_handleFragmentLoadComplete(t){this.waitingData?this.waitingData.complete=!0:super._handleFragmentLoadComplete(t)}onBufferReset(){this.mediaBuffer=null}onBufferCreated(t,e){this.bufferFlushed=this.flushing=!1;const r=e.tracks.audio;r&&(this.mediaBuffer=r.buffer||null)}onFragLoading(t,e){!this.audioOnly&&e.frag.type===fy&&Gy(e.frag)&&(this.mainFragLoading=e,this.state===vw&&this.tick())}onFragBuffered(t,e){const{frag:r,part:n}=e;if(r.type===py)if(this.fragContextChanged(r))this.warn("Fragment ".concat(r.sn).concat(n?" p: "+n.index:""," of level ").concat(r.level," finished buffering, but was aborted. state: ").concat(this.state,", audioSwitch: ").concat(this.switchingTrack?this.switchingTrack.name:"false"));else{if(Gy(r)){this.fragPrevious=r;const t=this.switchingTrack;t&&(this.bufferedTrack=t,this.switchingTrack=null,this.hls.trigger(ly.AUDIO_TRACK_SWITCHED,wy({},t)))}this.fragBufferedComplete(r,n),this.media&&this.tick()}else this.audioOnly||r.type!==fy||r.elementaryStreams.video||r.elementaryStreams.audiovideo||(this.audioOnly=!0,this.mainFragLoading=null)}onError(t,e){var r;if(e.fatal)this.state=Aw;else switch(e.details){case oy.FRAG_GAP:case oy.FRAG_PARSING_ERROR:case oy.FRAG_DECRYPT_ERROR:case oy.FRAG_LOAD_ERROR:case oy.FRAG_LOAD_TIMEOUT:case oy.KEY_LOAD_ERROR:case oy.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(py,e);break;case oy.AUDIO_TRACK_LOAD_ERROR:case oy.AUDIO_TRACK_LOAD_TIMEOUT:case oy.LEVEL_PARSING_ERROR:e.levelRetry||this.state!==Ew||(null==(r=e.context)?void 0:r.type)!==hy||(this.state=vw);break;case oy.BUFFER_ADD_CODEC_ERROR:case oy.BUFFER_APPEND_ERROR:if("audio"!==e.parent)return;this.reduceLengthAndFlushBuffer(e)||this.resetLoadingState();break;case oy.BUFFER_FULL_ERROR:if("audio"!==e.parent)return;this.reduceLengthAndFlushBuffer(e)&&(this.bufferedTrack=null,super.flushMainBuffer(0,Number.POSITIVE_INFINITY,"audio"));break;case oy.INTERNAL_EXCEPTION:this.recoverWorkerError(e)}}onBufferFlushing(t,e){let{type:r}=e;r!==jy&&(this.flushing=!0)}onBufferFlushed(t,e){let{type:r}=e;if(r!==jy){this.flushing=!1,this.bufferFlushed=!0,this.state===kw&&(this.state=vw);const t=this.mediaBuffer||this.media;t&&(this.afterBufferFlushed(t,r,py),this.tick())}}_handleTransmuxComplete(t){var e;const r="audio",{hls:n}=this,{remuxResult:i,chunkMeta:s}=t,a=this.getCurrentContext(s);if(!a)return void this.resetWhenMissingContext(s);const{frag:o,part:l,level:c}=a,{details:u}=c,{audio:h,text:d,id3:f,initSegment:p}=i;if(!this.fragContextChanged(o)&&u){if(this.state=Sw,this.switchingTrack&&h&&this.completeAudioSwitch(this.switchingTrack),null!=p&&p.tracks){const t=o.initSegment||o;if(this.unhandledEncryptionError(p,o))return;this._bufferInitSegment(c,p.tracks,t,s),n.trigger(ly.FRAG_PARSING_INIT_SEGMENT,{frag:t,id:r,tracks:p.tracks})}if(h){const{startPTS:t,endPTS:e,startDTS:r,endDTS:n}=h;l&&(l.elementaryStreams[By]={startPTS:t,endPTS:e,startDTS:r,endDTS:n}),o.setElementaryStreamInfo(By,t,e,r,n),this.bufferFragmentData(h,o,l,s)}if(null!=f&&null!=(e=f.samples)&&e.length){const t=by({id:r,frag:o,details:u},f);n.trigger(ly.FRAG_PARSING_METADATA,t)}if(d){const t=by({id:r,frag:o,details:u},d);n.trigger(ly.FRAG_PARSING_USERDATA,t)}}else this.fragmentTracker.removeFragment(o)}_bufferInitSegment(t,e,r,n){if(this.state!==Sw)return;if(e.video&&delete e.video,e.audiovideo&&delete e.audiovideo,!e.audio)return;const i=e.audio;i.id=py;const s=t.audioCodec;this.log("Init audio buffer, container:".concat(i.container,", codecs[level/parsed]=[").concat(s,"/").concat(i.codec,"]")),s&&1===s.split(",").length&&(i.levelCodec=s),this.hls.trigger(ly.BUFFER_CODECS,e);const a=i.initSegment;if(null!=a&&a.byteLength){const t={type:"audio",frag:r,part:null,chunkMeta:n,parent:r.type,data:a};this.hls.trigger(ly.BUFFER_APPENDING,t)}this.tickImmediate()}loadFragment(t,e,r){const n=this.fragmentTracker.getState(t);var i;if(this.switchingTrack||n===Rb||n===Pb)if(Gy(t))if(null!=(i=e.details)&&i.live&&!this.initPTS[t.cc]){this.log("Waiting for video PTS in continuity counter ".concat(t.cc," of live stream before loading audio fragment ").concat(t.sn," of level ").concat(this.trackId)),this.state=xw;const r=this.mainDetails;r&&r.fragmentStart!==e.details.fragmentStart&&fw(e.details,r)}else super.loadFragment(t,e,r);else this._loadInitSegment(t,e);else this.clearTrackerIfNeeded(t)}flushAudioIfNeeded(t){if(this.media&&this.bufferedTrack){const{name:e,lang:r,assocLang:n,characteristics:i,audioCodec:s,channels:a}=this.bufferedTrack;nb({name:e,lang:r,assocLang:n,characteristics:i,audioCodec:s,channels:a},t,ib)||(ab(t.url,this.hls)?(this.log("Switching audio track : flushing all audio"),super.flushMainBuffer(0,Number.POSITIVE_INFINITY,"audio"),this.bufferedTrack=null):this.bufferedTrack=t)}}completeAudioSwitch(t){const{hls:e}=this;this.flushAudioIfNeeded(t),this.bufferedTrack=t,this.switchingTrack=null,e.trigger(ly.AUDIO_TRACK_SWITCHED,wy({},t))}},audioTrackController:class extends oS{constructor(t){super(t,"audio-track-controller"),this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0,this.registerListeners()}registerListeners(){const{hls:t}=this;t.on(ly.MANIFEST_LOADING,this.onManifestLoading,this),t.on(ly.MANIFEST_PARSED,this.onManifestParsed,this),t.on(ly.LEVEL_LOADING,this.onLevelLoading,this),t.on(ly.LEVEL_SWITCHING,this.onLevelSwitching,this),t.on(ly.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),t.on(ly.ERROR,this.onError,this)}unregisterListeners(){const{hls:t}=this;t.off(ly.MANIFEST_LOADING,this.onManifestLoading,this),t.off(ly.MANIFEST_PARSED,this.onManifestParsed,this),t.off(ly.LEVEL_LOADING,this.onLevelLoading,this),t.off(ly.LEVEL_SWITCHING,this.onLevelSwitching,this),t.off(ly.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),t.off(ly.ERROR,this.onError,this)}destroy(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.currentTrack=null,super.destroy()}onManifestLoading(){this.tracks=[],this.tracksInGroup=[],this.groupIds=null,this.currentTrack=null,this.trackId=-1,this.selectDefaultTrack=!0}onManifestParsed(t,e){this.tracks=e.audioTracks||[]}onAudioTrackLoaded(t,e){const{id:r,groupId:n,details:i}=e,s=this.tracksInGroup[r];if(!s||s.groupId!==n)return void this.warn("Audio track with id:".concat(r," and group:").concat(n," not found in active group ").concat(null==s?void 0:s.groupId));const a=s.details;s.details=e.details,this.log("Audio track ".concat(r,' "').concat(s.name,'" lang:').concat(s.lang," group:").concat(n," loaded [").concat(i.startSN,"-").concat(i.endSN,"]")),r===this.trackId&&this.playlistLoaded(r,e,a)}onLevelLoading(t,e){this.switchLevel(e.level)}onLevelSwitching(t,e){this.switchLevel(e.level)}switchLevel(t){const e=this.hls.levels[t];if(!e)return;const r=e.audioGroups||null,n=this.groupIds;let i=this.currentTrack;if(!r||(null==n?void 0:n.length)!==(null==r?void 0:r.length)||null!=r&&r.some(t=>-1===(null==n?void 0:n.indexOf(t)))){this.groupIds=r,this.trackId=-1,this.currentTrack=null;const t=this.tracks.filter(t=>!r||-1!==r.indexOf(t.groupId));if(t.length)this.selectDefaultTrack&&!t.some(t=>t.default)&&(this.selectDefaultTrack=!1),t.forEach((t,e)=>{t.id=e});else if(!i&&!this.tracksInGroup.length)return;this.tracksInGroup=t;const e=this.hls.config.audioPreference;if(!i&&e){const r=rb(e,t,ib);if(r>-1)i=t[r];else{const t=rb(e,this.tracks);i=this.tracks[t]}}let n=this.findTrackId(i);-1===n&&i&&(n=this.findTrackId(null));const a={audioTracks:t};this.log("Updating audio tracks, ".concat(t.length," track(s) found in group(s): ").concat(null==r?void 0:r.join(","))),this.hls.trigger(ly.AUDIO_TRACKS_UPDATED,a);const o=this.trackId;if(-1!==n&&-1===o)this.setAudioTrack(n);else if(t.length&&-1===o){var s;const e=new Error("No audio track selected for current audio group-ID(s): ".concat(null==(s=this.groupIds)?void 0:s.join(",")," track count: ").concat(t.length));this.warn(e.message),this.hls.trigger(ly.ERROR,{type:ay.MEDIA_ERROR,details:oy.AUDIO_TRACK_LOAD_ERROR,fatal:!0,error:e})}}}onError(t,e){!e.fatal&&e.context&&(e.context.type!==hy||e.context.id!==this.trackId||this.groupIds&&-1===this.groupIds.indexOf(e.context.groupId)||this.checkRetry(e))}get allAudioTracks(){return this.tracks}get audioTracks(){return this.tracksInGroup}get audioTrack(){return this.trackId}set audioTrack(t){this.selectDefaultTrack=!1,this.setAudioTrack(t)}setAudioOption(t){const e=this.hls;if(e.config.audioPreference=t,t){const r=this.allAudioTracks;if(this.selectDefaultTrack=!1,r.length){const n=this.currentTrack;if(n&&nb(t,n,ib))return n;const i=rb(t,this.tracksInGroup,ib);if(i>-1){const t=this.tracksInGroup[i];return this.setAudioTrack(i),t}if(n){let n=e.loadLevel;-1===n&&(n=e.firstAutoLevel);const i=function(t,e,r,n,i){const s=e[n],a=e.reduce((t,e,r)=>{const n=e.uri;return(t[n]||(t[n]=[])).push(r),t},{})[s.uri];a.length>1&&(n=Math.max.apply(Math,a));const o=s.videoRange,l=s.frameRate,c=s.codecSet.substring(0,4),u=sb(e,n,e=>{if(e.videoRange!==o||e.frameRate!==l||e.codecSet.substring(0,4)!==c)return!1;const n=e.audioGroups,s=r.filter(t=>!n||-1!==n.indexOf(t.groupId));return rb(t,s,i)>-1});return u>-1?u:sb(e,n,e=>{const n=e.audioGroups,s=r.filter(t=>!n||-1!==n.indexOf(t.groupId));return rb(t,s,i)>-1})}(t,e.levels,r,n,ib);if(-1===i)return null;e.nextLoadLevel=i}if(t.channels||t.audioCodec){const e=rb(t,r);if(e>-1)return r[e]}}}return null}setAudioTrack(t){const e=this.tracksInGroup;if(t<0||t>=e.length)return void this.warn("Invalid audio track id: ".concat(t));this.selectDefaultTrack=!1;const r=this.currentTrack,n=e[t],i=n.details&&!n.details.live;if(t===this.trackId&&n===r&&i)return;if(this.log("Switching to audio-track ".concat(t,' "').concat(n.name,'" lang:').concat(n.lang," group:").concat(n.groupId," channels:").concat(n.channels)),this.trackId=t,this.currentTrack=n,this.hls.trigger(ly.AUDIO_TRACK_SWITCHING,wy({},n)),i)return;const s=this.switchParams(n.url,null==r?void 0:r.details,n.details);this.loadPlaylist(s)}findTrackId(t){const e=this.tracksInGroup;for(let r=0;r<e.length;r++){const n=e[r];if((!this.selectDefaultTrack||n.default)&&(!t||nb(t,n,ib)))return r}if(t){const{name:r,lang:n,assocLang:i,characteristics:s,audioCodec:a,channels:o}=t;for(let t=0;t<e.length;t++){if(nb({name:r,lang:n,assocLang:i,characteristics:s,audioCodec:a,channels:o},e[t],ib))return t}for(let l=0;l<e.length;l++){const r=e[l];if(cS(t.attrs,r.attrs,["LANGUAGE","ASSOC-LANGUAGE","CHARACTERISTICS"]))return l}for(let l=0;l<e.length;l++){const r=e[l];if(cS(t.attrs,r.attrs,["LANGUAGE"]))return l}}return-1}loadPlaylist(t){super.loadPlaylist();const e=this.currentTrack;this.shouldLoadPlaylist(e)&&ab(e.url,this.hls)&&this.scheduleLoading(e,t)}loadingPlaylist(t,e){super.loadingPlaylist(t,e);const r=t.id,n=t.groupId,i=this.getUrlWithDirectives(t.url,e),s=t.details,a=null==s?void 0:s.age;this.log("Loading audio-track ".concat(r,' "').concat(t.name,'" lang:').concat(t.lang," group:").concat(n).concat(void 0!==(null==e?void 0:e.msn)?" at sn "+e.msn+" part "+e.part:"").concat(a&&s.live?" age "+a.toFixed(1)+(s.type?" "+s.type||0:""):""," ").concat(i)),this.hls.trigger(ly.AUDIO_TRACK_LOADING,{url:i,id:r,groupId:n,deliveryDirectives:e||null,track:t})}},emeController:fT,cmcdController:class{constructor(t){this.hls=void 0,this.config=void 0,this.media=void 0,this.sid=void 0,this.cid=void 0,this.useHeaders=!1,this.includeKeys=void 0,this.initialized=!1,this.starved=!1,this.buffering=!0,this.audioBuffer=void 0,this.videoBuffer=void 0,this.onWaiting=()=>{this.initialized&&(this.starved=!0),this.buffering=!0},this.onPlaying=()=>{this.initialized||(this.initialized=!0),this.buffering=!1},this.applyPlaylistData=t=>{try{this.apply(t,{ot:vS.MANIFEST,su:!this.initialized})}catch(cg){this.hls.logger.warn("Could not generate manifest CMCD data.",cg)}},this.applyFragmentData=t=>{try{const{frag:e,part:r}=t,n=this.hls.levels[e.level],i=this.getObjectType(e),s={d:1e3*(r||e).duration,ot:i};i!==vS.VIDEO&&i!==vS.AUDIO&&i!=vS.MUXED||(s.br=n.bitrate/1e3,s.tb=this.getTopBandwidth(i)/1e3,s.bl=this.getBufferLength(i));const a=r?this.getNextPart(r):this.getNextFrag(e);null!=a&&a.url&&a.url!==e.url&&(s.nor=a.url),this.apply(t,s)}catch(cg){this.hls.logger.warn("Could not generate segment CMCD data.",cg)}},this.hls=t;const e=this.config=t.config,{cmcd:r}=e;null!=r&&(e.pLoader=this.createPlaylistLoader(),e.fLoader=this.createFragmentLoader(),this.sid=r.sessionId||t.sessionId,this.cid=r.contentId,this.useHeaders=!0===r.useHeaders,this.includeKeys=r.includeKeys,this.registerListeners())}registerListeners(){const t=this.hls;t.on(ly.MEDIA_ATTACHED,this.onMediaAttached,this),t.on(ly.MEDIA_DETACHED,this.onMediaDetached,this),t.on(ly.BUFFER_CREATED,this.onBufferCreated,this)}unregisterListeners(){const t=this.hls;t.off(ly.MEDIA_ATTACHED,this.onMediaAttached,this),t.off(ly.MEDIA_DETACHED,this.onMediaDetached,this),t.off(ly.BUFFER_CREATED,this.onBufferCreated,this)}destroy(){this.unregisterListeners(),this.onMediaDetached(),this.hls=this.config=this.audioBuffer=this.videoBuffer=null,this.onWaiting=this.onPlaying=this.media=null}onMediaAttached(t,e){this.media=e.media,this.media.addEventListener("waiting",this.onWaiting),this.media.addEventListener("playing",this.onPlaying)}onMediaDetached(){this.media&&(this.media.removeEventListener("waiting",this.onWaiting),this.media.removeEventListener("playing",this.onPlaying),this.media=null)}onBufferCreated(t,e){var r,n;this.audioBuffer=null==(r=e.tracks.audio)?void 0:r.buffer,this.videoBuffer=null==(n=e.tracks.video)?void 0:n.buffer}createData(){var t;return{v:1,sf:bS.HLS,sid:this.sid,cid:this.cid,pr:null==(t=this.media)?void 0:t.playbackRate,mtp:this.hls.bandwidthEstimate/1e3}}apply(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};by(e,this.createData());const r=e.ot===vS.INIT||e.ot===vS.VIDEO||e.ot===vS.MUXED;this.starved&&r&&(e.bs=!0,e.su=!0,this.starved=!1),null==e.su&&(e.su=this.buffering);const{includeKeys:n}=this;n&&(e=Object.keys(e).reduce((t,r)=>(n.includes(r)&&(t[r]=e[r]),t),{}));const i={baseUrl:t.url};this.useHeaders?(t.headers||(t.headers={}),oT(t.headers,e,i)):t.url=uT(t.url,e,i)}getNextFrag(t){var e;const r=null==(e=this.hls.levels[t.level])?void 0:e.details;if(r){const e=t.sn-r.startSN;return r.fragments[e+1]}}getNextPart(t){var e;const{index:r,fragment:n}=t,i=null==(e=this.hls.levels[n.level])||null==(e=e.details)?void 0:e.partList;if(i){const{sn:t}=n;for(let e=i.length-1;e>=0;e--){const n=i[e];if(n.index===r&&n.fragment.sn===t)return i[e+1]}}}getObjectType(t){const{type:e}=t;return"subtitle"===e?vS.TIMED_TEXT:"initSegment"===t.sn?vS.INIT:"audio"===e?vS.AUDIO:"main"===e?this.hls.audioTracks.length?vS.VIDEO:vS.MUXED:void 0}getTopBandwidth(t){let e,r=0;const n=this.hls;if(t===vS.AUDIO)e=n.audioTracks;else{const t=n.maxAutoLevel,r=t>-1?t+1:n.levels.length;e=n.levels.slice(0,r)}return e.forEach(t=>{t.bitrate>r&&(r=t.bitrate)}),r>0?r:NaN}getBufferLength(t){const e=this.media,r=t===vS.AUDIO?this.audioBuffer:this.videoBuffer;if(!r||!e)return NaN;return 1e3*$b.bufferInfo(r,e.currentTime,this.config.maxBufferHole).len}createPlaylistLoader(){const{pLoader:t}=this.config,e=this.applyPlaylistData,r=t||this.config.loader;return class{constructor(t){this.loader=void 0,this.loader=new r(t)}get stats(){return this.loader.stats}get context(){return this.loader.context}destroy(){this.loader.destroy()}abort(){this.loader.abort()}load(t,r,n){e(t),this.loader.load(t,r,n)}}}createFragmentLoader(){const{fLoader:t}=this.config,e=this.applyFragmentData,r=t||this.config.loader;return class{constructor(t){this.loader=void 0,this.loader=new r(t)}get stats(){return this.loader.stats}get context(){return this.loader.context}destroy(){this.loader.destroy()}abort(){this.loader.abort()}load(t,r,n){e(t),this.loader.load(t,r,n)}}}},contentSteeringController:class extends Ey{constructor(t){super("content-steering",t.logger),this.hls=void 0,this.loader=null,this.uri=null,this.pathwayId=".",this._pathwayPriority=null,this.timeToLoad=300,this.reloadTimer=-1,this.updated=0,this.started=!1,this.enabled=!0,this.levels=null,this.audioTracks=null,this.subtitleTracks=null,this.penalizedPathways={},this.hls=t,this.registerListeners()}registerListeners(){const t=this.hls;t.on(ly.MANIFEST_LOADING,this.onManifestLoading,this),t.on(ly.MANIFEST_LOADED,this.onManifestLoaded,this),t.on(ly.MANIFEST_PARSED,this.onManifestParsed,this),t.on(ly.ERROR,this.onError,this)}unregisterListeners(){const t=this.hls;t&&(t.off(ly.MANIFEST_LOADING,this.onManifestLoading,this),t.off(ly.MANIFEST_LOADED,this.onManifestLoaded,this),t.off(ly.MANIFEST_PARSED,this.onManifestParsed,this),t.off(ly.ERROR,this.onError,this))}pathways(){return(this.levels||[]).reduce((t,e)=>(-1===t.indexOf(e.pathwayId)&&t.push(e.pathwayId),t),[])}get pathwayPriority(){return this._pathwayPriority}set pathwayPriority(t){this.updatePathwayPriority(t)}startLoad(){if(this.started=!0,this.clearTimeout(),this.enabled&&this.uri){if(this.updated){const t=1e3*this.timeToLoad-(performance.now()-this.updated);if(t>0)return void this.scheduleRefresh(this.uri,t)}this.loadSteeringManifest(this.uri)}}stopLoad(){this.started=!1,this.loader&&(this.loader.destroy(),this.loader=null),this.clearTimeout()}clearTimeout(){-1!==this.reloadTimer&&(self.clearTimeout(this.reloadTimer),this.reloadTimer=-1)}destroy(){this.unregisterListeners(),this.stopLoad(),this.hls=null,this.levels=this.audioTracks=this.subtitleTracks=null}removeLevel(t){const e=this.levels;e&&(this.levels=e.filter(e=>e!==t))}onManifestLoading(){this.stopLoad(),this.enabled=!0,this.timeToLoad=300,this.updated=0,this.uri=null,this.pathwayId=".",this.levels=this.audioTracks=this.subtitleTracks=null}onManifestLoaded(t,e){const{contentSteering:r}=e;null!==r&&(this.pathwayId=r.pathwayId,this.uri=r.uri,this.started&&this.startLoad())}onManifestParsed(t,e){this.audioTracks=e.audioTracks,this.subtitleTracks=e.subtitleTracks}onError(t,e){const{errorAction:r}=e;if((null==r?void 0:r.action)===wb&&r.flags===kb){const t=this.levels;let n=this._pathwayPriority,i=this.pathwayId;if(e.context){const{groupId:r,pathwayId:n,type:s}=e.context;r&&t?i=this.getPathwayForGroupId(r,s,i):n&&(i=n)}i in this.penalizedPathways||(this.penalizedPathways[i]=performance.now()),!n&&t&&(n=this.pathways()),n&&n.length>1&&(this.updatePathwayPriority(n),r.resolved=this.pathwayId!==i),e.details!==oy.BUFFER_APPEND_ERROR||e.fatal?r.resolved||this.warn("Could not resolve ".concat(e.details,' ("').concat(e.error.message,'") with content-steering for Pathway: ').concat(i," levels: ").concat(t?t.length:t," priorities: ").concat(Zv(n)," penalized: ").concat(Zv(this.penalizedPathways))):r.resolved=!0}}filterParsedLevels(t){this.levels=t;let e=this.getLevelsForPathway(this.pathwayId);if(0===e.length){const r=t[0].pathwayId;this.log("No levels found in Pathway ".concat(this.pathwayId,'. Setting initial Pathway to "').concat(r,'"')),e=this.getLevelsForPathway(r),this.pathwayId=r}return e.length!==t.length&&this.log("Found ".concat(e.length,"/").concat(t.length,' levels in Pathway "').concat(this.pathwayId,'"')),e}getLevelsForPathway(t){return null===this.levels?[]:this.levels.filter(e=>t===e.pathwayId)}updatePathwayPriority(t){let e;this._pathwayPriority=t;const r=this.penalizedPathways,n=performance.now();Object.keys(r).forEach(t=>{n-r[t]>3e5&&delete r[t]});for(let i=0;i<t.length;i++){const n=t[i];if(n in r)continue;if(n===this.pathwayId)return;const s=this.hls.nextLoadLevel,a=this.hls.levels[s];if(e=this.getLevelsForPathway(n),e.length>0){this.log('Setting Pathway to "'.concat(n,'"')),this.pathwayId=n,aw(e),this.hls.trigger(ly.LEVELS_UPDATED,{levels:e});const t=this.hls.levels[s];a&&t&&this.levels&&(t.attrs["STABLE-VARIANT-ID"]!==a.attrs["STABLE-VARIANT-ID"]&&t.bitrate!==a.bitrate&&this.log("Unstable Pathways change from bitrate ".concat(a.bitrate," to ").concat(t.bitrate)),this.hls.nextLoadLevel=s);break}}}getPathwayForGroupId(t,e,r){const n=this.getLevelsForPathway(r).concat(this.levels||[]);for(let i=0;i<n.length;i++)if(e===hy&&n[i].hasAudioGroup(t)||e===dy&&n[i].hasSubtitleGroup(t))return n[i].pathwayId;return r}clonePathways(t){const e=this.levels;if(!e)return;const r={},n={};t.forEach(t=>{const{ID:i,"BASE-ID":s,"URI-REPLACEMENT":a}=t;if(e.some(t=>t.pathwayId===i))return;const o=this.getLevelsForPathway(s).map(t=>{const e=new s_(t.attrs);e["PATHWAY-ID"]=i;const s=e.AUDIO&&"".concat(e.AUDIO,"_clone_").concat(i),o=e.SUBTITLES&&"".concat(e.SUBTITLES,"_clone_").concat(i);s&&(r[e.AUDIO]=s,e.AUDIO=s),o&&(n[e.SUBTITLES]=o,e.SUBTITLES=o);const l=dT(t.uri,e["STABLE-VARIANT-ID"],"PER-VARIANT-URIS",a),c=new Qv({attrs:e,audioCodec:t.audioCodec,bitrate:t.bitrate,height:t.height,name:t.name,url:l,videoCodec:t.videoCodec,width:t.width});if(t.audioGroups)for(let r=1;r<t.audioGroups.length;r++)c.addGroupId("audio","".concat(t.audioGroups[r],"_clone_").concat(i));if(t.subtitleGroups)for(let r=1;r<t.subtitleGroups.length;r++)c.addGroupId("text","".concat(t.subtitleGroups[r],"_clone_").concat(i));return c});e.push(...o),hT(this.audioTracks,r,a,i),hT(this.subtitleTracks,n,a,i)})}loadSteeringManifest(t){const e=this.hls.config,r=e.loader;let n;this.loader&&this.loader.destroy(),this.loader=new r(e);try{n=new self.URL(t)}catch(cg){return this.enabled=!1,void this.log("Failed to parse Steering Manifest URI: ".concat(t))}if("data:"!==n.protocol){const t=0|(this.hls.bandwidthEstimate||e.abrEwmaDefaultEstimate);n.searchParams.set("_HLS_pathway",this.pathwayId),n.searchParams.set("_HLS_throughput",""+t)}const i={responseType:"json",url:n.href},s=e.steeringManifestLoadPolicy.default,a=s.errorRetry||s.timeoutRetry||{},o={loadPolicy:s,timeout:s.maxLoadTimeMs,maxRetry:a.maxNumRetry||0,retryDelay:a.retryDelayMs||0,maxRetryDelay:a.maxRetryDelayMs||0},l={onSuccess:(t,e,r,i)=>{this.log('Loaded steering manifest: "'.concat(n,'"'));const s=t.data;if(1!==(null==s?void 0:s.VERSION))return void this.log("Steering VERSION ".concat(s.VERSION," not supported!"));this.updated=performance.now(),this.timeToLoad=s.TTL;const{"RELOAD-URI":a,"PATHWAY-CLONES":o,"PATHWAY-PRIORITY":l}=s;if(a)try{this.uri=new self.URL(a,n).href}catch(cg){return this.enabled=!1,void this.log("Failed to parse Steering Manifest RELOAD-URI: ".concat(a))}this.scheduleRefresh(this.uri||r.url),o&&this.clonePathways(o);const c={steeringManifest:s,url:n.toString()};this.hls.trigger(ly.STEERING_MANIFEST_LOADED,c),l&&this.updatePathwayPriority(l)},onError:(t,e,r,n)=>{if(this.log("Error loading steering manifest: ".concat(t.code," ").concat(t.text," (").concat(e.url,")")),this.stopLoad(),410===t.code)return this.enabled=!1,void this.log("Steering manifest ".concat(e.url," no longer available"));let i=1e3*this.timeToLoad;if(429===t.code){const t=this.loader;if("function"===typeof(null==t?void 0:t.getResponseHeader)){const e=t.getResponseHeader("Retry-After");e&&(i=1e3*parseFloat(e))}return void this.log("Steering manifest ".concat(e.url," rate limited"))}this.scheduleRefresh(this.uri||e.url,i)},onTimeout:(t,e,r)=>{this.log("Timeout loading steering manifest (".concat(e.url,")")),this.scheduleRefresh(this.uri||e.url)}};this.log("Requesting steering manifest: ".concat(n)),this.loader.load(i,o,l)}scheduleRefresh(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1e3*this.timeToLoad;this.clearTimeout(),this.reloadTimer=self.setTimeout(()=>{var e;const r=null==(e=this.hls)?void 0:e.media;!r||r.ended?this.scheduleRefresh(t,1e3*this.timeToLoad):this.loadSteeringManifest(t)},e)}},interstitialsController:class extends Ey{constructor(t,e){super("interstitials",t.logger),this.HlsPlayerClass=void 0,this.hls=void 0,this.assetListLoader=void 0,this.mediaSelection=null,this.altSelection=null,this.media=null,this.detachedData=null,this.requiredTracks=null,this.manager=null,this.playerQueue=[],this.bufferedPos=-1,this.timelinePos=-1,this.schedule=void 0,this.playingItem=null,this.bufferingItem=null,this.waitingItem=null,this.endedItem=null,this.playingAsset=null,this.endedAsset=null,this.bufferingAsset=null,this.shouldPlay=!1,this.onPlay=()=>{this.shouldPlay=!0},this.onPause=()=>{this.shouldPlay=!1},this.onSeeking=()=>{const t=this.currentTime;if(void 0===t||this.playbackDisabled||!this.schedule)return;const e=t-this.timelinePos;if(Math.abs(e)<1/7056e5)return;const r=e<=-.01;this.timelinePos=t,this.bufferedPos=t;const n=this.playingItem;if(!n)return void this.checkBuffer();if(r){this.schedule.resetErrorsInRange(t,t-e)&&this.updateSchedule(!0)}if(this.checkBuffer(),r&&t<n.start||t>=n.end){var i;const e=this.findItemIndex(n);let s=this.schedule.findItemIndexAtTime(t);if(-1===s&&(s=e+(r?-1:1),this.log("seeked ".concat(r?"back ":"","to position not covered by schedule ").concat(t," (resolving from ").concat(e," to ").concat(s,")"))),!this.isInterstitial(n)&&null!=(i=this.media)&&i.paused&&(this.shouldPlay=!1),!r&&s>e){const t=this.schedule.findJumpRestrictedIndex(e+1,s);if(t>e)return void this.setSchedulePosition(t)}return void this.setSchedulePosition(s)}const s=this.playingAsset;if(!s){if(this.playingLastItem&&this.isInterstitial(n)){const e=n.event.assetList[0];e&&(this.endedItem=this.playingItem,this.playingItem=null,this.setScheduleToAssetAtTime(t,e))}return}const a=s.timelineStart,o=s.duration||0;var l;(r&&t<a||t>=a+o)&&(null!=(l=n.event)&&l.appendInPlace&&(this.clearAssetPlayers(n.event,n),this.flushFrontBuffer(t)),this.setScheduleToAssetAtTime(t,s))},this.onTimeupdate=()=>{const t=this.currentTime;if(void 0===t||this.playbackDisabled)return;if(!(t>this.timelinePos))return;this.timelinePos=t,t>this.bufferedPos&&this.checkBuffer();const e=this.playingItem;if(!e||this.playingLastItem)return;if(t>=e.end){this.timelinePos=e.end;const t=this.findItemIndex(e);this.setSchedulePosition(t+1)}const r=this.playingAsset;if(!r)return;t>=r.timelineStart+(r.duration||0)&&this.setScheduleToAssetAtTime(t,r)},this.onScheduleUpdate=(t,e)=>{const r=this.schedule;if(!r)return;const n=this.playingItem,i=r.events||[],s=r.items||[],a=r.durations,o=t.map(t=>t.identifier),l=!(!i.length&&!o.length);(l||e)&&this.log("INTERSTITIALS_UPDATED (".concat(i.length,"): ").concat(i,"\nSchedule: ").concat(s.map(t=>OT(t))," pos: ").concat(this.timelinePos)),o.length&&this.log("Removed events ".concat(o));let c=null,u=null;n&&(c=this.updateItem(n,this.timelinePos),this.itemsMatch(n,c)?this.playingItem=c:this.waitingItem=this.endedItem=null),this.waitingItem=this.updateItem(this.waitingItem),this.endedItem=this.updateItem(this.endedItem);const h=this.bufferingItem;if(h&&(u=this.updateItem(h,this.bufferedPos),this.itemsMatch(h,u)?this.bufferingItem=u:h.event&&(this.bufferingItem=this.playingItem,this.clearInterstitial(h.event,null))),t.forEach(t=>{t.assetList.forEach(t=>{this.clearAssetPlayer(t.identifier,null)})}),this.playerQueue.forEach(t=>{if(t.interstitial.appendInPlace){const e=t.assetItem.timelineStart,r=t.timelineOffset-e;if(r)try{t.timelineOffset=e}catch(vA){Math.abs(r)>TT&&this.warn("".concat(vA,' ("').concat(t.assetId,'" ').concat(t.timelineOffset,"->").concat(e,")"))}}}),l||e){if(this.hls.trigger(ly.INTERSTITIALS_UPDATED,{events:i.slice(0),schedule:s.slice(0),durations:a,removedIds:o}),this.isInterstitial(n)&&o.includes(n.event.identifier))return this.warn('Interstitial "'.concat(n.event.identifier,'" removed while playing')),void this.primaryFallback(n.event);n&&this.trimInPlace(c,n),h&&u!==c&&this.trimInPlace(u,h),this.checkBuffer()}},this.hls=t,this.HlsPlayerClass=e,this.assetListLoader=new DT(t),this.schedule=new MT(this.onScheduleUpdate,t.logger),this.registerListeners()}registerListeners(){const t=this.hls;t&&(t.on(ly.MEDIA_ATTACHING,this.onMediaAttaching,this),t.on(ly.MEDIA_ATTACHED,this.onMediaAttached,this),t.on(ly.MEDIA_DETACHING,this.onMediaDetaching,this),t.on(ly.MANIFEST_LOADING,this.onManifestLoading,this),t.on(ly.LEVEL_UPDATED,this.onLevelUpdated,this),t.on(ly.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),t.on(ly.AUDIO_TRACK_UPDATED,this.onAudioTrackUpdated,this),t.on(ly.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),t.on(ly.SUBTITLE_TRACK_UPDATED,this.onSubtitleTrackUpdated,this),t.on(ly.EVENT_CUE_ENTER,this.onInterstitialCueEnter,this),t.on(ly.ASSET_LIST_LOADED,this.onAssetListLoaded,this),t.on(ly.BUFFER_APPENDED,this.onBufferAppended,this),t.on(ly.BUFFER_FLUSHED,this.onBufferFlushed,this),t.on(ly.BUFFERED_TO_END,this.onBufferedToEnd,this),t.on(ly.MEDIA_ENDED,this.onMediaEnded,this),t.on(ly.ERROR,this.onError,this),t.on(ly.DESTROYING,this.onDestroying,this))}unregisterListeners(){const t=this.hls;t&&(t.off(ly.MEDIA_ATTACHING,this.onMediaAttaching,this),t.off(ly.MEDIA_ATTACHED,this.onMediaAttached,this),t.off(ly.MEDIA_DETACHING,this.onMediaDetaching,this),t.off(ly.MANIFEST_LOADING,this.onManifestLoading,this),t.off(ly.LEVEL_UPDATED,this.onLevelUpdated,this),t.off(ly.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),t.off(ly.AUDIO_TRACK_UPDATED,this.onAudioTrackUpdated,this),t.off(ly.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),t.off(ly.SUBTITLE_TRACK_UPDATED,this.onSubtitleTrackUpdated,this),t.off(ly.EVENT_CUE_ENTER,this.onInterstitialCueEnter,this),t.off(ly.ASSET_LIST_LOADED,this.onAssetListLoaded,this),t.off(ly.BUFFER_CODECS,this.onBufferCodecs,this),t.off(ly.BUFFER_APPENDED,this.onBufferAppended,this),t.off(ly.BUFFER_FLUSHED,this.onBufferFlushed,this),t.off(ly.BUFFERED_TO_END,this.onBufferedToEnd,this),t.off(ly.MEDIA_ENDED,this.onMediaEnded,this),t.off(ly.ERROR,this.onError,this),t.off(ly.DESTROYING,this.onDestroying,this))}startLoad(){this.resumeBuffering()}stopLoad(){this.pauseBuffering()}resumeBuffering(){var t;null==(t=this.getBufferingPlayer())||t.resumeBuffering()}pauseBuffering(){var t;null==(t=this.getBufferingPlayer())||t.pauseBuffering()}destroy(){this.unregisterListeners(),this.stopLoad(),this.assetListLoader&&this.assetListLoader.destroy(),this.emptyPlayerQueue(),this.clearScheduleState(),this.schedule&&this.schedule.destroy(),this.media=this.detachedData=this.mediaSelection=this.requiredTracks=this.altSelection=this.schedule=this.manager=null,this.hls=this.HlsPlayerClass=this.log=null,this.assetListLoader=null,this.onPlay=this.onPause=this.onSeeking=this.onTimeupdate=null,this.onScheduleUpdate=null}onDestroying(){const t=this.primaryMedia||this.media;t&&this.removeMediaListeners(t)}removeMediaListeners(t){gw(t,"play",this.onPlay),gw(t,"pause",this.onPause),gw(t,"seeking",this.onSeeking),gw(t,"timeupdate",this.onTimeupdate)}onMediaAttaching(t,e){const r=this.media=e.media;pw(r,"seeking",this.onSeeking),pw(r,"timeupdate",this.onTimeupdate),pw(r,"play",this.onPlay),pw(r,"pause",this.onPause)}onMediaAttached(t,e){const r=this.effectivePlayingItem,n=this.detachedData;if(this.detachedData=null,null===r)this.checkStart();else if(!n){this.clearScheduleState();const t=this.findItemIndex(r);this.setSchedulePosition(t)}}clearScheduleState(){this.log("clear schedule state"),this.playingItem=this.bufferingItem=this.waitingItem=this.endedItem=this.playingAsset=this.endedAsset=this.bufferingAsset=null}onMediaDetaching(t,e){const r=!!e.transferMedia,n=this.media;if(this.media=null,!r&&(n&&this.removeMediaListeners(n),this.detachedData)){const t=this.getBufferingPlayer();t&&(this.log("Removing schedule state for detachedData and ".concat(t)),this.playingAsset=this.endedAsset=this.bufferingAsset=this.bufferingItem=this.waitingItem=this.detachedData=null,t.detachMedia()),this.shouldPlay=!1}}get interstitialsManager(){if(!this.hls)return null;if(this.manager)return this.manager;const t=this,e=()=>t.bufferingItem||t.waitingItem,r=e=>e?t.getAssetPlayer(e.identifier):e,n=(e,n,s,a,o)=>{if(e){let l=e[n].start;const c=e.event;if(c){if("playout"===n||c.timelineOccupancy!==kT.Point){const t=r(s);(null==t?void 0:t.interstitial)===c&&(l+=t.assetItem.startOffset+t[o])}}else{l+=("bufferedPos"===a?i():t[a])-e.start}return l}return 0},i=()=>{const e=t.bufferedPos;return e===Number.MAX_VALUE?s("primary"):Math.max(e,0)},s=e=>{var r,n;return null!=(r=t.primaryDetails)&&r.live?t.primaryDetails.edge:(null==(n=t.schedule)?void 0:n.durations[e])||0},a=(e,i)=>{var s,a;const o=t.effectivePlayingItem;if(null!=o&&null!=(s=o.event)&&s.restrictions.skip||!t.schedule)return;t.log("seek to ".concat(e,' "').concat(i,'"'));const l=t.effectivePlayingItem,c=t.schedule.findItemIndexAtTime(e,i),u=null==(a=t.schedule.items)?void 0:a[c],h=t.getBufferingPlayer(),d=null==h?void 0:h.interstitial,f=null==d?void 0:d.appendInPlace,p=l&&t.itemsMatch(l,u);if(l&&(f||p)){const s=r(t.playingAsset),a=(null==s?void 0:s.media)||t.primaryMedia;if(a){const r="primary"===i?a.currentTime:n(l,i,t.playingAsset,"timelinePos","currentTime"),o=e-r,c=(f?r:a.currentTime)+o;if(c>=0&&(!s||f||c<=s.duration))return void(a.currentTime=c)}}if(u){let r=e;if("primary"!==i){const t=e-u[i].start;r=u.start+t}const n=!t.isInterstitial(u);if(t.isInterstitial(l)&&!l.event.appendInPlace||!n&&!u.event.appendInPlace){if(l){const s=t.findItemIndex(l);if(c>s){const e=t.schedule.findJumpRestrictedIndex(s+1,c);if(e>s)return void t.setSchedulePosition(e)}let a=0;if(n)t.timelinePos=r,t.checkBuffer();else{const t=u.event.assetList,r=e-(u[i]||u).start;for(let e=t.length;e--;){const n=t[e];if(n.duration&&r>=n.startOffset&&r<n.startOffset+n.duration){a=e;break}}}t.setSchedulePosition(c,a)}}else{const e=t.media||(f?null==h?void 0:h.media:null);e&&(e.currentTime=r)}}},o=()=>{const r=t.effectivePlayingItem;if(t.isInterstitial(r))return r;const n=e();return t.isInterstitial(n)?n:null},l={get bufferedEnd(){const r=e(),i=t.bufferingItem;var s;return i&&i===r&&(n(i,"playout",t.bufferingAsset,"bufferedPos","bufferedEnd")-i.playout.start||(null==(s=t.bufferingAsset)?void 0:s.startOffset))||0},get currentTime(){const e=o(),r=t.effectivePlayingItem;return r&&r===e?n(r,"playout",t.effectivePlayingAsset,"timelinePos","currentTime")-r.playout.start:0},set currentTime(e){const r=o(),n=t.effectivePlayingItem;n&&n===r&&a(e+n.playout.start,"playout")},get duration(){const t=o();return t?t.playout.end-t.playout.start:0},get assetPlayers(){var e;const r=null==(e=o())?void 0:e.event.assetList;return r?r.map(e=>t.getAssetPlayer(e.identifier)):[]},get playingIndex(){var e;const r=null==(e=o())?void 0:e.event;return r&&t.effectivePlayingAsset?r.findAssetIndex(t.effectivePlayingAsset):-1},get scheduleItem(){return o()}};return this.manager={get events(){var e;return(null==(e=t.schedule)||null==(e=e.events)?void 0:e.slice(0))||[]},get schedule(){var e;return(null==(e=t.schedule)||null==(e=e.items)?void 0:e.slice(0))||[]},get interstitialPlayer(){return o()?l:null},get playerQueue(){return t.playerQueue.slice(0)},get bufferingAsset(){return t.bufferingAsset},get bufferingItem(){return e()},get bufferingIndex(){const r=e();return t.findItemIndex(r)},get playingAsset(){return t.effectivePlayingAsset},get playingItem(){return t.effectivePlayingItem},get playingIndex(){const e=t.effectivePlayingItem;return t.findItemIndex(e)},primary:{get bufferedEnd(){return i()},get currentTime(){const e=t.timelinePos;return e>0?e:0},set currentTime(t){a(t,"primary")},get duration(){return s("primary")},get seekableStart(){var e;return(null==(e=t.primaryDetails)?void 0:e.fragmentStart)||0}},integrated:{get bufferedEnd(){return n(e(),"integrated",t.bufferingAsset,"bufferedPos","bufferedEnd")},get currentTime(){return n(t.effectivePlayingItem,"integrated",t.effectivePlayingAsset,"timelinePos","currentTime")},set currentTime(t){a(t,"integrated")},get duration(){return s("integrated")},get seekableStart(){var e;return((e,r)=>{var n;if(0!==e&&"primary"!==r&&null!=(n=t.schedule)&&n.length){var i;const n=t.schedule.findItemIndexAtTime(e),s=null==(i=t.schedule.items)?void 0:i[n];if(s)return e+(s[r].start-s.start)}return e})((null==(e=t.primaryDetails)?void 0:e.fragmentStart)||0,"integrated")}},skip:()=>{const e=t.effectivePlayingItem,r=null==e?void 0:e.event;if(r&&!r.restrictions.skip){const n=t.findItemIndex(e);if(r.appendInPlace){const t=e.playout.start+e.event.duration;a(t+.001,"playout")}else t.advanceAfterAssetEnded(r,n,1/0)}}}}get effectivePlayingItem(){return this.waitingItem||this.playingItem||this.endedItem}get effectivePlayingAsset(){return this.playingAsset||this.endedAsset}get playingLastItem(){var t;const e=this.playingItem,r=null==(t=this.schedule)?void 0:t.items;return!!(this.playbackStarted&&e&&r)&&this.findItemIndex(e)===r.length-1}get playbackStarted(){return null!==this.effectivePlayingItem}get currentTime(){var t,e;if(null===this.mediaSelection)return;const r=this.waitingItem||this.playingItem;if(this.isInterstitial(r)&&!r.event.appendInPlace)return;let n=this.media;!n&&null!=(t=this.bufferingItem)&&null!=(t=t.event)&&t.appendInPlace&&(n=this.primaryMedia);const i=null==(e=n)?void 0:e.currentTime;return void 0!==i&&ny(i)?i:void 0}get primaryMedia(){var t;return this.media||(null==(t=this.detachedData)?void 0:t.media)||null}isInterstitial(t){return!(null==t||!t.event)}retreiveMediaSource(t,e){const r=this.getAssetPlayer(t);r&&this.transferMediaFromPlayer(r,e)}transferMediaFromPlayer(t,e){const r=t.interstitial.appendInPlace,n=t.media;if(r&&n===this.primaryMedia){if(this.bufferingAsset=null,(!e||this.isInterstitial(e)&&!e.event.appendInPlace)&&e&&n)return void(this.detachedData={media:n});const r=t.transferMedia();this.log("transfer MediaSource from ".concat(t," ").concat(Zv(r))),this.detachedData=r}else e&&n&&(this.shouldPlay||(this.shouldPlay=!n.paused))}transferMediaTo(t,e){var r,n;if(t.media===e)return;let i=null;const s=this.hls,a=t!==s,o=a&&t.interstitial.appendInPlace,l=null==(r=this.detachedData)?void 0:r.mediaSource;let c;if(s.media)o&&(i=s.transferMedia(),this.detachedData=i),c="Primary";else if(l){const t=this.getBufferingPlayer();t?(i=t.transferMedia(),c="".concat(t)):c="detached MediaSource"}else c="detached media";if(!i)if(l)i=this.detachedData,this.log("using detachedData: MediaSource ".concat(Zv(i)));else if(!this.detachedData||s.media===e){const t=this.playerQueue;t.length>1&&t.forEach(t=>{if(a&&t.interstitial.appendInPlace!==o){const e=t.interstitial;this.clearInterstitial(t.interstitial,null),e.appendInPlace=!1,e.appendInPlace&&this.warn("Could not change append strategy for queued assets ".concat(e))}}),this.hls.detachMedia(),this.detachedData={media:e}}const u=i&&"mediaSource"in i&&"closed"!==(null==(n=i.mediaSource)?void 0:n.readyState),h=u&&i?i:e;this.log("".concat(u?"transfering MediaSource":"attaching media"," to ").concat(a?t:"Primary"," from ").concat(c," (media.currentTime: ").concat(e.currentTime,")"));const d=this.schedule;if(h===i&&d){const e=a&&t.assetId===d.assetIdAtEnd;h.overrides={duration:d.duration,endOfStream:!a||e,cueRemoval:!a}}t.attachMedia(h)}onInterstitialCueEnter(){this.onTimeupdate()}checkStart(){const t=this.schedule,e=null==t?void 0:t.events;if(!e||this.playbackDisabled||!this.media)return;-1===this.bufferedPos&&(this.bufferedPos=0);const r=this.timelinePos,n=this.effectivePlayingItem;if(-1===r){const r=this.hls.startPosition;if(this.log(FT("checkStart",r)),this.timelinePos=r,e.length&&e[0].cue.pre){const r=t.findEventIndex(e[0].identifier);this.setSchedulePosition(r)}else if(r>=0||!this.primaryLive){const e=this.timelinePos=r>0?r:0,n=t.findItemIndexAtTime(e);this.setSchedulePosition(n)}}else if(n&&!this.playingItem){const e=t.findItemIndex(n);this.setSchedulePosition(e)}}advanceAssetBuffering(t,e){const r=t.event,n=r.findAssetIndex(e),i=LT(r,n);if(r.isAssetPastPlayoutLimit(i)){if(this.schedule){var s;const e=null==(s=this.schedule.items)?void 0:s[this.findItemIndex(t)+1];e&&this.bufferedToItem(e)}}else this.bufferedToEvent(t,i)}advanceAfterAssetEnded(t,e,r){const n=LT(t,r);if(t.isAssetPastPlayoutLimit(n)){if(this.schedule){const r=this.schedule.items;if(r){const n=e+1;if(n>=r.length)return void this.setSchedulePosition(-1);const i=t.resumeTime;this.timelinePos<i&&(this.log(FT("advanceAfterAssetEnded",i)),this.timelinePos=i,t.appendInPlace&&this.advanceInPlace(i),this.checkBuffer(this.bufferedPos<i)),this.setSchedulePosition(n)}}}else{if(t.appendInPlace){const e=t.assetList[n];e&&this.advanceInPlace(e.timelineStart)}this.setSchedulePosition(e,n)}}setScheduleToAssetAtTime(t,e){const r=this.schedule;if(!r)return;const n=e.parentIdentifier,i=r.getEvent(n);if(i){const e=r.findEventIndex(n),s=r.findAssetIndex(i,t);this.advanceAfterAssetEnded(i,e,s-1)}}setSchedulePosition(t,e){var r;const n=null==(r=this.schedule)?void 0:r.items;if(!n||this.playbackDisabled)return;const i=t>=0?n[t]:null;this.log("setSchedulePosition ".concat(t,", ").concat(e," (").concat(i?OT(i):i,") pos: ").concat(this.timelinePos));const s=this.waitingItem||this.playingItem,a=this.playingLastItem;if(this.isInterstitial(s)){const r=s.event,c=this.playingAsset,u=null==c?void 0:c.identifier,h=u?this.getAssetPlayer(u):null;if(h&&u&&(!this.eventItemsMatch(s,i)||void 0!==e&&u!==r.assetList[e].identifier)){var o;const e=r.findAssetIndex(c);if(this.log("INTERSTITIAL_ASSET_ENDED ".concat(e+1,"/").concat(r.assetList.length," ").concat(PT(c))),this.endedAsset=c,this.playingAsset=null,this.hls.trigger(ly.INTERSTITIAL_ASSET_ENDED,{asset:c,assetListIndex:e,event:r,schedule:n.slice(0),scheduleIndex:t,player:h}),s!==this.playingItem)return void(this.itemsMatch(s,this.playingItem)&&!this.playingAsset&&this.advanceAfterAssetEnded(r,this.findItemIndex(this.playingItem),e));this.retreiveMediaSource(u,i),!h.media||null!=(o=this.detachedData)&&o.mediaSource||h.detachMedia()}if(!this.eventItemsMatch(s,i)&&(this.endedItem=s,this.playingItem=null,this.log("INTERSTITIAL_ENDED ".concat(r," ").concat(OT(s))),r.hasPlayed=!0,this.hls.trigger(ly.INTERSTITIAL_ENDED,{event:r,schedule:n.slice(0),scheduleIndex:t}),r.cue.once)){var l;this.updateSchedule();const t=null==(l=this.schedule)?void 0:l.items;if(i&&t){const r=this.findItemIndex(i);this.advanceSchedule(r,t,e,s,a)}return}}this.advanceSchedule(t,n,e,s,a)}advanceSchedule(t,e,r,n,i){const s=this.schedule;if(!s)return;const a=e[t]||null,o=this.primaryMedia,l=this.playerQueue;if(l.length&&l.forEach(e=>{const r=e.interstitial,n=s.findEventIndex(r.identifier);(n<t||n>t+1)&&this.clearInterstitial(r,a)}),this.isInterstitial(a)){this.timelinePos=Math.min(Math.max(this.timelinePos,a.start),a.end);const i=a.event;if(void 0===r){const e=LT(i,(r=s.findAssetIndex(i,this.timelinePos))-1);if(i.isAssetPastPlayoutLimit(e)||i.appendInPlace&&this.timelinePos===a.end)return void this.advanceAfterAssetEnded(i,t,r);r=e}const l=this.waitingItem;this.assetsBuffered(a,o)||this.setBufferingItem(a);let c=this.preloadAssets(i,r);if(this.eventItemsMatch(a,l||n)||(this.waitingItem=a,this.log("INTERSTITIAL_STARTED ".concat(OT(a)," ").concat(i.appendInPlace?"append in place":"")),this.hls.trigger(ly.INTERSTITIAL_STARTED,{event:i,schedule:e.slice(0),scheduleIndex:t})),!i.assetListLoaded)return void this.log("Waiting for ASSET-LIST to complete loading ".concat(i));if(i.assetListLoader&&(i.assetListLoader.destroy(),i.assetListLoader=void 0),!o)return void this.log("Waiting for attachMedia to start Interstitial ".concat(i));this.waitingItem=this.endedItem=null,this.playingItem=a;const u=i.assetList[r];if(!u)return void this.advanceAfterAssetEnded(i,t,r||0);if(c||(c=this.getAssetPlayer(u.identifier)),null===c||c.destroyed){const t=i.assetList.length;this.warn("asset ".concat(r+1,"/").concat(t," player destroyed ").concat(i)),c=this.createAssetPlayer(i,u,r),c.loadSource()}if(!this.eventItemsMatch(a,this.bufferingItem)&&i.appendInPlace&&this.isAssetBuffered(u))return;this.startAssetPlayer(c,r,e,t,o),this.shouldPlay&&NT(c.media)}else a?(this.resumePrimary(a,t,n),this.shouldPlay&&NT(this.hls.media)):i&&this.isInterstitial(n)&&(this.endedItem=null,this.playingItem=n,n.event.appendInPlace||this.attachPrimary(s.durations.primary,null))}get playbackDisabled(){return!1===this.hls.config.enableInterstitialPlayback}get primaryDetails(){var t;return null==(t=this.mediaSelection)?void 0:t.main.details}get primaryLive(){var t;return!(null==(t=this.primaryDetails)||!t.live)}resumePrimary(t,e,r){var n,i;if(this.playingItem=t,this.playingAsset=this.endedAsset=null,this.waitingItem=this.endedItem=null,this.bufferedToItem(t),this.log("resuming ".concat(OT(t))),null==(n=this.detachedData)||!n.mediaSource){let r=this.timelinePos;(r<t.start||r>=t.end)&&(r=this.getPrimaryResumption(t,e),this.log(FT("resumePrimary",r)),this.timelinePos=r),this.attachPrimary(r,t)}if(!r)return;const s=null==(i=this.schedule)?void 0:i.items;s&&(this.log("INTERSTITIALS_PRIMARY_RESUMED ".concat(OT(t))),this.hls.trigger(ly.INTERSTITIALS_PRIMARY_RESUMED,{schedule:s.slice(0),scheduleIndex:e}),this.checkBuffer())}getPrimaryResumption(t,e){const r=t.start;if(this.primaryLive){const t=this.primaryDetails;if(0===e)return this.hls.startPosition;if(t&&(r<t.fragmentStart||r>t.edge))return this.hls.liveSyncPosition||-1}return r}isAssetBuffered(t){const e=this.getAssetPlayer(t.identifier);if(null!=e&&e.hls)return e.hls.bufferedToEnd;return $b.bufferInfo(this.primaryMedia,this.timelinePos,0).end+1>=t.timelineStart+(t.duration||0)}attachPrimary(t,e,r){e?this.setBufferingItem(e):this.bufferingItem=this.playingItem,this.bufferingAsset=null;const n=this.primaryMedia;if(!n)return;const i=this.hls;i.media?this.checkBuffer():(this.transferMediaTo(i,n),r&&this.startLoadingPrimaryAt(t,r)),r||(this.log(FT("attachPrimary",t)),this.timelinePos=t,this.startLoadingPrimaryAt(t,r))}startLoadingPrimaryAt(t,e){var r;const n=this.hls;!n.loadingEnabled||!n.media||Math.abs(((null==(r=n.mainForwardBufferInfo)?void 0:r.start)||n.media.currentTime)-t)>.5?n.startLoad(t,e):n.bufferingEnabled||n.resumeBuffering()}onManifestLoading(){var t;this.stopLoad(),null==(t=this.schedule)||t.reset(),this.emptyPlayerQueue(),this.clearScheduleState(),this.shouldPlay=!1,this.bufferedPos=this.timelinePos=-1,this.mediaSelection=this.altSelection=this.manager=this.requiredTracks=null,this.hls.off(ly.BUFFER_CODECS,this.onBufferCodecs,this),this.hls.on(ly.BUFFER_CODECS,this.onBufferCodecs,this)}onLevelUpdated(t,e){if(-1===e.level||!this.schedule)return;const r=this.hls.levels[e.level];if(!r.details)return;const n=wy(wy({},this.mediaSelection||this.altSelection),{},{main:r});this.mediaSelection=n,this.schedule.parseInterstitialDateRanges(n,this.hls.config.interstitialAppendInPlace),!this.effectivePlayingItem&&this.schedule.items&&this.checkStart()}onAudioTrackUpdated(t,e){const r=this.hls.audioTracks[e.id],n=this.mediaSelection;if(!n)return void(this.altSelection=wy(wy({},this.altSelection),{},{audio:r}));const i=wy(wy({},n),{},{audio:r});this.mediaSelection=i}onSubtitleTrackUpdated(t,e){const r=this.hls.subtitleTracks[e.id],n=this.mediaSelection;if(!n)return void(this.altSelection=wy(wy({},this.altSelection),{},{subtitles:r}));const i=wy(wy({},n),{},{subtitles:r});this.mediaSelection=i}onAudioTrackSwitching(t,e){const r=eb(e);this.playerQueue.forEach(t=>{let{hls:n}=t;return n&&(n.setAudioOption(e)||n.setAudioOption(r))})}onSubtitleTrackSwitch(t,e){const r=eb(e);this.playerQueue.forEach(t=>{let{hls:n}=t;return n&&(n.setSubtitleOption(e)||-1!==e.id&&n.setSubtitleOption(r))})}onBufferCodecs(t,e){const r=e.tracks;r&&(this.requiredTracks=r)}onBufferAppended(t,e){this.checkBuffer()}onBufferFlushed(t,e){const r=this.playingItem;if(r&&!this.itemsMatch(r,this.bufferingItem)&&!this.isInterstitial(r)){const t=this.timelinePos;this.bufferedPos=t,this.checkBuffer()}}onBufferedToEnd(t){if(!this.schedule)return;const e=this.schedule.events;if(this.bufferedPos<Number.MAX_VALUE&&e){for(let t=0;t<e.length;t++){const n=e[t];if(n.cue.post){var r;const t=this.schedule.findEventIndex(n.identifier),e=null==(r=this.schedule.items)?void 0:r[t];this.isInterstitial(e)&&this.eventItemsMatch(e,this.bufferingItem)&&this.bufferedToItem(e,0);break}}this.bufferedPos=Number.MAX_VALUE}}onMediaEnded(t){const e=this.playingItem;if(!this.playingLastItem&&e){const t=this.findItemIndex(e);this.setSchedulePosition(t+1)}else this.shouldPlay=!1}updateItem(t,e){var r;const n=null==(r=this.schedule)?void 0:r.items;if(t&&n){return n[this.findItemIndex(t,e)]||null}return null}trimInPlace(t,e){if(this.isInterstitial(t)&&t.event.appendInPlace&&e.end-t.end>.25){t.event.assetList.forEach((e,r)=>{t.event.isAssetPastPlayoutLimit(r)&&this.clearAssetPlayer(e.identifier,null)});const r=t.end+.25,n=$b.bufferInfo(this.primaryMedia,r,0);if(n.end>r||(n.nextStart||0)>r){this.log("trim buffered interstitial ".concat(OT(t)," (was ").concat(OT(e),")"));const n=!0;this.attachPrimary(r,null,n),this.flushFrontBuffer(r)}}}itemsMatch(t,e){return!!e&&(t===e||t.event&&e.event&&this.eventItemsMatch(t,e)||!t.event&&!e.event&&this.findItemIndex(t)===this.findItemIndex(e))}eventItemsMatch(t,e){var r;return!!e&&(t===e||t.event.identifier===(null==(r=e.event)?void 0:r.identifier))}findItemIndex(t,e){return t&&this.schedule?this.schedule.findItemIndex(t,e):-1}updateSchedule(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];var e;const r=this.mediaSelection;r&&(null==(e=this.schedule)||e.updateSchedule(r,[],t))}checkBuffer(t){var e;const r=null==(e=this.schedule)?void 0:e.items;if(!r)return;const n=$b.bufferInfo(this.primaryMedia,this.timelinePos,0);t&&(this.bufferedPos=this.timelinePos),t||(t=n.len<1),this.updateBufferedPos(n.end,r,t)}updateBufferedPos(t,e,r){const n=this.schedule,i=this.bufferingItem;if(this.bufferedPos>t||!n)return;if(1===e.length&&this.itemsMatch(e[0],i))return void(this.bufferedPos=t);const s=this.playingItem,a=this.findItemIndex(s);let o=n.findItemIndexAtTime(t);if(this.bufferedPos<t){var l;const r=this.findItemIndex(i),n=Math.min(r+1,e.length-1),s=e[n];if((-1===o&&i&&t>=i.end||null!=(l=s.event)&&l.appendInPlace&&t+.01>=s.start)&&(o=n),this.isInterstitial(i)){const t=i.event;if(n-a>1&&!1===t.appendInPlace)return;if(0===t.assetList.length&&t.assetListLoader)return}if(this.bufferedPos=t,o>r&&o>a)this.bufferedToItem(s);else{const e=this.primaryDetails;this.primaryLive&&e&&t>e.edge-e.targetduration&&s.start<e.edge+this.hls.config.interstitialLiveLookAhead&&this.isInterstitial(s)&&this.preloadAssets(s.event,0)}}else r&&s&&!this.itemsMatch(s,i)&&(o===a?this.bufferedToItem(s):o===a+1&&this.bufferedToItem(e[o]))}assetsBuffered(t,e){return 0!==t.event.assetList.length&&!t.event.assetList.some(t=>{const r=this.getAssetPlayer(t.identifier);return!(null!=r&&r.bufferedInPlaceToEnd(e))})}setBufferingItem(t){const e=this.bufferingItem,r=this.schedule;if(!this.itemsMatch(t,e)&&r){const{items:n,events:i}=r;if(!n||!i)return e;const s=this.isInterstitial(t),a=this.getBufferingPlayer();this.bufferingItem=t,this.bufferedPos=Math.max(t.start,Math.min(t.end,this.timelinePos));const o=a?a.remaining:e?e.end-this.timelinePos:0;if(this.log("INTERSTITIALS_BUFFERED_TO_BOUNDARY ".concat(OT(t))+(e?" (".concat(o.toFixed(2)," remaining)"):"")),!this.playbackDisabled)if(s){const e=r.findAssetIndex(t.event,this.bufferedPos);t.event.assetList.forEach((t,r)=>{const n=this.getAssetPlayer(t.identifier);n&&(r===e&&n.loadSource(),n.resumeBuffering())})}else this.hls.resumeBuffering(),this.playerQueue.forEach(t=>t.pauseBuffering());this.hls.trigger(ly.INTERSTITIALS_BUFFERED_TO_BOUNDARY,{events:i.slice(0),schedule:n.slice(0),bufferingIndex:this.findItemIndex(t),playingIndex:this.findItemIndex(this.playingItem)})}else this.bufferingItem!==t&&(this.bufferingItem=t);return e}bufferedToItem(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const r=this.setBufferingItem(t);if(!this.playbackDisabled)if(this.isInterstitial(t))this.bufferedToEvent(t,e);else if(null!==r){this.bufferingAsset=null;const e=this.detachedData;if(e)if(e.mediaSource){const e=!0;this.attachPrimary(t.start,t,e)}else this.preloadPrimary(t);else this.preloadPrimary(t)}}preloadPrimary(t){const e=this.findItemIndex(t),r=this.getPrimaryResumption(t,e);this.startLoadingPrimaryAt(r)}bufferedToEvent(t,e){const r=t.event,n=0===r.assetList.length&&!r.assetListLoader,i=r.cue.once;if(n||!i){const t=this.preloadAssets(r,e);if(null!=t&&t.interstitial.appendInPlace){const e=this.primaryMedia;e&&this.bufferAssetPlayer(t,e)}}}preloadAssets(t,e){const r=t.assetUrl,n=t.assetList.length,i=0===n&&!t.assetListLoader,s=t.cue.once;if(i){const i=t.timelineStart;if(t.appendInPlace){var a;const e=this.playingItem;this.isInterstitial(e)||(null==e||null==(a=e.nextEvent)?void 0:a.identifier)!==t.identifier||this.flushFrontBuffer(i+.25)}let s,o=0;if(!this.playingItem&&this.primaryLive&&(o=this.hls.startPosition,-1===o&&(o=this.hls.liveSyncPosition||0)),o&&!t.cue.pre&&!t.cue.post){const t=o-i;t>0&&(s=Math.round(1e3*t)/1e3)}if(this.log("Load interstitial asset ".concat(e+1,"/").concat(r?1:n," ").concat(t).concat(s?" live-start: ".concat(o," start-offset: ").concat(s):"")),r)return this.createAsset(t,0,0,i,t.duration,r);const l=this.assetListLoader.loadAssetList(t,s);l&&(t.assetListLoader=l)}else if(!s&&n){for(let i=e;i<n;i++){const e=t.assetList[i],r=this.getAssetPlayerQueueIndex(e.identifier);-1!==r&&!this.playerQueue[r].destroyed||e.error||this.createAssetPlayer(t,e,i)}const r=t.assetList[e];if(r){const t=this.getAssetPlayer(r.identifier);return t&&t.loadSource(),t}}return null}flushFrontBuffer(t){const e=this.requiredTracks;if(!e)return;this.log("Removing front buffer starting at ".concat(t));Object.keys(e).forEach(e=>{this.hls.trigger(ly.BUFFER_FLUSHING,{startOffset:t,endOffset:1/0,type:e})})}getAssetPlayerQueueIndex(t){const e=this.playerQueue;for(let r=0;r<e.length;r++)if(t===e[r].assetId)return r;return-1}getAssetPlayer(t){const e=this.getAssetPlayerQueueIndex(t);return this.playerQueue[e]||null}getBufferingPlayer(){const{playerQueue:t,primaryMedia:e}=this;if(e)for(let r=0;r<t.length;r++)if(t[r].media===e)return t[r];return null}createAsset(t,e,r,n,i,s){const a={parentIdentifier:t.identifier,identifier:AT(t,s,e),duration:i,startOffset:r,timelineStart:n,uri:s};return this.createAssetPlayer(t,a,e)}createAssetPlayer(t,e,r){const n=this.hls,i=n.userConfig;let s=i.videoPreference;const a=n.loadLevelObj||n.levels[n.currentLevel];(s||a)&&(s=by({},s),a.videoCodec&&(s.videoCodec=a.videoCodec),a.videoRange&&(s.allowedVideoRanges=[a.videoRange]));const o=n.audioTracks[n.audioTrack],l=n.subtitleTracks[n.subtitleTrack];let c=0;if(this.primaryLive||t.appendInPlace){const t=this.timelinePos-e.timelineStart;if(t>1){const r=e.duration;r&&t<r&&(c=t)}}const u=e.identifier,h=wy(wy({},i),{},{maxMaxBufferLength:Math.min(180,n.config.maxMaxBufferLength),autoStartLoad:!0,startFragPrefetch:!0,primarySessionId:n.sessionId,assetPlayerId:u,abrEwmaDefaultEstimate:n.bandwidthEstimate,interstitialsController:void 0,startPosition:c,liveDurationInfinity:!1,testBandwidth:!1,videoPreference:s,audioPreference:o||i.audioPreference,subtitlePreference:l||i.subtitlePreference});t.appendInPlace&&(t.appendInPlaceStarted=!0,e.timelineStart&&(h.timelineOffset=e.timelineStart));const d=h.cmcd;null!=d&&d.sessionId&&d.contentId&&(h.cmcd=by({},d,{contentId:ST(e.uri)})),this.getAssetPlayer(u)&&this.warn("Duplicate date range identifier ".concat(t," and asset ").concat(u));const f=new CT(this.HlsPlayerClass,h,t,e);this.playerQueue.push(f),t.assetList[r]=e;let p=!0;const g=n=>{if(n.live){var i;const e=new Error("Interstitials MUST be VOD assets ".concat(t)),n={fatal:!0,type:ay.OTHER_ERROR,details:oy.INTERSTITIAL_ASSET_ITEM_ERROR,error:e},s=(null==(i=this.schedule)?void 0:i.findEventIndex(t.identifier))||-1;return void this.handleAssetItemError(n,t,s,r,e.message)}const s=n.edge-n.fragmentStart,a=e.duration;(p||null===a||s>a)&&(p=!1,this.log('Interstitial asset "'.concat(u,'" duration change ').concat(a," > ").concat(s)),e.duration=s,this.updateSchedule())};f.on(ly.LEVEL_UPDATED,(t,e)=>{let{details:r}=e;return g(r)}),f.on(ly.LEVEL_PTS_UPDATED,(t,e)=>{let{details:r}=e;return g(r)}),f.on(ly.EVENT_CUE_ENTER,()=>this.onInterstitialCueEnter());const m=(t,e)=>{const r=this.getAssetPlayer(u);if(r&&e.tracks){r.off(ly.BUFFER_CODECS,m),r.tracks=e.tracks;const t=this.primaryMedia;this.bufferingAsset===r.assetItem&&t&&!r.media&&this.bufferAssetPlayer(r,t)}};f.on(ly.BUFFER_CODECS,m);f.on(ly.BUFFERED_TO_END,()=>{var r;const n=this.getAssetPlayer(u);if(this.log("buffered to end of asset ".concat(n)),!n||!this.schedule)return;const i=this.schedule.findEventIndex(t.identifier),s=null==(r=this.schedule.items)?void 0:r[i];this.isInterstitial(s)&&this.advanceAssetBuffering(s,e)});const y=e=>()=>{if(!this.getAssetPlayer(u)||!this.schedule)return;this.shouldPlay=!0;const r=this.schedule.findEventIndex(t.identifier);this.advanceAfterAssetEnded(t,r,e)};return f.once(ly.MEDIA_ENDED,y(r)),f.once(ly.PLAYOUT_LIMIT_REACHED,y(1/0)),f.on(ly.ERROR,(e,n)=>{if(!this.schedule)return;const i=this.getAssetPlayer(u);if(n.details===oy.BUFFER_STALLED_ERROR)return null!=i&&i.appendInPlace?void this.handleInPlaceStall(t):(this.onTimeupdate(),void this.checkBuffer(!0));this.handleAssetItemError(n,t,this.schedule.findEventIndex(t.identifier),r,"Asset player error ".concat(n.error," ").concat(t))}),f.on(ly.DESTROYING,()=>{if(!this.getAssetPlayer(u)||!this.schedule)return;const e=new Error("Asset player destroyed unexpectedly ".concat(u)),n={fatal:!0,type:ay.OTHER_ERROR,details:oy.INTERSTITIAL_ASSET_ITEM_ERROR,error:e};this.handleAssetItemError(n,t,this.schedule.findEventIndex(t.identifier),r,e.message)}),this.log("INTERSTITIAL_ASSET_PLAYER_CREATED ".concat(PT(e))),this.hls.trigger(ly.INTERSTITIAL_ASSET_PLAYER_CREATED,{asset:e,assetListIndex:r,event:t,player:f}),f}clearInterstitial(t,e){this.clearAssetPlayers(t,e),t.reset()}clearAssetPlayers(t,e){t.assetList.forEach(t=>{this.clearAssetPlayer(t.identifier,e)})}resetAssetPlayer(t){const e=this.getAssetPlayerQueueIndex(t);if(-1!==e){this.log('reset asset player "'.concat(t,'" after error'));const r=this.playerQueue[e];this.transferMediaFromPlayer(r,null),r.resetDetails()}}clearAssetPlayer(t,e){const r=this.getAssetPlayerQueueIndex(t);if(-1!==r){const t=this.playerQueue[r];this.log("clear ".concat(t," toSegment: ").concat(e?OT(e):e)),this.transferMediaFromPlayer(t,e),this.playerQueue.splice(r,1),t.destroy()}}emptyPlayerQueue(){let t;for(;t=this.playerQueue.pop();)t.destroy();this.playerQueue=[]}startAssetPlayer(t,e,r,n,i){const{interstitial:s,assetItem:a,assetId:o}=t,l=s.assetList.length,c=this.playingAsset;this.endedAsset=null,this.playingAsset=a,c&&c.identifier===o||(c&&(this.clearAssetPlayer(c.identifier,r[n]),delete c.error),this.log("INTERSTITIAL_ASSET_STARTED ".concat(e+1,"/").concat(l," ").concat(PT(a))),this.hls.trigger(ly.INTERSTITIAL_ASSET_STARTED,{asset:a,assetListIndex:e,event:s,schedule:r.slice(0),scheduleIndex:n,player:t})),this.bufferAssetPlayer(t,i)}bufferAssetPlayer(t,e){var r,n;if(!this.schedule)return;const{interstitial:i,assetItem:s}=t,a=this.schedule.findEventIndex(i.identifier),o=null==(r=this.schedule.items)?void 0:r[a];if(!o)return;t.loadSource(),this.setBufferingItem(o),this.bufferingAsset=s;const l=this.getBufferingPlayer();if(l===t)return;const c=i.appendInPlace;if(c&&!1===(null==l?void 0:l.interstitial.appendInPlace))return;const u=(null==l?void 0:l.tracks)||(null==(n=this.detachedData)?void 0:n.tracks)||this.requiredTracks;if(c&&s!==this.playingAsset){if(!t.tracks)return void this.log("Waiting for track info before buffering ".concat(t));if(u&&!Ly(u,t.tracks)){const e=new Error("Asset ".concat(PT(s)," SourceBuffer tracks ('").concat(Object.keys(t.tracks),"') are not compatible with primary content tracks ('").concat(Object.keys(u),"')")),r={fatal:!0,type:ay.OTHER_ERROR,details:oy.INTERSTITIAL_ASSET_ITEM_ERROR,error:e},n=i.findAssetIndex(s);return void this.handleAssetItemError(r,i,a,n,e.message)}}this.transferMediaTo(t,e)}handleInPlaceStall(t){const e=this.schedule,r=this.primaryMedia;if(!e||!r)return;const n=r.currentTime,i=e.findAssetIndex(t,n),s=t.assetList[i];if(s){const a=this.getAssetPlayer(s.identifier);if(a){const o=a.currentTime||n-s.timelineStart,l=a.duration-o;if(this.warn("Stalled at ".concat(o," of ").concat(o+l," in ").concat(a," ").concat(t," (media.currentTime: ").concat(n,")")),o&&(l/r.playbackRate<.5||a.bufferedInPlaceToEnd(r))&&a.hls){const r=e.findEventIndex(t.identifier);this.advanceAfterAssetEnded(t,r,i)}}}}advanceInPlace(t){const e=this.primaryMedia;e&&e.currentTime<t&&(e.currentTime=t)}handleAssetItemError(t,e,r,n,i){if(t.details===oy.BUFFER_STALLED_ERROR)return;const s=e.assetList[n]||null;if(this.warn("INTERSTITIAL_ASSET_ERROR ".concat(s?PT(s):s," ").concat(t.error)),!this.schedule)return;const a=(null==s?void 0:s.identifier)||"",o=this.getAssetPlayerQueueIndex(a),l=this.playerQueue[o]||null,c=this.schedule.items,u=by({},t,{fatal:!1,errorAction:Ib(!0),asset:s,assetListIndex:n,event:e,schedule:c,scheduleIndex:r,player:l});if(this.hls.trigger(ly.INTERSTITIAL_ASSET_ERROR,u),!t.fatal)return;const h=this.playingAsset,d=this.bufferingAsset,f=new Error(i);if(s&&(this.clearAssetPlayer(a,null),s.error=f),e.assetList.some(t=>!t.error))for(let p=n;p<e.assetList.length;p++)this.resetAssetPlayer(e.assetList[p].identifier);else e.error=f;this.updateSchedule(!0),e.error?this.primaryFallback(e):h&&h.identifier===a?this.advanceAfterAssetEnded(e,r,n):d&&d.identifier===a&&this.isInterstitial(this.bufferingItem)&&this.advanceAssetBuffering(this.bufferingItem,d)}primaryFallback(t){const e=t.timelineStart,r=this.effectivePlayingItem;let n=this.timelinePos;if(r){this.log('Fallback to primary from event "'.concat(t.identifier,'" start: ').concat(e," pos: ").concat(n," playing: ").concat(OT(r)," error: ").concat(t.error)),-1===n&&(n=this.hls.startPosition);const i=this.updateItem(r,n);this.itemsMatch(r,i)&&this.clearInterstitial(t,null),t.appendInPlace&&(this.attachPrimary(e,null),this.flushFrontBuffer(e))}else if(-1===n)return void this.checkStart();if(!this.schedule)return;const i=this.schedule.findItemIndexAtTime(n);this.setSchedulePosition(i)}onAssetListLoaded(t,e){var r,n;const i=e.event,s=i.identifier,a=e.assetListResponse.ASSETS;if(null==(r=this.schedule)||!r.hasEvent(s))return;const o=i.timelineStart,l=i.duration;let c=0;a.forEach((t,e)=>{const r=parseFloat(t.DURATION);this.createAsset(i,e,c,o+c,r,t.URI),c+=r}),i.duration=c,this.log("Loaded asset-list with duration: ".concat(c," (was: ").concat(l,") ").concat(i));const u=this.waitingItem,h=(null==u?void 0:u.event.identifier)===s;this.updateSchedule();const d=null==(n=this.bufferingItem)?void 0:n.event;if(h){var f;const t=this.schedule.findEventIndex(s),e=null==(f=this.schedule.items)?void 0:f[t];if(e){if(!this.playingItem&&this.timelinePos>e.end){if(this.schedule.findItemIndexAtTime(this.timelinePos)!==t)return i.error=new Error("Interstitial ".concat(a.length?"no longer within playback range":"asset-list is empty"," ").concat(this.timelinePos," ").concat(i)),this.log(i.error.message),this.updateSchedule(!0),void this.primaryFallback(i)}this.setBufferingItem(e)}this.setSchedulePosition(t)}else if((null==d?void 0:d.identifier)===s){const t=i.assetList[0];if(t){const e=this.getAssetPlayer(t.identifier);if(d.appendInPlace){const t=this.primaryMedia;e&&t&&this.bufferAssetPlayer(e,t)}else e&&e.loadSource()}}}onError(t,e){if(this.schedule)switch(e.details){case oy.ASSET_LIST_PARSING_ERROR:case oy.ASSET_LIST_LOAD_ERROR:case oy.ASSET_LIST_LOAD_TIMEOUT:{const t=e.interstitial;t&&(this.updateSchedule(!0),this.primaryFallback(t));break}case oy.BUFFER_STALLED_ERROR:{const t=this.endedItem||this.waitingItem||this.playingItem;if(this.isInterstitial(t)&&t.event.appendInPlace)return void this.handleInPlaceStall(t.event);this.log("Primary player stall @".concat(this.timelinePos," bufferedPos: ").concat(this.bufferedPos)),this.onTimeupdate(),this.checkBuffer(!0);break}}}}});function Wk(t){return t&&"object"===typeof t?Array.isArray(t)?t.map(Wk):Object.keys(t).reduce((e,r)=>(e[r]=Wk(t[r]),e),{}):t}function Gk(t,e){const r=t.loader;if(r!==Nk&&r!==jk)e.log("[config]: Custom loader detected, cannot enable progressive streaming"),t.progressive=!1;else{(function(){if(self.fetch&&self.AbortController&&self.ReadableStream&&self.Request)try{return new self.ReadableStream({}),!0}catch(vA){}return!1})()&&(t.loader=Nk,t.progressive=!0,t.enableSoftwareAES=!0,e.log("[config]: Progressive streaming enabled, using FetchLoader"))}}class Vk extends Yb{constructor(t,e){super("gap-controller",t.logger),this.hls=void 0,this.fragmentTracker=void 0,this.media=null,this.mediaSource=void 0,this.nudgeRetry=0,this.stallReported=!1,this.stalled=null,this.moved=!1,this.seeking=!1,this.buffered={},this.lastCurrentTime=0,this.ended=0,this.waiting=0,this.onMediaPlaying=()=>{this.ended=0,this.waiting=0},this.onMediaWaiting=()=>{var t;null!=(t=this.media)&&t.seeking||(this.waiting=self.performance.now(),this.tick())},this.onMediaEnded=()=>{var t;this.hls&&(this.ended=(null==(t=this.media)?void 0:t.currentTime)||1,this.hls.trigger(ly.MEDIA_ENDED,{stalled:!1}))},this.hls=t,this.fragmentTracker=e,this.registerListeners()}registerListeners(){const{hls:t}=this;t&&(t.on(ly.MEDIA_ATTACHED,this.onMediaAttached,this),t.on(ly.MEDIA_DETACHING,this.onMediaDetaching,this),t.on(ly.BUFFER_APPENDED,this.onBufferAppended,this))}unregisterListeners(){const{hls:t}=this;t&&(t.off(ly.MEDIA_ATTACHED,this.onMediaAttached,this),t.off(ly.MEDIA_DETACHING,this.onMediaDetaching,this),t.off(ly.BUFFER_APPENDED,this.onBufferAppended,this))}destroy(){super.destroy(),this.unregisterListeners(),this.media=this.hls=this.fragmentTracker=null,this.mediaSource=void 0}onMediaAttached(t,e){this.setInterval(100),this.mediaSource=e.mediaSource;const r=this.media=e.media;pw(r,"playing",this.onMediaPlaying),pw(r,"waiting",this.onMediaWaiting),pw(r,"ended",this.onMediaEnded)}onMediaDetaching(t,e){this.clearInterval();const{media:r}=this;r&&(gw(r,"playing",this.onMediaPlaying),gw(r,"waiting",this.onMediaWaiting),gw(r,"ended",this.onMediaEnded),this.media=null),this.mediaSource=void 0}onBufferAppended(t,e){this.buffered=e.timeRanges}get hasBuffered(){return Object.keys(this.buffered).length>0}tick(){var t;if(null==(t=this.media)||!t.readyState||!this.hasBuffered)return;const e=this.media.currentTime;this.poll(e,this.lastCurrentTime),this.lastCurrentTime=e}poll(t,e){var r,n;const i=null==(r=this.hls)?void 0:r.config;if(!i)return;const s=this.media;if(!s)return;const{seeking:a}=s,o=this.seeking&&!a,l=!this.seeking&&a,c=s.paused&&!a||s.ended||0===s.playbackRate;if(this.seeking=a,t!==e)return e&&(this.ended=0),this.moved=!0,a||(this.nudgeRetry=0,i.nudgeOnVideoHole&&!c&&t>e&&this.nudgeOnVideoHole(t,e)),void(0===this.waiting&&this.stallResolved(t));if(l||o)return void(o&&this.stallResolved(t));if(c)return this.nudgeRetry=0,this.stallResolved(t),void(!this.ended&&s.ended&&this.hls&&(this.ended=t||1,this.hls.trigger(ly.MEDIA_ENDED,{stalled:!1})));if(!$b.getBuffered(s).length)return void(this.nudgeRetry=0);const u=$b.bufferInfo(s,t,0),h=u.nextStart||0,d=this.fragmentTracker;if(a&&d&&this.hls){const e=Hk(this.hls.inFlightFragments,t),r=u.len>2,n=!h||e||h-t>2&&!d.getPartialFragment(t);if(r||n)return;this.moved=!1}const f=null==(n=this.hls)?void 0:n.latestLevelDetails;if(!this.moved&&null!==this.stalled&&d){if(!(u.len>0)&&!h)return;const e=Math.max(h,u.start||0)-t,r=!(null==f||!f.live)?2*f.targetduration:2,n=qk(t,d);if(e>0&&(e<=r||n))return void(s.paused||this._trySkipBufferHole(n))}const p=i.detectStallWithCurrentTimeMs,g=self.performance.now(),m=this.waiting;let y=this.stalled;if(null===y){if(!(m>0&&g-m<p))return void(this.stalled=g);y=this.stalled=m}const v=g-y;if(!a&&(v>=p||m)&&this.hls){var b;if("ended"===(null==(b=this.mediaSource)?void 0:b.readyState)&&(null==f||!f.live)&&Math.abs(t-((null==f?void 0:f.edge)||0))<1){if(this.ended)return;return this.ended=t||1,void this.hls.trigger(ly.MEDIA_ENDED,{stalled:!0})}if(this._reportStall(u),!this.media||!this.hls)return}const _=$b.bufferInfo(s,t,i.maxBufferHole);this._tryFixBufferStall(_,v,t)}stallResolved(t){const e=this.stalled;if(e&&this.hls&&(this.stalled=null,this.stallReported)){const r=self.performance.now()-e;this.log("playback not stuck anymore @".concat(t,", after ").concat(Math.round(r),"ms")),this.stallReported=!1,this.waiting=0,this.hls.trigger(ly.STALL_RESOLVED,{})}}nudgeOnVideoHole(t,e){var r;const n=this.buffered.video;if(this.hls&&this.media&&this.fragmentTracker&&null!=(r=this.buffered.audio)&&r.length&&n&&n.length>1&&t>n.end(0)){const r=$b.bufferedInfo($b.timeRangesToArray(this.buffered.audio),t,0);if(r.len>1&&e>=r.start){const r=$b.timeRangesToArray(n),i=$b.bufferedInfo(r,e,0).bufferedIndex;if(i>-1&&i<r.length-1){const e=$b.bufferedInfo(r,t,0).bufferedIndex,n=r[i].end,s=r[i+1].start;if((-1===e||e>i)&&s-n<1&&t-n<2){const r=new Error("nudging playhead to flush pipeline after video hole. currentTime: ".concat(t," hole: ").concat(n," -> ").concat(s," buffered index: ").concat(e));this.warn(r.message),this.media.currentTime+=1e-6;let i=qk(t,this.fragmentTracker);i&&"fragment"in i?i=i.fragment:i||(i=void 0);const a=$b.bufferInfo(this.media,t,0);this.hls.trigger(ly.ERROR,{type:ay.MEDIA_ERROR,details:oy.BUFFER_SEEK_OVER_HOLE,fatal:!1,error:r,reason:r.message,frag:i,buffer:a.len,bufferInfo:a})}}}}}_tryFixBufferStall(t,e,r){var n,i;const{fragmentTracker:s,media:a}=this,o=null==(n=this.hls)?void 0:n.config;if(!a||!s||!o)return;const l=null==(i=this.hls)?void 0:i.latestLevelDetails,c=qk(r,s);if(c||null!=l&&l.live&&r<l.fragmentStart){if(this._trySkipBufferHole(c)||!this.media)return}const u=t.buffered,h=this.adjacentTraversal(t,r);(u&&u.length>1&&t.len>o.maxBufferHole||t.nextStart&&(t.nextStart-r<o.maxBufferHole||h))&&(e>1e3*o.highBufferWatchdogPeriod||this.waiting)&&(this.warn("Trying to nudge playhead over buffer-hole"),this._tryNudgeBuffer(t))}adjacentTraversal(t,e){const r=this.fragmentTracker,n=t.nextStart;if(r&&n){const t=r.getFragAtPos(e,fy),i=r.getFragAtPos(n,fy);if(t&&i)return i.sn-t.sn<2}return!1}_reportStall(t){const{hls:e,media:r,stallReported:n,stalled:i}=this;if(!n&&null!==i&&r&&e){this.stallReported=!0;const n=new Error("Playback stalling at @".concat(r.currentTime," due to low buffer (").concat(Zv(t),")"));this.warn(n.message),e.trigger(ly.ERROR,{type:ay.MEDIA_ERROR,details:oy.BUFFER_STALLED_ERROR,fatal:!1,error:n,buffer:t.len,bufferInfo:t,stalled:{start:i}})}}_trySkipBufferHole(t){var e;const{fragmentTracker:r,media:n}=this,i=null==(e=this.hls)?void 0:e.config;if(!n||!r||!i)return 0;const s=n.currentTime,a=$b.bufferInfo(n,s,0),o=s<a.start?a.start:a.nextStart;if(o&&this.hls){const e=a.len<=i.maxBufferHole,c=a.len>0&&a.len<1&&n.readyState<3,u=o-s;if(u>0&&(e||c)){if(u>i.maxBufferHole){let e=!1;if(0===s){const t=r.getAppendedFrag(0,fy);t&&o<t.end&&(e=!0)}if(!e&&t){var l;if(null==(l=this.hls.loadLevelObj)||!l.details)return 0;if(Hk(this.hls.inFlightFragments,o))return 0;let e=!1,n=t.end;for(;n<o;){const t=qk(n,r);if(!t){e=!0;break}n+=t.duration}if(e)return 0}}const e=Math.max(o+.05,s+.1);if(this.warn("skipping hole, adjusting currentTime from ".concat(s," to ").concat(e)),this.moved=!0,n.currentTime=e,null==t||!t.gap){const r=new Error("fragment loaded with buffer holes, seeking from ".concat(s," to ").concat(e)),n={type:ay.MEDIA_ERROR,details:oy.BUFFER_SEEK_OVER_HOLE,fatal:!1,error:r,reason:r.message,buffer:a.len,bufferInfo:a};t&&("fragment"in t?n.part=t:n.frag=t),this.hls.trigger(ly.ERROR,n)}return e}}return 0}_tryNudgeBuffer(t){const{hls:e,media:r,nudgeRetry:n}=this,i=null==e?void 0:e.config;if(!r||!i)return 0;const s=r.currentTime;if(this.nudgeRetry++,n<i.nudgeMaxRetry){const a=s+(n+1)*i.nudgeOffset,o=new Error("Nudging 'currentTime' from ".concat(s," to ").concat(a));this.warn(o.message),r.currentTime=a,e.trigger(ly.ERROR,{type:ay.MEDIA_ERROR,details:oy.BUFFER_NUDGE_ON_STALL,error:o,fatal:!1,buffer:t.len,bufferInfo:t})}else{const r=new Error("Playhead still not moving while enough data buffered @".concat(s," after ").concat(i.nudgeMaxRetry," nudges"));this.error(r.message),e.trigger(ly.ERROR,{type:ay.MEDIA_ERROR,details:oy.BUFFER_STALLED_ERROR,error:r,fatal:!0,buffer:t.len,bufferInfo:t})}}}function Hk(t,e){const r=Kk(t.main);if(r&&r.start<=e)return r;const n=Kk(t.audio);return n&&n.start<=e?n:null}function Kk(t){if(!t)return null;switch(t.state){case vw:case yw:case kw:case Aw:return null}return t.frag}function qk(t,e){return e.getAppendedFrag(t,fy)||e.getPartialFragment(t)}function Yk(){if("undefined"!==typeof self)return self.VTTCue||self.TextTrackCue}function Qk(t,e,r,n,i){let s=new t(e,r,"");try{s.value=n,i&&(s.type=i)}catch(vA){s=new t(e,r,Zv(i?wy({type:i},n):n))}return s}const Xk=(()=>{const t=Yk();try{t&&new t(0,Number.POSITIVE_INFINITY,"")}catch(vA){return Number.MAX_VALUE}return Number.POSITIVE_INFINITY})();class $k{constructor(t){this.hls=void 0,this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.removeCues=!0,this.assetCue=void 0,this.onEventCueEnter=()=>{this.hls&&this.hls.trigger(ly.EVENT_CUE_ENTER,{})},this.hls=t,this._registerListeners()}destroy(){this._unregisterListeners(),this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.hls=this.onEventCueEnter=null}_registerListeners(){const{hls:t}=this;t&&(t.on(ly.MEDIA_ATTACHING,this.onMediaAttaching,this),t.on(ly.MEDIA_ATTACHED,this.onMediaAttached,this),t.on(ly.MEDIA_DETACHING,this.onMediaDetaching,this),t.on(ly.MANIFEST_LOADING,this.onManifestLoading,this),t.on(ly.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),t.on(ly.BUFFER_FLUSHING,this.onBufferFlushing,this),t.on(ly.LEVEL_UPDATED,this.onLevelUpdated,this),t.on(ly.LEVEL_PTS_UPDATED,this.onLevelPtsUpdated,this))}_unregisterListeners(){const{hls:t}=this;t&&(t.off(ly.MEDIA_ATTACHING,this.onMediaAttaching,this),t.off(ly.MEDIA_ATTACHED,this.onMediaAttached,this),t.off(ly.MEDIA_DETACHING,this.onMediaDetaching,this),t.off(ly.MANIFEST_LOADING,this.onManifestLoading,this),t.off(ly.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),t.off(ly.BUFFER_FLUSHING,this.onBufferFlushing,this),t.off(ly.LEVEL_UPDATED,this.onLevelUpdated,this),t.off(ly.LEVEL_PTS_UPDATED,this.onLevelPtsUpdated,this))}onMediaAttaching(t,e){var r;this.media=e.media,!1===(null==(r=e.overrides)?void 0:r.cueRemoval)&&(this.removeCues=!1)}onMediaAttached(){var t;const e=null==(t=this.hls)?void 0:t.latestLevelDetails;e&&this.updateDateRangeCues(e)}onMediaDetaching(t,e){this.media=null;!!e.transferMedia||(this.id3Track&&(this.removeCues&&_T(this.id3Track,this.onEventCueEnter),this.id3Track=null),this.dateRangeCuesAppended={})}onManifestLoading(){this.dateRangeCuesAppended={}}createTrack(t){const e=this.getID3Track(t.textTracks);return e.mode="hidden",e}getID3Track(t){if(this.media){for(let e=0;e<t.length;e++){const r=t[e];if("metadata"===r.kind&&"id3"===r.label)return vT(r,this.media),r}return this.media.addTextTrack("metadata","id3")}}onFragParsingMetadata(t,e){if(!this.media||!this.hls)return;const{enableEmsgMetadataCues:r,enableID3MetadataCues:n}=this.hls.config;if(!r&&!n)return;const{samples:i}=e;this.id3Track||(this.id3Track=this.createTrack(this.media));const s=Yk();if(s)for(let a=0;a<i.length;a++){const t=i[a].type;if(t===sE.emsg&&!r||!n)continue;const e=eE(i[a].data),o=i[a].pts;let l=o+i[a].duration;l>Xk&&(l=Xk);l-o<=0&&(l=o+.25);for(let r=0;r<e.length;r++){const n=e[r];if(!rE(n)){this.updateId3CueEnds(o,t);const e=Qk(s,o,l,n,t);e&&this.id3Track.addCue(e)}}}}updateId3CueEnds(t,e){var r;const n=null==(r=this.id3Track)?void 0:r.cues;if(n)for(let i=n.length;i--;){const r=n[i];r.type===e&&r.startTime<t&&r.endTime===Xk&&(r.endTime=t)}}onBufferFlushing(t,e){let{startOffset:r,endOffset:n,type:i}=e;const{id3Track:s,hls:a}=this;if(!a)return;const{config:{enableEmsgMetadataCues:o,enableID3MetadataCues:l}}=a;if(s&&(o||l)){let t;t="audio"===i?t=>t.type===sE.audioId3&&l:"video"===i?t=>t.type===sE.emsg&&o:t=>t.type===sE.audioId3&&l||t.type===sE.emsg&&o,wT(s,r,n,t)}}onLevelUpdated(t,e){let{details:r}=e;this.updateDateRangeCues(r,!0)}onLevelPtsUpdated(t,e){Math.abs(e.drift)>.01&&this.updateDateRangeCues(e.details)}updateDateRangeCues(t,e){if(!this.hls||!this.media)return;const{assetPlayerId:r,timelineOffset:n,enableDateRangeMetadataCues:i,interstitialsController:s}=this.hls.config;if(!i)return;const a=Yk();if(r&&n&&!s){const{fragmentStart:e,fragmentEnd:n}=t;let i=this.assetCue;i?(i.startTime=e,i.endTime=n):a&&(i=this.assetCue=Qk(a,e,n,{assetPlayerId:this.hls.config.assetPlayerId},"hlsjs.interstitial.asset"),i&&(i.id=r,this.id3Track||(this.id3Track=this.createTrack(this.media)),this.id3Track.addCue(i),i.addEventListener("enter",this.onEventCueEnter)))}if(!t.hasProgramDateTime)return;const{id3Track:o}=this,{dateRanges:l}=t,c=Object.keys(l);let u=this.dateRangeCuesAppended;var h;if(o&&e)if(null!=(h=o.cues)&&h.length){const t=Object.keys(u).filter(t=>!c.includes(t));for(let e=t.length;e--;){var d;const r=t[e],n=null==(d=u[r])?void 0:d.cues;delete u[r],n&&Object.keys(n).forEach(t=>{const e=n[t];if(e){e.removeEventListener("enter",this.onEventCueEnter);try{o.removeCue(e)}catch(vA){}}})}}else u=this.dateRangeCuesAppended={};const f=t.fragments[t.fragments.length-1];if(0!==c.length&&ny(null==f?void 0:f.programDateTime)){this.id3Track||(this.id3Track=this.createTrack(this.media));for(let t=0;t<c.length;t++){const e=c[t],r=l[e],n=r.startTime,i=u[e],o=(null==i?void 0:i.cues)||{};let h=(null==i?void 0:i.durationKnown)||!1,d=Xk;const{duration:f,endDate:p}=r;if(p&&null!==f)d=n+f,h=!0;else if(r.endOnNext&&!h){const t=c.reduce((t,e)=>{if(e!==r.id){const n=l[e];if(n.class===r.class&&n.startDate>r.startDate&&(!t||r.startDate<t.startDate))return n}return t},null);t&&(d=t.startTime,h=!0)}const g=Object.keys(r.attr);for(let t=0;t<g.length;t++){const l=g[t];if(!a_(l))continue;const c=o[l];if(c)!h||null!=i&&i.durationKnown?Math.abs(c.startTime-n)>.01&&(c.startTime=n,c.endTime=d):c.endTime=d;else if(a){let t=r.attr[l];o_(l)&&(t=My(t));const i=Qk(a,n,d,{key:l,data:t},sE.dateRange);i&&(i.id=e,this.id3Track.addCue(i),o[l]=i,s&&("X-ASSET-LIST"!==l&&"X-ASSET-URL"!==l||i.addEventListener("enter",this.onEventCueEnter)))}}u[e]={cues:o,dateRange:r,durationKnown:h}}}}}class Zk{constructor(t){this.hls=void 0,this.config=void 0,this.media=null,this.currentTime=0,this.stallCount=0,this._latency=null,this._targetLatencyUpdated=!1,this.onTimeupdate=()=>{const{media:t}=this,e=this.levelDetails;if(!t||!e)return;this.currentTime=t.currentTime;const r=this.computeLatency();if(null===r)return;this._latency=r;const{lowLatencyMode:n,maxLiveSyncPlaybackRate:i}=this.config;if(!n||1===i||!e.live)return;const s=this.targetLatency;if(null===s)return;const a=r-s;if(a<Math.min(this.maxLatency,s+e.targetduration)&&a>.05&&this.forwardBufferLength>1){const e=Math.min(2,Math.max(1,i)),r=Math.round(2/(1+Math.exp(-.75*a-this.edgeStalled))*20)/20,n=Math.min(e,Math.max(1,r));this.changeMediaPlaybackRate(t,n)}else 1!==t.playbackRate&&0!==t.playbackRate&&this.changeMediaPlaybackRate(t,1)},this.hls=t,this.config=t.config,this.registerListeners()}get levelDetails(){var t;return(null==(t=this.hls)?void 0:t.latestLevelDetails)||null}get latency(){return this._latency||0}get maxLatency(){const{config:t}=this;if(void 0!==t.liveMaxLatencyDuration)return t.liveMaxLatencyDuration;const e=this.levelDetails;return e?t.liveMaxLatencyDurationCount*e.targetduration:0}get targetLatency(){const t=this.levelDetails;if(null===t||null===this.hls)return null;const{holdBack:e,partHoldBack:r,targetduration:n}=t,{liveSyncDuration:i,liveSyncDurationCount:s,lowLatencyMode:a}=this.config,o=this.hls.userConfig;let l=a&&r||e;(this._targetLatencyUpdated||o.liveSyncDuration||o.liveSyncDurationCount||0===l)&&(l=void 0!==i?i:s*n);const c=n;return l+Math.min(this.stallCount*this.config.liveSyncOnStallIncrease,c)}set targetLatency(t){this.stallCount=0,this.config.liveSyncDuration=t,this._targetLatencyUpdated=!0}get liveSyncPosition(){const t=this.estimateLiveEdge(),e=this.targetLatency;if(null===t||null===e)return null;const r=this.levelDetails;if(null===r)return null;const n=r.edge,i=t-e-this.edgeStalled,s=n-r.totalduration,a=n-(this.config.lowLatencyMode&&r.partTarget||r.targetduration);return Math.min(Math.max(s,i),a)}get drift(){const t=this.levelDetails;return null===t?1:t.drift}get edgeStalled(){const t=this.levelDetails;if(null===t)return 0;const e=3*(this.config.lowLatencyMode&&t.partTarget||t.targetduration);return Math.max(t.age-e,0)}get forwardBufferLength(){const{media:t}=this,e=this.levelDetails;if(!t||!e)return 0;const r=t.buffered.length;return(r?t.buffered.end(r-1):e.edge)-this.currentTime}destroy(){this.unregisterListeners(),this.onMediaDetaching(),this.hls=null}registerListeners(){const{hls:t}=this;t&&(t.on(ly.MEDIA_ATTACHED,this.onMediaAttached,this),t.on(ly.MEDIA_DETACHING,this.onMediaDetaching,this),t.on(ly.MANIFEST_LOADING,this.onManifestLoading,this),t.on(ly.LEVEL_UPDATED,this.onLevelUpdated,this),t.on(ly.ERROR,this.onError,this))}unregisterListeners(){const{hls:t}=this;t&&(t.off(ly.MEDIA_ATTACHED,this.onMediaAttached,this),t.off(ly.MEDIA_DETACHING,this.onMediaDetaching,this),t.off(ly.MANIFEST_LOADING,this.onManifestLoading,this),t.off(ly.LEVEL_UPDATED,this.onLevelUpdated,this),t.off(ly.ERROR,this.onError,this))}onMediaAttached(t,e){this.media=e.media,this.media.addEventListener("timeupdate",this.onTimeupdate)}onMediaDetaching(){this.media&&(this.media.removeEventListener("timeupdate",this.onTimeupdate),this.media=null)}onManifestLoading(){this._latency=null,this.stallCount=0}onLevelUpdated(t,e){let{details:r}=e;r.advanced&&this.onTimeupdate(),!r.live&&this.media&&this.media.removeEventListener("timeupdate",this.onTimeupdate)}onError(t,e){var r;e.details===oy.BUFFER_STALLED_ERROR&&(this.stallCount++,this.hls&&null!=(r=this.levelDetails)&&r.live&&this.hls.logger.warn("[latency-controller]: Stall detected, adjusting target latency"))}changeMediaPlaybackRate(t,e){var r,n;t.playbackRate!==e&&(null==(r=this.hls)||r.logger.debug("[latency-controller]: latency=".concat(this.latency.toFixed(3),", targetLatency=").concat(null==(n=this.targetLatency)?void 0:n.toFixed(3),", forwardBufferLength=").concat(this.forwardBufferLength.toFixed(3),": adjusting playback rate from ").concat(t.playbackRate," to ").concat(e)),t.playbackRate=e)}estimateLiveEdge(){const t=this.levelDetails;return null===t?null:t.edge+t.age}computeLatency(){const t=this.estimateLiveEdge();return null===t?null:t-this.currentTime}}class Jk extends oS{constructor(t,e){super(t,"level-controller"),this._levels=[],this._firstLevel=-1,this._maxAutoLevel=-1,this._startLevel=void 0,this.currentLevel=null,this.currentLevelIndex=-1,this.manualLevelIndex=-1,this.steering=void 0,this.onParsedComplete=void 0,this.steering=e,this._registerListeners()}_registerListeners(){const{hls:t}=this;t.on(ly.MANIFEST_LOADING,this.onManifestLoading,this),t.on(ly.MANIFEST_LOADED,this.onManifestLoaded,this),t.on(ly.LEVEL_LOADED,this.onLevelLoaded,this),t.on(ly.LEVELS_UPDATED,this.onLevelsUpdated,this),t.on(ly.FRAG_BUFFERED,this.onFragBuffered,this),t.on(ly.ERROR,this.onError,this)}_unregisterListeners(){const{hls:t}=this;t.off(ly.MANIFEST_LOADING,this.onManifestLoading,this),t.off(ly.MANIFEST_LOADED,this.onManifestLoaded,this),t.off(ly.LEVEL_LOADED,this.onLevelLoaded,this),t.off(ly.LEVELS_UPDATED,this.onLevelsUpdated,this),t.off(ly.FRAG_BUFFERED,this.onFragBuffered,this),t.off(ly.ERROR,this.onError,this)}destroy(){this._unregisterListeners(),this.steering=null,this.resetLevels(),super.destroy()}stopLoad(){this._levels.forEach(t=>{t.loadError=0,t.fragmentError=0}),super.stopLoad()}resetLevels(){this._startLevel=void 0,this.manualLevelIndex=-1,this.currentLevelIndex=-1,this.currentLevel=null,this._levels=[],this._maxAutoLevel=-1}onManifestLoading(t,e){this.resetLevels()}onManifestLoaded(t,e){const r=this.hls.config.preferManagedMediaSource,n=[],i={},s={};let a=!1,o=!1,l=!1;e.levels.forEach(t=>{const e=t.attrs;let{audioCodec:c,videoCodec:u}=t;c&&(t.audioCodec=c=Rv(c,r)||void 0),u&&(u=t.videoCodec=function(t){const e=t.split(",");for(let r=0;r<e.length;r++){const t=e[r].split(".");t.length>2&&"avc1"===t[0]&&(e[r]="avc1.".concat(parseInt(t[1]).toString(16)).concat(("000"+parseInt(t[2]).toString(16)).slice(-4)))}return e.join(",")}(u));const{width:h,height:d,unknownCodecs:f}=t,p=(null==f?void 0:f.length)||0;if(a||(a=!(!h||!d)),o||(o=!!u),l||(l=!!c),p||c&&!this.isAudioSupported(c)||u&&!this.isVideoSupported(u))return void this.log('Some or all CODECS not supported "'.concat(e.CODECS,'"'));const{CODECS:g,"FRAME-RATE":m,"HDCP-LEVEL":y,"PATHWAY-ID":v,RESOLUTION:b,"VIDEO-RANGE":_}=e,w="".concat(v||".","-"),E="".concat(w).concat(t.bitrate,"-").concat(b,"-").concat(m,"-").concat(g,"-").concat(_,"-").concat(y);if(i[E])if(i[E].uri===t.url||t.attrs["PATHWAY-ID"])i[E].addGroupId("audio",e.AUDIO),i[E].addGroupId("text",e.SUBTITLES);else{const e=s[E]+=1;t.attrs["PATHWAY-ID"]=new Array(e+1).join(".");const r=this.createLevel(t);i[E]=r,n.push(r)}else{const e=this.createLevel(t);i[E]=e,s[E]=1,n.push(e)}}),this.filterAndSortMediaOptions(n,e,a,o,l)}createLevel(t){const e=new Qv(t),r=t.supplemental;if(null!=r&&r.videoCodec&&!this.isVideoSupported(r.videoCodec)){const t=new Error('SUPPLEMENTAL-CODECS not supported "'.concat(r.videoCodec,'"'));this.log(t.message),e.supportedResult=Fv(t,[])}return e}isAudioSupported(t){return Ev(t,"audio",this.hls.config.preferManagedMediaSource)}isVideoSupported(t){return Ev(t,"video",this.hls.config.preferManagedMediaSource)}filterAndSortMediaOptions(t,e,r,n,i){var s;let a=[],o=[],l=t;const c=(null==(s=e.stats)?void 0:s.parsing)||{};if((r||n)&&i&&(l=l.filter(t=>{let{videoCodec:e,videoRange:r,width:n,height:i}=t;return(!!e||!(!n||!i))&&(!!(s=r)&&Gv.indexOf(s)>-1);var s})),0===l.length)return Promise.resolve().then(()=>{if(this.hls){let t="no level with compatible codecs found in manifest",r=t;e.levels.length&&(r="one or more CODECS in variant not supported: ".concat(Zv(e.levels.map(t=>t.attrs.CODECS).filter((t,e,r)=>r.indexOf(t)===e))),this.warn(r),t+=" (".concat(r,")"));const n=new Error(t);this.hls.trigger(ly.ERROR,{type:ay.MEDIA_ERROR,details:oy.MANIFEST_INCOMPATIBLE_CODECS_ERROR,fatal:!0,url:e.url,error:n,reason:r})}}),void(c.end=performance.now());e.audioTracks&&(a=e.audioTracks.filter(t=>!t.audioCodec||this.isAudioSupported(t.audioCodec)),tA(a)),e.subtitles&&(o=e.subtitles,tA(o));const u=l.slice(0);l.sort((t,e)=>{if(t.attrs["HDCP-LEVEL"]!==e.attrs["HDCP-LEVEL"])return(t.attrs["HDCP-LEVEL"]||"")>(e.attrs["HDCP-LEVEL"]||"")?1:-1;if(r&&t.height!==e.height)return t.height-e.height;if(t.frameRate!==e.frameRate)return t.frameRate-e.frameRate;if(t.videoRange!==e.videoRange)return Gv.indexOf(t.videoRange)-Gv.indexOf(e.videoRange);if(t.videoCodec!==e.videoCodec){const r=kv(t.videoCodec),n=kv(e.videoCodec);if(r!==n)return n-r}if(t.uri===e.uri&&t.codecSet!==e.codecSet){const r=Av(t.codecSet),n=Av(e.codecSet);if(r!==n)return n-r}return t.averageBitrate!==e.averageBitrate?t.averageBitrate-e.averageBitrate:0});let h=u[0];if(this.steering&&(l=this.steering.filterParsedLevels(l),l.length!==u.length))for(let y=0;y<u.length;y++)if(u[y].pathwayId===l[0].pathwayId){h=u[y];break}this._levels=l;for(let y=0;y<l.length;y++)if(l[y]===h){var d;this._firstLevel=y;const t=h.bitrate,e=this.hls.bandwidthEstimate;if(this.log("manifest loaded, ".concat(l.length," level(s) found, first bitrate: ").concat(t)),void 0===(null==(d=this.hls.userConfig)?void 0:d.abrEwmaDefaultEstimate)){const r=Math.min(t,this.hls.config.abrEwmaDefaultEstimateMax);r>e&&e===this.hls.abrEwmaDefaultEstimate&&(this.hls.bandwidthEstimate=r)}break}const f=i&&!n,p=this.hls.config,g=!(!p.audioStreamController||!p.audioTrackController),m={levels:l,audioTracks:a,subtitleTracks:o,sessionData:e.sessionData,sessionKeys:e.sessionKeys,firstLevel:this._firstLevel,stats:e.stats,audio:i,video:n,altAudio:g&&!f&&a.some(t=>!!t.url)};c.end=performance.now(),this.hls.trigger(ly.MANIFEST_PARSED,m)}get levels(){return 0===this._levels.length?null:this._levels}get loadLevelObj(){return this.currentLevel}get level(){return this.currentLevelIndex}set level(t){const e=this._levels;if(0===e.length)return;if(t<0||t>=e.length){const r=new Error("invalid level idx"),n=t<0;if(this.hls.trigger(ly.ERROR,{type:ay.OTHER_ERROR,details:oy.LEVEL_SWITCH_ERROR,level:t,fatal:n,error:r,reason:r.message}),n)return;t=Math.min(t,e.length-1)}const r=this.currentLevelIndex,n=this.currentLevel,i=n?n.attrs["PATHWAY-ID"]:void 0,s=e[t],a=s.attrs["PATHWAY-ID"];if(this.currentLevelIndex=t,this.currentLevel=s,r===t&&n&&i===a)return;this.log("Switching to level ".concat(t," (").concat(s.height?s.height+"p ":"").concat(s.videoRange?s.videoRange+" ":"").concat(s.codecSet?s.codecSet+" ":"","@").concat(s.bitrate,")").concat(a?" with Pathway "+a:""," from level ").concat(r).concat(i?" with Pathway "+i:""));const o={level:t,attrs:s.attrs,details:s.details,bitrate:s.bitrate,averageBitrate:s.averageBitrate,maxBitrate:s.maxBitrate,realBitrate:s.realBitrate,width:s.width,height:s.height,codecSet:s.codecSet,audioCodec:s.audioCodec,videoCodec:s.videoCodec,audioGroups:s.audioGroups,subtitleGroups:s.subtitleGroups,loaded:s.loaded,loadError:s.loadError,fragmentError:s.fragmentError,name:s.name,id:s.id,uri:s.uri,url:s.url,urlId:0,audioGroupIds:s.audioGroupIds,textGroupIds:s.textGroupIds};this.hls.trigger(ly.LEVEL_SWITCHING,o);const l=s.details;if(!l||l.live){const t=this.switchParams(s.uri,null==n?void 0:n.details,l);this.loadPlaylist(t)}}get manualLevel(){return this.manualLevelIndex}set manualLevel(t){this.manualLevelIndex=t,void 0===this._startLevel&&(this._startLevel=t),-1!==t&&(this.level=t)}get firstLevel(){return this._firstLevel}set firstLevel(t){this._firstLevel=t}get startLevel(){if(void 0===this._startLevel){const t=this.hls.config.startLevel;return void 0!==t?t:this.hls.firstAutoLevel}return this._startLevel}set startLevel(t){this._startLevel=t}get pathways(){return this.steering?this.steering.pathways():[]}get pathwayPriority(){return this.steering?this.steering.pathwayPriority:null}set pathwayPriority(t){if(this.steering){const e=this.steering.pathways(),r=t.filter(t=>-1!==e.indexOf(t));if(t.length<1)return void this.warn("pathwayPriority ".concat(t," should contain at least one pathway from list: ").concat(e));this.steering.pathwayPriority=r}}onError(t,e){!e.fatal&&e.context&&e.context.type===uy&&e.context.level===this.level&&this.checkRetry(e)}onFragBuffered(t,e){let{frag:r}=e;if(void 0!==r&&r.type===fy){const t=r.elementaryStreams;if(!Object.keys(t).some(e=>!!t[e]))return;const e=this._levels[r.level];null!=e&&e.loadError&&(this.log("Resetting level error count of ".concat(e.loadError," on frag buffered")),e.loadError=0)}}onLevelLoaded(t,e){var r;const{level:n,details:i}=e,s=e.levelInfo;var a;if(!s)return this.warn("Invalid level index ".concat(n)),void(null!=(a=e.deliveryDirectives)&&a.skip&&(i.deltaUpdateFailed=!0));if(s===this.currentLevel||e.withoutMultiVariant){0===s.fragmentError&&(s.loadError=0);let t=s.details;t===e.details&&t.advanced&&(t=void 0),this.playlistLoaded(n,e,t)}else null!=(r=e.deliveryDirectives)&&r.skip&&(i.deltaUpdateFailed=!0)}loadPlaylist(t){super.loadPlaylist(),this.shouldLoadPlaylist(this.currentLevel)&&this.scheduleLoading(this.currentLevel,t)}loadingPlaylist(t,e){super.loadingPlaylist(t,e);const r=this.getUrlWithDirectives(t.uri,e),n=this.currentLevelIndex,i=t.attrs["PATHWAY-ID"],s=t.details,a=null==s?void 0:s.age;this.log("Loading level index ".concat(n).concat(void 0!==(null==e?void 0:e.msn)?" at sn "+e.msn+" part "+e.part:"").concat(i?" Pathway "+i:"").concat(a&&s.live?" age "+a.toFixed(1)+(s.type?" "+s.type||0:""):""," ").concat(r)),this.hls.trigger(ly.LEVEL_LOADING,{url:r,level:n,levelInfo:t,pathwayId:t.attrs["PATHWAY-ID"],id:0,deliveryDirectives:e||null})}get nextLoadLevel(){return-1!==this.manualLevelIndex?this.manualLevelIndex:this.hls.nextAutoLevel}set nextLoadLevel(t){this.level=t,-1===this.manualLevelIndex&&(this.hls.nextAutoLevel=t)}removeLevel(t){var e;if(1===this._levels.length)return;const r=this._levels.filter((e,r)=>r!==t||(this.steering&&this.steering.removeLevel(e),e===this.currentLevel&&(this.currentLevel=null,this.currentLevelIndex=-1,e.details&&e.details.fragments.forEach(t=>t.level=-1)),!1));aw(r),this._levels=r,this.currentLevelIndex>-1&&null!=(e=this.currentLevel)&&e.details&&(this.currentLevelIndex=this.currentLevel.details.fragments[0].level),this.manualLevelIndex>-1&&(this.manualLevelIndex=this.currentLevelIndex);const n=r.length-1;this._firstLevel=Math.min(this._firstLevel,n),this._startLevel&&(this._startLevel=Math.min(this._startLevel,n)),this.hls.trigger(ly.LEVELS_UPDATED,{levels:r})}onLevelsUpdated(t,e){let{levels:r}=e;this._levels=r}checkMaxAutoUpdated(){const{autoLevelCapping:t,maxAutoLevel:e,maxHdcpLevel:r}=this.hls;this._maxAutoLevel!==e&&(this._maxAutoLevel=e,this.hls.trigger(ly.MAX_AUTO_LEVEL_UPDATED,{autoLevelCapping:t,levels:this.levels,maxAutoLevel:e,minAutoLevel:this.hls.minAutoLevel,maxHdcpLevel:r}))}}function tA(t){const e={};t.forEach(t=>{const r=t.groupId||"";t.id=e[r]=e[r]||0,e[r]++})}function eA(){return self.SourceBuffer||self.WebKitSourceBuffer}function rA(){if(!Ry())return!1;const t=eA();return!t||t.prototype&&"function"===typeof t.prototype.appendBuffer&&"function"===typeof t.prototype.remove}class nA extends Rw{constructor(t,e,r){super(t,e,r,"stream-controller",fy),this.audioCodecSwap=!1,this.level=-1,this._forceStartLoad=!1,this._hasEnoughToStart=!1,this.altAudio=0,this.audioOnly=!1,this.fragPlaying=null,this.fragLastKbps=0,this.couldBacktrack=!1,this.backtrackFragment=null,this.audioCodecSwitch=!1,this.videoBuffer=null,this.onMediaPlaying=()=>{this.tick()},this.onMediaSeeked=()=>{const t=this.media,e=t?t.currentTime:null;if(null===e||!ny(e))return;if(this.log("Media seeked to ".concat(e.toFixed(3))),!this.getBufferedFrag(e))return;const r=this.getFwdBufferInfoAtPos(t,e,fy,0);null!==r&&0!==r.len?this.tick():this.warn("Main forward buffer length at ".concat(e,' on "seeked" event ').concat(r?r.len:"empty",")"))},this.registerListeners()}registerListeners(){super.registerListeners();const{hls:t}=this;t.on(ly.MANIFEST_PARSED,this.onManifestParsed,this),t.on(ly.LEVEL_LOADING,this.onLevelLoading,this),t.on(ly.LEVEL_LOADED,this.onLevelLoaded,this),t.on(ly.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),t.on(ly.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),t.on(ly.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),t.on(ly.BUFFER_CREATED,this.onBufferCreated,this),t.on(ly.BUFFER_FLUSHED,this.onBufferFlushed,this),t.on(ly.LEVELS_UPDATED,this.onLevelsUpdated,this),t.on(ly.FRAG_BUFFERED,this.onFragBuffered,this)}unregisterListeners(){super.unregisterListeners();const{hls:t}=this;t.off(ly.MANIFEST_PARSED,this.onManifestParsed,this),t.off(ly.LEVEL_LOADED,this.onLevelLoaded,this),t.off(ly.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),t.off(ly.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),t.off(ly.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),t.off(ly.BUFFER_CREATED,this.onBufferCreated,this),t.off(ly.BUFFER_FLUSHED,this.onBufferFlushed,this),t.off(ly.LEVELS_UPDATED,this.onLevelsUpdated,this),t.off(ly.FRAG_BUFFERED,this.onFragBuffered,this)}onHandlerDestroying(){this.onMediaPlaying=this.onMediaSeeked=null,this.unregisterListeners(),super.onHandlerDestroying()}startLoad(t,e){if(this.levels){const{lastCurrentTime:r,hls:n}=this;if(this.stopLoad(),this.setInterval(100),this.level=-1,!this.startFragRequested){let t=n.startLevel;-1===t&&(n.config.testBandwidth&&this.levels.length>1?(t=0,this.bitrateTest=!0):t=n.firstAutoLevel),n.nextLoadLevel=t,this.level=n.loadLevel,this._hasEnoughToStart=!!e}r>0&&-1===t&&!e&&(this.log("Override startPosition with lastCurrentTime @".concat(r.toFixed(3))),t=r),this.state=vw,this.nextLoadPosition=this.lastCurrentTime=t+this.timelineOffset,this.startPosition=e?-1:t,this.tick()}else this._forceStartLoad=!0,this.state=yw}stopLoad(){this._forceStartLoad=!1,super.stopLoad()}doTick(){switch(this.state){case Iw:{const{levels:t,level:e}=this,r=null==t?void 0:t[e],n=null==r?void 0:r.details;if(n&&(!n.live||this.levelLastLoaded===r&&!this.waitForLive(r))){if(this.waitForCdnTuneIn(n))break;this.state=vw;break}if(this.hls.nextLoadLevel!==this.level){this.state=vw;break}break}case ww:this.checkRetryDate()}this.state===vw&&this.doTickIdle(),this.onTickEnd()}onTickEnd(){var t;super.onTickEnd(),null!=(t=this.media)&&t.readyState&&!1===this.media.seeking&&(this.lastCurrentTime=this.media.currentTime),this.checkFragmentChanged()}doTickIdle(){const{hls:t,levelLastLoaded:e,levels:r,media:n}=this;if(null===e||!n&&!this.primaryPrefetch&&(this.startFragRequested||!t.config.startFragPrefetch))return;if(this.altAudio&&this.audioOnly)return;const i=this.buffering?t.nextLoadLevel:t.loadLevel;if(null==r||!r[i])return;const s=r[i],a=this.getMainFwdBufferInfo();if(null===a)return;const o=this.getLevelDetails();if(o&&this._streamEnded(a,o)){const t={};return 2===this.altAudio&&(t.type="video"),this.hls.trigger(ly.BUFFER_EOS,t),void(this.state=kw)}if(!this.buffering)return;t.loadLevel!==i&&-1===t.manualLevel&&this.log("Adapting to level ".concat(i," from level ").concat(this.level)),this.level=t.nextLoadLevel=i;const l=s.details;if(!l||this.state===Iw||this.waitForLive(s))return this.level=i,this.state=Iw,void(this.startFragRequested=!1);const c=a.len,u=this.getMaxBufferLength(s.maxBitrate);if(c>=u)return;this.backtrackFragment&&this.backtrackFragment.start>a.end&&(this.backtrackFragment=null);const h=this.backtrackFragment?this.backtrackFragment.start:a.end;let d=this.getNextFragment(h,l);if(this.couldBacktrack&&!this.fragPrevious&&d&&Gy(d)&&this.fragmentTracker.getState(d)!==Cb){var f;const t=(null!=(f=this.backtrackFragment)?f:d).sn-l.startSN,e=l.fragments[t-1];e&&d.cc===e.cc&&(d=e,this.fragmentTracker.removeFragment(e))}else this.backtrackFragment&&a.len&&(this.backtrackFragment=null);if(d&&this.isLoopLoading(d,h)){if(!d.gap){const t=this.audioOnly&&!this.altAudio?By:jy,e=(t===jy?this.videoBuffer:this.mediaBuffer)||this.media;e&&this.afterBufferFlushed(e,t,fy)}d=this.getNextFragmentLoopLoading(d,l,a,fy,u)}d&&(!d.initSegment||d.initSegment.data||this.bitrateTest||(d=d.initSegment),this.loadFragment(d,s,h))}loadFragment(t,e,r){const n=this.fragmentTracker.getState(t);n===Rb||n===Pb?Gy(t)?this.bitrateTest?(this.log("Fragment ".concat(t.sn," of level ").concat(t.level," is being downloaded to test bitrate and will not be buffered")),this._loadBitrateTestFrag(t,e)):super.loadFragment(t,e,r):this._loadInitSegment(t,e):this.clearTrackerIfNeeded(t)}getBufferedFrag(t){return this.fragmentTracker.getBufferedFrag(t,fy)}followingBufferedFrag(t){return t?this.getBufferedFrag(t.end+.5):null}immediateLevelSwitch(){this.abortCurrentFrag(),this.flushMainBuffer(0,Number.POSITIVE_INFINITY)}nextLevelSwitch(){const{levels:t,media:e}=this;if(null!=e&&e.readyState){let r;const n=this.getAppendedFrag(e.currentTime);n&&n.start>1&&this.flushMainBuffer(0,n.start-1);const i=this.getLevelDetails();if(null!=i&&i.live){const t=this.getMainFwdBufferInfo();if(!t||t.len<2*i.targetduration)return}if(!e.paused&&t){const e=t[this.hls.nextLoadLevel],n=this.fragLastKbps;r=n&&this.fragCurrent?this.fragCurrent.duration*e.maxBitrate/(1e3*n)+1:0}else r=0;const s=this.getBufferedFrag(e.currentTime+r);if(s){const t=this.followingBufferedFrag(s);if(t){this.abortCurrentFrag();const e=t.maxStartPTS?t.maxStartPTS:t.start,r=t.duration,n=Math.max(s.end,e+Math.min(Math.max(r-this.config.maxFragLookUpTolerance,r*(this.couldBacktrack?.5:.125)),r*(this.couldBacktrack?.75:.25)));this.flushMainBuffer(n,Number.POSITIVE_INFINITY)}}}}abortCurrentFrag(){const t=this.fragCurrent;switch(this.fragCurrent=null,this.backtrackFragment=null,t&&(t.abortRequests(),this.fragmentTracker.removeFragment(t)),this.state){case bw:case _w:case ww:case Sw:case Tw:this.state=vw}this.nextLoadPosition=this.getLoadPosition()}flushMainBuffer(t,e){super.flushMainBuffer(t,e,2===this.altAudio?"video":null)}onMediaAttached(t,e){super.onMediaAttached(t,e);const r=e.media;pw(r,"playing",this.onMediaPlaying),pw(r,"seeked",this.onMediaSeeked)}onMediaDetaching(t,e){const{media:r}=this;r&&(gw(r,"playing",this.onMediaPlaying),gw(r,"seeked",this.onMediaSeeked)),this.videoBuffer=null,this.fragPlaying=null,super.onMediaDetaching(t,e);!!e.transferMedia||(this._hasEnoughToStart=!1)}onManifestLoading(){super.onManifestLoading(),this.log("Trigger BUFFER_RESET"),this.hls.trigger(ly.BUFFER_RESET,void 0),this.couldBacktrack=!1,this.fragLastKbps=0,this.fragPlaying=this.backtrackFragment=null,this.altAudio=0,this.audioOnly=!1}onManifestParsed(t,e){let r=!1,n=!1;for(let i=0;i<e.levels.length;i++){const t=e.levels[i].audioCodec;t&&(r=r||-1!==t.indexOf("mp4a.40.2"),n=n||-1!==t.indexOf("mp4a.40.5"))}this.audioCodecSwitch=r&&n&&!function(){var t;const e=eA();return"function"===typeof(null==e||null==(t=e.prototype)?void 0:t.changeType)}(),this.audioCodecSwitch&&this.log("Both AAC/HE-AAC audio found in levels; declaring level codec as HE-AAC"),this.levels=e.levels,this.startFragRequested=!1}onLevelLoading(t,e){const{levels:r}=this;if(!r||this.state!==vw)return;const n=e.levelInfo;(!n.details||n.details.live&&(this.levelLastLoaded!==n||n.details.expired)||this.waitForCdnTuneIn(n.details))&&(this.state=Iw)}onLevelLoaded(t,e){var r;const{levels:n,startFragRequested:i}=this,s=e.level,a=e.details,o=a.totalduration;if(!n)return void this.warn("Levels were reset while loading level ".concat(s));this.log("Level ".concat(s," loaded [").concat(a.startSN,",").concat(a.endSN,"]").concat(a.lastPartSn?"[part-".concat(a.lastPartSn,"-").concat(a.lastPartIndex,"]"):"",", cc [").concat(a.startCC,", ").concat(a.endCC,"] duration:").concat(o));const l=e.levelInfo,c=this.fragCurrent;!c||this.state!==_w&&this.state!==ww||c.level!==e.level&&c.loader&&this.abortCurrentFrag();let u=0;if(a.live||null!=(r=l.details)&&r.live){var h;if(this.checkLiveUpdate(a),a.deltaUpdateFailed)return;u=this.alignPlaylists(a,l.details,null==(h=this.levelLastLoaded)?void 0:h.details)}if(l.details=a,this.levelLastLoaded=l,i||this.setStartPosition(a,u),this.hls.trigger(ly.LEVEL_UPDATED,{details:a,level:s}),this.state===Iw){if(this.waitForCdnTuneIn(a))return;this.state=vw}i&&a.live&&this.synchronizeToLiveEdge(a),this.tick()}synchronizeToLiveEdge(t){const{config:e,media:r}=this;if(!r)return;const n=this.hls.liveSyncPosition,i=this.getLoadPosition(),s=t.fragmentStart,a=t.edge,o=i>=s-e.maxFragLookUpTolerance&&i<=a;if(null!==n&&r.duration>n&&(i<n||!o)){const s=void 0!==e.liveMaxLatencyDuration?e.liveMaxLatencyDuration:e.liveMaxLatencyDurationCount*t.targetduration;if((!o&&r.readyState<4||i<a-s)&&(this._hasEnoughToStart||(this.nextLoadPosition=n),r.readyState))if(this.warn("Playback: ".concat(i.toFixed(3)," is located too far from the end of live sliding playlist: ").concat(a,", reset currentTime to : ").concat(n.toFixed(3))),"buffered"===this.config.liveSyncMode){var l;const t=$b.bufferInfo(r,n,0);if(null==(l=t.buffered)||!l.length)return void(r.currentTime=n);if(t.start<=i)return void(r.currentTime=n);const{nextStart:e}=$b.bufferedInfo(t.buffered,i,0);e&&(r.currentTime=e)}else r.currentTime=n}}_handleFragmentLoadProgress(t){var e;const r=t.frag,{part:n,payload:i}=t,{levels:s}=this;if(!s)return void this.warn("Levels were reset while fragment load was in progress. Fragment ".concat(r.sn," of level ").concat(r.level," will not be buffered"));const a=s[r.level];if(!a)return void this.warn("Level ".concat(r.level," not found on progress"));const o=a.details;if(!o)return this.warn("Dropping fragment ".concat(r.sn," of level ").concat(r.level," after level details were reset")),void this.fragmentTracker.removeFragment(r);const l=a.videoCodec,c=o.PTSKnown||!o.live,u=null==(e=r.initSegment)?void 0:e.data,h=this._getAudioCodec(a),d=this.transmuxer=this.transmuxer||new aS(this.hls,fy,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)),f=n?n.index:-1,p=-1!==f,g=new Qb(r.level,r.sn,r.stats.chunkCount,i.byteLength,f,p),m=this.initPTS[r.cc];d.push(i,u,h,l,r,n,o.totalduration,c,g,m)}onAudioTrackSwitching(t,e){const r=this.hls,n=0!==this.altAudio;if(ab(e.url,r))this.altAudio=1;else{if(this.mediaBuffer!==this.media){this.log("Switching on main audio, use media.buffered to schedule main fragment loading"),this.mediaBuffer=this.media;const t=this.fragCurrent;t&&(this.log("Switching to main audio track, cancel main fragment load"),t.abortRequests(),this.fragmentTracker.removeFragment(t)),this.resetTransmuxer(),this.resetLoadingState()}else this.audioOnly&&this.resetTransmuxer();if(n)return this.altAudio=0,this.fragmentTracker.removeAllFragments(),r.once(ly.BUFFER_FLUSHED,()=>{this.hls&&this.hls.trigger(ly.AUDIO_TRACK_SWITCHED,e)}),void r.trigger(ly.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:null});r.trigger(ly.AUDIO_TRACK_SWITCHED,e)}}onAudioTrackSwitched(t,e){const r=ab(e.url,this.hls);if(r){const t=this.videoBuffer;t&&this.mediaBuffer!==t&&(this.log("Switching on alternate audio, use video.buffered to schedule main fragment loading"),this.mediaBuffer=t)}this.altAudio=r?2:0,this.tick()}onBufferCreated(t,e){const r=e.tracks;let n,i,s=!1;for(const a in r){const t=r[a];if("main"===t.id){if(i=a,n=t,"video"===a){const t=r[a];t&&(this.videoBuffer=t.buffer)}}else s=!0}s&&n?(this.log("Alternate track found, use ".concat(i,".buffered to schedule main fragment loading")),this.mediaBuffer=n.buffer):this.mediaBuffer=this.media}onFragBuffered(t,e){const{frag:r,part:n}=e,i=r.type===fy;if(i){if(this.fragContextChanged(r))return this.warn("Fragment ".concat(r.sn).concat(n?" p: "+n.index:""," of level ").concat(r.level," finished buffering, but was aborted. state: ").concat(this.state)),void(this.state===Tw&&(this.state=vw));const t=n?n.stats:r.stats;this.fragLastKbps=Math.round(8*t.total/(t.buffering.end-t.loading.first)),Gy(r)&&(this.fragPrevious=r),this.fragBufferedComplete(r,n)}const s=this.media;s&&(!this._hasEnoughToStart&&$b.getBuffered(s).length&&(this._hasEnoughToStart=!0,this.seekToStartPos()),i&&this.tick())}get hasEnoughToStart(){return this._hasEnoughToStart}onError(t,e){var r;if(e.fatal)this.state=Aw;else switch(e.details){case oy.FRAG_GAP:case oy.FRAG_PARSING_ERROR:case oy.FRAG_DECRYPT_ERROR:case oy.FRAG_LOAD_ERROR:case oy.FRAG_LOAD_TIMEOUT:case oy.KEY_LOAD_ERROR:case oy.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(fy,e);break;case oy.LEVEL_LOAD_ERROR:case oy.LEVEL_LOAD_TIMEOUT:case oy.LEVEL_PARSING_ERROR:e.levelRetry||this.state!==Iw||(null==(r=e.context)?void 0:r.type)!==uy||(this.state=vw);break;case oy.BUFFER_ADD_CODEC_ERROR:case oy.BUFFER_APPEND_ERROR:if("main"!==e.parent)return;this.reduceLengthAndFlushBuffer(e)&&this.resetLoadingState();break;case oy.BUFFER_FULL_ERROR:if("main"!==e.parent)return;if(this.reduceLengthAndFlushBuffer(e)){!this.config.interstitialsController&&this.config.assetPlayerId?this._hasEnoughToStart=!0:this.flushMainBuffer(0,Number.POSITIVE_INFINITY)}break;case oy.INTERNAL_EXCEPTION:this.recoverWorkerError(e)}}onFragLoadEmergencyAborted(){this.state=vw,this._hasEnoughToStart||(this.startFragRequested=!1,this.nextLoadPosition=this.lastCurrentTime),this.tickImmediate()}onBufferFlushed(t,e){let{type:r}=e;if(r!==By||!this.altAudio){const t=(r===jy?this.videoBuffer:this.mediaBuffer)||this.media;t&&(this.afterBufferFlushed(t,r,fy),this.tick())}}onLevelsUpdated(t,e){this.level>-1&&this.fragCurrent&&(this.level=this.fragCurrent.level,-1===this.level&&this.resetWhenMissingContext(this.fragCurrent)),this.levels=e.levels}swapAudioCodec(){this.audioCodecSwap=!this.audioCodecSwap}seekToStartPos(){const{media:t}=this;if(!t)return;const e=t.currentTime;let r=this.startPosition;if(r>=0&&e<r){if(t.seeking)return void this.log("could not seek to ".concat(r,", already seeking at ").concat(e));const n=this.timelineOffset;n&&r&&(r+=n);const i=this.getLevelDetails(),s=$b.getBuffered(t),a=s.length?s.start(0):0,o=a-r,l=Math.max(this.config.maxBufferHole,this.config.maxFragLookUpTolerance);(this.config.startOnSegmentBoundary||o>0&&(o<l||this.loadingParts&&o<2*((null==i?void 0:i.partTarget)||0)))&&(this.log("adjusting start position by ".concat(o," to match buffer start")),r+=o,this.startPosition=r),e<r&&(this.log("seek to target start position ".concat(r," from current time ").concat(e," buffer start ").concat(a)),t.currentTime=r)}}_getAudioCodec(t){let e=this.config.defaultAudioCodec||t.audioCodec;return this.audioCodecSwap&&e&&(this.log("Swapping audio codec"),e=-1!==e.indexOf("mp4a.40.5")?"mp4a.40.2":"mp4a.40.5"),e}_loadBitrateTestFrag(t,e){t.bitrateTest=!0,this._doFragLoad(t,e).then(t=>{const{hls:r}=this,n=null==t?void 0:t.frag;if(!n||this.fragContextChanged(n))return;e.fragmentError=0,this.state=vw,this.startFragRequested=!1,this.bitrateTest=!1;const i=n.stats;i.parsing.start=i.parsing.end=i.buffering.start=i.buffering.end=self.performance.now(),r.trigger(ly.FRAG_LOADED,t),n.bitrateTest=!1}).catch(e=>{this.state!==yw&&this.state!==Aw&&(this.warn(e),this.resetFragmentLoading(t))})}_handleTransmuxComplete(t){const e=this.playlistType,{hls:r}=this,{remuxResult:n,chunkMeta:i}=t,s=this.getCurrentContext(i);if(!s)return void this.resetWhenMissingContext(i);const{frag:a,part:o,level:l}=s,{video:c,text:u,id3:h,initSegment:d}=n,{details:f}=l,p=this.altAudio?void 0:n.audio;if(this.fragContextChanged(a))this.fragmentTracker.removeFragment(a);else{if(this.state=Sw,d){const t=d.tracks;if(t){const n=a.initSegment||a;if(this.unhandledEncryptionError(d,a))return;this._bufferInitSegment(l,t,n,i),r.trigger(ly.FRAG_PARSING_INIT_SEGMENT,{frag:n,id:e,tracks:t})}const n=d.initPTS,s=d.timescale,o=this.initPTS[a.cc];if(ny(n)&&(!o||o.baseTime!==n||o.timescale!==s)){const t=d.trackId;this.initPTS[a.cc]={baseTime:n,timescale:s,trackId:t},r.trigger(ly.INIT_PTS_FOUND,{frag:a,id:e,initPTS:n,timescale:s,trackId:t})}}if(c&&f){p&&"audiovideo"===c.type&&this.logMuxedErr(a);const t=f.fragments[a.sn-1-f.startSN],e=a.sn===f.startSN,r=!t||a.cc>t.cc;if(!1!==n.independent){const{startPTS:t,endPTS:n,startDTS:s,endDTS:l}=c;if(o)o.elementaryStreams[c.type]={startPTS:t,endPTS:n,startDTS:s,endDTS:l};else if(c.firstKeyFrame&&c.independent&&1===i.id&&!r&&(this.couldBacktrack=!0),c.dropped&&c.independent){const i=this.getMainFwdBufferInfo(),s=(i?i.end:this.getLoadPosition())+this.config.maxBufferHole,o=c.firstKeyFramePTS?c.firstKeyFramePTS:t;if(!e&&s<o-this.config.maxBufferHole&&!r)return void this.backtrack(a);r&&(a.gap=!0),a.setElementaryStreamInfo(c.type,a.start,n,a.start,l,!0)}else e&&t-(f.appliedTimelineOffset||0)>2&&(a.gap=!0);a.setElementaryStreamInfo(c.type,t,n,s,l),this.backtrackFragment&&(this.backtrackFragment=a),this.bufferFragmentData(c,a,o,i,e||r)}else{if(!e&&!r)return void this.backtrack(a);a.gap=!0}}if(p){const{startPTS:t,endPTS:e,startDTS:r,endDTS:n}=p;o&&(o.elementaryStreams[By]={startPTS:t,endPTS:e,startDTS:r,endDTS:n}),a.setElementaryStreamInfo(By,t,e,r,n),this.bufferFragmentData(p,a,o,i)}if(f&&null!=h&&h.samples.length){const t={id:e,frag:a,details:f,samples:h.samples};r.trigger(ly.FRAG_PARSING_METADATA,t)}if(f&&u){const t={id:e,frag:a,details:f,samples:u.samples};r.trigger(ly.FRAG_PARSING_USERDATA,t)}}}logMuxedErr(t){this.warn("".concat(Gy(t)?"Media":"Init"," segment with muxed audiovideo where only video expected: ").concat(t.url))}_bufferInitSegment(t,e,r,n){if(this.state!==Sw)return;this.audioOnly=!!e.audio&&!e.video,this.altAudio&&!this.audioOnly&&(delete e.audio,e.audiovideo&&this.logMuxedErr(r));const{audio:i,video:s,audiovideo:a}=e;if(i){const r=t.audioCodec;let n=Lv(i.codec,r);"mp4a"===n&&(n="mp4a.40.5");const s=navigator.userAgent.toLowerCase();if(this.audioCodecSwitch){n&&(n=-1!==n.indexOf("mp4a.40.5")?"mp4a.40.2":"mp4a.40.5");const t=i.metadata;t&&"channelCount"in t&&1!==(t.channelCount||1)&&-1===s.indexOf("firefox")&&(n="mp4a.40.5")}n&&-1!==n.indexOf("mp4a.40.5")&&-1!==s.indexOf("android")&&"audio/mpeg"!==i.container&&(n="mp4a.40.2",this.log("Android: force audio codec to ".concat(n))),r&&r!==n&&this.log('Swapping manifest audio codec "'.concat(r,'" for "').concat(n,'"')),i.levelCodec=n,i.id=fy,this.log("Init audio buffer, container:".concat(i.container,", codecs[selected/level/parsed]=[").concat(n||"","/").concat(r||"","/").concat(i.codec,"]")),delete e.audiovideo}if(s){s.levelCodec=t.videoCodec,s.id=fy;const r=s.codec;if(4===(null==r?void 0:r.length))switch(r){case"hvc1":case"hev1":s.codec="hvc1.1.6.L120.90";break;case"av01":s.codec="av01.0.04M.08";break;case"avc1":s.codec="avc1.42e01e"}this.log("Init video buffer, container:".concat(s.container,", codecs[level/parsed]=[").concat(t.videoCodec||"","/").concat(r,"]").concat(s.codec!==r?" parsed-corrected="+s.codec:"").concat(s.supplemental?" supplemental="+s.supplemental:"")),delete e.audiovideo}a&&(this.log("Init audiovideo buffer, container:".concat(a.container,", codecs[level/parsed]=[").concat(t.codecs,"/").concat(a.codec,"]")),delete e.video,delete e.audio);const o=Object.keys(e);if(o.length){if(this.hls.trigger(ly.BUFFER_CODECS,e),!this.hls)return;o.forEach(t=>{const i=e[t].initSegment;null!=i&&i.byteLength&&this.hls.trigger(ly.BUFFER_APPENDING,{type:t,data:i,frag:r,part:null,chunkMeta:n,parent:r.type})})}this.tickImmediate()}getMainFwdBufferInfo(){const t=this.mediaBuffer&&2===this.altAudio?this.mediaBuffer:this.media;return this.getFwdBufferInfo(t,fy)}get maxBufferLength(){const{levels:t,level:e}=this,r=null==t?void 0:t[e];return r?this.getMaxBufferLength(r.maxBitrate):this.config.maxBufferLength}backtrack(t){this.couldBacktrack=!0,this.backtrackFragment=t,this.resetTransmuxer(),this.flushBufferGap(t),this.fragmentTracker.removeFragment(t),this.fragPrevious=null,this.nextLoadPosition=t.start,this.state=vw}checkFragmentChanged(){const t=this.media;let e=null;if(t&&t.readyState>1&&!1===t.seeking){const r=t.currentTime;if($b.isBuffered(t,r)?e=this.getAppendedFrag(r):$b.isBuffered(t,r+.1)&&(e=this.getAppendedFrag(r+.1)),e){this.backtrackFragment=null;const t=this.fragPlaying,r=e.level;t&&e.sn===t.sn&&t.level===r||(this.fragPlaying=e,this.hls.trigger(ly.FRAG_CHANGED,{frag:e}),t&&t.level===r||this.hls.trigger(ly.LEVEL_SWITCHED,{level:r}))}}}get nextLevel(){const t=this.nextBufferedFrag;return t?t.level:-1}get currentFrag(){var t;if(this.fragPlaying)return this.fragPlaying;const e=(null==(t=this.media)?void 0:t.currentTime)||this.lastCurrentTime;return ny(e)?this.getAppendedFrag(e):null}get currentProgramDateTime(){var t;const e=(null==(t=this.media)?void 0:t.currentTime)||this.lastCurrentTime;if(ny(e)){const t=this.getLevelDetails(),r=this.currentFrag||(t?lb(null,t.fragments,e):null);if(r){const t=r.programDateTime;if(null!==t){const n=t+1e3*(e-r.start);return new Date(n)}}}return null}get currentLevel(){const t=this.currentFrag;return t?t.level:-1}get nextBufferedFrag(){const t=this.currentFrag;return t?this.followingBufferedFrag(t):null}get forceStartLoad(){return this._forceStartLoad}}class iA extends Ey{constructor(t,e){super("key-loader",e),this.config=void 0,this.keyIdToKeyInfo={},this.emeController=null,this.config=t}abort(t){for(const r in this.keyIdToKeyInfo){const n=this.keyIdToKeyInfo[r].loader;if(n){var e;if(t&&t!==(null==(e=n.context)?void 0:e.frag.type))return;n.abort()}}}detach(){for(const t in this.keyIdToKeyInfo){const e=this.keyIdToKeyInfo[t];(e.mediaKeySessionContext||e.decryptdata.isCommonEncryption)&&delete this.keyIdToKeyInfo[t]}}destroy(){this.detach();for(const t in this.keyIdToKeyInfo){const e=this.keyIdToKeyInfo[t].loader;e&&e.destroy()}this.keyIdToKeyInfo={}}createKeyLoadError(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:oy.KEY_LOAD_ERROR,r=arguments.length>2?arguments[2]:void 0,n=arguments.length>3?arguments[3]:void 0,i=arguments.length>4?arguments[4]:void 0;return new qb({type:ay.NETWORK_ERROR,details:e,fatal:!1,frag:t,response:i,error:r,networkDetails:n})}loadClear(t,e,r){if(this.emeController&&this.config.emeEnabled&&!this.emeController.getSelectedKeySystemFormats().length){if(e.length)for(let n=0,i=e.length;n<i;n++){const s=e[n];if(t.cc<=s.cc&&(!Gy(t)||!Gy(s)||t.sn<s.sn)||!r&&n==i-1)return this.emeController.selectKeySystemFormat(s).then(t=>{if(!this.emeController)return;s.setKeyFormat(t);const e=T_(t);return e?this.emeController.getKeySystemAccess([e]):void 0})}if(this.config.requireKeySystemAccessOnStart){const t=A_(this.config);if(t.length)return this.emeController.getKeySystemAccess(t)}}return null}load(t){return!t.decryptdata&&t.encrypted&&this.emeController&&this.config.emeEnabled?this.emeController.selectKeySystemFormat(t).then(e=>this.loadInternal(t,e)):this.loadInternal(t)}loadInternal(t,e){var r,n;e&&t.setKeyFormat(e);const i=t.decryptdata;if(!i){const r=new Error(e?"Expected frag.decryptdata to be defined after setting format ".concat(e):"Missing decryption data on fragment in onKeyLoading (emeEnabled with controller: ".concat(this.emeController&&this.config.emeEnabled,")"));return Promise.reject(this.createKeyLoadError(t,oy.KEY_LOAD_ERROR,r))}const s=i.uri;if(!s)return Promise.reject(this.createKeyLoadError(t,oy.KEY_LOAD_ERROR,new Error('Invalid key URI: "'.concat(s,'"'))));const a=sA(i);let o=this.keyIdToKeyInfo[a];if(null!=(r=o)&&r.decryptdata.key)return i.key=o.decryptdata.key,Promise.resolve({frag:t,keyInfo:o});if(this.emeController&&null!=(n=o)&&n.keyLoadPromise){switch(this.emeController.getKeyStatus(o.decryptdata)){case"usable":case"usable-in-future":return o.keyLoadPromise.then(e=>{const{keyInfo:r}=e;return i.key=r.decryptdata.key,{frag:t,keyInfo:r}})}}switch(this.log("".concat(this.keyIdToKeyInfo[a]?"Rel":"L","oading").concat(i.keyId?" keyId: "+Cy(i.keyId):""," URI: ").concat(i.uri," from ").concat(t.type," ").concat(t.level)),o=this.keyIdToKeyInfo[a]={decryptdata:i,keyLoadPromise:null,loader:null,mediaKeySessionContext:null},i.method){case"SAMPLE-AES":case"SAMPLE-AES-CENC":case"SAMPLE-AES-CTR":return"identity"===i.keyFormat?this.loadKeyHTTP(o,t):this.loadKeyEME(o,t);case"AES-128":case"AES-256":case"AES-256-CTR":return this.loadKeyHTTP(o,t);default:return Promise.reject(this.createKeyLoadError(t,oy.KEY_LOAD_ERROR,new Error('Key supplied with unsupported METHOD: "'.concat(i.method,'"'))))}}loadKeyEME(t,e){const r={frag:e,keyInfo:t};if(this.emeController&&this.config.emeEnabled){var n;if(!t.decryptdata.keyId&&null!=(n=e.initSegment)&&n.data){const r=function(t){const e=[];return cv(t,t=>e.push(t.subarray(8,24))),e}(e.initSegment.data);if(r.length){let e=r[0];e.some(t=>0!==t)?(this.log("Using keyId found in init segment ".concat(Cy(e))),P_.setKeyIdForUri(t.decryptdata.uri,e)):(e=P_.addKeyIdForUri(t.decryptdata.uri),this.log("Generating keyId to patch media ".concat(Cy(e)))),t.decryptdata.keyId=e}}if(!t.decryptdata.keyId&&!Gy(e))return Promise.resolve(r);const i=this.emeController.loadKey(r);return(t.keyLoadPromise=i.then(e=>(t.mediaKeySessionContext=e,r))).catch(r=>{throw t.keyLoadPromise=null,"data"in r&&(r.data.frag=e),r})}return Promise.resolve(r)}loadKeyHTTP(t,e){const r=this.config,n=new(0,r.loader)(r);return e.keyLoader=t.loader=n,t.keyLoadPromise=new Promise((i,s)=>{const a={keyInfo:t,frag:e,responseType:"arraybuffer",url:t.decryptdata.uri},o=r.keyLoadPolicy.default,l={loadPolicy:o,timeout:o.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},c={onSuccess:(t,e,r,n)=>{const{frag:a,keyInfo:o}=r,l=sA(o.decryptdata);if(!a.decryptdata||o!==this.keyIdToKeyInfo[l])return s(this.createKeyLoadError(a,oy.KEY_LOAD_ERROR,new Error("after key load, decryptdata unset or changed"),n));o.decryptdata.key=a.decryptdata.key=new Uint8Array(t.data),a.keyLoader=null,o.loader=null,i({frag:a,keyInfo:o})},onError:(t,r,n,i)=>{this.resetLoader(r),s(this.createKeyLoadError(e,oy.KEY_LOAD_ERROR,new Error("HTTP Error ".concat(t.code," loading key ").concat(t.text)),n,wy({url:a.url,data:void 0},t)))},onTimeout:(t,r,n)=>{this.resetLoader(r),s(this.createKeyLoadError(e,oy.KEY_LOAD_TIMEOUT,new Error("key loading timed out"),n))},onAbort:(t,r,n)=>{this.resetLoader(r),s(this.createKeyLoadError(e,oy.INTERNAL_ABORTED,new Error("key loading aborted"),n))}};n.load(a,l,c)})}resetLoader(t){const{frag:e,keyInfo:r,url:n}=t,i=r.loader;e.keyLoader===i&&(e.keyLoader=null,r.loader=null);const s=sA(r.decryptdata)||n;delete this.keyIdToKeyInfo[s],i&&i.destroy()}}function sA(t){if(t.keyFormat!==w_){const e=t.keyId;if(e)return Cy(e)}return t.uri}function aA(t){const{type:e}=t;switch(e){case hy:return py;case dy:return gy;default:return fy}}function oA(t,e){let r=t.url;return void 0!==r&&0!==r.indexOf("data:")||(r=e.url),r}class lA{constructor(t){this.hls=void 0,this.loaders=Object.create(null),this.variableList=null,this.onManifestLoaded=this.checkAutostartLoad,this.hls=t,this.registerListeners()}startLoad(t){}stopLoad(){this.destroyInternalLoaders()}registerListeners(){const{hls:t}=this;t.on(ly.MANIFEST_LOADING,this.onManifestLoading,this),t.on(ly.LEVEL_LOADING,this.onLevelLoading,this),t.on(ly.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),t.on(ly.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this),t.on(ly.LEVELS_UPDATED,this.onLevelsUpdated,this)}unregisterListeners(){const{hls:t}=this;t.off(ly.MANIFEST_LOADING,this.onManifestLoading,this),t.off(ly.LEVEL_LOADING,this.onLevelLoading,this),t.off(ly.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),t.off(ly.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this),t.off(ly.LEVELS_UPDATED,this.onLevelsUpdated,this)}createInternalLoader(t){const e=this.hls.config,r=e.pLoader,n=e.loader,i=new(r||n)(e);return this.loaders[t.type]=i,i}getInternalLoader(t){return this.loaders[t.type]}resetInternalLoader(t){this.loaders[t]&&delete this.loaders[t]}destroyInternalLoaders(){for(const t in this.loaders){const e=this.loaders[t];e&&e.destroy(),this.resetInternalLoader(t)}}destroy(){this.variableList=null,this.unregisterListeners(),this.destroyInternalLoaders()}onManifestLoading(t,e){const{url:r}=e;this.variableList=null,this.load({id:null,level:0,responseType:"text",type:cy,url:r,deliveryDirectives:null,levelOrTrack:null})}onLevelLoading(t,e){const{id:r,level:n,pathwayId:i,url:s,deliveryDirectives:a,levelInfo:o}=e;this.load({id:r,level:n,pathwayId:i,responseType:"text",type:uy,url:s,deliveryDirectives:a,levelOrTrack:o})}onAudioTrackLoading(t,e){const{id:r,groupId:n,url:i,deliveryDirectives:s,track:a}=e;this.load({id:r,groupId:n,level:null,responseType:"text",type:hy,url:i,deliveryDirectives:s,levelOrTrack:a})}onSubtitleTrackLoading(t,e){const{id:r,groupId:n,url:i,deliveryDirectives:s,track:a}=e;this.load({id:r,groupId:n,level:null,responseType:"text",type:dy,url:i,deliveryDirectives:s,levelOrTrack:a})}onLevelsUpdated(t,e){const r=this.loaders[uy];if(r){const t=r.context;t&&!e.levels.some(e=>e===t.levelOrTrack)&&(r.abort(),delete this.loaders[uy])}}load(t){var e;const r=this.hls.config;let n,i=this.getInternalLoader(t);if(i){const e=this.hls.logger,r=i.context;if(r&&r.levelOrTrack===t.levelOrTrack&&(r.url===t.url||r.deliveryDirectives&&!t.deliveryDirectives))return void(r.url===t.url?e.log("[playlist-loader]: ignore ".concat(t.url," ongoing request")):e.log("[playlist-loader]: ignore ".concat(t.url," in favor of ").concat(r.url)));e.log("[playlist-loader]: aborting previous loader for type: ".concat(t.type)),i.abort()}if(n=t.type===cy?r.manifestLoadPolicy.default:by({},r.playlistLoadPolicy.default,{timeoutRetry:null,errorRetry:null}),i=this.createInternalLoader(t),ny(null==(e=t.deliveryDirectives)?void 0:e.part)){let e;if(t.type===uy&&null!==t.level?e=this.hls.levels[t.level].details:t.type===hy&&null!==t.id?e=this.hls.audioTracks[t.id].details:t.type===dy&&null!==t.id&&(e=this.hls.subtitleTracks[t.id].details),e){const t=e.partTarget,r=e.targetduration;if(t&&r){const e=1e3*Math.max(3*t,.8*r);n=by({},n,{maxTimeToFirstByteMs:Math.min(e,n.maxTimeToFirstByteMs),maxLoadTimeMs:Math.min(e,n.maxTimeToFirstByteMs)})}}}const s=n.errorRetry||n.timeoutRetry||{},a={loadPolicy:n,timeout:n.maxLoadTimeMs,maxRetry:s.maxNumRetry||0,retryDelay:s.retryDelayMs||0,maxRetryDelay:s.maxRetryDelayMs||0},o={onSuccess:(t,e,r,n)=>{const i=this.getInternalLoader(r);this.resetInternalLoader(r.type);const s=t.data;e.parsing.start=performance.now(),U_.isMediaPlaylist(s)||r.type!==cy?this.handleTrackOrLevelPlaylist(t,e,r,n||null,i):this.handleMasterPlaylist(t,e,r,n)},onError:(t,e,r,n)=>{this.handleNetworkError(e,r,!1,t,n)},onTimeout:(t,e,r)=>{this.handleNetworkError(e,r,!0,void 0,t)}};i.load(t,a,o)}checkAutostartLoad(){if(!this.hls)return;const{config:{autoStartLoad:t,startPosition:e},forceStartLoad:r}=this.hls;(t||r)&&(this.hls.logger.log("".concat(t?"auto":"force"," startLoad with configured startPosition ").concat(e)),this.hls.startLoad(e))}handleMasterPlaylist(t,e,r,n){const i=this.hls,s=t.data,a=oA(t,r),o=U_.parseMasterPlaylist(s,a);if(o.playlistParsingError)return e.parsing.end=performance.now(),void this.handleManifestParsingError(t,r,o.playlistParsingError,n,e);const{contentSteering:l,levels:c,sessionData:u,sessionKeys:h,startTimeOffset:d,variableList:f}=o;this.variableList=f,c.forEach(t=>{const{unknownCodecs:e}=t;if(e){const{preferManagedMediaSource:r}=this.hls.config;let{audioCodec:n,videoCodec:i}=t;for(let s=e.length;s--;){const a=e[s];Ev(a,"audio",r)?(t.audioCodec=n=n?"".concat(n,",").concat(a):a,_v.audio[n.substring(0,4)]=2,e.splice(s,1)):Ev(a,"video",r)&&(t.videoCodec=i=i?"".concat(i,",").concat(a):a,_v.video[i.substring(0,4)]=2,e.splice(s,1))}}});const{AUDIO:p=[],SUBTITLES:g,"CLOSED-CAPTIONS":m}=U_.parseMasterPlaylistMedia(s,a,o);if(p.length){p.some(t=>!t.url)||!c[0].audioCodec||c[0].attrs.AUDIO||(this.hls.logger.log("[playlist-loader]: audio codec signaled in quality level, but no embedded audio track signaled, create one"),p.unshift({type:"main",name:"main",groupId:"main",default:!1,autoselect:!1,forced:!1,id:-1,attrs:new s_({}),bitrate:0,url:""}))}i.trigger(ly.MANIFEST_LOADED,{levels:c,audioTracks:p,subtitles:g,captions:m,contentSteering:l,url:a,stats:e,networkDetails:n,sessionData:u,sessionKeys:h,startTimeOffset:d,variableList:f})}handleTrackOrLevelPlaylist(t,e,r,n,i){const s=this.hls,{id:a,level:o,type:l}=r,c=oA(t,r),u=ny(o)?o:ny(a)?a:0,h=aA(r),d=U_.parseLevelPlaylist(t.data,c,u,h,0,this.variableList);if(l===cy){const t={attrs:new s_({}),bitrate:0,details:d,name:"",url:c};d.requestScheduled=e.loading.start+rw(d,0),s.trigger(ly.MANIFEST_LOADED,{levels:[t],audioTracks:[],url:c,stats:e,networkDetails:n,sessionData:null,sessionKeys:null,contentSteering:null,startTimeOffset:null,variableList:null})}e.parsing.end=performance.now(),r.levelDetails=d,this.handlePlaylistLoaded(d,t,e,r,n,i)}handleManifestParsingError(t,e,r,n,i){this.hls.trigger(ly.ERROR,{type:ay.NETWORK_ERROR,details:oy.MANIFEST_PARSING_ERROR,fatal:e.type===cy,url:t.url,err:r,error:r,reason:r.message,response:t,context:e,networkDetails:n,stats:i})}handleNetworkError(t,e){let r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=arguments.length>3?arguments[3]:void 0,i=arguments.length>4?arguments[4]:void 0,s="A network ".concat(r?"timeout":"error"+(n?" (status "+n.code+")":"")," occurred while loading ").concat(t.type);t.type===uy?s+=": ".concat(t.level," id: ").concat(t.id):t.type!==hy&&t.type!==dy||(s+=" id: ".concat(t.id,' group-id: "').concat(t.groupId,'"'));const a=new Error(s);this.hls.logger.warn("[playlist-loader]: ".concat(s));let o=oy.UNKNOWN,l=!1;const c=this.getInternalLoader(t);switch(t.type){case cy:o=r?oy.MANIFEST_LOAD_TIMEOUT:oy.MANIFEST_LOAD_ERROR,l=!0;break;case uy:o=r?oy.LEVEL_LOAD_TIMEOUT:oy.LEVEL_LOAD_ERROR,l=!1;break;case hy:o=r?oy.AUDIO_TRACK_LOAD_TIMEOUT:oy.AUDIO_TRACK_LOAD_ERROR,l=!1;break;case dy:o=r?oy.SUBTITLE_TRACK_LOAD_TIMEOUT:oy.SUBTITLE_LOAD_ERROR,l=!1}c&&this.resetInternalLoader(t.type);const u={type:ay.NETWORK_ERROR,details:o,fatal:l,url:t.url,loader:c,context:t,error:a,networkDetails:e,stats:i};if(n){const r=(null==e?void 0:e.url)||t.url;u.response=wy({url:r,data:void 0},n)}this.hls.trigger(ly.ERROR,u)}handlePlaylistLoaded(t,e,r,n,i,s){const a=this.hls,{type:o,level:l,levelOrTrack:c,id:u,groupId:h,deliveryDirectives:d}=n,f=oA(e,n),p=aA(n);let g="number"===typeof n.level&&p===fy?l:void 0;const m=t.playlistParsingError;if(m){if(this.hls.logger.warn("".concat(m," ").concat(t.url)),!a.config.ignorePlaylistParsingErrors)return void a.trigger(ly.ERROR,{type:ay.NETWORK_ERROR,details:oy.LEVEL_PARSING_ERROR,fatal:!1,url:f,error:m,reason:m.message,response:e,context:n,level:g,parent:p,networkDetails:i,stats:r});t.playlistParsingError=null}if(!t.fragments.length){const s=t.playlistParsingError=new Error("No Segments found in Playlist");return void a.trigger(ly.ERROR,{type:ay.NETWORK_ERROR,details:oy.LEVEL_EMPTY_ERROR,fatal:!1,url:f,error:s,reason:s.message,response:e,context:n,level:g,parent:p,networkDetails:i,stats:r})}switch(t.live&&s&&(s.getCacheAge&&(t.ageHeader=s.getCacheAge()||0),s.getCacheAge&&!isNaN(t.ageHeader)||(t.ageHeader=0)),o){case cy:case uy:if(g)if(c){if(c!==a.levels[g]){const t=a.levels.indexOf(c);t>-1&&(g=t)}}else g=0;a.trigger(ly.LEVEL_LOADED,{details:t,levelInfo:c||a.levels[0],level:g||0,id:u||0,stats:r,networkDetails:i,deliveryDirectives:d,withoutMultiVariant:o===cy});break;case hy:a.trigger(ly.AUDIO_TRACK_LOADED,{details:t,track:c,id:u||0,groupId:h||"",stats:r,networkDetails:i,deliveryDirectives:d});break;case dy:a.trigger(ly.SUBTITLE_TRACK_LOADED,{details:t,track:c,id:u||0,groupId:h||"",stats:r,networkDetails:i,deliveryDirectives:d})}}}class cA{static get version(){return Nw}static isMSESupported(){return rA()}static isSupported(){return function(){if(!rA())return!1;const t=Ry();return"function"===typeof(null==t?void 0:t.isTypeSupported)&&(["avc1.42E01E,mp4a.40.2","av01.0.01M.08","vp09.00.50.08"].some(e=>t.isTypeSupported(Tv(e,"video")))||["mp4a.40.2","fLaC"].some(e=>t.isTypeSupported(Tv(e,"audio"))))}()}static getMediaSource(){return Ry()}static get Events(){return ly}static get MetadataSchema(){return sE}static get ErrorTypes(){return ay}static get ErrorDetails(){return oy}static get DefaultConfig(){return cA.defaultConfig?cA.defaultConfig:zk}static set DefaultConfig(t){cA.defaultConfig=t}constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.config=void 0,this.userConfig=void 0,this.logger=void 0,this.coreComponents=void 0,this.networkControllers=void 0,this._emitter=new Dw,this._autoLevelCapping=-1,this._maxHdcpLevel=null,this.abrController=void 0,this.bufferController=void 0,this.capLevelController=void 0,this.latencyController=void 0,this.levelController=void 0,this.streamController=void 0,this.audioStreamController=void 0,this.subtititleStreamController=void 0,this.audioTrackController=void 0,this.subtitleTrackController=void 0,this.interstitialsController=void 0,this.gapController=void 0,this.emeController=void 0,this.cmcdController=void 0,this._media=null,this._url=null,this._sessionId=void 0,this.triggeringException=void 0,this.started=!1;const e=this.logger=function(t,e,r){const n=ky();if("object"===typeof console&&!0===t||"object"===typeof t){const i=["debug","log","info","warn","error"];i.forEach(e=>{n[e]=Ay(e,t,r)});try{n.log('Debug logs enabled for "'.concat(e,'" in hls.js version ',"1.6.15"))}catch(vA){return ky()}i.forEach(e=>{xy[e]=Ay(e,t)})}else by(xy,n);return n}(t.debug||!1,"Hls instance",t.assetPlayerId),r=this.config=function(t,e,r){if((e.liveSyncDurationCount||e.liveMaxLatencyDurationCount)&&(e.liveSyncDuration||e.liveMaxLatencyDuration))throw new Error("Illegal hls.js config: don't mix up liveSyncDurationCount/liveMaxLatencyDurationCount and liveSyncDuration/liveMaxLatencyDuration");if(void 0!==e.liveMaxLatencyDurationCount&&(void 0===e.liveSyncDurationCount||e.liveMaxLatencyDurationCount<=e.liveSyncDurationCount))throw new Error('Illegal hls.js config: "liveMaxLatencyDurationCount" must be greater than "liveSyncDurationCount"');if(void 0!==e.liveMaxLatencyDuration&&(void 0===e.liveSyncDuration||e.liveMaxLatencyDuration<=e.liveSyncDuration))throw new Error('Illegal hls.js config: "liveMaxLatencyDuration" must be greater than "liveSyncDuration"');const n=Wk(t),i=["TimeOut","MaxRetry","RetryDelay","MaxRetryTimeout"];return["manifest","level","frag"].forEach(t=>{const s="".concat("level"===t?"playlist":t,"LoadPolicy"),a=void 0===e[s],o=[];i.forEach(r=>{const i="".concat(t,"Loading").concat(r),l=e[i];if(void 0!==l&&a){o.push(i);const t=n[s].default;switch(e[s]={default:t},r){case"TimeOut":t.maxLoadTimeMs=l,t.maxTimeToFirstByteMs=l;break;case"MaxRetry":t.errorRetry.maxNumRetry=l,t.timeoutRetry.maxNumRetry=l;break;case"RetryDelay":t.errorRetry.retryDelayMs=l,t.timeoutRetry.retryDelayMs=l;break;case"MaxRetryTimeout":t.errorRetry.maxRetryDelayMs=l,t.timeoutRetry.maxRetryDelayMs=l}}}),o.length&&r.warn('hls.js config: "'.concat(o.join('", "'),'" setting(s) are deprecated, use "').concat(s,'": ').concat(Zv(e[s])))}),wy(wy({},n),e)}(cA.DefaultConfig,t,e);this.userConfig=t,r.progressive&&Gk(r,e);const{abrController:n,bufferController:i,capLevelController:s,errorController:a,fpsController:o}=r,l=new a(this),c=this.abrController=new n(this),u=new Mb(this),h=r.interstitialsController,d=h?this.interstitialsController=new h(this,cA):null,f=this.bufferController=new i(this,u),p=this.capLevelController=new s(this),g=new o(this),m=new lA(this),y=r.contentSteeringController,v=y?new y(this):null,b=this.levelController=new Jk(this,v),_=new $k(this),w=new iA(this.config,this.logger),E=this.streamController=new nA(this,u,w),S=this.gapController=new Vk(this,u);p.setStreamController(E),g.setStreamController(E);const T=[m,b,E];d&&T.splice(1,0,d),v&&T.splice(1,0,v),this.networkControllers=T;const k=[c,f,S,p,g,_,u];this.audioTrackController=this.createController(r.audioTrackController,T);const A=r.audioStreamController;A&&T.push(this.audioStreamController=new A(this,u,w)),this.subtitleTrackController=this.createController(r.subtitleTrackController,T);const x=r.subtitleStreamController;x&&T.push(this.subtititleStreamController=new x(this,u,w)),this.createController(r.timelineController,k),w.emeController=this.emeController=this.createController(r.emeController,k),this.cmcdController=this.createController(r.cmcdController,k),this.latencyController=this.createController(Zk,k),this.coreComponents=k,T.push(l);const I=l.onErrorOut;"function"===typeof I&&this.on(ly.ERROR,I,l),this.on(ly.MANIFEST_LOADED,m.onManifestLoaded,m)}createController(t,e){if(t){const r=new t(this);return e&&e.push(r),r}return null}on(t,e){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this;this._emitter.on(t,e,r)}once(t,e){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this;this._emitter.once(t,e,r)}removeAllListeners(t){this._emitter.removeAllListeners(t)}off(t,e){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this,n=arguments.length>3?arguments[3]:void 0;this._emitter.off(t,e,r,n)}listeners(t){return this._emitter.listeners(t)}emit(t,e,r){return this._emitter.emit(t,e,r)}trigger(t,e){if(this.config.debug)return this.emit(t,t,e);try{return this.emit(t,t,e)}catch(cg){if(this.logger.error("An internal error happened while handling event "+t+'. Error message: "'+cg.message+'". Here is a stacktrace:',cg),!this.triggeringException){this.triggeringException=!0;const r=t===ly.ERROR;this.trigger(ly.ERROR,{type:ay.OTHER_ERROR,details:oy.INTERNAL_EXCEPTION,fatal:r,event:t,error:cg}),this.triggeringException=!1}}return!1}listenerCount(t){return this._emitter.listenerCount(t)}destroy(){this.logger.log("destroy"),this.trigger(ly.DESTROYING,void 0),this.detachMedia(),this.removeAllListeners(),this._autoLevelCapping=-1,this._url=null,this.networkControllers.forEach(t=>t.destroy()),this.networkControllers.length=0,this.coreComponents.forEach(t=>t.destroy()),this.coreComponents.length=0;const t=this.config;t.xhrSetup=t.fetchSetup=void 0,this.userConfig=null}attachMedia(t){if(!t||"media"in t&&!t.media){const e=new Error("attachMedia failed: invalid argument (".concat(t,")"));return void this.trigger(ly.ERROR,{type:ay.OTHER_ERROR,details:oy.ATTACH_MEDIA_ERROR,fatal:!0,error:e})}this.logger.log("attachMedia"),this._media&&(this.logger.warn("media must be detached before attaching"),this.detachMedia());const e="media"in t,r=e?t.media:t,n=e?t:{media:r};this._media=r,this.trigger(ly.MEDIA_ATTACHING,n)}detachMedia(){this.logger.log("detachMedia"),this.trigger(ly.MEDIA_DETACHING,{}),this._media=null}transferMedia(){this._media=null;const t=this.bufferController.transferMedia();return this.trigger(ly.MEDIA_DETACHING,{transferMedia:t}),t}loadSource(t){this.stopLoad();const e=this.media,r=this._url,n=this._url=Fy.buildAbsoluteURL(self.location.href,t,{alwaysNormalize:!0});this._autoLevelCapping=-1,this._maxHdcpLevel=null,this.logger.log("loadSource:".concat(n)),e&&r&&(r!==n||this.bufferController.hasSourceTypes())&&(this.detachMedia(),this.attachMedia(e)),this.trigger(ly.MANIFEST_LOADING,{url:t})}get url(){return this._url}get hasEnoughToStart(){return this.streamController.hasEnoughToStart}get startPosition(){return this.streamController.startPositionValue}startLoad(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1,e=arguments.length>1?arguments[1]:void 0;this.logger.log("startLoad(".concat(t+(e?", <skip seek to start>":""),")")),this.started=!0,this.resumeBuffering();for(let r=0;r<this.networkControllers.length&&(this.networkControllers[r].startLoad(t,e),this.started&&this.networkControllers);r++);}stopLoad(){this.logger.log("stopLoad"),this.started=!1;for(let t=0;t<this.networkControllers.length&&(this.networkControllers[t].stopLoad(),!this.started&&this.networkControllers);t++);}get loadingEnabled(){return this.started}get bufferingEnabled(){return this.streamController.bufferingEnabled}resumeBuffering(){this.bufferingEnabled||(this.logger.log("resume buffering"),this.networkControllers.forEach(t=>{t.resumeBuffering&&t.resumeBuffering()}))}pauseBuffering(){this.bufferingEnabled&&(this.logger.log("pause buffering"),this.networkControllers.forEach(t=>{t.pauseBuffering&&t.pauseBuffering()}))}get inFlightFragments(){const t={[fy]:this.streamController.inFlightFrag};return this.audioStreamController&&(t[py]=this.audioStreamController.inFlightFrag),this.subtititleStreamController&&(t[gy]=this.subtititleStreamController.inFlightFrag),t}swapAudioCodec(){this.logger.log("swapAudioCodec"),this.streamController.swapAudioCodec()}recoverMediaError(){this.logger.log("recoverMediaError");const t=this._media,e=null==t?void 0:t.currentTime;this.detachMedia(),t&&(this.attachMedia(t),e&&this.startLoad(e))}removeLevel(t){this.levelController.removeLevel(t)}get sessionId(){let t=this._sessionId;return t||(t=this._sessionId=function(){try{return crypto.randomUUID()}catch(cg){try{const t=URL.createObjectURL(new Blob),e=t.toString();return URL.revokeObjectURL(t),e.slice(e.lastIndexOf("/")+1)}catch(cg){let e=(new Date).getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,t=>{const r=(e+16*Math.random())%16|0;return e=Math.floor(e/16),("x"==t?r:3&r|8).toString(16)})}}}()),t}get levels(){const t=this.levelController.levels;return t||[]}get latestLevelDetails(){return this.streamController.getLevelDetails()||null}get loadLevelObj(){return this.levelController.loadLevelObj}get currentLevel(){return this.streamController.currentLevel}set currentLevel(t){this.logger.log("set currentLevel:".concat(t)),this.levelController.manualLevel=t,this.streamController.immediateLevelSwitch()}get nextLevel(){return this.streamController.nextLevel}set nextLevel(t){this.logger.log("set nextLevel:".concat(t)),this.levelController.manualLevel=t,this.streamController.nextLevelSwitch()}get loadLevel(){return this.levelController.level}set loadLevel(t){this.logger.log("set loadLevel:".concat(t)),this.levelController.manualLevel=t}get nextLoadLevel(){return this.levelController.nextLoadLevel}set nextLoadLevel(t){this.levelController.nextLoadLevel=t}get firstLevel(){return Math.max(this.levelController.firstLevel,this.minAutoLevel)}set firstLevel(t){this.logger.log("set firstLevel:".concat(t)),this.levelController.firstLevel=t}get startLevel(){const t=this.levelController.startLevel;return-1===t&&this.abrController.forcedAutoLevel>-1?this.abrController.forcedAutoLevel:t}set startLevel(t){this.logger.log("set startLevel:".concat(t)),-1!==t&&(t=Math.max(t,this.minAutoLevel)),this.levelController.startLevel=t}get capLevelToPlayerSize(){return this.config.capLevelToPlayerSize}set capLevelToPlayerSize(t){const e=!!t;e!==this.config.capLevelToPlayerSize&&(e?this.capLevelController.startCapping():(this.capLevelController.stopCapping(),this.autoLevelCapping=-1,this.streamController.nextLevelSwitch()),this.config.capLevelToPlayerSize=e)}get autoLevelCapping(){return this._autoLevelCapping}get bandwidthEstimate(){const{bwEstimator:t}=this.abrController;return t?t.getEstimate():NaN}set bandwidthEstimate(t){this.abrController.resetEstimator(t)}get abrEwmaDefaultEstimate(){const{bwEstimator:t}=this.abrController;return t?t.defaultEstimate:NaN}get ttfbEstimate(){const{bwEstimator:t}=this.abrController;return t?t.getEstimateTTFB():NaN}set autoLevelCapping(t){this._autoLevelCapping!==t&&(this.logger.log("set autoLevelCapping:".concat(t)),this._autoLevelCapping=t,this.levelController.checkMaxAutoUpdated())}get maxHdcpLevel(){return this._maxHdcpLevel}set maxHdcpLevel(t){(function(t){return Wv.indexOf(t)>-1})(t)&&this._maxHdcpLevel!==t&&(this._maxHdcpLevel=t,this.levelController.checkMaxAutoUpdated())}get autoLevelEnabled(){return-1===this.levelController.manualLevel}get manualLevel(){return this.levelController.manualLevel}get minAutoLevel(){const{levels:t,config:{minAutoBitrate:e}}=this;if(!t)return 0;const r=t.length;for(let n=0;n<r;n++)if(t[n].maxBitrate>=e)return n;return 0}get maxAutoLevel(){const{levels:t,autoLevelCapping:e,maxHdcpLevel:r}=this;let n;if(n=-1===e&&null!=t&&t.length?t.length-1:e,r)for(let i=n;i--;){const e=t[i].attrs["HDCP-LEVEL"];if(e&&e<=r)return i}return n}get firstAutoLevel(){return this.abrController.firstAutoLevel}get nextAutoLevel(){return this.abrController.nextAutoLevel}set nextAutoLevel(t){this.abrController.nextAutoLevel=t}get playingDate(){return this.streamController.currentProgramDateTime}get mainForwardBufferInfo(){return this.streamController.getMainFwdBufferInfo()}get maxBufferLength(){return this.streamController.maxBufferLength}setAudioOption(t){var e;return(null==(e=this.audioTrackController)?void 0:e.setAudioOption(t))||null}setSubtitleOption(t){var e;return(null==(e=this.subtitleTrackController)?void 0:e.setSubtitleOption(t))||null}get allAudioTracks(){const t=this.audioTrackController;return t?t.allAudioTracks:[]}get audioTracks(){const t=this.audioTrackController;return t?t.audioTracks:[]}get audioTrack(){const t=this.audioTrackController;return t?t.audioTrack:-1}set audioTrack(t){const e=this.audioTrackController;e&&(e.audioTrack=t)}get allSubtitleTracks(){const t=this.subtitleTrackController;return t?t.allSubtitleTracks:[]}get subtitleTracks(){const t=this.subtitleTrackController;return t?t.subtitleTracks:[]}get subtitleTrack(){const t=this.subtitleTrackController;return t?t.subtitleTrack:-1}get media(){return this._media}set subtitleTrack(t){const e=this.subtitleTrackController;e&&(e.subtitleTrack=t)}get subtitleDisplay(){const t=this.subtitleTrackController;return!!t&&t.subtitleDisplay}set subtitleDisplay(t){const e=this.subtitleTrackController;e&&(e.subtitleDisplay=t)}get lowLatencyMode(){return this.config.lowLatencyMode}set lowLatencyMode(t){this.config.lowLatencyMode=t}get liveSyncPosition(){return this.latencyController.liveSyncPosition}get latency(){return this.latencyController.latency}get maxLatency(){return this.latencyController.maxLatency}get targetLatency(){return this.latencyController.targetLatency}set targetLatency(t){this.latencyController.targetLatency=t}get drift(){return this.latencyController.drift}get forceStartLoad(){return this.streamController.forceStartLoad}get pathways(){return this.levelController.pathways}get pathwayPriority(){return this.levelController.pathwayPriority}set pathwayPriority(t){this.levelController.pathwayPriority=t}get bufferedToEnd(){var t;return!(null==(t=this.bufferController)||!t.bufferedToEnd)}get interstitialsManager(){var t;return(null==(t=this.interstitialsController)?void 0:t.interstitialsManager)||null}getMediaDecodingInfo(t){return Bv(t,tb(arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.allAudioTracks),navigator.mediaCapabilities)}}cA.defaultConfig=void 0;class uA extends t.Component{constructor(e){super(e),this.reloadComponent=async()=>{this.hls&&(this.hls.destroy(),this.hls=null);const t=this.videoRef.current;t&&(t.pause(),t.removeAttribute("src"),t.load()),this.setState({error:!1,initialized:!1});const e="https://hls_bot1_camera.jampenglab.tw/bot1/frontCam/index.m3u8";try{await fetch(e,{method:"HEAD"}),this.initHLS(e)}catch(r){this.setState({error:!0})}},this.initHLS=t=>{const e=this.videoRef.current;if(!e)return;if(/iPad|iPhone|iPod/.test(navigator.userAgent)&&e.canPlayType("application/vnd.apple.mpegurl"))return e.setAttribute("playsInline",""),e.setAttribute("webkit-playsinline","true"),e.setAttribute("x-webkit-airplay","allow"),e.setAttribute("disableRemotePlayback",""),e.src=t,e.addEventListener("waiting",()=>{e.play().catch(()=>{})}),e.addEventListener("pause",()=>{e.ended||e.play().catch(()=>{})}),e.play().catch(()=>{}),void this.setState({initialized:!0});const r=new cA({enableWorker:!0,lowLatencyMode:!0});this.hls=r,r.attachMedia(e),r.on(cA.Events.MEDIA_ATTACHED,()=>{r.loadSource(t)}),r.on(cA.Events.MANIFEST_PARSED,()=>{this.setState({initialized:!0}),e.play().catch(()=>{})}),r.on(cA.Events.ERROR,(t,e)=>{e.fatal&&this.setState({error:!0})})},this.videoRef=(0,t.createRef)(),this.hls=null,this.state={reloadKey:0,error:!1,initialized:!1}}componentDidMount(){setTimeout(()=>{this.reloadComponent()},0)}componentDidUpdate(t){"idle"===t.currentMode&&"idle"!==this.props.currentMode&&setTimeout(()=>{this.reloadComponent()},200)}componentWillUnmount(){this.hls&&this.hls.destroy()}render(){const{currentMode:t}=this.props,{error:e}=this.state,r="idle"===t;return(0,Me.jsxs)("div",{className:"rtsp-camera-container",children:[!r&&(0,Me.jsx)("div",{className:"rtsp-btn-group",children:(0,Me.jsx)("button",{className:"rtsp-btn-reload",onClick:this.reloadComponent,children:"\u5f71\u50cf\u9023\u7dda"})}),(0,Me.jsx)("video",{ref:this.videoRef,controls:!1,autoPlay:!0,muted:!0,playsInline:!0,"webkit-playsinline":"true","x-webkit-airplay":"allow",disableRemotePlayback:!0,className:"rtsp-video",style:{opacity:r?0:1}},this.state.reloadKey),r&&(0,Me.jsx)("div",{className:"rtsp-overlay",children:"\u7b49\u5f85\u9023\u7dda\u4e2d ..."}),!r&&e&&(0,Me.jsx)("div",{className:"rtsp-overlay rtsp-error",children:"\u5f71\u50cf\u5c1a\u672a\u9023\u7dda"})]})}}const hA=uA;class dA extends t.Component{constructor(e){var r;super(e),r=this,this.addToast=function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"success",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:5e3;const i=r.toastId++;r.setState(r=>({toasts:[...r.toasts,{id:i,message:t,type:e,duration:n}]}))},this.showLoading=function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5e3,n=arguments.length>2?arguments[2]:void 0;r.setState({loading:!0,loadingMessage:t},()=>{setTimeout(()=>{r.setState({loading:!1}),n&&n()},e)})},this.handleModeChange=t=>{this.setState({currentMode:t}),hu.connected||hu.connect()},this.toggleSidebar=()=>{this.setState(t=>{const e=!t.isSidebarOpen;return localStorage.setItem("rightSidebarOpen",e),{isSidebarOpen:e}})},this.handleSetGoalMode=()=>{if(this.mapRef.current){const t=!this.state.goalMode;this.mapRef.current.setGoalMode(t),this.setState({goalMode:t})}},this.handleGoalSelected=t=>{this.setState({goalMode:!1})},this.startDrag=t=>{t.preventDefault(),this.dragStartY=t.touches?t.touches[0].clientY:t.clientY,this.setState({dragging:!0}),document.addEventListener("mousemove",this.onDrag),document.addEventListener("touchmove",this.onDrag),document.addEventListener("mouseup",this.endDrag),document.addEventListener("touchend",this.endDrag)},this.onDrag=t=>{if(!this.state.dragging)return;const e=t.touches?t.touches[0].clientY:t.clientY,r=this.dragStartY-e;this.setState({dragDelta:Math.max(r,0)})},this.endDrag=()=>{document.removeEventListener("mousemove",this.onDrag),document.removeEventListener("touchmove",this.onDrag),document.removeEventListener("mouseup",this.endDrag),document.removeEventListener("touchend",this.endDrag),this.state.dragDelta>50?this.setState({mobileControlOpen:!0}):this.setState({mobileControlOpen:!1}),this.setState({dragging:!1,dragDelta:0})},this.mapRef=(0,t.createRef)();const n="true"===localStorage.getItem("rightSidebarOpen");this.state={goalMode:!1,isSidebarOpen:n,isSlamming:!1,currentMode:"idle",loading:!1,loadingMessage:"",toasts:[]},this.toastId=0}async componentDidMount(){const t=await sr.getStatus();this.setState({currentMode:t.mode}),t.running}render(){const{goalMode:t,isSidebarOpen:e}=this.state;return(0,Me.jsxs)("div",{className:"pt-3",children:[(0,Me.jsx)(yu,{toasts:this.state.toasts}),(0,Me.jsx)("div",{className:"power-area",children:(0,Me.jsx)(Zm,{simulate:!0})}),this.state.loading&&(0,Me.jsx)(fu,{message:this.state.loadingMessage,duration:5e3}),(0,Me.jsxs)("div",{className:"right-sidebar ".concat(e?"open":"collapsed"),children:[(0,Me.jsx)("div",{className:"right-sidebar-header",children:(0,Me.jsx)("span",{className:"execution-mode-label",onClick:this.toggleSidebar,children:"\u555f\u52d5\u6a21\u5f0f"})}),e&&(0,Me.jsx)("div",{className:"right-sidebar-content",children:(0,Me.jsx)(mh,{onModeChange:this.handleModeChange,onCloseSidebar:()=>this.setState({isSidebarOpen:!1}),isSlamming:this.state.isSlamming,setSlamming:t=>this.setState({isSlamming:t}),currentMode:this.state.currentMode,addToast:this.addToast,showLoading:this.showLoading})})]}),(0,Me.jsxs)("div",{className:"section-header main-font",children:[(0,Me.jsx)("div",{className:"map-panel",children:(0,Me.jsxs)("div",{className:"main-border map-card",children:[(0,Me.jsx)("div",{className:"map-option",children:(0,Me.jsx)(rr,{className:"single-nav-btn py-0 ".concat(t?"single-nav-btn-active":""),onClick:this.handleSetGoalMode,children:t?"\u53d6\u6d88\u9078\u53d6":"\u9078\u53d6\u5c0e\u822a\u9ede"})}),(0,Me.jsx)("div",{className:"map-box",children:(0,Me.jsx)(Bp,{ref:this.mapRef,currentMode:this.state.currentMode,onGoalSelected:this.handleGoalSelected})}),(0,Me.jsx)("div",{className:"second-border robotState-box desktop-only",children:(0,Me.jsx)(qm,{})})]})}),(0,Me.jsx)("div",{className:"camera-panel",children:(0,Me.jsxs)("div",{className:"main-border camera-card",children:[(0,Me.jsx)(hA,{currentMode:this.state.currentMode}),(0,Me.jsxs)("div",{className:"second-border control-box desktop-only",children:[(0,Me.jsx)("div",{children:(0,Me.jsx)(ty,{})}),(0,Me.jsx)("div",{children:(0,Me.jsx)(ry,{})}),(0,Me.jsx)("div",{children:(0,Me.jsx)(Xm,{})})]})]})}),(0,Me.jsx)("div",{className:"mobile-panel",children:(0,Me.jsxs)("div",{className:"mobile-main-area",children:[(0,Me.jsxs)("div",{className:"mobile-control-toggle",onMouseDown:this.startDrag,onTouchStart:this.startDrag,onClick:()=>this.setState(t=>({mobileControlOpen:!t.mobileControlOpen})),children:[(0,Me.jsx)("div",{className:"handle-line"}),(0,Me.jsx)("div",{className:"handle-line"}),(0,Me.jsx)("div",{className:"handle-line"})]}),(0,Me.jsxs)("div",{className:"mobile-control-area ".concat(this.state.mobileControlOpen?"expanded":"collapsed"),children:[(0,Me.jsx)("div",{children:(0,Me.jsx)(ty,{})}),(0,Me.jsx)("div",{children:(0,Me.jsx)(ry,{})}),(0,Me.jsx)("div",{children:(0,Me.jsx)(Xm,{})})]})]})})]})]})}}const fA=dA;class pA extends t.Component{render(){return(0,Me.jsx)(qe,{fluid:!0,children:(0,Me.jsxs)(Ht,{children:[(0,Me.jsx)(Gt,{path:"/",element:(0,Me.jsx)(Xe,{})}),(0,Me.jsx)(Gt,{path:"/panel",element:(0,Me.jsx)(Ye,{children:(0,Me.jsx)(fA,{})})})]})})}}const gA=pA;const mA=function(){return(0,Me.jsx)(Te,{children:(0,Me.jsxs)("div",{className:"app-container",children:[(0,Me.jsx)(Ne,{}),(0,Me.jsx)(gA,{})]})})},yA=t=>{t&&t instanceof Function&&r.e(453).then(r.bind(r,453)).then(e=>{let{getCLS:r,getFID:n,getFCP:i,getLCP:s,getTTFB:a}=e;r(t),n(t),i(t),s(t),a(t)})};n.createRoot(document.getElementById("root")).render((0,Me.jsx)(t.StrictMode,{children:(0,Me.jsx)(mA,{})})),yA()})()})();
//# sourceMappingURL=main.e2a1011b.js.map